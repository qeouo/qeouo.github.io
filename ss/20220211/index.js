/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../lib/engine/assetmanager.js":
/*!*************************************!*\
  !*** ../lib/engine/assetmanager.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _o3o_o3o_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./o3o/o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/ono3d.js */ \"../lib/lib/ono3d.js\");\n\n\n\nvar AssetManager = function () {\n  var AssetManager = {};\n  var ret = AssetManager;\n  var ono3d;\n  ret.assetList = [];\n\n  ret.texture = function (path, func) {\n    if (!this.assetList[path]) {\n      this.assetList[path] = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadTexture(path + \"?\" + globalParam.version, func);\n    }\n\n    return this.assetList[path];\n  };\n\n  ret.bumpTexture = function (path, func) {\n    if (!this.assetList[path]) {\n      this.assetList[path] = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadBumpTexture(path + \"?\" + globalParam.version, func);\n    }\n\n    return this.assetList[path];\n  };\n\n  ret.o3o = function (path, func) {\n    var _this = this;\n\n    if (!this.assetList[path]) {\n      this.assetList[path] = {\n        data: null,\n        status: \"\"\n      };\n      var _path = path;\n      var _func = func;\n      this.assetList[path].data = _o3o_o3o_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].load(path + \"?\" + globalParam.version, function (e) {\n        if (!e) {\n          _this.assetList[path].status = \"failed\";\n        } else {\n          _this.assetList[path].status = \"loaded\";\n        }\n\n        if (_func) {\n          _func(e);\n        }\n      });\n      this.assetList[path].status = \"loading\";\n    }\n\n    return this.assetList[path].data;\n  };\n\n  ret.getStatus = function (path) {\n    var asset = this.assetList[path];\n\n    if (!asset) {\n      return \"noload\";\n    }\n\n    return asset.status;\n  };\n\n  return ret;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (AssetManager);\n\n//# sourceURL=webpack://bc/../lib/engine/assetmanager.js?");

/***/ }),

/***/ "../lib/engine/camera.js":
/*!*******************************!*\
  !*** ../lib/engine/camera.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Camera; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/collider/collider.js */ \"../lib/lib/collider/collider.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\nvar scope = [[-1, -1, -1], [-1, 1, -1], [1, 1, -1], [1, -1, -1], [-1, -1, 1], [-1, 1, 1], [1, 1, 1], [1, -1, 1]]; //カメラ\n\nvar Camera = /*#__PURE__*/function () {\n  function Camera() {\n    _classCallCheck(this, Camera);\n\n    this.p = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.a = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.aov = 0.577;\n    this.znear = 1;\n    this.zfar = 10;\n    this.cameracol = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].ConvexHull();\n    this.cameracol2 = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].ConvexHull();\n\n    for (var i = 0; i < 8; i++) {\n      this.cameracol.poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n      this.cameracol2.poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n    }\n\n    this.pvMatrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44();\n    this.matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n  }\n\n  _createClass(Camera, [{\n    key: \"calcCollision2\",\n    value: function calcCollision2(collision, matrix, z_near, z_far) {\n      var v4 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n\n      for (var i = 0; i < 8; i++) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v4, scope[i]);\n        v4[3] = 1;\n\n        if (v4[2] < 0) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.mul(v4, v4, z_near);\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.mul(v4, v4, z_far);\n        }\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.dotVec4(v4, matrix, v4);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(collision.poses[i], v4);\n      }\n\n      collision.refresh();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n    }\n  }, {\n    key: \"calcCollision\",\n    value: function calcCollision(collision, matrix) {\n      var im = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.poolAlloc();\n      var v4 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n\n      if (!matrix) {\n        //Mat44.dot(im,ono3d.projectionMatrix,ono3d.viewMatrix);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.getInv(im, this.pvMatrix);\n      } else {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.getInv(im, matrix);\n      }\n\n      for (var i = 0; i < 8; i++) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v4, scope[i]);\n        v4[3] = 1;\n\n        if (!matrix) {\n          if (v4[2] < 0) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.mul(v4, v4, this.znear);\n          } else {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.mul(v4, v4, this.zfar);\n          }\n        }\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.dotVec4(v4, im, v4);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(collision.poses[i], v4);\n      }\n\n      collision.refresh();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat44.poolFree(1);\n    }\n  }]);\n\n  return Camera;\n}();\n\n\n\nCamera.homing = function (angle, target, camera) {\n  var dx = target[0] - camera[0];\n  var dy = target[1] - camera[1];\n  var dz = target[2] - camera[2];\n  angle[0] = Math.atan2(dy, Math.sqrt(dz * dz + dx * dx));\n  angle[1] = Math.atan2(dx, dz);\n  angle[2] = 0;\n};\n\n//# sourceURL=webpack://bc/../lib/engine/camera.js?");

/***/ }),

/***/ "../lib/engine/engine.js":
/*!*******************************!*\
  !*** ../lib/engine/engine.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Engine; }\n/* harmony export */ });\n/* harmony import */ var _lib_spherical_harmonics_sh_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/spherical_harmonics/sh.js */ \"../lib/lib/spherical_harmonics/sh.js\");\n/* harmony import */ var _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/rastgl.js */ \"../lib/lib/rastgl.js\");\n/* harmony import */ var _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/ono3d.js */ \"../lib/lib/ono3d.js\");\n/* harmony import */ var _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/onophy/onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _lib_bsp_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/bsp.js */ \"../lib/lib/bsp.js\");\n/* harmony import */ var _lib_delaunay_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../lib/delaunay.js */ \"../lib/lib/delaunay.js\");\n/* harmony import */ var _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../lib/collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _assetmanager_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./assetmanager.js */ \"../lib/engine/assetmanager.js\");\n/* harmony import */ var _o3o_o3o_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./o3o/o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../lib/util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _camera_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./camera.js */ \"../lib/engine/camera.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _obj_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./obj.js */ \"../lib/engine/obj.js\");\n/* harmony import */ var _objman_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./objman.js */ \"../lib/engine/objman.js\");\n/* harmony import */ var _lib_aabb_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../lib/aabb.js */ \"../lib/lib/aabb.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classPrivateMethodInitSpec(obj, privateSet) { _checkPrivateRedeclaration(obj, privateSet); privateSet.add(obj); }\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classPrivateMethodGet(receiver, privateSet, fn) { if (!privateSet.has(receiver)) { throw new TypeError(\"attempted to get private field on non-instance\"); } return fn; }\n\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\n\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\"); _classApplyDescriptorSet(receiver, descriptor, value); return value; }\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) { if (descriptor.set) { descriptor.set.call(receiver, value); } else { if (!descriptor.writable) { throw new TypeError(\"attempted to set read only private field\"); } descriptor.value = value; } }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar ono3d;\n\nvar _drawFlg = /*#__PURE__*/new WeakMap();\n\nvar _animationFunc = /*#__PURE__*/new WeakSet();\n\nvar Engine = /*#__PURE__*/function () {\n  function Engine() {\n    _classCallCheck(this, Engine);\n\n    _classPrivateMethodInitSpec(this, _animationFunc);\n\n    _classPrivateFieldInitSpec(this, _drawFlg, {\n      writable: true,\n      value: false\n    });\n\n    this.camera = new _camera_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"]();\n    this.objMan = new _objman_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"]();\n    this.stereomode = 0;\n    this.fps = 30;\n    this.step = 1;\n    this.physics = 1; //カメラ露光\n\n    this.autoExposure = 1;\n    this.exposure_level = 0.5;\n    this.exposure_upper = 1;\n    this.exposure_bloom = 0.1;\n    this.custom_material = null;\n    window.engine = this;\n  }\n\n  _createClass(Engine, [{\n    key: \"init\",\n    value: function init(parentnode, WIDTH, HEIGHT) {\n      var _this = this;\n\n      this.WIDTH = WIDTH;\n      this.HEIGHT = HEIGHT;\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = WIDTH;\n      canvas.height = HEIGHT;\n      parentnode.appendChild(canvas);\n      var canvasgl = document.getElementById(\"maincanvas\");\n\n      if (!canvasgl) {\n        canvasgl = document.createElement(\"canvas\");\n        canvasgl.width = WIDTH;\n        canvasgl.height = HEIGHT;\n        parentnode.appendChild(canvasgl);\n      } else {\n        canvasgl.width = WIDTH;\n        canvasgl.height = HEIGHT;\n        this.WIDTH = canvasgl.width;\n        this.HEIGHT = canvasgl.height;\n        WIDTH = this.WIDTH;\n        HEIGHT = this.HEIGHT;\n      }\n\n      var ctx = canvas.getContext(\"2d\");\n      gl = canvasgl.getContext('webgl') || canvasgl.getContext('experimental-webgl');\n      this.gl = gl;\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].enableVirtualPad = true;\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].init(canvas, canvasgl, parentnode);\n\n      if (gl) {\n        this.enableGL = true;\n      } else {\n        this.enableGL = false;\n      }\n\n      globalParam.gl = gl;\n\n      if (this.enableGL) {\n        _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].init(gl);\n        canvas.style.width = \"0px\";\n        canvasgl.style.display = \"inline\";\n      } else {\n        canvasgl.style.display = \"none\";\n        canvas.style.display = \"inline\";\n      }\n\n      ono3d = new _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n      this.ono3d = ono3d;\n      bufTexture = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(1024, 1024);\n      gl.bindTexture(gl.TEXTURE_2D, bufTexture.glTexture);\n      this.bufTexture = bufTexture;\n      tex512 = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(512, 512);\n      tex128 = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(128, 128);\n      averageTexture = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(512, 512); //物理エンジン\n\n      onoPhy = new _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]();\n      this.onoPhy = onoPhy;\n      this.collider = onoPhy.collider;\n      sigmaShader = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].loadShader(\"./lib/spherical_harmonics/sigma.shader\");\n      shadow_gauss_shader = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].loadShader(\"./engine/gauss_shadow.shader\");\n      Engine.basecolorShader = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].loadShader(\"./lib/shader/basecolor.shader\");\n\n      for (var i = 0; i < 9; i++) {\n        shShader.push(_lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].loadShader(\"./lib/spherical_harmonics/sh\" + i + \".shader\"));\n      }\n\n      _o3o_o3o_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].setOno3d(ono3d);\n      ono3d.init(canvas, ctx);\n      ono3d.rendercanvas = canvas;\n      var measures = [\"mainloop\", \"physics\", \"aabb\", \"collision\", \"impulse\", \"draw\", \"drawGeometry\", \"drawRasterise\"];\n      this.process_times = {};\n      this.process_times[\"fps\"] = 0;\n      measures.forEach(function (e) {\n        _this.process_times[e] = 0;\n      });\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].setFps(this.fps, function () {\n        _this.mainloop();\n      });\n\n      var www = function www() {\n        if (_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].getLoadingCount() === 0) {\n          //初期ロード完了して初期化していない場合は実行\n          _this.start();\n\n          _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].fpsman.mainloop();\n        } else {\n          setTimeout(function () {\n            www();\n          }, 1000);\n        }\n      };\n\n      www();\n    }\n  }, {\n    key: \"getSightPos\",\n    value: function getSightPos(near_pos, far_pos) {\n      //視線とニアファークリップ面との交点を求める\n      var mat44 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44();\n      var p1 = far_pos;\n      var p0 = near_pos;\n      var camera = this.camera;\n      var ono3d = this.ono3d;\n      p1[0] = _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].cursorX / this.WIDTH * 2 - 1;\n      p1[1] = -(_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].cursorY / this.HEIGHT * 2 - 1);\n      p1[2] = 1;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.getInv(mat44, camera.pvMatrix);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(p0, p1[0], p1[1], -1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.dotVec3(p0, mat44, p0);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.mul(p0, p0, ono3d.znear);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.dotVec3(p1, mat44, p1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.mul(p1, p1, ono3d.zfar);\n    }\n  }, {\n    key: \"calcSHcoef\",\n    value: function calcSHcoef(x, y, z) {\n      Engine.createSHcoeff(x, y, z, function (x, y, w, h) {\n        engine.drawSub(x, y, w, h);\n      });\n      var gl = _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].gl;\n      var u8 = new Uint8Array(9 * 4);\n      gl.readPixels(0, 0, 9, 1, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n      var size = 32;\n      var ratio = 1 / (255 * (size * size * Math.PI)); // 1/ (255 * (球の表面積))\n\n      var shcoef = [];\n      var d = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec4();\n\n      for (var j = 0; j < 9; j++) {\n        d[0] = u8[j * 4 + 0];\n        d[1] = u8[j * 4 + 1];\n        d[2] = u8[j * 4 + 2];\n        d[3] = u8[j * 4 + 3];\n        var e = [0, 0, 0]; //new Vec3();\n\n        _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].unpackFloat(e, d);\n        e[0] = e[0] * ratio;\n        e[1] = e[1] * ratio;\n        e[2] = e[2] * ratio;\n        shcoef.push(e);\n      } //拡散用の係数に変換\n\n\n      _lib_spherical_harmonics_sh_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].mulA(shcoef);\n      return shcoef;\n    }\n  }, {\n    key: \"calcSHcoefs\",\n    value: function calcSHcoefs(vecs) {\n      var _this2 = this;\n\n      var coefsCollection = [];\n      vecs.forEach(function (vec) {\n        var coefs = _this2.calcSHcoef(vec[0], vec[1], vec[2]);\n\n        coefsCollection.push(coefs);\n      });\n      return coefsCollection;\n    }\n  }, {\n    key: \"calcEnvironment\",\n    value: function calcEnvironment(_points, _shcoefs) {\n      //環境マップ作成\n      var ono3d = this.ono3d;\n      var engine = this;\n      this.calcLightMatrix(); //環境マップ\n\n      ono3d.environments[0].envTexture = ono3d.createEnv(null, 0, 0, 0, function (x, y, w, h) {\n        engine.drawSub(x, y, w, h);\n      });\n      var shcoef = this.calcSHcoef(0, 0, 0); //ライトプローブ生成\n\n      var points = [];\n      var shcoefs = [];\n      var MAX = 1000;\n\n      if (_points) {\n        points = points.concat(_points);\n        shcoefs = shcoefs.concat(_shcoefs);\n      } //外側に最大の枠を作っておく\n\n\n      for (var i = 0; i < 8; i++) {\n        var p = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(p, ((i & 1) * 2 - 1) * MAX, (((i & 2) >> 1) * 2 - 1) * MAX, (((i & 4) >> 2) * 2 - 1) * MAX);\n        points.push(p);\n      }\n\n      for (var i = 0; i < 8; i++) {\n        shcoefs.push(shcoef);\n      }\n\n      var lightProbe = Engine.createLightProbe(points, shcoefs);\n      ono3d.environments[0].lightProbe = lightProbe;\n    }\n  }, {\n    key: \"drawFunc\",\n    value: function drawFunc() {\n      var HEIGHT = this.HEIGHT;\n      var WIDTH = this.WIDTH;\n\n      _classPrivateFieldSet(this, _drawFlg, false);\n\n      framecount++;\n      this.ono3d.clear();\n      performance.mark(\"drawStart\");\n      performance.mark(\"drawGeometryStart\");\n      this.calcMatrix();\n      this.objMan.draw();\n      performance.mark(\"drawGeometryEnd\");\n      performance.mark(\"drawRasteriseStart\");\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.depthMask(true);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      this.calcMatrix();\n      this.drawSub(0, 0, this.WIDTH, this.HEIGHT); //描画結果をバッファにコピー\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(bufTexture, 0, 0, 0, 0, WIDTH, HEIGHT); //画面平均光度算出\n\n      if (this.autoExposure) {\n        //オート露光調整の場合は画面全体の輝度から算出\n        Engine.calcExpose(bufTexture, (WIDTH - 512) / 2.0 / 1024, 0, 512 / 1024, HEIGHT / 1024);\n      } else {\n        //マニュアル露光調整の場合は露光と最大値をセット\n        Engine.setExpose(this.exposure_level, this.exposure_upper);\n      }\n\n      if (this.exposure_bloom) {\n        // ブルーム処理\n        ono3d.setViewport(0, 0, WIDTH, HEIGHT);\n        Engine.bloom(bufTexture, this.exposure_bloom);\n        _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(bufTexture, 0, 0, 0, 0, WIDTH, HEIGHT);\n      } //トーンマッピング\n\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      ono3d.setViewport(0, 0, WIDTH, HEIGHT);\n      Engine.toneMapping(bufTexture, WIDTH / 1024, HEIGHT / 1024); //\t\tif(ono3d.shadowTexture){\n      //\t\t\tono3d.setViewport(0,0,WIDTH/2,HEIGHT/2);\n      ////\tvar tex=\tono3d.environments[0].envTexture\n      //\t\t\tOno3d.postEffect(ono3d.shadowTexture,0,0 ,1,1,ono3d.shaders[\"shadow_dec\"]); \n      ////\t\t\t\tOno3d.drawCopy(tex,0,0,1,1)\n      //\t\t}\n      //gl.getParameter(gl.VIEWPORT);\n\n      performance.mark(\"drawRasteriseEnd\");\n      performance.mark(\"drawEnd\");\n    }\n  }, {\n    key: \"mainloop\",\n    value: function mainloop() {\n      var _this3 = this;\n\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].fpsman.setFps(Number(this.fps));\n\n      _classPrivateFieldSet(this, _drawFlg, true);\n\n      if (_classPrivateFieldGet(this, _drawFlg)) {\n        this.drawFunc();\n      }\n\n      var nowTime = performance.now();\n      performance.mark(\"mainloopStart\");\n      var obj;\n      pad[0] = _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].padX + (_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[2] || _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[10]) - (_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[0] || _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[8]);\n      pad[1] = _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].padY + (_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[3] || _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[11]) - (_lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[1] || _lib_util_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].keyflag[9]);\n      var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2.scalar(pad);\n\n      if (l > 1) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2.norm(pad);\n      }\n\n      this.objMan.move();\n\n      if (this.physics) {\n        performance.mark(\"physicsStart\");\n\n        for (var i = 0; i < this.step; i++) {\n          onoPhy.calc(1.0 / this.fps / this.step);\n        }\n\n        this.physics_ = 1;\n        performance.mark(\"physicsEnd\");\n      }\n\n      var nowTime = performance.now();\n      performance.mark(\"mainloopEnd\");\n      var measures = [\"mainloop\", \"physics\", \"aabb\", \"collision\", \"impulse\", \"draw\", \"drawGeometry\", \"drawRasterise\"];\n\n      for (var i = 0; i < measures.length; i++) {\n        var name = measures[i];\n\n        try {\n          performance.measure(name, name + 'Start', name + 'End');\n        } catch (e) {}\n      }\n\n      mseccount += performance.now() - nowTime;\n\n      if (nowTime - oldTime > 1000) {\n        var mspf = 0;\n        var fps = framecount * 1000 / (nowTime - oldTime);\n\n        var entr = function entr(name) {\n          try {\n            var entr = performance.getEntriesByName(name);\n            var res = 0;\n\n            for (var i = 0; i < entr.length; i++) {\n              res += entr[i].duration;\n            }\n\n            return res / entr.length;\n          } catch (e) {\n            return -1;\n          }\n        };\n\n        measures.forEach(function (e) {\n          _this3.process_times[e] = entr(e);\n        });\n        this.process_times[\"fps\"] = fps;\n        framecount = 0;\n        mseccount = 0;\n        oldTime = nowTime;\n        performance.clearMeasures();\n      }\n    }\n  }, {\n    key: \"calcMatrix\",\n    value: function calcMatrix() {\n      //カメラ情報からレンダリング用の行列作成\n      var camera = this.camera;\n      var rot = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var scale = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var m = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat43();\n      var ono3d = this.ono3d;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(scale, 1, 1, 1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(rot, camera.a[0], camera.a[1] + Math.PI, camera.a[2]);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat43.fromLSE(camera.matrix, camera.p, scale, rot);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat43.getInv(m, camera.matrix);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.copyMat43(ono3d.viewMatrix, m);\n      var persx = camera.aov;\n      var persy = camera.aov * ono3d.viewport[3] / ono3d.viewport[2];\n      _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].perspectiveMatrix(camera.pvMatrix, persx, persy, camera.znear, camera.zfar);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.dotMat43(camera.pvMatrix, camera.pvMatrix, m);\n      ono3d.znear = camera.znear;\n      ono3d.zfar = camera.zfar;\n      ono3d.aov = camera.aov;\n    }\n  }, {\n    key: \"drawSub\",\n    value: function drawSub(x, y, w, h) {\n      //画面描画関数\n      ono3d.rf = 0;\n      ono3d.lineWidth = 1.0;\n      ono3d.smoothing = this.smoothing;\n      ono3d.lightThreshold1 = this.lightThreshold1;\n      ono3d.lightThreshold2 = this.lightThreshold2; //背景描画\n\n      gl.disable(gl.DEPTH_TEST);\n      gl.disable(gl.BLEND);\n      gl.depthMask(true);\n      ono3d.setViewport(x, y, w, h); //this.calcMatrix();\n\n      var a = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(a, 0.1, 0.1, 0.1);\n      var b = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec4();\n      _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].packR11G11B10(b, a);\n      gl.clearColor(b[0], b[1], b[2], b[3]);\n      gl.clear(gl.COLOR_BUFFER_BIT); //\t\tgl.clearColor(0,0,0,0);\n\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      gl.depthMask(false);\n      gl.disable(gl.BLEND);\n      var skyTexture = this.skyTexture;\n\n      if (skyTexture) {\n        if (skyTexture.glTexture) {\n          if (this.stereomode == 0) {\n            ono3d.drawCelestialSphere(skyTexture);\n          } else {\n            _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].perspectiveMatrix(ono3d.projectionMatrix, camera.aov, camera.aov * HEIGHT / WIDTH * 2, camera.znear, camera.zfar);\n            ono3d.setViewport(0, 0, WIDTH / 2, HEIGHT);\n            ono3d.drawCelestialSphere(skyTexture);\n            ono3d.setViewport(WIDTH / 2, 0, WIDTH / 2, HEIGHT);\n            ono3d.drawCelestialSphere(skyTexture);\n          }\n        }\n      }\n\n      ono3d.setViewport(x, y, w, h); //オブジェクト描画\n\n      gl.depthMask(true);\n      gl.enable(gl.DEPTH_TEST);\n\n      if (this.custom_material) {\n        var faces = ono3d.faces;\n        var s = ono3d.faces_index;\n\n        for (var fi = ono3d.faces_static_index; fi < s; fi++) {\n          faces[fi].material = this.custom_material;\n        }\n      }\n\n      ono3d.render(this.camera.p);\n      gl.finish();\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      //urlからオプションデータ取得\n      var url = location.search.substring(1, location.search.length);\n      var args = url.split(\"&\");\n\n      for (var i = args.length; i--;) {\n        var arg = args[i].split(\"=\");\n\n        if (arg.length > 1) {\n          if (!isNaN(arg[1]) && arg[1] != \"\") {\n            if (arg[1].length > 1 && arg[1].indexOf(0) == \"0\") {\n              globalParam[arg[0]] = arg[1];\n            } else {\n              globalParam[arg[0]] = +arg[1];\n            }\n          } else {\n            globalParam[arg[0]] = arg[1];\n          }\n        }\n      } //デフォルト背景読み込み\n\n\n      this.skyTexture = this.loadEnvTexture(\"./engine/back.png\");\n\n      if (this.userInit) {\n        //初期化処理が設定されていれば実行\n        this.userInit();\n      }\n\n      _classPrivateFieldSet(this, _drawFlg, true);\n\n      _classPrivateMethodGet(this, _animationFunc, _animationFunc2).call(this);\n    }\n  }, {\n    key: \"loadEnvTexture\",\n    value: function loadEnvTexture(path) {\n      var _this4 = this;\n\n      //環境マップ読み込み\n      return _assetmanager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].texture(path, function (image) {\n        gl.disable(gl.BLEND);\n        gl.disable(gl.DEPTH_TEST);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].frameBuffer);\n        gl.viewport(0, 0, image.width, image.height);\n        _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(image, 0, 0, 1, 1, _this4.ono3d.shaders[\"envset\"]);\n        gl.bindTexture(gl.TEXTURE_2D, image.glTexture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(image, 0, 0, 0, 0, image.width, image.height);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      });\n    }\n  }, {\n    key: \"calcLightMatrix\",\n    value: function calcLightMatrix(points) {\n      var HEIGHT = this.HEIGHT;\n      var WIDTH = this.WIDTH; // ライト行列計算 ------\n      // パースシャドウマップを作るための行列を作る\n\n      var camera = this.camera;\n      var light = this.ono3d.environments[0].sun;\n      var xup = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var yup = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var zup = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var projection_matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44();\n      var view_matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat43();\n      var cameraz = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3(); //ライト向きとカメラ向きからライトレンダリング向き決める\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(yup, light.matrix[8], light.matrix[9], light.matrix[10]);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(cameraz, camera.matrix[6], camera.matrix[7], camera.matrix[8]);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.cross(xup, yup, cameraz);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.norm(xup);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.cross(zup, xup, yup);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.norm(zup);\n      var offset = 10;\n      var light_anchor_pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n      var aabb = new _lib_aabb_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"]();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(aabb.min, -2, -10, -2);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.set(aabb.max, 2, 10, 2);\n      var axis = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33.set(axis, xup[0], yup[0], zup[0], xup[1], yup[1], zup[1], xup[2], yup[2], zup[2]);\n\n      if (points) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33.dotVec3(aabb.min, axis, points[0]);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33.dotVec3(aabb.max, axis, points[0]);\n        var aaa = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3() + points.forEach(function (point) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33.dotVec3(aaa, axis, point);\n\n          for (var i = 0; i < DIMENSION; i++) {\n            aabb.min[i] = Math.min(aabb.min[i], aaa[i]);\n            aabb.max[i] = Math.max(aabb.min[i], aaa[i]);\n          }\n        });\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.madd(light_anchor_pos, light_anchor_pos, aabb.min, 0.5);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.madd(light_anchor_pos, light_anchor_pos, aabb.max, 0.5);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat33.dotVec3(light_anchor_pos, axis, light_anchor_pos);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.madd(light_anchor_pos, light_anchor_pos, zup, offset - aabb.min[2]); //シャドウマップ用行列計算\n\n      var view_matrix = light.viewmatrix;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.set(view_matrix, xup[0], xup[1], xup[2], 0, yup[0], yup[1], yup[2], 0, zup[0], zup[1], zup[2], 0, light_anchor_pos[0], light_anchor_pos[1], light_anchor_pos[2], 1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.getInv(view_matrix, view_matrix);\n      _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].perspectiveMatrix(projection_matrix, -(aabb.max[0] - aabb.min[0]) * 0.5, (aabb.max[0] - aabb.min[0]) * 0.5, -(aabb.max[1] - aabb.min[1]) * 0.5, (aabb.max[1] - aabb.min[1]) * 0.5, offset, offset + (aabb.max[2] - aabb.min[2])); //yとzを入れ替える\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.dot(view_matrix, projection_matrix, view_matrix);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.setInit(projection_matrix);\n      projection_matrix[5] = 0;\n      projection_matrix[9] = -1;\n      projection_matrix[6] = -1;\n      projection_matrix[10] = 0;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Mat44.dot(view_matrix, projection_matrix, view_matrix);\n    }\n  }], [{\n    key: \"createLightProbe\",\n    value: function createLightProbe(points, shcoefs) {\n      //位置と球面調和係数のリストからライトプローブを作成\n      var triangles = _lib_delaunay_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].create(points);\n      var bspTree = _lib_bsp_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].createBspTree(triangles);\n      var lightProbe = {};\n      lightProbe.bspTree = bspTree;\n      lightProbe.points = points;\n      lightProbe.shcoefs = shcoefs;\n      return lightProbe;\n    }\n  }]);\n\n  return Engine;\n}(); //カメラ位置計算\n\n\nfunction _animationFunc2() {\n  var _this5 = this;\n\n  window.requestAnimationFrame(function () {\n    _classPrivateMethodGet(_this5, _animationFunc, _animationFunc2).call(_this5);\n  });\n\n  _classPrivateFieldSet(this, _drawFlg, true);\n}\n\n_defineProperty(Engine, \"Camera\", _camera_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"]);\n\n\n\nvar calcSupport = function calcSupport(axis, poses, reverse) {\n  var effic = 1;\n\n  if (reverse) {\n    effic = -1;\n  }\n\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(poses[0], axis) * effic;\n\n  for (pi = 1; pi < poses.length; pi++) {\n    var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(poses[pi], axis) * effic;\n\n    if (l2 < l) {\n      l = l2;\n    }\n  }\n\n  return l * effic;\n};\n\nvar calcSupportAngle = function calcSupportAngle(axis, poses, ref_point, reverse, zup) {\n  //posesが全て内包されるよう画角を求める\n  var effic = 1;\n\n  if (reverse) {\n    effic = -1;\n  }\n\n  var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3();\n  var pi = 0;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.sub(vec3, poses[pi], ref_point);\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(vec3, axis) / -_lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(vec3, zup) * effic;\n\n  for (pi = 1; pi < poses.length; pi++) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.sub(vec3, poses[pi], ref_point);\n    var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(vec3, axis) / -_lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec3.dot(vec3, zup) * effic;\n\n    if (l2 < l) {\n      l = l2;\n    }\n  }\n\n  return l * effic;\n};\n\nvar shShader = [];\nvar sigmaShader;\nvar shadow_gauss_shader;\nvar ret = Engine;\nvar gl;\nvar onoPhy = null;\nvar bdf;\nvar bdfimage = null;\nvar soundbuffer = null;\nret.goClass = [];\nret.go = [];\nvar tex512; //bloom用\n\nvar tex128; //SHcoef計算用\n\nvar env2Texture;\nvar averageTexture;\nvar bufTexture;\n_objman_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].Obj = _obj_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"];\nvar pad = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2();\nEngine.pad = pad;\nEngine.probs = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\nvar physicsTime;\nvar oldTime = 0;\nvar nowTime = 0;\nvar drawgeometryTime = 0;\nvar drawrasteriseTime = 0;\nvar drawTime = 0;\nvar mseccount = 0;\nvar framecount = 0; //hud描画用\n\nvar blit = function blit(tex, x, y, w, h, u, v, u2, v2) {\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].drawCopy(tex.glTexture, x, y, w * 2, h * 2, u / tex.width, (v + v2) / tex.height, u2 / tex.width, -v2 / tex.height);\n};\n\nglobalParam.outline_bold = 0;\nglobalParam.outline_color = \"000000\";\nglobalParam.lightColor1 = \"808080\";\nglobalParam.lightColor2 = \"808080\";\n;\nglobalParam.lightThreshold1 = 0.;\nglobalParam.lightThreshold2 = 1.;\nglobalParam.physics = 1;\nglobalParam.physics_ = 0;\nglobalParam.smoothing = 0;\nglobalParam.stereomode = 0;\nglobalParam.stereoVolume = 1;\nglobalParam.step = 1;\nglobalParam.fps = 30;\nglobalParam.scene = 0;\nglobalParam.shadow = 1;\nglobalParam.model = \"./f1.o3o\";\nglobalParam.materialMode = false; //カスタムマテリアル\n\nglobalParam.baseColor = \"ffffff\";\nglobalParam.metallic = 0;\nglobalParam.metalColor = \"ffffff\";\nglobalParam.specular = 0;\nglobalParam.roughness = 0;\nglobalParam.subRoughness = 0;\nglobalParam.frenel = 0;\nglobalParam.opacity = 1.0;\nglobalParam.ior = 1.1;\nglobalParam.cNormal = 1.0;\nglobalParam.emi = 0.0;\nglobalParam.debugMenu = 0;\nglobalParam.source = 0;\nglobalParam.target = 0;\nglobalParam.reference = 0;\nglobalParam.actionAlpha = 0;\n\nvar parentnode = function (scripts) {\n  return scripts[scripts.length - 1].parentNode;\n}(document.scripts || document.getElementsByTagName('script'));\n/** ブルーム画像を作成し、合成する **/\n\n\nEngine.bloom = function (image, exposure_bloom) {\n  var shaders = ono3d.shaders;\n  var addShader = shaders[\"add\"]; //var tex512 = tex512;\n\n  var WIDTH = ono3d.viewport[2];\n  var HEIGHT = ono3d.viewport[3];\n  var emiSize = 0.5; //光テクスチャをぼかす\n  //レンダリング画像をコピー(まず1/2サイズにする)\n\n  ono3d.setViewport(0, 0, WIDTH * 0.5, HEIGHT * 0.5);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(image, 0, 0, WIDTH / image.width, HEIGHT / image.height, shaders[\"half\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex512, 0, 0, 0, 0, WIDTH * 0.5, HEIGHT * 0.5);\n  gl.clearColor(0., 0., 0., 0.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n  var width = WIDTH * 0.5;\n  var height = HEIGHT * 0.5; // 1/2 1/4 1/8...\n\n  var ratio = 0.5;\n  ono3d.setViewport(0, 0, width * ratio, height * ratio);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(tex512, 0, 1 - ratio * 2, width / 512 * ratio * 2, height / 512 * ratio * 2, shaders[\"half\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex512, 0, 0, 0, 0, 512, 512);\n  ratio *= 0.5;\n\n  for (var i = 0; i < 3; i++) {\n    ono3d.setViewport(0, 0, width * ratio, height * ratio);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(tex512, 0, 1 - ratio * 4, width / 512 * ratio * 2, height * ratio * 2 / 512, shaders[\"half\"]);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex512, 0, (1 - ratio * 2) * 512, 0, 0, width * ratio, height * ratio); //ono3d.setViewport(0,0,size*0.5,size*0.5);\n    //Ono3d.postEffect(transTexture,0,(1024-size*2)/bunbo,size/bunbo,size/bunbo,shaders[\"half\"]);\n\n    ratio *= 0.5; //Ono3d.copyImage(transTexture,0,1024-size*2,0,0,size,size);\n  } //ガウスぼかし\n\n\n  ono3d.setViewport(0, 0, 256, 512);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].gauss(256, 512, 100, tex512, 0, 0, 0.5, 1);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex512, 0, 0, 0, 0, 256, 512); //全サイズ足す\n\n  ono3d.setViewport(0, 0, 512, 512);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(tex512, 0, 0, 0.5, 0.5, shaders[\"multiadd\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex512, 0, 0, 0, 0, 512, 512); //画面に合成\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  gl.useProgram(addShader.program);\n  gl.uniform1i(addShader.unis[\"uSampler2\"].location, 1);\n  gl.activeTexture(gl.TEXTURE1);\n  gl.bindTexture(gl.TEXTURE_2D, tex512.glTexture);\n  gl.uniform1f(addShader.unis[\"v1\"].location, 1.0);\n  gl.uniform1f(addShader.unis[\"v2\"].location, exposure_bloom);\n  ono3d.setViewport(0, 0, WIDTH, HEIGHT);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(image, 0, 0, WIDTH / image.width, HEIGHT / image.height, addShader);\n};\n/** カメラの露光設定を現在のレンダリング画像から自動設定する**/\n\n\nEngine.calcExpose = function (image, x, y, w, h) {\n  var shaders = ono3d.shaders; //ピクセル毎の光度と最大値を取得\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].frameBuffer);\n  ono3d.setViewport(0, 0, 256, 256);\n  gl.bindTexture(gl.TEXTURE_2D, averageTexture.glTexture);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(image, x, y, w, h, shaders[\"average\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(averageTexture, 0, 0, 0, 0, 256, 256); //1/2縮小を繰り返し平均と最大値を求める\n\n  var size = 256;\n\n  for (var i = 0; size > 1; i++) {\n    ono3d.setViewport(0, 0, size / 2, size / 2);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(averageTexture, 0, 0, size / 512, size / 512, shaders[\"average2\"]);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(averageTexture, 0, 0, 0, 0, size / 2, size / 2);\n    size /= 2;\n  }\n\n  ono3d.setViewport(0, 511, 1, 1);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(averageTexture, 0, 511 / 512, 1 / 512, 1 / 512, shaders[\"average3\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(averageTexture, 0, 511, 0, 511, 1, 1);\n};\n/** カメラの露光設定をセットする**/\n\n\nvar packUFP16 = function packUFP16(dst, raw) {\n  if (raw === 0.0) {\n    dst[0] = 0;\n    dst[1] = 0;\n    return;\n  }\n\n  var geta = 15.0;\n  var idx = Math.min(Math.max(Math.floor(Math.log2(raw)), -geta), 31.0 - geta);\n  var f;\n\n  if (idx < 0) {\n    f = raw * (1 << -idx);\n  } else {\n    f = raw / (1 << idx);\n  }\n\n  f = (f - 1.0) * 256.0;\n  dst[0] = f | 0;\n  dst[1] = ((f - (f | 0)) * 8.0 << 5) + (idx + geta);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2.mul(dst, dst, 1.0 / 255.0);\n  return;\n};\n\nEngine.setExpose = function (level, upper) {\n  var a = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2();\n  var b = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_11__.Vec2();\n  var shaders = ono3d.shaders; //Vec4.set(a,level,upper,0.5,0.5);\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].frameBuffer);\n  ono3d.setViewport(0, 511, 1, 1);\n  gl.useProgram(shaders[\"fill\"].program);\n  packUFP16(a, level);\n  packUFP16(b, upper); //encode2(a,a);\n\n  gl.uniform4f(shaders[\"fill\"].unis[\"uColor\"].location, a[0], a[1], b[0], b[1]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(averageTexture, 0, 0, 0, 0, shaders[\"fill\"]);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(averageTexture, 0, 511, 0, 511, 1, 1);\n};\n\nEngine.toneMapping = function (image, w, h) {\n  var shaders = ono3d.shaders;\n  var decodeShader = shaders[\"decode\"];\n  gl.useProgram(decodeShader.program);\n  gl.uniform1i(decodeShader.unis[\"uSampler2\"].location, 1);\n  gl.activeTexture(gl.TEXTURE1);\n  gl.bindTexture(gl.TEXTURE_2D, averageTexture.glTexture);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(image, 0, 0, w, h, decodeShader);\n};\n\nEngine.createSHcoeff = function (x, y, z, func) {\n  //ライトプローブの球面調和関数の係数を計算する\n  var tex = tex128;\n  var envBuf = ono3d.envbufTexture;\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null); //キューブマップ作成\n\n  ono3d.createCubeMap(envBuf, x, y, z, 256, func);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].frameBuffer); //gl.clearColor(0,0,0,1);\n  //gl.clear(gl.COLOR_BUFFER_BIT);\n  //Ono3d.copyImage(envBuf,0,0,0,0,1024,512);\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  var size = 32;\n\n  for (var i = 0; i < 9; i++) {\n    //係数の数だけループ\n    gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].frameBuffer);\n    gl.clearColor(0, 0, 0, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    ono3d.setViewport(0, 0, size * 4, size * 2); //係数ごとのシェーダで計算\n\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(envBuf, 0, 0, 256 * 4 / envBuf.width, 256 * 2 / envBuf.height, shShader[i]);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex, 0, 0, 0, 0, size * 4, size);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex, 0, size, 0, size, size * 2, size); //計算結果を全て合計\n\n    var texsize = tex.width;\n\n    while (2 < texsize) {\n      //積分\n      texsize >>= 1;\n      ono3d.setViewport(0, 0, texsize, texsize);\n      _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(tex, 0, 0, texsize * 2 / tex.width, texsize * 2 / tex.width, sigmaShader);\n      _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex, 0, 0, 0, 0, texsize, texsize);\n    } //ラストはメインのフレームに描く\n\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    texsize >>= 1;\n    ono3d.setViewport(i, 0, 1, 1);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(tex, 0, 0, texsize * 2 / tex.width, texsize * 2 / tex.width, sigmaShader);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(tex, 0, 0, 0, 0, texsize, texsize);\n  }\n\n  return tex;\n};\n\nEngine.shadowGauss = function (width, height, d, src, x, y, w, h) {\n  //係数作成\n  var weight = new Array(5);\n  var t = 0.0;\n\n  for (var i = 0; i < weight.length; i++) {\n    var r = 1.0 + 2.0 * i;\n    var we = Math.exp(-0.5 * (r * r) / d);\n    weight[i] = we;\n\n    if (i > 0) {\n      we *= 2.0;\n    }\n\n    t += we;\n  }\n\n  for (i = 0; i < weight.length; i++) {\n    weight[i] /= t;\n  }\n\n  var shader = shadow_gauss_shader;\n  var args = shader.unis;\n  gl.useProgram(shader.program); //\tgl.uniform1fv(args[\"weight\"].location,weight);\n  //\tgl.bindBuffer(gl.ARRAY_BUFFER, Rastgl.fullposbuffer);\n  //横ぼかし\n\n  gl.uniform2f(args[\"uAxis\"].location, 1 / width, 0);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(src, x, y, w, h, shader);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copyImage(src, 0, 0, 0, 0, width, height); //縦ぼかし\n\n  gl.uniform2f(args[\"uAxis\"].location, 0, 1 / height);\n  _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].postEffect(src, 0, 0, width / src.width, height / src.height, shader);\n};\n\n//# sourceURL=webpack://bc/../lib/engine/engine.js?");

/***/ }),

/***/ "../lib/engine/o3o/action.js":
/*!***********************************!*\
  !*** ../lib/engine/o3o/action.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Action; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Action = /*#__PURE__*/_createClass(function Action() {\n  _classCallCheck(this, Action);\n\n  //アクション\n  this.name = \"\"; //アクション名\n\n  this.endframe = 0; //終了フレーム\n\n  this.id_root = \"\"; //ターゲットの種類\n\n  this.fcurves = []; //キーフレーム情報\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/action.js?");

/***/ }),

/***/ "../lib/engine/o3o/armature.js":
/*!*************************************!*\
  !*** ../lib/engine/o3o/armature.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Armature; }\n/* harmony export */ });\n/* harmony import */ var _objecttype_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./objecttype.js */ \"../lib/engine/o3o/objecttype.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar Armature = /*#__PURE__*/_createClass(function Armature() {\n  _classCallCheck(this, Armature);\n\n  //骨組み\n  this.name = \"\"; //名前\n\n  this.bones = []; //骨\n});\n\n\nArmature.prototype.objecttype = _objecttype_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].ARMATURE;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/armature.js?");

/***/ }),

/***/ "../lib/engine/o3o/bone.js":
/*!*********************************!*\
  !*** ../lib/engine/o3o/bone.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Bone; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar Bone = /*#__PURE__*/_createClass( //骨\nfunction Bone() {\n  _classCallCheck(this, Bone);\n\n  this.name = \"\";\n  this.parent = \"\";\n  this.length = 0;\n  this.matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n  this.imatrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/bone.js?");

/***/ }),

/***/ "../lib/engine/o3o/bufmesh.js":
/*!************************************!*\
  !*** ../lib/engine/o3o/bufmesh.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _vertex_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vertex.js */ \"../lib/engine/o3o/vertex.js\");\n/* harmony import */ var _face_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./face.js */ \"../lib/engine/o3o/face.js\");\n/* harmony import */ var _edge_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./edge.js */ \"../lib/engine/o3o/edge.js\");\n/* harmony import */ var _mesh_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./mesh.js */ \"../lib/engine/o3o/mesh.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n\n\n\n\n\nvar MAX_SIZE = 4096;\nvar bufMesh = new _mesh_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](); //メッシュバッファ\n\nbufMesh.ratios = [];\nbufMesh.vertices = _vertex_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].array(MAX_SIZE);\nbufMesh.faces = _face_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].array(MAX_SIZE);\nbufMesh.edges = _edge_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].array(MAX_SIZE);\n\nfor (var i = 0; i < MAX_SIZE; i++) {\n  //bufMesh.faces.push(new Face());\n  //bufMesh.edges.push(new Edge());\n  bufMesh.ratios.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4());\n}\n\n;\n/* harmony default export */ __webpack_exports__[\"default\"] = (bufMesh);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/bufmesh.js?");

/***/ }),

/***/ "../lib/engine/o3o/edge.js":
/*!*********************************!*\
  !*** ../lib/engine/o3o/edge.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Edge; }\n/* harmony export */ });\n/* harmony import */ var _typedclass_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./typedclass.js */ \"../lib/engine/o3o/typedclass.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\nvar Edge = /*#__PURE__*/function (_TypedClass) {\n  _inherits(Edge, _TypedClass);\n\n  var _super = _createSuper(Edge);\n\n  function Edge(buffer, offset) {\n    var _this;\n\n    _classCallCheck(this, Edge);\n\n    _this = _super.call(this); //辺\n\n    if (!buffer) {\n      buffer = new ArrayBuffer(Edge.size);\n      offset = 0;\n    }\n\n    _this.vIndices = new Int16Array(buffer, offset, 2);\n    _this.fIndices = new Int16Array(buffer, offset + 4, 2);\n\n    _this.fIndices.set([-1, -1]); //\t\tthis.vIndices[0] = -1; //頂点インデックス1\n    //\t\tthis.vIndices[1] = -1;//頂点インデックス2\n    //\t\tthis.fIndices[0] = -1;//面インデックス1\n    //\t\tthis.fIndices[1] = -1;//面インデックス2\n\n\n    return _this;\n  }\n\n  return _createClass(Edge);\n}(_typedclass_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]);\n\n\nEdge.size = 8;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/edge.js?");

/***/ }),

/***/ "../lib/engine/o3o/environment.js":
/*!****************************************!*\
  !*** ../lib/engine/o3o/environment.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Environment; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Environment = /*#__PURE__*/_createClass(function Environment() {\n  _classCallCheck(this, Environment);\n\n  //ライティング環境\n  this.name = \"\";\n  this.lights = [];\n  this.lightProbe = null;\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/environment.js?");

/***/ }),

/***/ "../lib/engine/o3o/face.js":
/*!*********************************!*\
  !*** ../lib/engine/o3o/face.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Face; }\n/* harmony export */ });\n/* harmony import */ var _typedclass_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./typedclass.js */ \"../lib/engine/o3o/typedclass.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\nvar Face = /*#__PURE__*/function (_TypedClass) {\n  _inherits(Face, _TypedClass);\n\n  var _super = _createSuper(Face);\n\n  function Face(buffer, offset) {\n    var _this;\n\n    _classCallCheck(this, Face);\n\n    _this = _super.call(this); //面\n\n    if (!buffer) {\n      buffer = new ArrayBuffer(Face.size);\n      offset = 0;\n    } //this.uv = new Array(8); //uv値(そのうち消す)\n\n\n    _this.idx = new Int16Array(buffer, offset, 4); //[ -1 , -1 , -1 , -1]; //頂点インデックス\n\n    _this.idx.set([-1, -1, -1, -1]);\n\n    _this.normal = new Float32Array(buffer, offset + 8, 3); // new Vec3(); //法線\n\n    _this.material = null; //マテリアル\n\n    _this.flg = 0; //フラグ\n\n    _this.fs = 0; //フラグ2\n\n    _this.mat = -1;\n    _this.idxnum = 3; //頂点数\n\n    return _this;\n  }\n\n  return _createClass(Face);\n}(_typedclass_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]);\n\n\n;\nFace.size = 28;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/face.js?");

/***/ }),

/***/ "../lib/engine/o3o/fcurve.js":
/*!***********************************!*\
  !*** ../lib/engine/o3o/fcurve.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Fcurve; }\n/* harmony export */ });\n/* harmony import */ var _interpolationmode_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./interpolationmode.js */ \"../lib/engine/o3o/interpolationmode.js\");\n/* harmony import */ var _repeatmode_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./repeatmode.js */ \"../lib/engine/o3o/repeatmode.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\nvar Fcurve = /*#__PURE__*/_createClass(function Fcurve() {\n  _classCallCheck(this, Fcurve);\n\n  //キーフレーム\n  this.target = \"\"; //ターゲット(ボーン名かマテリアル番号)\n\n  this.type = \"\"; //\n\n  this.idx = 0; //\n\n  this.interpolatemode = _interpolationmode_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].LINER; //補完タイプ\n\n  this.repeatmode = _repeatmode_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].NONE; //繰り返しタイプ\n\n  this.keys = []; //キー時間\n\n  this.params = []; //キーパラメータ\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/fcurve.js?");

/***/ }),

/***/ "../lib/engine/o3o/fcurvemode.js":
/*!***************************************!*\
  !*** ../lib/engine/o3o/fcurvemode.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar i = 0;\nvar FcurveMode = {\n  ROT_QUAT: i++,\n  ROT_EULER: i++,\n  LOCATION: i++,\n  SCALE: i++,\n  SHAPEKEY: i++,\n  OFFSET: i++\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (FcurveMode);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/fcurvemode.js?");

/***/ }),

/***/ "../lib/engine/o3o/interpolationmode.js":
/*!**********************************************!*\
  !*** ../lib/engine/o3o/interpolationmode.js ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar i = 0;\nvar InterpolationMode = {\n  LINER: i++,\n  SPLINE: i++\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (InterpolationMode);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/interpolationmode.js?");

/***/ }),

/***/ "../lib/engine/o3o/light.js":
/*!**********************************!*\
  !*** ../lib/engine/o3o/light.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Light; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar Light = /*#__PURE__*/_createClass(function Light() {\n  _classCallCheck(this, Light);\n\n  this.name = \"\";\n  this.type = \"\";\n  this.color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/light.js?");

/***/ }),

/***/ "../lib/engine/o3o/material.js":
/*!*************************************!*\
  !*** ../lib/engine/o3o/material.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Material; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar Material = /*#__PURE__*/_createClass(function Material() {\n  _classCallCheck(this, Material);\n\n  //マテリアル\n  this.name = \"\";\n  this.blend_method = \"OPAQUE\";\n  this.baseColor = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.baseColor, 1, 1, 1); //アルベド\n\n  this.baseColorMap = \"\"; //アルベドテクスチャ\n\n  this.opacity = 1.0; //不透明度\n\n  this.specular = 0.0; //光沢\n\n  this.metallic = 0.0; //金属光沢\n\n  this.roughness = 0.0; //表面拡散度合い\n\n  this.ior = 1.0; //屈折率\n\n  this.subRoughness = 0.0; //内部拡散度合い\n\n  this.emt = 0.0; //自己発光\n\n  this.pbrMap = \"\"; //光沢、拡散、屈折、内部拡散\n\n  this.hightMap = \"\"; //ハイトマップ\n\n  this.hightMapPower = 0; //ハイトマップ影響度\n\n  this.hightBase = 0.5; //ハイトマップ基準\n\n  this.lightMap = \"\"; //ライトマップ\n\n  this.uv = \"\"; //uv座標\n\n  this.fresnel = 0.0; //フレネル率\n\n  this.shader = \"\"; //別シェーダ\n\n  this.uvOffset = [0, 0]; //uvアニメ用オフセット\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/material.js?");

/***/ }),

/***/ "../lib/engine/o3o/mesh.js":
/*!*********************************!*\
  !*** ../lib/engine/o3o/mesh.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Mesh; }\n/* harmony export */ });\n/* harmony import */ var _objecttype_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./objecttype.js */ \"../lib/engine/o3o/objecttype.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar Mesh = /*#__PURE__*/_createClass(function Mesh() {\n  _classCallCheck(this, Mesh);\n\n  //メッシュ情報\n  this.name = \"\"; //名前\n\n  this.use_auto_smooth = 0;\n  this.auto_smooth_angle = 0;\n  this.vertices = []; //頂点\n\n  this.colors = []; //頂点色\n\n  this.shcoefs = []; //球面調和関数の係数\n\n  this.shapeKeys = []; //シェイプキー\n\n  this.faces = []; //面\n\n  this.edges = []; //辺\n\n  this.flg = 0; //フラグ\n\n  this.uv_layers = []; //uv情報\n});\n\n\n;\nMesh.prototype.objecttype = _objecttype_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].MESH;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/mesh.js?");

/***/ }),

/***/ "../lib/engine/o3o/o3o.js":
/*!********************************!*\
  !*** ../lib/engine/o3o/o3o.js ***!
  \********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ O3o; }\n/* harmony export */ });\n/* harmony import */ var _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/ono3d.js */ \"../lib/lib/ono3d.js\");\n/* harmony import */ var _engine_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../engine.js */ \"../lib/engine/engine.js\");\n/* harmony import */ var _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/onophy/onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _lib_geono_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/geono.js */ \"../lib/lib/geono.js\");\n/* harmony import */ var _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _assetmanager_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../assetmanager.js */ \"../lib/engine/assetmanager.js\");\n/* harmony import */ var _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/rastgl.js */ \"../lib/lib/rastgl.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../lib/util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _lib_spherical_harmonics_sh_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../lib/spherical_harmonics/sh.js */ \"../lib/lib/spherical_harmonics/sh.js\");\n/* harmony import */ var _material_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./material.js */ \"../lib/engine/o3o/material.js\");\n/* harmony import */ var _armature_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./armature.js */ \"../lib/engine/o3o/armature.js\");\n/* harmony import */ var _uvlayer_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./uvlayer.js */ \"../lib/engine/o3o/uvlayer.js\");\n/* harmony import */ var _bone_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./bone.js */ \"../lib/engine/o3o/bone.js\");\n/* harmony import */ var _environment_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./environment.js */ \"../lib/engine/o3o/environment.js\");\n/* harmony import */ var _light_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./light.js */ \"../lib/engine/o3o/light.js\");\n/* harmony import */ var _mesh_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./mesh.js */ \"../lib/engine/o3o/mesh.js\");\n/* harmony import */ var _pose_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./pose.js */ \"../lib/engine/o3o/pose.js\");\n/* harmony import */ var _posebone_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./posebone.js */ \"../lib/engine/o3o/posebone.js\");\n/* harmony import */ var _objecttype_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./objecttype.js */ \"../lib/engine/o3o/objecttype.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/engine/o3o/rigidbody.js\");\n/* harmony import */ var _scene_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./scene.js */ \"../lib/engine/o3o/scene.js\");\n/* harmony import */ var _rigidbodyconstraint_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./rigidbodyconstraint.js */ \"../lib/engine/o3o/rigidbodyconstraint.js\");\n/* harmony import */ var _sceneobject_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./sceneobject.js */ \"../lib/engine/o3o/sceneobject.js\");\n/* harmony import */ var _action_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./action.js */ \"../lib/engine/o3o/action.js\");\n/* harmony import */ var _fcurve_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./fcurve.js */ \"../lib/engine/o3o/fcurve.js\");\n/* harmony import */ var _rotationmode_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./rotationmode.js */ \"../lib/engine/o3o/rotationmode.js\");\n/* harmony import */ var _interpolationmode_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./interpolationmode.js */ \"../lib/engine/o3o/interpolationmode.js\");\n/* harmony import */ var _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./fcurvemode.js */ \"../lib/engine/o3o/fcurvemode.js\");\n/* harmony import */ var _repeatmode_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./repeatmode.js */ \"../lib/engine/o3o/repeatmode.js\");\n/* harmony import */ var _reflectionprobe_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./reflectionprobe.js */ \"../lib/engine/o3o/reflectionprobe.js\");\n/* harmony import */ var _typedclass_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./typedclass.js */ \"../lib/engine/o3o/typedclass.js\");\n/* harmony import */ var _vertex_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./vertex.js */ \"../lib/engine/o3o/vertex.js\");\n/* harmony import */ var _face_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./face.js */ \"../lib/engine/o3o/face.js\");\n/* harmony import */ var _edge_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./edge.js */ \"../lib/engine/o3o/edge.js\");\n/* harmony import */ var _o3oinstance_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./o3oinstance.js */ \"../lib/engine/o3o/o3oinstance.js\");\n/* harmony import */ var _sceneobjectinstance_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./sceneobjectinstance.js */ \"../lib/engine/o3o/sceneobjectinstance.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _bufmesh_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./bufmesh.js */ \"../lib/engine/o3o/bufmesh.js\");\n\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar ono3d = null;\nvar basecolorShader;\n\nvar loadTexture = function loadTexture(path, func) {\n  //return engine.loadEnvTexture(path);\n  //return AssetManager.texture(path,func);\n  return _assetmanager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].texture(path, function (image) {\n    var gl = _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].gl;\n    gl.disable(gl.BLEND);\n    gl.disable(gl.DEPTH_TEST);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].frameBuffer);\n    gl.viewport(0, 0, image.width, image.height);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].postEffect(image, 0, 0, 1, 1, _engine_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].basecolorShader);\n    gl.bindTexture(gl.TEXTURE_2D, image.glTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].copyImage(image, 0, 0, 0, 0, image.width, image.height);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  });\n}; //fカーブのモードを数値コードに変換するテーブル\n\n\nvar fcurveConvert = {};\nfcurveConvert[\"rotation_quaternion\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].ROT_QUAT;\nfcurveConvert[\"rotation_euler\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].ROT_EULER;\nfcurveConvert[\"location\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].LOCATION;\nfcurveConvert[\"scale\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].SCALE;\nfcurveConvert[\"offset\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].OFFSET;\nfcurveConvert[\"value\"] = _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].SHAPEKEY;\n\nvar O3o = /*#__PURE__*/function () {\n  function O3o() {\n    _classCallCheck(this, O3o);\n\n    //モデルデータ\n    this.scenes = []; //シーン情報\n\n    this.collections = [];\n    this.objects = []; //オブジェクト情報\n\n    this.objects_name_hash = [];\n    this.materials = []; //マテリアル\n\n    this.meshes = []; //メッシュ\n\n    this.meshes_name_hash = []; //メッシュ(名前ハッシュ)\n\n    this.armatures = []; //スケルトン\n\n    this.actions = []; //アニメーション\n\n    this.lights = []; //照明\n\n    this.environments = [];\n    this.reflectionProbes = []; //反射プローブ\n  }\n\n  _createClass(O3o, [{\n    key: \"getCollectionObjectList\",\n    value: function getCollectionObjectList(collection_name) {\n      var _this = this;\n\n      var objects = [];\n      var collection = this.collections[collection_name];\n      if (!collection) return objects;\n      collection.children.forEach(function (value) {\n        //入れ子の場合\n        var children = _this.getCollectionObjectList(value);\n\n        objects = objects.concat(children);\n      });\n      collection.objects.forEach(function (e) {\n        objects.push(_this.objects_name_hash[e]);\n      }); //objects = objects.concat(collection.objects);\n\n      return objects;\n    }\n  }, {\n    key: \"createInstance\",\n    value: function createInstance() {\n      return new _o3oinstance_js__WEBPACK_IMPORTED_MODULE_34__[\"default\"](this);\n    }\n  }]);\n\n  return O3o;\n}();\n\n_defineProperty(O3o, \"Material\", _material_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"]);\n\n\n;\n\nO3o.setOno3d = function (a) {\n  ono3d = a;\n  window.ono3d = a;\n};\n\nvar onloadfunc = function onloadfunc(o3o, url, buf) {\n  var i, imax, j, jmax; //if(buf.substring(0,11) ===\"Metasequoia\"){\n  //}else if(buf.substring(0,16) ==='{\"format\":\"Ono3d'){\n\n  loadO3o(o3o, url, buf); //}else{\n  //\treturn\n  //}\n\n  var res = /.*\\//.exec(url);\n  var currentdir = \"\";\n  var texture;\n  if (res) currentdir = res[0];\n  o3o.name = url;\n  res = /[^\\/]*$/.exec(url);\n  if (res) o3o.name = res[0];\n\n  var loadMap = function loadMap(_path, flg) {\n    if (_path === \"\") return null;\n    var res = /[^\\\\\\/]*$/.exec(_path);\n    var path = currentdir + res[0];\n\n    var func = function func(image) {\n      var gl = _lib_rastgl_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].gl;\n      gl.bindTexture(gl.TEXTURE_2D, image.glTexture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT); //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    };\n\n    if (flg) {\n      return _assetmanager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].bumpTexture(path, func);\n    } else {\n      return loadTexture(path, func);\n    }\n  };\n\n  o3o.objects.forEach(function (e) {\n    o3o.objects_name_hash[e.name_full] = e;\n  });\n  o3o.meshes.forEach(function (e) {\n    o3o.meshes_name_hash[e.name_full] = e;\n  });\n\n  for (i = o3o.scenes.length; i--;) {\n    var scene = o3o.scenes[i];\n\n    for (j = scene.objects.length; j--;) {\n      scene.objects[j] = o3o.objects.find(function (a) {\n        return a.name === this;\n      }, scene.objects[j]);\n    }\n\n    if (scene.world.envTexture) {\n      var res = /[^\\\\\\/]*$/.exec(scene.world.envTexture);\n      var path = currentdir + res[0];\n      scene.world.envTexture = engine.loadEnvTexture(path);\n    }\n  } //loadtexture\n\n\n  for (i = o3o.materials.length; i--;) {\n    var material = o3o.materials[i];\n    material.baseColorMap = loadMap(material.baseColorMap, 0);\n    material.pbrMap = loadMap(material.pbrMap, 0);\n    material.hightMap = loadMap(material.hightMap, 1);\n    material.lightMap = loadMap(material.lightMap, 0);\n\n    if (material.shader !== \"\") {\n      if (ono3d.shaders[material.shader]) {\n        continue;\n      }\n\n      var currentpath = _lib_util_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].getCurrent();\n      var filename = material.shader;\n      ono3d.shaders[filename] = _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadShader(currentdir + filename + \".shader\");\n    }\n  } //edge\n\n\n  var addEdge = function addEdge(edges, v0, v1, f) {\n    var i, imax;\n\n    for (i = 0, imax = edges.length; i < imax; i++) {\n      if (edges[i].vIndices[0] === v0 && edges[i].vIndices[1] === v1 || edges[i].vIndices[0] === v1 && edges[i].vIndices[1] === v0) {\n        if (edges[i].fIndices[0] < 0) {\n          edges[i].fIndices[0] = f;\n        } else {\n          edges[i].fIndices[1] = f;\n        }\n\n        return 0;\n      }\n    }\n\n    var edge = new _edge_js__WEBPACK_IMPORTED_MODULE_33__[\"default\"]();\n    edge.vIndices[0] = v0;\n    edge.vIndices[1] = v1;\n    edge.fIndices[0] = f;\n    edge.fIndices[1] = -1;\n    edges.push(edge);\n    return 1;\n  };\n\n  for (i = 0; i < o3o.meshes.length; i++) {\n    var faces = o3o.meshes[i].faces;\n    var edges;\n\n    if (o3o.meshes[i].edges) {\n      edges = o3o.meshes[i].edges;\n    } else {\n      edges = [];\n      o3o.meshes[i].edges = edges;\n    }\n\n    for (j = 0, jmax = faces.length; j < jmax; j++) {\n      var face = faces[j];\n\n      if (face.idx[3] >= 0) {\n        face.idxnum = 4;\n      } else {\n        face.idxnum = 3;\n      }\n\n      for (var k = 0; k < face.idxnum - 1; k++) {\n        addEdge(edges, face.idx[k], face.idx[k + 1], j);\n      }\n\n      addEdge(edges, face.idx[face.idxnum - 1], face.idx[0], j);\n    }\n\n    o3o.meshes[i].edgeSize = edges.length;\n    var edges2 = _edge_js__WEBPACK_IMPORTED_MODULE_33__[\"default\"].array(o3o.meshes[i].edgeSize);\n\n    for (j = 0; j < edges.length; j++) {\n      var t = edges2[j].vIndices;\n      new Int8Array(t.buffer, t.byteOffset).set(new Int8Array(edges[j].vIndices.buffer));\n    }\n\n    o3o.meshes[i].edges = edges2;\n  }\n\n  var bind = function bind(object, modifier) {\n    var mod = new _mesh_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"]();\n    freezeMesh(mod, modifier.object);\n    freezeMesh(_bufmesh_js__WEBPACK_IMPORTED_MODULE_37__[\"default\"], object);\n    var binddata = [];\n    var O3o1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.poolAlloc();\n    var O3o2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.poolAlloc();\n    var BINDSIZE = 2;\n\n    for (var i = 0; i < _bufmesh_js__WEBPACK_IMPORTED_MODULE_37__[\"default\"].vertexSize; i++) {\n      var pos = _bufmesh_js__WEBPACK_IMPORTED_MODULE_37__[\"default\"].vertices[i].pos;\n      var binds = [];\n\n      for (var j = 0; j < mod.faceSize; j++) {\n        //近い面を探す\n        var l = 99999999;\n\n        for (var k = 0; k < mod.faces[j].idxnum - 2; k++) {\n          _lib_geono_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].TRIANGLE_POINT(O3o1, mod.vertices[mod.faces[j].idx[0]].pos, mod.vertices[mod.faces[j].idx[1 + k]].pos, mod.vertices[mod.faces[j].idx[2 + k]].pos, pos);\n          l = Math.min(l, _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.len2(O3o1, pos));\n        } //頂点に既にバインドされている面より近い場合はバインドデータ付与\n\n\n        var k = 0;\n\n        for (k = 0; k < binds.length; k++) {\n          if (binds[k].weight > l) {\n            break;\n          }\n        }\n\n        if (k < BINDSIZE) {\n          var bind = {\n            idx: -1,\n            weight: 99999,\n            len: 0,\n            pweight: [0, 0, 0]\n          };\n          bind.idx = j;\n          bind.weight = l;\n          binds.splice(k, 0, bind);\n          binds.splice(BINDSIZE, binds.length - BINDSIZE);\n        }\n      }\n\n      var sum = 0;\n      var v = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.poolAlloc();\n\n      for (var j = 0; j < binds.length; j++) {\n        var bind = binds[j]; //ウェイト変換\n\n        if (bind.weight === 0) {\n          //面との距離が0の場合はウェイト1で終了\n          for (var k = 0; k < bind.length; k++) {\n            binds[k].weight = 0;\n          }\n\n          bind.weight = 1;\n          sum = 1;\n          break;\n        }\n\n        bind.weight = 1 / Math.sqrt(bind.weight); //距離の逆数をウェイトにする\n\n        sum += bind.weight; //総ウェイト\n        //面との位置関係を求める\n\n        var face = mod.faces[bind.idx];\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.cross2(O3o1, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.norm(O3o1);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.sub(O3o2, pos, mod.vertices[face.idx[0]].pos);\n        bind.len = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.dot(O3o1, O3o2); //法線距離\n\n        if (face.idxnum == 4) {\n          _lib_geono_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].calcSquarePos(bind.pweight, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos, mod.vertices[face.idx[3]].pos, pos);\n          bind.pweight[2] = bind.pweight[0] * bind.pweight[1];\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.sub(v, mod.vertices[face.idx[2]].pos, mod.vertices[face.idx[1]].pos);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.add(v, mod.vertices[face.idx[0]].pos, v);\n          _lib_geono_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].calcSquarePos(bind.pweight, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos, v, pos);\n          bind.pweight[2] = 0;\n        }\n\n        bind.pweight[3] = bind.len;\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.poolFree(1);\n      sum = 1 / sum;\n\n      for (var j = 0; j < binds.length; j++) {\n        binds[j].weight *= sum; //ウェイトの総計1になるようスケーリング\n      }\n\n      binddata.push(binds);\n    }\n\n    modifier.binddata = binddata;\n    var basePos = [];\n\n    for (var i = 0; i < mod.vertexSize; i++) {\n      basePos.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3());\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.copy(basePos[i], mod.vertices[i].pos);\n    }\n\n    modifier.basePos = basePos;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.poolFree(2);\n  };\n};\n\nO3o.load = function (url, callback) {\n  var o3o = new O3o();\n  _lib_util_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].loadText(url, function (buf) {\n    if (!buf) {\n      //失敗時\n      if (callback) {\n        callback(null);\n      }\n    } else {\n      onloadfunc(o3o, url, buf);\n\n      if (callback) {\n        callback(o3o);\n      }\n    }\n  });\n  return o3o;\n};\n\nvar classes = {}; //classes[\"materials\"]=Material;\n//classes[\"meshes\"]=Mesh;\n//classes[\"vertices\"]=Vertex;\n//classes[\"faces\"]=Face;\n\nclasses[\"armatures\"] = _armature_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"];\nclasses[\"actions\"] = _action_js__WEBPACK_IMPORTED_MODULE_23__[\"default\"];\nclasses[\"objects\"] = _sceneobject_js__WEBPACK_IMPORTED_MODULE_22__[\"default\"];\nclasses[\"scenes\"] = _scene_js__WEBPACK_IMPORTED_MODULE_20__[\"default\"];\nclasses[\"lights\"] = _light_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"];\nclasses[\"reflectionprobes\"] = _reflectionprobe_js__WEBPACK_IMPORTED_MODULE_29__[\"default\"];\nclasses[\"bones\"] = _bone_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"];\nclasses[\"uv_layers\"] = _uvlayer_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"];\nclasses[\"fcurves\"] = _fcurve_js__WEBPACK_IMPORTED_MODULE_24__[\"default\"];\n\nvar setdata2 = function setdata2(dst, src) {\n  for (var member in src) {\n    var srcdata = src[member];\n    var dstdata = dst[member];\n    if (srcdata == null) continue;\n\n    var to = _typeof(srcdata);\n\n    if (to == \"string\" || to == \"number\") {\n      dst[member] = srcdata;\n    } else if (dstdata instanceof Int8Array || dstdata instanceof Int16Array) {\n      for (var i = 0; i < srcdata.length; i++) {\n        dstdata[i] = srcdata[i] | 0;\n      }\n    } else if (dstdata instanceof Float32Array) {\n      for (var i = 0; i < srcdata.length; i++) {\n        dstdata[i] = srcdata[i];\n      }\n    } else if (dstdata instanceof Array && srcdata.length > 0) {\n      if (typeof srcdata[0] == \"string\" || typeof srcdata[0] == \"number\") {\n        dst[member] = srcdata;\n      } else if (classes[member]) {\n        for (var i = 0; i < srcdata.length; i++) {\n          var obj = new classes[member]();\n          setdata2(obj, srcdata[i]);\n          dstdata.push(obj);\n        }\n      } else if (dstdata.length > 0) {\n        for (var i = 0; i < srcdata.length; i++) {\n          setdata2(dstdata[i], srcdata[i]);\n        }\n      } else {\n        dst[member] = srcdata;\n      }\n    } else {\n      dst[member] = srcdata;\n    }\n  }\n};\n\nvar loadO3o = function loadO3o(o3o, url, buf) {\n  var res = /.*\\//.exec(url);\n  var currentdir = \"./\";\n  if (res) currentdir = res[0];\n  var raw = JSON.parse(buf);\n  var size = raw.materials.length;\n\n  for (var i = 0; i < size; i++) {\n    o3o.materials.push(new _material_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"]());\n  }\n\n  size = raw.meshes.length;\n\n  for (var i = 0; i < size; i++) {\n    var rawdata = raw.meshes[i];\n    var mesh = new _mesh_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"]();\n    o3o.meshes.push(mesh);\n    mesh.vertices = _vertex_js__WEBPACK_IMPORTED_MODULE_31__[\"default\"].array(rawdata.vertices.length);\n    mesh.faces = _face_js__WEBPACK_IMPORTED_MODULE_32__[\"default\"].array(rawdata.faces.length);\n  }\n\n  setdata2(o3o, raw);\n\n  for (var type in o3o) {\n    if (type === \"collections\") continue; //1層目のオブジェクトには親のリンク作っとく\n\n    var arrays = o3o[type];\n\n    if (arrays instanceof Array) {\n      for (var i = 0; i < arrays.length; i++) {\n        arrays[i].o3o = o3o;\n      }\n    }\n  } //オブジェクトを連想配列\n\n\n  for (j = o3o.objects.length; j--;) {//o3o.objects[o3o.objects[j].name]=o3o.objects[j] ;\n  } //アクションを連想配列\n\n\n  for (j = o3o.actions.length; j--;) {\n    o3o.actions[o3o.actions[j].name] = o3o.actions[j];\n  } //コレクションを設定\n\n\n  for (var key in o3o.collections) {\n    var obj = o3o.collections[key];\n\n    for (var i = 0; i < obj.children.length; i++) {\n      obj.children[i] = o3o.collections[obj.children[i]];\n    } //for(var i=0;i<obj.objects.length;i++){\n    //\tobj.objects[i]= o3o.objects[obj.objects[i]];\n    //}\n\n  }\n\n  ; //オブジェクトのdataをアドレスに変換\n\n  var typedatas = {\n    \"MESH\": {\n      objecttype: _objecttype_js__WEBPACK_IMPORTED_MODULE_18__[\"default\"].MESH,\n      target: \"meshes\"\n    },\n    \"ARMATURE\": {\n      objecttype: _objecttype_js__WEBPACK_IMPORTED_MODULE_18__[\"default\"].ARMATURE,\n      target: \"armatures\"\n    },\n    \"LIGHT\": {\n      objecttype: _objecttype_js__WEBPACK_IMPORTED_MODULE_18__[\"default\"].LIGHT,\n      target: \"lights\"\n    },\n    \"LIGHT_PROBE\": {\n      objecttype: _objecttype_js__WEBPACK_IMPORTED_MODULE_18__[\"default\"].REFLECTIONPROBE,\n      target: \"reflectionProbes\"\n    }\n  };\n  var scene, name, object, objects;\n\n  for (j = o3o.objects.length; j--;) {\n    object = o3o.objects[j];\n    var typedata = typedatas[object.type];\n\n    if (typedata) {\n      object.objecttype = typedata.objecttype;\n      var data = null;\n      data = o3o[typedata.target].find(function (a) {\n        return a.name_full === this;\n      }, object.data);\n\n      if (!data) {\n        data = o3o[typedata.target].find(function (a) {\n          return a.name === this;\n        }, object.data);\n      }\n\n      object.data = data;\n    } else {\n      object.objecttype = \"\";\n      object.data = null;\n    }\n\n    object.parent = o3o.objects.find(function (a) {\n      return a.name === this;\n    }, object.parent);\n\n    for (k = 0; k < object.modifiers.length; k++) {\n      //object.modifiers[k].object=o3o.objects.find(function(a){return a.name === this;},object.modifiers[k].object)\n      var name = object.modifiers[k].vertex_group;\n      object.modifiers[k].vertex_group = -1;\n\n      for (var l = 0; l < object.groups.length; l++) {\n        if (object.groups[l] === name) {\n          object.modifiers[k].vertex_group = l;\n          break;\n        }\n      }\n    }\n\n    object.action = o3o.actions.find(function (a) {\n      return a.name === this;\n    }, object.action);\n\n    if (object.rigid_body_constraint) {\n      object.rigid_body_constraint.object1 = o3o.objects.find(function (a) {\n        return a.name === this;\n      }, object.rigid_body_constraint.object1);\n      object.rigid_body_constraint.object2 = o3o.objects.find(function (a) {\n        return a.name === this;\n      }, object.rigid_body_constraint.object2);\n    }\n  }\n\n  for (var i = 0; i < o3o.meshes.length; i++) {\n    var mesh = o3o.meshes[i];\n\n    for (var j = 0; j < mesh.vertices.length; j++) {\n      //ウェイト自動設定\n      var vertex = mesh.vertices[j];\n\n      if (vertex.groupWeights.length == 0) {\n        for (var i = 0; i < vertex.groups.length; i++) {\n          vertex.groupWeights.push(1.0 / vertex.groups.length);\n        }\n      }\n    }\n\n    mesh.vertexSize = mesh.vertices.length;\n\n    for (var j = 0; j < mesh.faces.length; j++) {\n      //三角ポリか四角ポリか\n      var face = mesh.faces[j];\n\n      for (var k = 0; k < 4; k++) {\n        if (face.idx[k] < 0) break;\n      }\n\n      face.idxnum = k;\n    }\n\n    mesh.faceSize = mesh.faces.length;\n    mesh.uv_layerSize = mesh.uv_layers.length;\n\n    if (mesh.double_sided) {\n      mesh.flg &= ~_lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].RF_DOUBLE_SIDED;\n      mesh.flg |= _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].RF_DOUBLE_SIDED;\n      delete mesh.double_sided;\n    }\n  }\n\n  for (var i = 0; i < o3o.actions.length; i++) {\n    var action = o3o.actions[i];\n\n    for (var j = 0; j < action.fcurves.length; j++) {\n      //フレームとパラメータ値を分ける\n      var fcurve = action.fcurves[j];\n      var keys = fcurve.keys;\n      delete fcurve.keys;\n      fcurve.keys = [];\n      fcurve.params = [];\n\n      for (var k = 0; k < keys.length; k++) {\n        fcurve.keys.push(keys[k].f);\n        fcurve.params.push(keys[k].p);\n      }\n\n      fcurve.type = fcurveConvert[fcurve.type]; //文字列をコードに変換\n    }\n  }\n\n  for (j = o3o.objects.length; j--;) {\n    var object = o3o.objects[j];\n\n    if (object.type === \"ARMATURE\") {\n      object.pose = new _pose_js__WEBPACK_IMPORTED_MODULE_16__[\"default\"](object.data);\n      object.pose.object = object;\n\n      if (object.poseBones) {\n        for (var k = 0; k < object.poseBones.length; k++) {\n          var poseBone = object.poseBones[k];\n\n          if (poseBone.constraints) {\n            for (var l = 0; l < poseBone.constraints.length; l++) {\n              var constraint = poseBone.constraints[l];\n              constraint.target = o3o.objects.find(function (a) {\n                return a.name === this;\n              }, constraint.target);\n            }\n          } else {\n            poseBone.constraints = [];\n          }\n        }\n      }\n    }\n  }\n\n  var count = 0;\n\n  for (var i = o3o.meshes.length; i--;) {\n    mesh = o3o.meshes[i]; //マテリアルのポインタ設定\n\n    for (j = mesh.faces.length; j--;) {\n      var face = mesh.faces[j];\n      face.material = o3o.materials[face.mat];\n    }\n  } //骨の名称をアドレスに変更\n\n\n  for (var i = o3o.armatures.length; i--;) {\n    var armature = o3o.armatures[i];\n\n    for (j = armature.bones.length; j--;) {\n      var bone = armature.bones[j];\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.getInv(bone.imatrix, bone.matrix);\n      var a = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.dot(a, bone.matrix, bone.imatrix);\n\n      for (k = armature.bones.length; k--;) {\n        if (bone.parent === armature.bones[k].name) {\n          bone.parent = armature.bones[k];\n          break;\n        }\n      }\n\n      bone.id = j;\n    }\n  }\n\n  for (var j = o3o.objects.length; j--;) {\n    object = o3o.objects[j];\n\n    if (object.parent) {\n      if (object.parent_bone) {\n        for (var i = 0; i < object.parent.data.bones.length; i++) {\n          if (object.parent_bone == object.parent.data.bones[i].name) {\n            object.parent_bone = i + 1;\n          }\n        }\n      }\n    }\n  }\n\n  return o3o;\n};\n\nvar addaction = O3o.addaction = function (obj, name, action, frame) {\n  var a,\n      b,\n      c,\n      tim,\n      ratio,\n      fcurve,\n      keys,\n      mat43,\n      paramA,\n      paramB,\n      quat = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec4.poolAlloc();\n  ;\n  frame = frame % action.endframe;\n\n  for (var i = 0, imax = action.fcurves.length; i < imax; i++) {\n    if (action.fcurves[i].target !== name) continue;\n    fcurve = action.fcurves[i];\n    keys = fcurve.keys;\n    tim = frame;\n    a = 0;\n    b = fcurve.keys.length - 1;\n\n    switch (fcurve.repeatmode) {\n      case _repeatmode_js__WEBPACK_IMPORTED_MODULE_28__[\"default\"].NONE:\n        if (tim < keys[a]) tim = keys[a];\n        if (tim > keys[b]) tim = keys[b];\n        break;\n\n      case _repeatmode_js__WEBPACK_IMPORTED_MODULE_28__[\"default\"].LOOP:\n        if (tim < keys[a]) tim = keys[b] - (keys[a] - tim) % (keys[b] - keys[a]);\n        if (tim > keys[b]) tim = keys[a] + (tim - keys[b]) % (keys[b] - keys[a]);\n        break;\n\n      case _repeatmode_js__WEBPACK_IMPORTED_MODULE_28__[\"default\"].LINER:\n        break;\n    }\n\n    while (a < b) {\n      c = a + b >> 1;\n\n      if (keys[c] <= tim) {\n        a = c + 1;\n      } else {\n        b = c;\n      }\n    }\n\n    if (tim === keys[a]) {\n      ratio = 0;\n      paramA = fcurve.params[a];\n      paramB = paramA; //fcurve.params[a]\n    } else {\n      if (a > 0) a--;\n      ratio = (tim - keys[a]) / (keys[a + 1] - keys[a]);\n      ratio = ratio * ratio * (3 - 2 * ratio);\n      paramA = fcurve.params[a];\n      paramB = fcurve.params[a + 1];\n    }\n\n    if (fcurve.type == _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].ROT_QUAT) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec4.slerp(obj.rotation, paramA, paramB, ratio);\n    } else {\n      var target;\n\n      switch (fcurve.type) {\n        case _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].ROT_EULER:\n          target = obj.rotation;\n          break;\n\n        case _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].SCALE:\n          target = obj.scale;\n          break;\n\n        case _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].LOCATION:\n          target = obj.location;\n          break;\n\n        case _fcurvemode_js__WEBPACK_IMPORTED_MODULE_27__[\"default\"].OFFSET:\n          target = obj.offset;\n          break;\n      }\n\n      target[fcurve.idx] = (paramB - paramA) * ratio + paramA;\n    }\n  }\n\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec4.poolFree(1);\n};\n\nvar copyFace = function copyFace(dst, src) {\n  dst.vertices[0] = src.vertices[0];\n  dst.vertices[1] = src.vertices[1];\n  dst.vertices[2] = src.vertices[2];\n  dst.environments[0] = src.environments[0];\n  dst.environments[1] = src.environments[1];\n  dst.environmentRatio = src.environmentRatio;\n  dst.material = src.material;\n};\n\nO3o.drawStaticFaces = function (faces) {\n  var idx = ono3d.faces_index;\n  var renderFaces = ono3d.faces;\n\n  for (var i = 0; i < faces.length; i++) {\n    copyFace(renderFaces[idx + i], faces[i]);\n  }\n\n  ono3d.faces_index += faces.length;\n  return;\n};\n\nO3o.setEnvironments = function (scene) {\n  var m = _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.poolAlloc();\n  var environment;\n\n  for (var i = 0; i < scene.objects.length; i++) {\n    //ライト設定\n    var object = scene.objects[i];\n    if (object.type !== \"LIGHT\") continue;\n    environment = ono3d.environments[0];\n    var ol = object.data;\n    var light;\n\n    if (ol.type === \"SUN\") {\n      light = environment.sun;\n    } else {\n      light = environment.area;\n    }\n\n    light.power = 1;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Vec3.copy(light.color, ol.color);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.fromLSE(m, object.location, object.scale, object.rotation); //ライトの姿勢行列\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat44.dotMat43(light.matrix, ono3d.worldMatrix, m); //ワールド行列で変換\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.fromRotVector(m, Math.PI * 0.5, 1, 0, 0); //ライトはデフォルト姿勢で下向きなので補正\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat44.dotMat43(light.matrix, light.matrix, m);\n    ono3d.setOrtho(10.0, 10.0, 0.1, 80.0);\n    var mat44 = ono3d.viewMatrix;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat44.getInv(mat44, light.matrix);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat44.dot(light.viewmatrix, ono3d.projectionMatrix, mat44); //影生成用のビュー行列\n  }\n\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_36__.Mat43.poolFree(1);\n}; // ------------------------  インスタンス ---------------------\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/o3o.js?");

/***/ }),

/***/ "../lib/engine/o3o/o3oinstance.js":
/*!****************************************!*\
  !*** ../lib/engine/o3o/o3oinstance.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ O3oInstance; }\n/* harmony export */ });\n/* harmony import */ var _o3o_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/onophy/onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _sceneobjectinstance_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sceneobjectinstance.js */ \"../lib/engine/o3o/sceneobjectinstance.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\n\n\nvar O3oInstance = /*#__PURE__*/function () {\n  function O3oInstance(o3o, _objects) {\n    _classCallCheck(this, O3oInstance);\n\n    this.objectInstances = [];\n    this.objectInstances_hash = [];\n    var objects;\n\n    if (_objects) {\n      objects = _objects;\n    } else {\n      objects = o3o.objects;\n    }\n\n    for (var i = 0; i < objects.length; i++) {\n      //オブジェクトのインスタンスを作成\n      var object = objects[i];\n\n      if (object == null) {\n        continue;\n      }\n\n      object.idx = i;\n      var instance = new _sceneobjectinstance_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](object);\n      instance.o3oInstance = this;\n      this.objectInstances.push(instance);\n      this.objectInstances_hash[object.name] = instance;\n    } //オブジェクトインスタンス初期化\n\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat44.setInit(ono3d.worldMatrix);\n    this.calcMatrix(0, true);\n\n    for (var i = 0; i < objects.length; i++) {\n      //ジョイント作成\n      if (!objects[i].rigid_body_constraint) continue;\n      var joint = createPhyJoint(objects[i], this.objectInstances);\n      this.objectInstances[i].joint = joint;\n    }\n\n    for (i = 0; i < objects.length; i++) {\n      //メッシュ変形のバインド\n      var object = objects[i];\n      var instance = this.objectInstances[i];\n\n      for (var j = 0; j < object.modifiers.length; j++) {\n        if (object.modifiers[j].type === \"MESH_DEFORM\") {\n          var ins2 = this.objectInstances[object.modifiers[j].object.name];\n          bind(instance, ins2, object.modifiers[j]);\n        }\n      }\n    }\n  }\n\n  _createClass(O3oInstance, [{\n    key: \"searchObject\",\n    value: function searchObject(name) {\n      var children = this.objectInstances;\n      var result = children.find(function (child) {\n        return child.object.name === name;\n      });\n\n      if (result) {\n        return result;\n      }\n\n      children.forEach(function (child) {\n        result = child.searchObject(name);\n\n        if (result) {\n          return false;\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"calcMatrix\",\n    value: function calcMatrix(dt, flg) {\n      for (var i = 0; i < this.objectInstances.length; i++) {\n        this.objectInstances[i].resetMatrix();\n      }\n\n      for (var i = 0; i < this.objectInstances.length; i++) {\n        this.objectInstances[i].calcMatrix(dt, flg);\n      }\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      this.objectInstances.forEach(function (e) {\n        if (e.object.hide_render) {\n          return;\n        }\n\n        e.draw();\n      });\n    }\n  }, {\n    key: \"joinPhyObj\",\n    value: function joinPhyObj(onoPhy) {\n      //物理オブジェクトを登録\n      var objectInstances = this.objectInstances;\n      var imat = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43();\n\n      for (var i = 0; i < objectInstances.length; i++) {\n        if (objectInstances[i].phyObj) {\n          onoPhy.addPhyObj(objectInstances[i].phyObj);\n        }\n      }\n\n      for (var i = 0; i < objectInstances.length; i++) {\n        if (objectInstances[i].joint) {\n          var joint = objectInstances[i].joint; //接続差異行列設定\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.getInv(imat, joint.parent.matrix);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.dot(joint.matrix, imat, objectInstances[i].matrix);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.getInv(imat, joint.child.matrix);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.dot(joint.matrix2, imat, objectInstances[i].matrix);\n          onoPhy.addJoint(objectInstances[i].joint);\n        }\n      }\n    }\n  }]);\n\n  return O3oInstance;\n}();\n\n\n\nvar bind = function bind(instance, ins2, modifier) {\n  var object = instance.object;\n  var mod = new Mesh();\n  mod.ratios = [];\n  mod.vertices = Vertex.array(MAX_SIZE);\n  mod.faces = Face.array(MAX_SIZE);\n  mod.edges = Edge.array(MAX_SIZE);\n\n  for (i = 0; i < MAX_SIZE; i++) {\n    //mod.faces.push(new Face());\n    //mod.edges.push(new Edge());\n    mod.ratios.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec4());\n  }\n\n  ;\n  ins2.freezeMesh(mod);\n  instance.freezeMesh(bufMesh);\n  var binddata = [];\n  var ret1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.poolAlloc();\n  var ret2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.poolAlloc();\n  var BINDSIZE = 2;\n\n  for (var i = 0; i < bufMesh.vertexSize; i++) {\n    var pos = bufMesh.vertices[i].pos;\n    var binds = [];\n\n    for (var j = 0; j < mod.faceSize; j++) {\n      //近い面を探す\n      var l = 99999999;\n\n      for (var k = 0; k < mod.faces[j].idxnum - 2; k++) {\n        Geono.TRIANGLE_POINT(ret1, mod.vertices[mod.faces[j].idx[0]].pos, mod.vertices[mod.faces[j].idx[1 + k]].pos, mod.vertices[mod.faces[j].idx[2 + k]].pos, pos);\n        l = Math.min(l, _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.len2(ret1, pos));\n      } //頂点に既にバインドされている面より近い場合はバインドデータ付与\n\n\n      var k = 0;\n\n      for (k = 0; k < binds.length; k++) {\n        if (binds[k].weight > l) {\n          break;\n        }\n      }\n\n      if (k < BINDSIZE) {\n        var bind = {\n          idx: -1,\n          weight: 99999,\n          len: 0,\n          pweight: [0, 0, 0]\n        };\n        bind.idx = j;\n        bind.weight = l;\n        binds.splice(k, 0, bind);\n        binds.splice(BINDSIZE, binds.length - BINDSIZE);\n      }\n    }\n\n    var sum = 0;\n    var v = _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.poolAlloc();\n\n    for (var j = 0; j < binds.length; j++) {\n      var bind = binds[j]; //ウェイト変換\n\n      if (bind.weight === 0) {\n        //面との距離が0の場合はウェイト1で終了\n        for (var k = 0; k < bind.length; k++) {\n          binds[k].weight = 0;\n        }\n\n        bind.weight = 1;\n        sum = 1;\n        break;\n      }\n\n      bind.weight = 1 / Math.sqrt(bind.weight); //距離の逆数をウェイトにする\n\n      sum += bind.weight; //総ウェイト\n      //面との位置関係を求める\n\n      var face = mod.faces[bind.idx];\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.cross2(ret1, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.norm(ret1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.sub(ret2, pos, mod.vertices[face.idx[0]].pos);\n      bind.len = _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.dot(ret1, ret2); //法線距離\n\n      if (face.idxnum == 4) {\n        Geono.calcSquarePos(bind.pweight, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos, mod.vertices[face.idx[3]].pos, pos);\n        bind.pweight[2] = bind.pweight[0] * bind.pweight[1];\n      } else {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.sub(v, mod.vertices[face.idx[2]].pos, mod.vertices[face.idx[1]].pos);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.add(v, mod.vertices[face.idx[0]].pos, v);\n        Geono.calcSquarePos(bind.pweight, mod.vertices[face.idx[0]].pos, mod.vertices[face.idx[1]].pos, mod.vertices[face.idx[2]].pos, v, pos);\n        bind.pweight[2] = 0;\n      }\n\n      bind.pweight[3] = bind.len;\n    }\n\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.poolFree(1);\n    sum = 1 / sum;\n\n    for (var j = 0; j < binds.length; j++) {\n      binds[j].weight *= sum; //ウェイトの総計1になるようスケーリング\n    }\n\n    binddata.push(binds);\n  }\n\n  modifier.binddata = binddata;\n  var basePos = [];\n\n  for (var i = 0; i < mod.vertexSize; i++) {\n    basePos.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3());\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(basePos[i], mod.vertices[i].pos);\n  }\n\n  modifier.basePos = basePos;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.poolFree(2);\n};\n\nvar createPhyJoint = function createPhyJoint(sceneObject, objectInstances) {\n  var search = function search(name) {\n    //物理オブジェクト一覧から名前で探す\n    for (var j = 0; j < objectInstances.length; j++) {\n      if (name == objectInstances[j].object.name) {\n        return objectInstances[j].phyObj;\n      }\n    }\n\n    return null;\n  };\n\n  var rbc = sceneObject.rigid_body_constraint; //剛体コンストレイント情報\n\n  if (!rbc.enabled || !rbc.object1 || !rbc.object2) {\n    //ジョイント情報無しもしくは不十分な場合は無視\n    return;\n  }\n\n  var joint = null; //ジョイント作成\n\n  joint = new _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].Joint(); //onoPhy.createJoint();\n  //パラメータセット\n\n  joint.breaking_threshold = rbc.breaking_threshold;\n  joint.disable_collisions = rbc.disable_collisions;\n  joint.enabled = rbc.enabled;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.limit_ang_lower, rbc.limit_ang_lower);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.limit_ang_upper, rbc.limit_ang_upper);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.limit_lin_lower, rbc.limit_lin_lower);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.limit_lin_upper, rbc.limit_lin_upper);\n  joint.motor_ang_max_impulse = rbc.motor_ang_max_impulse;\n  joint.motor_ang_target_velocity = rbc.motor_ang_target_velocity;\n  joint.motor_lin_max_impulse = rbc.motor_lin_max_impulse;\n  joint.motor_lin_target_velocity = rbc.motor_lin_target_velocity;\n  joint.object1 = rbc.object1;\n  joint.object2 = rbc.object2;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.spring_damping, rbc.spring_damping);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.spring_stiffness, rbc.spring_stiffness);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.spring_damping_ang, rbc.spring_damping_ang);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.spring_stiffness_ang, rbc.spring_stiffness_ang);\n  joint.use_breaking = rbc.use_breaking;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.use_limit_ang, rbc.use_limit_ang);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.use_limit_lin, rbc.use_limit_lin);\n  joint.use_motor_ang = rbc.use_motor_ang;\n  joint.use_motor_lin = rbc.use_motor_lin;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.use_spring, rbc.use_spring);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.copy(joint.use_spring_ang, rbc.use_spring_ang); //ジョイントタイプによって制限を設ける\n\n  var flg = 0;\n\n  if (rbc.type == \"FIXED\") {\n    flg = 0x77;\n  } else if (rbc.type == \"POINT\") {\n    flg = 0x07;\n  } else if (rbc.type == \"HINGE\") {\n    flg = 0x57;\n  } else if (rbc.type == \"SLIDER\") {\n    flg = 0x76;\n  } else if (rbc.type == \"PISTON\") {\n    flg = 0x66;\n  }\n\n  for (var i = 0; i < 3; i++) {\n    if (flg >> i & 0x1) {\n      joint.use_limit_lin[i] = 1;\n      joint.limit_lin_upper[i] = 0;\n      joint.limit_lin_lower[i] = 0;\n    }\n\n    if (flg >> i & 0x10) {\n      joint.use_limit_ang[i] = 1;\n      joint.limit_ang_upper[i] = 0;\n      joint.limit_ang_lower[i] = 0;\n    }\n  }\n\n  if (rbc.type != \"GENERIC_SPRING\") {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_spring, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_spring_ang, 0, 0, 0);\n  }\n\n  if (rbc.type == \"MOTOR\") {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_limit_lin, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_limit_ang, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_spring, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Vec3.set(joint.use_spring_ang, 0, 0, 0);\n  } else {\n    joint.use_motor_lin = 0;\n    joint.use_motor_ang = 0;\n  } //ジョイント接続剛体設定\n\n\n  joint.object1 = search(joint.object1.name);\n  joint.object2 = search(joint.object2.name);\n  joint.parent = joint.object1;\n  joint.child = joint.object2;\n  var imat = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43(); //接続差異行列設定\n\n  var instance = objectInstances[sceneObject.idx];\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.getInv(imat, joint.parent.matrix);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.dot(joint.matrix, imat, instance.matrix);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.getInv(imat, joint.child.matrix);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_2__.Mat43.dot(joint.matrix2, imat, instance.matrix);\n  return joint;\n};\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/o3oinstance.js?");

/***/ }),

/***/ "../lib/engine/o3o/objecttype.js":
/*!***************************************!*\
  !*** ../lib/engine/o3o/objecttype.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar ObjectType = {\n  MESH: 1,\n  ARMATURE: 2,\n  LIGHT: 3,\n  REFLECTIONPROBE: 4\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (ObjectType);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/objecttype.js?");

/***/ }),

/***/ "../lib/engine/o3o/pose.js":
/*!*********************************!*\
  !*** ../lib/engine/o3o/pose.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Pose; }\n/* harmony export */ });\n/* harmony import */ var _o3o_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _posebone_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./posebone.js */ \"../lib/engine/o3o/posebone.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\n\nvar Pose = /*#__PURE__*/function () {\n  function Pose(armature) {\n    _classCallCheck(this, Pose);\n\n    this.armature = armature;\n    this.poseBones = []; // ボーンの状態\n\n    this.matrices = [];\n\n    for (var i = 0; i < armature.bones.length; i++) {\n      this.poseBones.push(new _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]());\n      this.matrices.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat43());\n    }\n  }\n\n  _createClass(Pose, [{\n    key: \"setAction\",\n    value: function setAction(action, frame) {\n      var armature = this.armature;\n      var poseBones = this.poseBones;\n\n      for (var i = 0; i < poseBones.length; i++) {\n        //ボーンの数だけ計算する\n        var poseBone = poseBones[i];\n        var bone = armature.bones[i]; //対象ボーンのアクションを計算\n\n        _o3o_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].addaction(poseBone, bone.name, action, frame);\n      }\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      for (var i = 0; i < this.poseBones.length; i++) {\n        this.poseBones[i].reset();\n      }\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(a, b) {\n      for (var i = 0; i < b.poseBones.length; i++) {\n        _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].copy(a.poseBones[i], b.poseBones[i]);\n      }\n    }\n  }, {\n    key: \"add\",\n    value: function add(a, b, c) {\n      for (var i = 0; i < b.poseBones.length; i++) {\n        _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].add(a.poseBones[i], b.poseBones[i], c.poseBones[i]);\n      }\n    }\n  }, {\n    key: \"sub\",\n    value: function sub(a, b, c) {\n      for (var i = 0; i < b.poseBones.length; i++) {\n        _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].sub(a.poseBones[i], b.poseBones[i], c.poseBones[i]);\n      }\n    }\n  }, {\n    key: \"madd\",\n    value: function madd(a, b, c, d) {\n      for (var i = 0; i < b.poseBones.length; i++) {\n        _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].madd(a.poseBones[i], b.poseBones[i], c.poseBones[i], d);\n      }\n    }\n  }, {\n    key: \"mul\",\n    value: function mul(a, b, c) {\n      for (var i = 0; i < b.poseBones.length; i++) {\n        _posebone_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].mul(a.poseBones[i], b.poseBones[i], c);\n      }\n    }\n  }]);\n\n  return Pose;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/pose.js?");

/***/ }),

/***/ "../lib/engine/o3o/posebone.js":
/*!*************************************!*\
  !*** ../lib/engine/o3o/posebone.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PoseBone; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _rotationmode_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rotationmode.js */ \"../lib/engine/o3o/rotationmode.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar PoseBone = /*#__PURE__*/function () {\n  function PoseBone() {\n    _classCallCheck(this, PoseBone);\n\n    //ボーン状態\n    this.location = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.rotation_mode = _rotationmode_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].QUATERNION;\n    this.rotation = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    this.scale = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.constraints = [];\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.location, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.rotation, 0, 0, 0, 0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.scale, 1, 1, 1);\n  }\n\n  _createClass(PoseBone, [{\n    key: \"reset\",\n    value: function reset() {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.location, 0, 0, 0);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.rotation, 0, 0, 0, 0);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.scale, 1, 1, 1);\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(a, b) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a.location, b.location);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a.scale, b.scale);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.copy(a.rotation, b.rotation);\n    }\n  }, {\n    key: \"add\",\n    value: function add(a, b, c) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(a.location, b.location, c.location);\n\n      for (var i = 0; i < 3; i++) {\n        a.scale[i] = b.scale[i] * c.scale[i];\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qdot(a.rotation, b.rotation, c.rotation);\n    }\n  }, {\n    key: \"sub\",\n    value: function sub(a, b, c) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(a.location, b.location, c.location);\n\n      for (var i = 0; i < 3; i++) {\n        a.scale[i] = b.scale[i] / c.scale[i];\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qmdot(a.rotation, b.rotation, c.rotation);\n    }\n  }, {\n    key: \"mul\",\n    value: function mul(a, b, c) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(a.location, b.location, c);\n\n      for (var i = 0; i < 3; i++) {\n        a.scale[i] = (b.scale[i] - 1) * c + 1;\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qmul(a.rotation, b.rotation, c);\n    }\n  }, {\n    key: \"madd\",\n    value: function madd(a, b, c, d) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a.location, b.location, c, d);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a.scale, b.scale, c, d);\n      var vec4 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n      iVec4.qmul(vec4, c, d);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qdot(a.rotation, b.rotation, vec4);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n    }\n  }]);\n\n  return PoseBone;\n}();\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/posebone.js?");

/***/ }),

/***/ "../lib/engine/o3o/reflectionprobe.js":
/*!********************************************!*\
  !*** ../lib/engine/o3o/reflectionprobe.js ***!
  \********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ReflectionProbe; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ReflectionProbe = /*#__PURE__*/_createClass(function ReflectionProbe() {\n  _classCallCheck(this, ReflectionProbe);\n\n  this.name = \"\";\n  this.type = \"\";\n  this.distance = 2;\n  this.falloff = 0.1;\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/reflectionprobe.js?");

/***/ }),

/***/ "../lib/engine/o3o/repeatmode.js":
/*!***************************************!*\
  !*** ../lib/engine/o3o/repeatmode.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar i = 0;\nvar RepeatMode = {\n  NONE: i++,\n  LOOP: i++,\n  LINER: i++,\n  SPLINE: i++\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (RepeatMode);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/repeatmode.js?");

/***/ }),

/***/ "../lib/engine/o3o/rigidbody.js":
/*!**************************************!*\
  !*** ../lib/engine/o3o/rigidbody.js ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ RigidBody; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RigidBody = /*#__PURE__*/_createClass(function RigidBody() {\n  _classCallCheck(this, RigidBody);\n\n  //剛体設定\n  this.type = \"\";\n  this.mass = 1.0;\n  this.collision_shape = \"\";\n  this.friction = 0.5;\n  this.restitution = 0.0;\n  this.bold = 0.0;\n  this.collision_groups = 0;\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/rigidbody.js?");

/***/ }),

/***/ "../lib/engine/o3o/rigidbodyconstraint.js":
/*!************************************************!*\
  !*** ../lib/engine/o3o/rigidbodyconstraint.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ RigidBodyConstraint; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar RigidBodyConstraint = /*#__PURE__*/_createClass(function RigidBodyConstraint() {\n  _classCallCheck(this, RigidBodyConstraint);\n\n  //剛体コンストレイント設定\n  this.breaking_threshold = 0.0;\n  this.disable_collisions = false;\n  this.enabled = false;\n  this.limit_ang_lower = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.limit_ang_upper = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.limit_lin_lower = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.limit_lin_upper = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.motor_ang_max_impulse = 1;\n  this.motor_ang_target_velocity = 1;\n  this.motor_lin_max_impulse = 1;\n  this.motor_lin_target_velocity = 1;\n  this.object1 = null;\n  this.object2 = null;\n  this.spring_damping = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.spring_stiffness = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.spring_damping_ang = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.spring_stiffness_ang = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.use_breaking = 0;\n  this.use_limit_ang = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.use_limit_lin = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.use_motor_ang = 0;\n  this.use_motor_lin = 0;\n  this.use_spring = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.use_spring_ang = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.type = \"\";\n});\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/rigidbodyconstraint.js?");

/***/ }),

/***/ "../lib/engine/o3o/rotationmode.js":
/*!*****************************************!*\
  !*** ../lib/engine/o3o/rotationmode.js ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar RotationMode = {\n  QUATERNION: 0,\n  EULER_XYZ: 1,\n  EULER_XZY: 6,\n  EULER_YXZ: 5,\n  EULER_YZX: 2,\n  EULER_ZXY: 4,\n  EULER_ZYX: 3\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (RotationMode);\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/rotationmode.js?");

/***/ }),

/***/ "../lib/engine/o3o/scene.js":
/*!**********************************!*\
  !*** ../lib/engine/o3o/scene.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Scene; }\n/* harmony export */ });\n/* harmony import */ var _o3o_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _objecttype_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./objecttype.js */ \"../lib/engine/o3o/objecttype.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar Scene = /*#__PURE__*/function () {\n  function Scene() {\n    _classCallCheck(this, Scene);\n\n    //シーン\n    this.name = \"\"; //名前\n\n    this.frame_start = 0; //開始フレーム\n\n    this.frame_end = 0; //終了フレーム\n\n    this.objects = []; //シーンに存在するオブジェクト\n\n    this.world = {};\n  }\n\n  _createClass(Scene, [{\n    key: \"setFrame\",\n    value: function setFrame(frame) {\n      var objects = this.objects;\n      var o3o = this.o3o;\n\n      if (o3o) {\n        for (var i = o3o.materials.length; i--;) {////マテリアルのUVアニメーション\n          //var material=o3o.materials[i];\n          //for(var j=material.texture_slots.length;j--;){\n          //\tvar texture_slot = material.texture_slots[j];\n          //\tif(texture_slot.action){\n          //\t\taddaction(texture_slot,\"0\",texture_slot.action,frame);\n          //\t}\n          //}\n        }\n      }\n\n      for (var i = 0; i < objects.length; i++) {\n        objects[i].flg = false;\n      }\n\n      for (var i = 0; i < objects.length; i++) {\n        //オブジェクト(アーマチュア及びメッシュ)のアニメーション\n        if (objects[i].action) {\n          //対象オブジェクトに関連するアクションを計算\n          _o3o_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].addaction(objects[i], \"\", objects[i].action, frame);\n        } //objects[i].calcMatrix(frame);\n\n\n        if (objects[i].objecttype === _objecttype_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].ARMATURE && objects[i].action) {\n          //もしアーマチュアの場合は、ボーンの計算を行う\n          objects[i].pose.setAction(objects[i].action, frame);\n        }\n      }\n    }\n  }]);\n\n  return Scene;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/scene.js?");

/***/ }),

/***/ "../lib/engine/o3o/sceneobject.js":
/*!****************************************!*\
  !*** ../lib/engine/o3o/sceneobject.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ SceneObject; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/engine/o3o/rigidbody.js\");\n/* harmony import */ var _rigidbodyconstraint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rigidbodyconstraint.js */ \"../lib/engine/o3o/rigidbodyconstraint.js\");\n/* harmony import */ var _rotationmode_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rotationmode.js */ \"../lib/engine/o3o/rotationmode.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\n\nvar SceneObject = /*#__PURE__*/_createClass(function SceneObject() {\n  _classCallCheck(this, SceneObject);\n\n  this.name = \"\"; //オブジェクト名\n\n  this.type = \"\"; //オブジェクト種類\n\n  this.hide_render = 0; //レンダリングするかどうか\n\n  this.data = \"\"; //内容(メッシュとかアーマチュア)\n\n  this.modifiers = []; //モディファイア\n\n  this.location = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //平行移動\n\n  this.scale = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //スケール\n\n  this.rotation_mode = _rotationmode_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].EULER_XYZ; //角度形式(デフォルトはオイラー角XYZ)\n\n  this.rotation = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4(); //回転オイラー角かクォータニオン\n\n  this.bound_box = []; //バウンディングボックス\n\n  this.bound_type = \"\"; //バウンディング形\n\n  this.parent = \"\"; //親オブジェクト\n\n  this.iparentmatrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43(); //親とのオフセット行列\n\n  this.parent_bone = null; //親骨オブジェクト\n\n  this.pose = null;\n  this.action = \"\"; //関連付けられたアニメーション\n\n  this.groups = []; //頂点グループ\n\n  this.rigid_body = new _rigidbody_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](); //剛体設定\n\n  this.rigid_body_constraint = new _rigidbodyconstraint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](); //剛体コンストレイント設定\n\n  this.flg = false; //既に合成行列が計算されているかどうかのフラグ\n\n  this.poseBones = null;\n  this[\"static\"] = 0;\n});\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/sceneobject.js?");

/***/ }),

/***/ "../lib/engine/o3o/sceneobjectinstance.js":
/*!************************************************!*\
  !*** ../lib/engine/o3o/sceneobjectinstance.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ SceneObjectInstance; }\n/* harmony export */ });\n/* harmony import */ var _material_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./material.js */ \"../lib/engine/o3o/material.js\");\n/* harmony import */ var _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/ono3d.js */ \"../lib/lib/ono3d.js\");\n/* harmony import */ var _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/onophy/onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _lib_spherical_harmonics_sh_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/spherical_harmonics/sh.js */ \"../lib/lib/spherical_harmonics/sh.js\");\n/* harmony import */ var _uvlayer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./uvlayer.js */ \"../lib/engine/o3o/uvlayer.js\");\n/* harmony import */ var _rotationmode_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./rotationmode.js */ \"../lib/engine/o3o/rotationmode.js\");\n/* harmony import */ var _objecttype_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./objecttype.js */ \"../lib/engine/o3o/objecttype.js\");\n/* harmony import */ var _vertex_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./vertex.js */ \"../lib/engine/o3o/vertex.js\");\n/* harmony import */ var _face_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./face.js */ \"../lib/engine/o3o/face.js\");\n/* harmony import */ var _edge_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./edge.js */ \"../lib/engine/o3o/edge.js\");\n/* harmony import */ var _mesh_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./mesh.js */ \"../lib/engine/o3o/mesh.js\");\n/* harmony import */ var _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../lib/collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./bufmesh.js */ \"../lib/engine/o3o/bufmesh.js\");\n/* harmony import */ var _engine_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../engine.js */ \"../lib/engine/engine.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar sphere = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Sphere();\nvar cuboid = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cuboid();\nvar cylinder = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cylinder();\nvar cone = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cone();\nvar capsule = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Capsule();\nvar defaultMaterial = new _material_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\nvar deformMatricies = [];\n\nfor (var i = 0; i < 128; i++) {\n  deformMatricies.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43());\n}\n\nvar deformMesh = new _mesh_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"]();\nvar materialTable = new Array(256);\nvar MAX_SIZE = 4096;\ndeformMesh.ratios = [];\ndeformMesh.vertices = _vertex_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].array(MAX_SIZE);\ndeformMesh.faces = _face_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].array(MAX_SIZE);\ndeformMesh.edges = _edge_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].array(MAX_SIZE);\nvar table = new Array(64);\n\nfor (i = 0; i < MAX_SIZE; i++) {\n  deformMesh.ratios.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec4());\n}\n\n;\nvar abs = Math.abs;\nvar groupMatricies = new Array(64),\n    groupMatFlg = new Array(64);\n\nfor (var i = groupMatricies.length; i--;) {\n  groupMatricies[i] = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43();\n}\n\nvar genMatrix = function genMatrix(mat, obj) {\n  if (obj.rotation_mode === _rotationmode_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].QUATERNION) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.fromLSR(mat, obj.location, obj.scale, obj.rotation);\n  } else {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.fromLSE(mat, obj.location, obj.scale, obj.rotation);\n  }\n};\n\nfunction createCollision(obj) {\n  var collision = null;\n  var shape = obj.bound_type;\n\n  if (obj.rigid_body.type) {\n    shape = obj.rigid_body.collision_shape;\n  }\n\n  if (shape == \"SPHERE\") {\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Sphere();\n  } else if (shape == \"BOX\") {\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cuboid();\n  } else if (shape == \"CYLINDER\") {\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cylinder();\n  } else if (shape == \"CONE\") {\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Cone();\n  } else if (shape == \"CAPSULE\") {\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Capsule();\n  } else if (shape == \"CONVEX_HULL\") {\n    var mesh = obj.data;\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].ConvexHull();\n\n    for (var i = 0; i < mesh.vertices.length; i++) {\n      collision.poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3());\n    }\n  } else if (shape == \"MESH\") {\n    var mesh = obj.data;\n    collision = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Mesh();\n\n    for (var i = 0; i < mesh.vertices.length; i++) {\n      collision.poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3());\n    }\n\n    for (var i = 0; i < mesh.faces.length; i++) {\n      var triangle = new _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].Triangle();\n      triangle.poses[0] = collision.poses[mesh.faces[i].idx[0]];\n      triangle.poses[1] = collision.poses[mesh.faces[i].idx[1]];\n      triangle.poses[2] = collision.poses[mesh.faces[i].idx[2]];\n      collision.triangles.push(triangle);\n    }\n  }\n\n  if (collision) {\n    collision.name = obj.name;\n    collision.groups = obj.rigid_body.collision_groups;\n  }\n\n  return collision;\n}\n\nfunction createPhyObj(instance) {\n  var mesh,\n      phyobj = null,\n      vertices;\n  var obj = instance.object;\n  var renderVertices = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices;\n  var renderVertex;\n  var renderFaces = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faces;\n  var renderFace;\n  var idx;\n  var mod;\n\n  if (obj.rigid_body.type) {\n    var rigid = obj.rigid_body;\n    var shape = rigid.collision_shape;\n    phyobj = new _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].RigidBody(); //phyobj=onoPhy.createRigidBody();\n\n    var collision = createCollision(obj);\n    phyobj.collision = collision;\n\n    if (collision) {\n      //onoPhy.collider.addCollision(collision);\n      if (collision.type === _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].MESH || collision.type === _lib_collider_collider_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].CONVEX_HULL) {\n        phyobj.mesh = obj.data;\n      }\n\n      collision.parent = phyobj;\n      var b = obj.bound_box;\n      phyobj.collisionSize[0] = (b[3] - b[0]) * 0.5;\n      phyobj.collisionSize[1] = (b[4] - b[1]) * 0.5;\n      phyobj.collisionSize[2] = (b[5] - b[2]) * 0.5;\n    }\n\n    if (rigid.type === \"ACTIVE\") {\n      phyobj.fix = false;\n    }\n\n    phyobj.friction = rigid.friction;\n    phyobj.restitution = rigid.restitution;\n\n    if (rigid.bold) {\n      phyobj.bold = rigid.bold;\n    } else {\n      phyobj.bold = 0;\n    }\n\n    phyobj.mass = rigid.mass;\n    phyobj.name = obj.name;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.toLSR(phyobj.location, phyobj.scale, phyobj.rotq, instance.matrix);\n  }\n\n  for (var i = 0; i < obj.modifiers.length; i++) {\n    mod = obj.modifiers[i];\n\n    if (mod.type === \"CLOTH\" || mod.type === \"SOFT_BODY\") {\n      mesh = obj.data;\n      instance.freezeMesh(_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"]);\n\n      if (mod.type === \"CLOTH\") {\n        phyobj = new _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].Cloth(_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize, _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].edgeSize, _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize);\n        phyobj.air_damping = mod.air_damping;\n        phyobj.mass = mod.mass;\n        phyobj.speed = 1.0;\n        phyobj.structual_stiffness = mod.structual_stiffness; //構造\n\n        phyobj.bending_stiffness = mod.bending_stiffness; //まげ\n\n        phyobj.spring_damping = mod.spring_damping; //ばね抵抗\n\n        phyobj.air_damping = mod.air_damping; //空気抵抗\n\n        phyobj.vel_damping = mod.vel_damping; //速度抵抗\n      } else {\n        phyobj = new _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SoftBody(_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize, _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].edgeSize, _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize);\n        phyobj.friction = mod.friction; //摩擦\n\n        phyobj.mass = mod.mass; //質量\n\n        phyobj.speed = 1.0; //スピード\n\n        phyobj.pull = mod.pull * 0.1; //ばね定数引き\n\n        phyobj.push = mod.push * 0.1; //ばね定数押し\n\n        phyobj.damping = mod.damping; //ダンパ\n\n        phyobj.bending_stiffness = mod.bend; //構造\n      } //onoPhy.clothes.push(phyobj);\n      //点\n\n\n      vertices = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices;\n\n      for (j = 0; j < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize; j++) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.copy(phyobj.points[j].location, vertices[j].pos);\n        phyobj.points[j].id = j;\n\n        for (var k = 0; k < vertices[j].groups.length; k++) {\n          if (vertices[j].groups[k] < 0) break;\n\n          if (obj.groups[vertices[j].groups[k]] === mod.pin) {\n            phyobj.points[j].fix = true;\n            break;\n          }\n        }\n      } //面\n\n\n      for (j = 0; j < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize; j++) {\n        var face = renderFaces[j];\n        phyobj.faces[j].idxnum = face.idxnum;\n\n        if (face.idxnum >= 3) {\n          for (var k = 0; k < face.idxnum; k++) {\n            phyobj.faces[j].points[k] = phyobj.points[face.idx[k]];\n          }\n        }\n      } //エッジ\n\n\n      for (var j = 0; j < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].edgeSize; j++) {\n        var edge = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].edges[j];\n        phyobj.edges[j].point1 = phyobj.points[edge.vIndices[0]];\n        phyobj.edges[j].point2 = phyobj.points[edge.vIndices[1]];\n      }\n\n      for (var j = 0; j < phyobj.edges.length; j++) {\n        phyobj.edges[j].len = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.len(phyobj.edges[j].point1.location, phyobj.edges[j].point2.location);\n      }\n\n      phyobj.init();\n    }\n  }\n\n  if (phyobj) {\n    phyobj.name = obj.name;\n    phyobj.parent = instance;\n    phyobj.refreshCollision();\n    phyobj.refreshInertia();\n  }\n\n  return phyobj;\n}\n\nvar SceneObjectInstance = /*#__PURE__*/function () {\n  function SceneObjectInstance(object) {\n    _classCallCheck(this, SceneObjectInstance);\n\n    _defineProperty(this, \"hitCheck\", function (collider, flg) {\n      var collision = this.getTempCollision(flg);\n      return collider.checkHitAll(collision);\n    });\n\n    _defineProperty(this, \"freezeMesh\", function (dst) {\n      //モデファイアとワールド行列を反映\n      var obj = this.object;\n      copyMesh(dst, obj.data);\n      var flg = false;\n      var phyObj = null;\n      phyObj = this.phyObj;\n      flg |= this.calcModifiers(dst);\n\n      if (phyObj) {\n        if (phyObj.type === _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SPRING_MESH || phyObj.type === _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CLOTH) {\n          for (var j = phyObj.points.length; j--;) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.copy(dst.vertices[j].pos, phyObj.points[j].location);\n          }\n\n          flg = true;\n        }\n      }\n\n      var defMat = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolAlloc();\n\n      if (!flg) {\n        //既に頂点単位で計算された場合はこの座標変換は行わない\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotMat44Mat43(defMat, ono3d.worldMatrix, this.matrix);\n        var bufMeshVertices = dst.vertices;\n        var mat0 = defMat[0];\n        var mat1 = defMat[1];\n        var mat2 = defMat[2];\n        var mat3 = defMat[3];\n        var mat4 = defMat[4];\n        var mat5 = defMat[5];\n        var mat6 = defMat[6];\n        var mat7 = defMat[7];\n        var mat8 = defMat[8];\n        var mat9 = defMat[9];\n        var mat10 = defMat[10];\n        var mat11 = defMat[11];\n\n        for (var i = 0; i < dst.vertexSize; i++) {\n          var pos = bufMeshVertices[i].pos;\n          var x = pos[0];\n          var y = pos[1];\n          var z = pos[2];\n          pos[0] = mat0 * x + mat3 * y + mat6 * z + mat9;\n          pos[1] = mat1 * x + mat4 * y + mat7 * z + mat10;\n          pos[2] = mat2 * x + mat5 * y + mat8 * z + mat11;\n        }\n\n        if (_lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.determinant(defMat) < 0) {\n          //フェイス反転している場合は戻す\n          var faces = dst.faces;\n\n          for (var i = 0; i < dst.faceSize; i++) {\n            var idx = faces[i].idx;\n            var buf = idx[0];\n            idx[0] = idx[2];\n            idx[2] = buf;\n          }\n\n          if (dst.uv_layerSize) {\n            //uv指定ありの場合はレイヤを設定(0番固定)\n            var uv_layerdata = dst.uv_layers[0].data;\n\n            for (var i = 0; i < dst.faceSize; i++) {\n              var data = uv_layerdata[i];\n              var buf = data[0];\n              data[0] = data[4];\n              data[4] = buf;\n              buf = data[1];\n              data[1] = data[5];\n              data[5] = buf;\n            }\n          }\n        }\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolFree(1);\n    });\n\n    _defineProperty(this, \"drawStatic\", function (environment, environment2, envratio) {\n      var oldIdx = ono3d.faces_index;\n      this.draw(environment, environment2, envratio);\n      var count = ono3d.faces_index - oldIdx;\n      var faces = [];\n      var renderFaces = ono3d.faces;\n\n      for (var i = 0; i < count; i++) {\n        var face = new _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].Face();\n        copyFace(face, renderFaces[i + oldIdx]);\n        faces.push(face);\n      }\n\n      return faces;\n    });\n\n    _defineProperty(this, \"draw\", function (environment, environment2, envratio) {\n      //描画\n      var obj = this.object;\n\n      if (obj.type !== \"MESH\") {\n        return null;\n      }\n\n      var o3o = obj.o3o; //マテリアルインデックステーブルにセット\n\n      materialTable[0] = setMaterial(defaultMaterial, \"defaultMaterial\");\n      var materials = o3o.materials;\n      var custom_material = null;\n\n      if (this.o3oInstance.custom_material) {\n        custom_material = this.o3oInstance.custom_material;\n      }\n\n      if (custom_material) {\n        materialTable[0] = setMaterial(custom_material, custom_material.name_full);\n      }\n\n      var material_slots = obj.material_slots;\n\n      if (material_slots) {\n        var i = 1;\n        material_slots.forEach(function (e) {\n          if (custom_material) {\n            materialTable[i] = materialTable[0];\n          } else {\n            var na = e;\n            var mat = materials.find(function (e) {\n              return e.name_full == na;\n            });\n            materialTable[i] = setMaterial(mat, o3o.name + \"_\" + mat.name_full);\n          }\n\n          i++;\n        });\n      } else {\n        var i = 1;\n        materials.foreach(function (e) {\n          if (custom_material) {\n            materialTable[i] = materialTable[0];\n          } else {\n            materialTable[i] = setMaterial(e, o3o.name + \"_\" + e.name);\n          }\n\n          i++;\n        });\n      }\n\n      if (!environment) {\n        //環境情報がない場合はデフォルトをセット\n        environment = ono3d.environments[0];\n        envratio = 0.0;\n      }\n\n      if (!environment2) {\n        environment2 = ono3d.environments[0];\n      }\n\n      this.freezeMesh(_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"]); //モデファイア適用\n\n      var bufMeshVertices = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices;\n      var renderVertices = ono3d.verticesFloat32Array;\n      var rvIndex = ono3d.vertices_index;\n      var renderFaces = ono3d.faces;\n      var rfIndex = ono3d.faces_index;\n      var rfCount = 0;\n      var renderMaterials = ono3d.materials;\n      var face, renderFace;\n      var smoothing = ono3d.smoothing;\n      var offsetx = 0,\n          offsety = 0;\n      var uv;\n      var uv_layerdata;\n      var lightMapUvData;\n\n      if (_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].uv_layerSize) {\n        //uv指定ありの場合はレイヤを設定(0番固定)\n        uv_layerdata = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].uv_layers[0].data;\n        lightMapUvData = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].uv_layers[0].data;\n      }\n\n      if (_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].uv_layerSize >= 2) {\n        //uvが2つ以上ある場合は2個目も設定\n        lightMapUvData = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].uv_layers[1].data;\n      } //面の法線計算\n\n\n      var vertices = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices;\n      var faces = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faces;\n\n      for (var i = 0; i < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize; i++) {\n        var n = faces[i].normal;\n        var idx = faces[i].idx;\n\n        if (faces[i].idxnum == 3) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.cross2(n, vertices[idx[0]].pos, vertices[idx[1]].pos, vertices[idx[2]].pos);\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.cross3(n, vertices[idx[0]].pos, vertices[idx[2]].pos, vertices[idx[1]].pos, vertices[idx[3]].pos);\n        }\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.norm(n);\n      } //if( ono3d.smoothing>0){\n\n\n      if (obj.data.use_auto_smooth) {\n        //if( true){\n        //スムーシングする場合は頂点法線を計算\n        //属する面の法線の平均を取る\n        for (var i = 0; i < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize; i++) {\n          vertices[i].normal.fill(0);\n        }\n\n        for (var i = 0; i < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize; i++) {\n          var idx = faces[i].idx;\n          var fn = faces[i].normal;\n          var n = vertices[idx[0]].normal;\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.add(n, n, fn);\n          n = vertices[idx[1]].normal;\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.add(n, n, fn);\n          n = vertices[idx[2]].normal;\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.add(n, n, fn);\n\n          if (faces[i].idxnum == 4) {\n            n = vertices[idx[3]].normal;\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.add(n, n, fn);\n          }\n        }\n\n        for (var i = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize; i--;) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.norm(vertices[i].normal);\n        }\n\n        smoothing = 1;\n      } else {\n        smoothing = 0;\n      }\n\n      var lightProbeEnv = environment.lightProbe;\n\n      if (!lightProbeEnv) {\n        //デフォルトのライトプローブを選択\n        lightProbeEnv = ono3d.environments[0].lightProbe;\n      }\n\n      if (lightProbeEnv) {\n        //ライトプローブ計算\n        var bspTree = lightProbeEnv.bspTree;\n        var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3();\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(vec3, this.matrix[9], this.matrix[10], this.matrix[11]);\n        var hitTriangle = bspTree.getItem(vec3);\n\n        if (hitTriangle) {\n          var shcoefs = lightProbeEnv.shcoefs; //for(var i = bufMesh.vertexSize;i--;){\n          //\tvar vertex=vertices[i];\n          //\tvar hitTriangle = bspTree.getItem(vertex.pos);\n          //\tvertex.hitTriangle=hitTriangle;\n          //\tif(!hitTriangle){\n          //\t\tcontinue;\n          //\t}\n          //\tvar bsps=hitTriangle.bsps;\n          //\tfor(var k=0;k<4;k++){\n          //\t\tbufMesh.ratios[i][k]=Vec3.dot(bsps[k].v,vertex.pos)-bsps[k].m;\n          //\t}\n          //}\n\n          for (var i = 0; i < calcSHcoef.length; i++) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(calcSHcoef[i], 0, 0, 0);\n          }\n\n          var bsps = hitTriangle.bsps;\n          var pIdx = hitTriangle.pIdx;\n\n          for (var k = 0; k < 4; k++) {\n            var shcoef = shcoefs[pIdx[k]];\n            var r = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.dot(bsps[k].v, vec3) - bsps[k].m;\n\n            for (var i = 0; i < calcSHcoef.length; i++) {\n              _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.madd(calcSHcoef[i], calcSHcoef[i], shcoef[i], r);\n            }\n          }\n        }\n      }\n\n      var ii = rfIndex;\n      var jj = rvIndex * 20;\n      var svec = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n      var tvec = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n      var color = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n      var normal = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n\n      for (var i = 0; i < _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].faceSize; i++) {\n        //フェイスをレンダー用バッファに格納\n        face = faces[i];\n        var idx = face.idx;\n\n        for (var j = 0; j < face.idxnum - 2; j++) {\n          //三角単位でレンダー用バッファに格納\n          renderFace = renderFaces[ii];\n          ii++;\n          rfCount++; //renderFace.rf = Ono3d.RF_OUTLINE * (1-face.fs);\n          //renderFace.smoothing = smoothing;\n          //Vec3.copy(facenormal,face.normal);\n\n          var facenormal = face.normal; //buff[envratioindex+vindex]=renderface.environmentRatio ;\n\n          renderFace.material = ono3d.materials[materialTable[face.mat + 1]];\n          renderFace.environments[0] = environment;\n          renderFace.environments[1] = environment2;\n          renderFace.environmentRatio = envratio;\n          uv = null;\n\n          if (face.mat >= 0 && uv_layerdata) {\n            //uv値セット　オフセット分もたす\n            offsetx = renderFace.material.offsetx;\n            offsety = renderFace.material.offsety;\n            uv = uv_layerdata[i];\n          }\n\n          var uv2 = null;\n\n          if (lightMapUvData) {\n            uv2 = lightMapUvData[i];\n          }\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(svec, -facenormal[1], facenormal[2], facenormal[0]);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(tvec, facenormal[2], -facenormal[0], facenormal[1]);\n\n          if (renderFace.material.hightMap) {\n            _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].calcST(svec, tvec, vertices[idx[0]].pos, vertices[idx[1 + j]].pos, vertices[idx[2 + j]].pos, uv[0], uv[1], uv[(1 + j) * 2], uv[(1 + j) * 2 + 1], uv[(2 + j) * 2], uv[(2 + j) * 2 + 1]);\n          }\n\n          renderFace.vertices[0] = rvIndex;\n          renderFace.vertices[1] = rvIndex + 1;\n          renderFace.vertices[2] = rvIndex + 2; //頂点\n\n          var vertex = vertices[j];\n          var nx = face.normal[0] * (1 - smoothing);\n          var ny = face.normal[1] * (1 - smoothing);\n          var nz = face.normal[2] * (1 - smoothing);\n          var vidx = [0, 1 + j, 2 + j];\n\n          for (var k = 0; k < 3; k++) {\n            var id = idx[vidx[k]];\n            var vertex = vertices[id];\n            renderVertices[jj] = vertex.pos[0];\n            renderVertices[jj + 1] = vertex.pos[1];\n            renderVertices[jj + 2] = vertex.pos[2];\n            renderVertices[jj + 3] = normal[0] = vertex.normal[0] * smoothing + nx;\n            renderVertices[jj + 4] = normal[1] = vertex.normal[1] * smoothing + ny;\n            renderVertices[jj + 5] = normal[2] = vertex.normal[2] * smoothing + nz;\n            renderVertices[jj + 6] = svec[0];\n            renderVertices[jj + 7] = svec[1];\n            renderVertices[jj + 8] = svec[2];\n            renderVertices[jj + 9] = tvec[0];\n            renderVertices[jj + 10] = tvec[1];\n            renderVertices[jj + 11] = tvec[2];\n\n            if (uv) {\n              renderVertices[jj + 12] = uv[vidx[k] * 2] + offsetx;\n              renderVertices[jj + 13] = uv[vidx[k] * 2 + 1] + offsety;\n            }\n\n            renderVertices[jj + 14] = renderFace.environmentRatio;\n\n            if (uv2) {\n              renderVertices[jj + 15] = uv2[vidx[k] * 2] + offsetx;\n              renderVertices[jj + 16] = uv2[vidx[k] * 2 + 1] + offsety;\n            } //calcSH(color,normal,vertex,shcoefs,bufMesh.ratios[id]);\n\n\n            _lib_spherical_harmonics_sh_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].decode2xyz(color, calcSHcoef, normal[0], normal[1], normal[2]);\n            renderVertices[jj + 17] = color[0];\n            renderVertices[jj + 18] = color[1];\n            renderVertices[jj + 19] = color[2]; //renderVertices.set(vertex.pos,jj);\n            //renderVertices.set(normal,jj+3);\n            //renderVertices.set(svec,jj+6);\n            //renderVertices.set(tvec,jj+9);\n            //renderVertices.set(color,jj+17);\n\n            rvIndex++;\n            jj += 20;\n          }\n        }\n      }\n\n      if (ono3d.rf & _lib_ono3d_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].RF_OUTLINE && 0) { var renderLine, mat1, mat0, renderMat, edge, vertex_current, renderLines, lines_index, edges, renderMateriala, renderMaterial, idx, i, cp2, cp1, cp0, bM44, bufFace, normal; }\n\n      ono3d.vertices_index = rvIndex;\n      ono3d.faces_index += rfCount;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolFree(4);\n      return;\n    });\n\n    this.object = object;\n    this.matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43();\n    this.boneMatrices = [];\n    this.boneFlgs = [];\n    this.children = [];\n\n    if (object.objecttype === _objecttype_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].ARMATURE) {\n      var bones = object.data.bones;\n\n      for (var _i = 0; _i < bones.length; _i++) {\n        this.boneMatrices.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43());\n        this.boneFlgs.push(false);\n      }\n    }\n\n    this.phyObj = createPhyObj(this);\n  }\n\n  _createClass(SceneObjectInstance, [{\n    key: \"searchObject\",\n    value: function searchObject(name) {\n      if (!this.children) return false;\n      var result = this.children.find(function (child) {\n        return child.object.name === name;\n      });\n\n      if (result) {\n        return result;\n      }\n\n      this.children.forEach(function (child) {\n        result = child.searchObject(name);\n\n        if (result) {\n          return false;\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"getTempCollision\",\n    value: function getTempCollision(groups) {\n      var collision;\n      var obj = this.object;\n      var scale = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(scale, 1, 1, 1);\n\n      if (obj.type === \"MESH\") {\n        var b = obj.bound_box;\n        scale[0] = (b[3] - b[0]) * 0.5;\n        scale[1] = (b[4] - b[1]) * 0.5;\n        scale[2] = (b[5] - b[2]) * 0.5;\n      }\n\n      switch (obj.bound_type) {\n        case \"SPHERE\":\n          collision = sphere;\n          break;\n\n        case \"BOX\":\n          collision = cuboid;\n          break;\n\n        case \"CYLINDER\":\n          collision = cylinder;\n          break;\n\n        case \"CONE\":\n          collision = cone;\n          break;\n\n        case \"CAPSULE\":\n          collision = capsule;\n          break;\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.copy(collision.matrix, this.matrix);\n      var m = collision.matrix;\n\n      for (var i = 0; i < 3; i++) {\n        for (var j = 0; j < 3; j++) {\n          m[i * 3 + j] *= scale[i];\n        }\n      }\n\n      collision.groups = groups;\n      collision.notgroups = 0;\n      collision.bold = 0;\n\n      switch (obj.bound_type) {\n        case \"SPHERE\":\n          scale[0] = Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]);\n          scale[1] = Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]);\n          scale[2] = Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]);\n          collision.bold = Math.max(Math.max(scale[0], scale[1]), scale[2]);\n          break;\n\n        case \"CAPSULE\":\n          scale[0] = Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]);\n          scale[1] = Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]);\n          scale[2] = Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]);\n          collision.bold = Math.max(scale[0], scale[2]);\n          var a = (scale[1] - collision.bold) / scale[1];\n          m[3] *= a;\n          m[4] *= a;\n          m[5] *= a;\n          break;\n      }\n\n      collision.refresh();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolFree(1);\n      return collision;\n    }\n  }, {\n    key: \"resetMatrix\",\n    value: function resetMatrix() {\n      //オブジェクトの姿勢行列の計算済みフラグをオフにする\n      this.flg = false;\n\n      for (var i = 0; i < this.boneFlgs.length; i++) {\n        this.boneFlgs[i] = false;\n      }\n    }\n  }, {\n    key: \"calcBoneMatrix\",\n    value: function calcBoneMatrix(n, dt, flg) {\n      if (this.boneFlgs[n]) {\n        //計算済み\n        return;\n      }\n\n      var matrix = this.boneMatrices[n];\n      var object = this.object;\n      var bone = object.data.bones[n];\n      var poseBone = object.pose.poseBones[n];\n      genMatrix(matrix, poseBone); //ボーンの姿勢から行列を作成\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, bone.matrix, matrix); //初期姿勢掛ける\n\n      if (bone.parent) {\n        var m = bone.parent.id;\n        this.calcBoneMatrix(m, dt, flg);\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, this.boneMatrices[m], matrix); //親行列掛ける\n      }\n\n      if (object.poseBones) {\n        var poseBone_ = object.poseBones[n];\n\n        for (var i = 0; i < poseBone_.constraints.length; i++) {\n          var constraint = poseBone_.constraints[i];\n\n          switch (constraint.type) {\n            case \"COPY_ROTATION\":\n              var target = this.o3oInstance.objectInstances[constraint.target.idx];\n              target.calcMatrix(dt, flg);\n              _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat33.copy(matrix, target.matrix); //角度を強制的に設定\n\n              break;\n          }\n        }\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, matrix, bone.imatrix); //初期姿勢逆行列\n\n      poseBone.flg = true;\n    }\n  }, {\n    key: \"calcMatrix\",\n    value: function calcMatrix(dt, flg) {\n      //dt 物理オブジェクトの速度を求めるためのdt\n      //flg trueの場合は物理オブジェクトを強制的に指定値にする\n      var obj = this.object;\n      var matrix = this.matrix;\n      var phyObj = this.phyObj;\n      var o3oInstance = this.o3oInstance;\n\n      if (phyObj) {\n        if (obj.rigid_body.type !== \"PASSIVE\" && !flg && phyObj.type === _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].RIGID) {\n          //fixでない剛体の場合はそれに合わせる\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.copy(matrix, phyObj.matrix);\n          this.flg = true;\n          return;\n        }\n      }\n\n      if (obj.rotation_mode === _rotationmode_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].QUATERNION) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.fromLSR(matrix, obj.location, obj.scale, obj.rotation);\n      } else {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.fromLSE(matrix, obj.location, obj.scale, obj.rotation);\n      }\n\n      for (var i = 0; i < this.boneMatrices.length; i++) {\n        this.calcBoneMatrix(i, dt, flg);\n      }\n\n      if (obj.parent) {\n        var parent = obj.parent; //var parentInstance = o3oInstance.objectInstances[parent.idx];\n\n        var parentInstance = o3oInstance.searchObject(parent.name);\n\n        if (parentInstance) {\n          parentInstance.calcMatrix(dt, flg);\n\n          if (obj.parent_bone) {\n            var i = obj.parent_bone - 1;\n            this.matrix[11] -= parent.data.bones[i].length;\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, parent.data.bones[i].matrix, matrix);\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, parentInstance.boneMatrices[i], matrix);\n          } else {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, obj.iparentmatrix, matrix);\n          }\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(matrix, parentInstance.matrix, matrix);\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotMat44Mat43(matrix, ono3d.worldMatrix, matrix);\n        }\n      } else {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotMat44Mat43(matrix, ono3d.worldMatrix, matrix);\n      }\n\n      if (phyObj) {\n        if ((obj.rigid_body.type == \"PASSIVE\" || flg) && phyObj.type === _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].RIGID) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(phyObj.v, 0, 0, 0);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.copy(phyObj.v, phyObj.location);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(phyObj.rotV, 0, 0, 0);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.copy(phyObj.matrix, this.matrix); //Mat43.dotMat44Mat43(phyObj.matrix,ono3d.worldMatrix,this.matrix);\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.toLSR(phyObj.location, phyObj.scale, phyObj.rotq, phyObj.matrix);\n\n          if (dt != 0) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(phyObj.v, phyObj.location, phyObj.v);\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.mul(phyObj.v, phyObj.v, 1 / dt);\n          } else {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.mul(phyObj.v, phyObj.v, 0);\n          }\n\n          phyObj.calcPre();\n        }\n\n        if (phyObj.type === _lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CLOTH) {\n          var dst = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"];\n          copyMesh(dst, obj.data);\n          var defMat = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolAlloc();\n          this.calcModifiers(dst);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotMat44Mat43(defMat, ono3d.worldMatrix, this.matrix);\n          var bufMeshVertices = dst.vertices;\n          var mat0 = defMat[0];\n          var mat1 = defMat[1];\n          var mat2 = defMat[2];\n          var mat3 = defMat[3];\n          var mat4 = defMat[4];\n          var mat5 = defMat[5];\n          var mat6 = defMat[6];\n          var mat7 = defMat[7];\n          var mat8 = defMat[8];\n          var mat9 = defMat[9];\n          var mat10 = defMat[10];\n          var mat11 = defMat[11];\n          var vertices = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices;\n          var dst = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"];\n          var points = phyObj.points;\n\n          for (var i = 0; i < dst.vertexSize; i++) {\n            if (points[i].fix || flg) {\n              var pos = points[i].location;\n              var x = vertices[i].pos[0];\n              var y = vertices[i].pos[1];\n              var z = vertices[i].pos[2];\n              pos[0] = mat0 * x + mat3 * y + mat6 * z + mat9;\n              pos[1] = mat1 * x + mat4 * y + mat7 * z + mat10;\n              pos[2] = mat2 * x + mat5 * y + mat8 * z + mat11;\n            }\n          }\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolFree(1);\n        }\n      }\n\n      this.flg = true;\n    }\n  }, {\n    key: \"modMeshDeform\",\n    value: function modMeshDeform(dst, mod) {\n      //メッシュデフォーム\n      if (!mod.basePos) {\n        return 0;\n      }\n\n      var obj = this.object;\n      var parentInstance = this.o3oInstance.objectInstances[mod.object.idx]; //デフォーム親メッシュを計算\n\n      parentInstance.freezeMesh(deformMesh);\n      var dmv = deformMesh.vertices;\n      var binddata = mod.binddata;\n      var f = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec4.poolAlloc();\n\n      for (var i = 0; i < deformMesh.faceSize; i++) {\n        //デフォーム親面ごとの係数計算\n        var face = deformMesh.faces[i];\n        var dmv0 = dmv[face.idx[0]].pos;\n        var dmv1 = dmv[face.idx[1]].pos;\n        var dmv2 = dmv[face.idx[2]].pos;\n        var dmv3 = dmv[face.idx[3]].pos;\n        var dm = deformMatricies[i]; //平面方向\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(f, dmv1, dmv0);\n        dm[0] = f[0];\n        dm[1] = f[1];\n        dm[2] = f[2];\n\n        if (face.idxnum == 4) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(f, dmv2, f);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(f, f, dmv3);\n          dm[6] = f[0];\n          dm[7] = f[1];\n          dm[8] = f[2];\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(f, dmv3, dmv0);\n          dm[3] = f[0];\n          dm[4] = f[1];\n          dm[5] = f[2];\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.sub(f, dmv2, dmv0);\n          dm[3] = f[0];\n          dm[4] = f[1];\n          dm[5] = f[2]; //Vec3.set(deformbuf2[i],0,0,0);\n        } //法線方向\n\n\n        if (face.idx === 4) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.cross3(f, dmv0, dmv2, dmv1, dmv3);\n        } else {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.cross2(f, dmv0, dmv1, dmv2);\n        }\n\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.norm(f);\n        dm[9] = f[0];\n        dm[10] = f[1];\n        dm[11] = f[2];\n      }\n\n      for (var i = 0; i < dst.vertexSize; i++) {\n        //デフォーム子の頂点計算\n        var binds = binddata[i]; //バインド情報\n\n        var vertex = dst.vertices[i];\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(vertex.pos, 0, 0, 0);\n\n        for (var j = 0; j < binds.length; j++) {\n          //バインド数分ループ\n          var bind = binds[j]; //バインド情報に係数をかけて座標を算出\n\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotVec4(f, deformMatricies[bind.idx], bind.pweight);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.add(f, dmv[deformMesh.faces[bind.idx].idx[0]].pos, f);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.madd(vertex.pos, vertex.pos, f, bind.weight); //重みを付けて加算\n        }\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec4.poolFree(1);\n      return 1;\n    }\n  }, {\n    key: \"modMirror\",\n    value: function modMirror(dst, mod) {\n      //ミラーリングをフリーズ\n      var obj = this.object;\n      var bufMesh = dst;\n      var bufMeshVertices = bufMesh.vertices;\n      var renderVertex;\n      var dstvertices, srcvertices;\n      var dstvertex, srcvertex;\n      var vertexSize = bufMesh.vertexSize;\n      var mrr = 0;\n\n      if (mod.use_x) {\n        mrr = 0;\n      }\n\n      ;\n\n      if (mod.use_y) {\n        mrr = 1;\n      }\n\n      ;\n\n      if (mod.use_z) {\n        mrr = 2;\n      }\n\n      ;\n      var uv_layerdata = null;\n\n      if (bufMesh.uv_layerSize) {\n        //uv指定ありの場合はレイヤを設定(0番固定)\n        uv_layerdata = bufMesh.uv_layers[0].data;\n      }\n\n      for (j = 0; j < vertexSize; j++) {\n        //頂点をコピー\n        srcvertex = bufMeshVertices[j];\n        dstvertex = bufMeshVertices[j + vertexSize];\n        dstvertex.pos[0] = srcvertex.pos[0];\n        dstvertex.pos[1] = srcvertex.pos[1];\n        dstvertex.pos[2] = srcvertex.pos[2];\n        dstvertex.pos[mrr] *= -1; //dstvertex.groups=srcvertex.groups;\n        //dstvertex.groupWeights=srcvertex.groupWeights;\n\n        for (var k = 0; k < srcvertex.groups.length; k++) {\n          dstvertex.groups[k] = srcvertex.groups[k];\n          dstvertex.groupWeights[k] = srcvertex.groupWeights[k];\n        }\n      }\n\n      var dstFace, srcFace;\n      var faceSize = bufMesh.faceSize;\n\n      for (var j = 0; j < faceSize; j++) {\n        //フェイスをコピー\n        srcFace = bufMesh.faces[j];\n        srcvertices = srcFace.idx;\n        dstFace = bufMesh.faces[faceSize + j];\n        dstFace.idxnum = srcFace.idxnum;\n        dstvertices = dstFace.idx;\n\n        for (var k = 0; k < srcFace.idxnum; k++) {\n          var _k = srcFace.idxnum - k;\n\n          if (k == 0) {\n            _k = 0;\n          }\n\n          ;\n\n          if (abs(bufMeshVertices[srcvertices[_k]].pos[mrr]) > 0.0001) {\n            dstvertices[k] = srcvertices[_k] + vertexSize;\n          } else {\n            //座標が中心に近い場合は共有\n            dstvertices[k] = srcvertices[_k];\n          }\n        }\n\n        dstFace.material = srcFace.material;\n        dstFace.mat = srcFace.mat;\n        dstFace.fs = srcFace.fs;\n      }\n\n      for (var i = 0; i < bufMesh.uv_layerSize; i++) {\n        var dstdata = bufMesh.uv_layers[i].data;\n        var d = faceSize * 2 - dstdata.length;\n\n        for (var j = 0; j < d; j++) {\n          dstdata.push([]);\n        }\n      }\n\n      if (uv_layerdata) {\n        //uv情報をコピー\n        var dstdata = uv_layerdata;\n\n        for (var j = 0; j < faceSize; j++) {\n          srcFace = bufMesh.faces[j];\n\n          for (var k = 0; k < srcFace.idxnum; k++) {\n            var _k = srcFace.idxnum - k;\n\n            if (k == 0) {\n              _k = 0;\n            }\n\n            ;\n            dstdata[j + faceSize][k * 2] = dstdata[j][_k * 2];\n            dstdata[j + faceSize][k * 2 + 1] = dstdata[j][_k * 2 + 1];\n          }\n        }\n      }\n\n      var jj = 0;\n\n      for (var j = 0; j < bufMesh.edgeSize; j++) {\n        var e_dst = bufMesh.edges[jj + bufMesh.edgeSize];\n        var src = bufMesh.edges[j];\n\n        if (abs(bufMeshVertices[src.vIndices[0]].pos[mrr]) < 0.01 && abs(bufMeshVertices[src.vIndices[1]].pos[mrr]) < 0.01) {\n          src.fIndices[1] = src.fIndices[0] + faceSize;\n          continue;\n        }\n\n        e_dst.vIndices[0] = src.vIndices[0] + vertexSize;\n        e_dst.vIndices[1] = src.vIndices[1] + vertexSize;\n        e_dst.fIndices[0] = src.fIndices[0] + faceSize;\n\n        if (src.fIndices[1] >= 0) {\n          e_dst.fIndices[1] = src.fIndices[1] + faceSize;\n        } else {\n          e_dst.fIndices[1] = -1;\n        }\n\n        jj++;\n      }\n\n      bufMesh.edgeSize += jj; //LR表記のあるグループを逆にする\n\n      for (j = 0; j < obj.groups.length; j++) {\n        table[j] = j;\n        var groupName = obj.groups[j];\n\n        if (groupName.match(/L$/)) {\n          groupName = groupName.replace(/L$/, \"R\");\n        } else if (groupName.match(/R$/)) {\n          groupName = groupName.replace(/R$/, \"L\");\n        } else {\n          continue;\n        }\n\n        for (k = 0; k < obj.groups.length; k++) {\n          if (groupName === obj.groups[k]) {\n            table[j] = k;\n            break;\n          }\n        }\n      }\n\n      for (k = 0; k < vertexSize; k++) {\n        var vertex = bufMeshVertices[vertexSize + k];\n\n        for (var l = 0; l < 8; l++) {\n          if (vertex.groups[l] < 0) continue;\n          vertex.groups[l] = table[vertex.groups[l]];\n        }\n      }\n\n      bufMesh.faceSize += faceSize;\n      bufMesh.vertexSize += vertexSize;\n    }\n  }, {\n    key: \"modArmature\",\n    value: function modArmature(dst, mod) {\n      //アーマチュア変形\n      var bufMesh = dst;\n      var bufMeshVertices = bufMesh.vertices;\n      var renderVertex;\n      var groupMatrix;\n      var groupName;\n      var x, y, z;\n      var obj = this.object;\n      var objectInstances = this.o3oInstance.objectInstances;\n      var ratio, pos, vertex;\n      var groups = obj.groups;\n      if (!mod.object) return;\n      var armature_instance = this.o3oInstance.searchObject(mod.object);\n      if (!armature_instance) return;\n      var bM = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolAlloc();\n      var bM2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolAlloc();\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.getInv(bM2, armature_instance.matrix);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(bM, bM2, this.matrix);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.getInv(bM2, bM);\n      var bones = armature_instance.object.data.bones;\n      var boneMatrices = armature_instance.boneMatrices;\n\n      for (var j = groups.length; j--;) {\n        groupMatFlg[j] = false;\n        groupName = groups[j];\n        groupMatrix = groupMatricies[j];\n\n        for (var k = 0, kmax = bones.length; k < kmax; k++) {\n          if (bones[k].name != groupName) continue;\n          groupMatFlg[j] = true;\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(groupMatrix, boneMatrices[k], bM);\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dot(groupMatrix, bM2, groupMatrix);\n          break;\n        }\n      }\n\n      var bV0 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolAlloc();\n\n      for (var k = 0; k < bufMesh.vertexSize; k++) {\n        pos = bufMeshVertices[k].pos;\n        vertex = bufMeshVertices[k];\n        var vertexGroups = vertex.groups;\n        x = 0;\n        y = 0;\n        z = 0;\n        var ratiosum = 0;\n\n        for (var j = vertexGroups.length; j--;) {\n          if (vertexGroups[j] < 0) continue;\n\n          if (!groupMatFlg[vertexGroups[j]]) {\n            continue;\n          }\n\n          ratio = vertex.groupWeights[j];\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotVec3(bV0, groupMatricies[vertexGroups[j]], pos);\n          x += bV0[0] * ratio;\n          y += bV0[1] * ratio;\n          z += bV0[2] * ratio;\n          ratiosum += ratio;\n        }\n\n        if (ratiosum > 0) {\n          ratiosum = 1.0 / ratiosum;\n          pos[0] = x * ratiosum;\n          pos[1] = y * ratiosum;\n          pos[2] = z * ratiosum;\n        } else {\n          if (mod.vertex_group >= 0) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.dotVec3(pos, groupMatricies[mod.vertex_group], pos);\n          }\n        }\n      }\n\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.poolFree(1);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Mat43.poolFree(2);\n    }\n  }, {\n    key: \"calcModifiers\",\n    value: function calcModifiers(dst) {\n      //モディファイア適用\n      var flg = 0;\n      var obj = this.object;\n\n      for (var i = 0, imax = obj.modifiers.length; i < imax; i++) {\n        var mod = obj.modifiers[i];\n\n        if (mod.type != \"MIRROR\" && flg) {\n          continue;\n        }\n\n        if (mod.type == \"MIRROR\") {\n          flg |= this.modMirror(dst, mod);\n        } else if (mod.type == \"ARMATURE\") {\n          flg |= this.modArmature(dst, mod);\n        } else if (mod.type == \"MESH_DEFORM\") {\n          flg |= this.modMeshDeform(dst, mod);\n        }\n      }\n\n      return flg;\n    }\n  }, {\n    key: \"getPoints\",\n    value: function getPoints() {\n      this.freezeMesh(_bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"]);\n      var vertexSize = _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertexSize;\n      var points = [];\n      var p;\n\n      for (var i = 0; i < vertexSize; i++) {\n        p = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3();\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.copy(p, _bufmesh_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"].vertices[i].pos);\n        points.push(p);\n      }\n\n      return points;\n    }\n  }]);\n\n  return SceneObjectInstance;\n}();\n\n\n\nvar setMaterial = function setMaterial(material, name) {\n  var renderMaterial;\n  var material;\n  var renderMaterials = ono3d.materials;\n  var i = 0;\n\n  for (; i < ono3d.materials_index; i++) {\n    if (renderMaterials[i].name === name) {\n      return i;\n    }\n  }\n\n  renderMaterial = renderMaterials[i];\n  ono3d.materials_index++;\n\n  if (material.blend_method != \"OPAQUE\") {\n    renderMaterial.blend_method = 1;\n  } else {\n    renderMaterial.blend_method = 0;\n  }\n\n  renderMaterial.offsetx = material.uvOffset[0];\n  renderMaterial.offsety = material.uvOffset[1];\n  renderMaterial.name = name;\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.copy(renderMaterial.baseColor, material.baseColor);\n  renderMaterial.opacity = material.opacity;\n  renderMaterial.metallic = material.metallic;\n  renderMaterial.specular = material.specular;\n  renderMaterial.roughness = material.roughness;\n  renderMaterial.ior = material.ior;\n  renderMaterial.subRoughness = material.subRoughness;\n  renderMaterial.emt = material.emt;\n  renderMaterial.baseColorMap = material.baseColorMap;\n  renderMaterial.orgMap = material.orgMap;\n  renderMaterial.hightMap = material.hightMap;\n  renderMaterial.hightMapPower = material.hightMapPower;\n  renderMaterial.hightBase = material.hightBase;\n  renderMaterial.pbrMap = material.pbrMap;\n  renderMaterial.lightMap = material.lightMap;\n  renderMaterial.shader = material.shader;\n  return i;\n};\n\nvar copyMesh = function copyMesh(dst, src) {\n  dst.name = src.name; //頂点情報をコピー\n  //var d=src.vertexSize - dst.vertices.length;\n  //for(var i = 0;i<d;i++){\n  //\t//変数領域が足りない場合は追加\n  //\tdst.vertices.push(new Vertex());\n  //}\n  //for(var i = 0;i<src.vertexSize;i++){\n  //\tdst.vertices[i].pos.set(src.vertices[i].pos);\n  //\tfor(var j=0;j<3;j++){\n  //\t\tdst.vertices[i].groups[j]= src.vertices[i].groups[j];\n  //\t\tdst.vertices[i].groupWeights[j]= src.vertices[i].groupWeights[j];\n  //\t}\n  //}\n\n  dst.vertices.buf.set(src.vertices.buf); //\t\tvar aaa=new Int8Array(src.vertices[0].pos.buffer);\n  //\t\tvar bbb=new Int8Array(dst.vertices[0].pos.buffer);\n  //\t\tbbb.set(aaa);\n\n  dst.vertexSize = src.vertexSize; //辺情報をコピー\n  //var d=src.edgeSize - dst.edges.length;\n  //for(var i = 0;i<d;i++){\n  //\t//変数領域が足りない場合は追加\n  //\tdst.edges.push(new Edge());\n  //}\n  //for(var i = 0;i<src.edgeSize;i++){\n  //\tvar srcEdge=src.edges[i];\n  //\tvar dstEdge=dst.edges[i];\n  //\tdstEdge.vIndices[0]=srcEdge.vIndices[0];\n  //\tdstEdge.vIndices[1]=srcEdge.vIndices[1];\n  //\tdstEdge.fIndices[0]=srcEdge.fIndices[0];\n  //\tdstEdge.fIndices[1]=srcEdge.fIndices[1];\n  //}\n\n  dst.edges.buf.set(src.edges.buf); //aaa=new Int8Array(src.edges[0].vIndices.buffer);\n  //bbb=new Int8Array(dst.edges[0].vIndices.buffer);\n  //bbb.set(aaa);\n\n  dst.edgeSize = src.edgeSize; //面情報をコピー\n  //d=src.faceSize - dst.faces.length;\n  //for(var i = 0;i<d;i++){\n  //\t//変数領域が足りない場合は追加\n  //\tdst.faces.push(new Face());\n  //}\n\n  for (var i = 0; i < src.faceSize; i++) {\n    var dstFace = dst.faces[i];\n    var srcFace = src.faces[i];\n    dstFace.material = srcFace.material;\n    dstFace.mat = srcFace.mat;\n    dstFace.idxnum = srcFace.idxnum;\n    dstFace.fs = srcFace.fs; //\t\tfor(var j=0;j<srcFace.idxnum;j++){\n    //\t\t\tdstFace.idx[j]= srcFace.idx[j];\n    //\t\t}\n  }\n\n  if (src.faces.length > 0) {\n    dst.faces.buf.set(src.faces.buf);\n  } //aaa=new Int8Array(src.faces[0].idx.buffer);\n  //bbb=new Int8Array(dst.faces[0].idx.buffer);\n  //bbb.set(aaa);\n\n\n  dst.faceSize = src.faceSize; //uvをコピー\n\n  var d = src.uv_layersSize - dst.uv_layers.length;\n\n  for (var i = 0; i < d; i++) {\n    //変数領域が足りない場合は追加\n    dst.uv_layers.push(new _uvlayer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"]());\n  }\n\n  for (var i = 0; i < src.uv_layerSize; i++) {\n    var srcdata = src.uv_layers[i].data;\n\n    if (dst.uv_layers.length <= i) {\n      dst.uv_layers.push(new _uvlayer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"]());\n    }\n\n    var dstdata = dst.uv_layers[i].data;\n    d = src.faceSize - dstdata.length;\n\n    for (var j = 0; j < d; j++) {\n      dstdata.push([]);\n    }\n\n    for (var j = 0; j < src.faceSize; j++) {\n      dstdata[j][0] = srcdata[j][0];\n      dstdata[j][1] = srcdata[j][1];\n      dstdata[j][2] = srcdata[j][2];\n      dstdata[j][3] = srcdata[j][3];\n      dstdata[j][4] = srcdata[j][4];\n      dstdata[j][5] = srcdata[j][5];\n      dstdata[j][6] = srcdata[j][6];\n      dstdata[j][7] = srcdata[j][7];\n    }\n  }\n\n  dst.uv_layerSize = src.uv_layerSize;\n};\n\nvar calcSHcoef = [];\n\nfor (var i = 0; i < 9; i++) {\n  calcSHcoef.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3());\n}\n\nvar calcSH = function calcSH(color, normal, vertex, shcoefs, ratio) {\n  var hitTriangle = vertex.hitTriangle;\n\n  if (!hitTriangle) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(color, 0.5, 0.5, 0.5);\n    return;\n  }\n\n  if (shcoefs.length === 0) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(color, 0.5, 0.5, 0.5);\n    return;\n  }\n\n  var pIdx = hitTriangle.pIdx;\n\n  for (var i = 0; i < calcSHcoef.length; i++) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.set(calcSHcoef[i], 0, 0, 0);\n  }\n\n  for (var k = 0; k < 4; k++) {\n    var shcoef = shcoefs[pIdx[k]];\n    var r = ratio[k];\n\n    for (var i = 0; i < calcSHcoef.length; i++) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_12__.Vec3.madd(calcSHcoef[i], calcSHcoef[i], shcoef[i], r);\n    }\n  }\n};\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/sceneobjectinstance.js?");

/***/ }),

/***/ "../lib/engine/o3o/typedclass.js":
/*!***************************************!*\
  !*** ../lib/engine/o3o/typedclass.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ TypedClass; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TypedClass = /*#__PURE__*/_createClass(function TypedClass() {\n  _classCallCheck(this, TypedClass);\n});\n\n\n;\n\nTypedClass.array = function (n) {\n  var size = this.size;\n  var buffer = new ArrayBuffer(size * n);\n  var arr = [];\n\n  for (var i = 0; i < n; i++) {\n    var obj = new this(buffer, size * i);\n    arr.push(obj);\n  }\n\n  arr.buf = new Int8Array(buffer);\n  return arr;\n};\n\nTypedClass.size = 0;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/typedclass.js?");

/***/ }),

/***/ "../lib/engine/o3o/uvlayer.js":
/*!************************************!*\
  !*** ../lib/engine/o3o/uvlayer.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ UvLayer; }\n/* harmony export */ });\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar UvLayer = /*#__PURE__*/_createClass(function UvLayer() {\n  _classCallCheck(this, UvLayer);\n\n  //uv情報\n  this.name = \"\"; //名前\n\n  this.data = []; //uv値\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/uvlayer.js?");

/***/ }),

/***/ "../lib/engine/o3o/vertex.js":
/*!***********************************!*\
  !*** ../lib/engine/o3o/vertex.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Vertex; }\n/* harmony export */ });\n/* harmony import */ var _typedclass_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./typedclass.js */ \"../lib/engine/o3o/typedclass.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\nvar Vertex = /*#__PURE__*/function (_TypedClass) {\n  _inherits(Vertex, _TypedClass);\n\n  var _super = _createSuper(Vertex);\n\n  function Vertex(buffer, offset) {\n    var _this;\n\n    _classCallCheck(this, Vertex);\n\n    _this = _super.call(this);\n\n    if (!buffer) {\n      buffer = new ArrayBuffer(Vertex.size);\n      offset = 0;\n    } //頂点\n    //12+12+3+12=39バイト\n\n\n    _this.pos = new Float32Array(buffer, offset, 3); //new Vec3(); //座標\n\n    _this.normal = new Float32Array(buffer, offset + 12, 3); //new Vec3(); //法線\n\n    _this.groupWeights = new Float32Array(buffer, offset + 24, 3); //[1,0,0]; //グループウェイト\n\n    _this.groupWeights.set([1, 0, 0]);\n\n    _this.groups = new Int8Array(buffer, offset + 36, 3); //[-1,-1,-1]; //グループ\n\n    _this.groups.set([-1, -1, -1]);\n\n    return _this;\n  }\n\n  return _createClass(Vertex);\n}(_typedclass_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]);\n\n\nVertex.size = 40;\n\n//# sourceURL=webpack://bc/../lib/engine/o3o/vertex.js?");

/***/ }),

/***/ "../lib/engine/obj.js":
/*!****************************!*\
  !*** ../lib/engine/obj.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Obj; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _objman_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./objman.js */ \"../lib/engine/objman.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar Obj = /*#__PURE__*/function () {\n  function Obj() {\n    _classCallCheck(this, Obj);\n\n    this.p = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.scale = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.rotq = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    this.v = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.a = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.stat = _objman_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].STAT_CREATE;\n    this.type = 0;\n    this.hp = 1;\n    this.t = 0;\n    this.hitareas = [];\n    this.matrix = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n    this.phyObjs = [];\n  }\n\n  _createClass(Obj, [{\n    key: \"init\",\n    value: function init() {}\n  }, {\n    key: \"move\",\n    value: function move() {}\n  }, {\n    key: \"draw\",\n    value: function draw() {}\n  }, {\n    key: \"drawShadow\",\n    value: function drawShadow() {\n      this.draw();\n    }\n  }, {\n    key: \"hit\",\n    value: function hit() {}\n  }, {\n    key: \"delete\",\n    value: function _delete() {}\n  }, {\n    key: \"drawhud\",\n    value: function drawhud() {}\n  }]);\n\n  return Obj;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/engine/obj.js?");

/***/ }),

/***/ "../lib/engine/objman.js":
/*!*******************************!*\
  !*** ../lib/engine/objman.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ObjMan; }\n/* harmony export */ });\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n//�I�u�W�F�N�g�}�l�[�W��\nvar STAT_EMPTY = 0,\n    STAT_ENABLE = 1,\n    STAT_CREATE = 2;\nvar objPool = [];\n\nvar ObjMan = /*#__PURE__*/function () {\n  function ObjMan() {\n    _classCallCheck(this, ObjMan);\n\n    this.objs = [];\n    this.id = 0;\n  }\n\n  _createClass(ObjMan, [{\n    key: \"addObj\",\n    value: function addObj(obj) {\n      //�I�u�W�F�N�g�ǉ�\n      this.objs.push(obj);\n    }\n  }, {\n    key: \"rmObj\",\n    value: function rmObj(obj) {\n      //�I�u�W�F�N�g�폜\n      var idx = this.objs.indexOf(obj);\n\n      if (idx >= 0) {\n        this.objs.splice(idx, 1);\n      }\n    }\n  }, {\n    key: \"createObj\",\n    value: function createObj(c) {\n      if (!c) {\n        c = Engine.defObj;\n      }\n\n      var obj = null;\n\n      if (objPool.length > 0) {\n        obj = objPool[objPool.length - 1];\n\n        if (obj.stat < 0) {\n          //�N�[���^�C���Ȃ͖̂���\n          obj = null;\n        }\n      }\n\n      if (!obj) {\n        //�v�[������Ƃ��Ă���Ȃ��ꍇ�͉����ǉ�����\n        for (var i = 0; i < 16; i++) {\n          objPool.push(new Obj());\n        }\n      } //�v�[������I�u�W�F�N�g���ړ�\n\n\n      obj = objPool.pop();\n      this.objs.push(obj);\n\n      if (this.objs.length > 1024) {\n        //�s�{��\n        alert(\"objs>1024!\");\n      } //�����l�Z�b�g\n\n\n      Mat43.setInit(obj.matrix);\n      obj.parent = null;\n      Vec3.set(obj.scale, 1, 1, 1);\n      obj.angle = 0;\n      obj.t = 0;\n      obj.hp = 1;\n      obj.stat = STAT_CREATE;\n      obj.pattern = 0;\n      obj.frame = 0;\n      obj.pos2 = new Vec3();\n      obj.func = c; //ID�Z�b�g\n\n      obj.id = this.id;\n      this.id++;\n      obj.__proto__ = c.prototype;\n      obj.scene = this.scene;\n      obj.init();\n      return obj;\n    }\n  }, {\n    key: \"deleteObj\",\n    value: function deleteObj(obj) {\n      for (var i = 0; i < this.objs.length; i++) {\n        if (obj === this.objs[i]) {\n          //�N�[���^�C�������\n          obj.stat = -10; //�v�[���Ɉړ�\n\n          objPool.unshift(objs[i]);\n          objs.splice(i, 1);\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var objs = this.objs;\n\n      for (var i = 0; i < this.objs.length; i++) {\n        if (objs[i].stat === STAT_CREATE) {\n          objs[i].stat = STAT_ENABLE;\n        }\n\n        if (objs[i].stat === STAT_ENABLE) {\n          objs[i].t++;\n          objs[i].frame++;\n        }\n      }\n\n      for (var i = 0; i < objPool.length; i++) {\n        if (objPool[i].stat < 0) {\n          objPool[i].stat++;\n        } else {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"move\",\n    value: function move() {\n      this.update();\n      var objs = this.objs;\n      objs.forEach(function (e) {\n        if (e.stat !== STAT_ENABLE) return;\n        e.move();\n      });\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      var objs = this.objs;\n      objs.forEach(function (e) {\n        if (e.stat !== STAT_ENABLE) return;\n        e.draw();\n      });\n    }\n  }]);\n\n  return ObjMan;\n}();\n\n\n;\nObjMan.STAT_EMPTY = STAT_EMPTY;\nObjMan.STAT_ENABLE = STAT_ENABLE;\nObjMan.STAT_CREATE = STAT_CREATE;\n\n//# sourceURL=webpack://bc/../lib/engine/objman.js?");

/***/ }),

/***/ "../lib/lib/aabb.js":
/*!**************************!*\
  !*** ../lib/lib/aabb.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ AABB; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n //AABB -----------------\n\nvar DIMENSION = 3,\n    MIN = Math.min,\n    MAX = Math.max;\n\nvar AABB = /*#__PURE__*/function () {\n  function AABB() {\n    _classCallCheck(this, AABB);\n\n    this.min = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.max = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  }\n\n  _createClass(AABB, null, [{\n    key: \"add\",\n    value: function add(a, b, c) {\n      //2つのAABBを内包するAABBを作成\n      for (var i = 0; i < DIMENSION; i++) {\n        if (b.min[i] < c.min[i]) {\n          a.min[i] = b.min[i];\n        } else {\n          a.min[i] = c.min[i];\n        }\n\n        if (b.max[i] > c.max[i]) {\n          a.max[i] = b.max[i];\n        } else {\n          a.max[i] = c.max[i];\n        }\n      }\n    }\n  }, {\n    key: \"hitCheck\",\n    value: function hitCheck(a, b) {\n      //2つのAABBが重なっているか\n      for (var i = 0; i < DIMENSION; i++) {\n        if (a.min[i] > b.max[i] || a.max[i] < b.min[i]) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hitCheckLine\",\n    value: function hitCheckLine(a, p0, p1) {\n      //AABBと線分p0p1が接触しているか\n      var min = -99999;\n      var max = 99999;\n      var t = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(t, p1, p0); //線の傾き\n\n      for (var i = 0; i < DIMENSION; i++) {\n        var n = t[i];\n\n        if (n > 0) {\n          var n3 = (a.min[i] - p0[i]) / n;\n\n          if (n3 > min) {\n            min = n3;\n          }\n\n          n3 = (a.max[i] - p0[i]) / n;\n\n          if (n3 < max) {\n            max = n3;\n          }\n        } else if (n < 0) {\n          var n3 = (a.max[i] - p0[i]) / n;\n\n          if (n3 > min) {\n            min = n3;\n          }\n\n          n3 = (a.min[i] - p0[i]) / n;\n\n          if (n3 < max) {\n            max = n3;\n          }\n        } else {\n          //平行な場合\n          if (a.min[i] > p0[i] || a.max[i] < p0[i]) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n            return -1;\n          }\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n\n      if (min > max) {\n        return -1;\n      }\n\n      return min;\n    }\n  }, {\n    key: \"createFromPoints\",\n    value: function createFromPoints(aabb, points) {\n      //すべての頂点を内包するAABBを求める\n      for (var i = 0; i < DIMENSION; i++) {\n        aabb.min[i] = points[0][i];\n        aabb.max[i] = points[0][i];\n      }\n\n      points.forEach(function (point) {\n        for (var i = 0; i < DIMENSION; i++) {\n          aabb.min[i] = MIN(point[i]);\n          aabb.max[i] = MAX(point[i]);\n        }\n      });\n    }\n  }, {\n    key: \"createFromPolygon\",\n    value: function createFromPolygon(aabb, v1, v2, v3, v4) {\n      //すべての頂点を内包するAABBを求める\n      if (v4) {\n        for (var i = 0; i < DIMENSION; i++) {\n          aabb.min[i] = MIN(MIN(MIN(v1[i], v2[i]), v3[i]), v4[i]);\n          aabb.max[i] = MAX(MAX(MAX(v1[i], v2[i]), v3[i]), v4[i]);\n        }\n      } else {\n        for (var i = 0; i < DIMENSION; i++) {\n          aabb.min[i] = MIN(MIN(v1[i], v2[i]), v3[i]);\n          aabb.max[i] = MAX(MAX(v1[i], v2[i]), v3[i]);\n        }\n      }\n    }\n  }, {\n    key: \"aabbCast\",\n    value: function aabbCast(ang, aabb1, aabb2) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(aabbBuf.min, aabb1.min, aabb2.max);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(aabbBuf.max, aabb1.max, aabb2.min);\n      return this.hitCheckLine(aabbBuf, _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.ZERO, ang);\n    }\n  }]);\n\n  return AABB;\n}();\n\n\n;\nvar aabbBuf = new AABB();\n\n//# sourceURL=webpack://bc/../lib/lib/aabb.js?");

/***/ }),

/***/ "../lib/lib/aabbtree.js":
/*!******************************!*\
  !*** ../lib/lib/aabbtree.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ AABBTree; }\n/* harmony export */ });\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _sort_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sort.js */ \"../lib/lib/sort.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar Node = /*#__PURE__*/function () {\n  function Node() {\n    _classCallCheck(this, Node);\n\n    this.child1 = null;\n    this.child2 = null;\n    this.element = null;\n    this.aabb = new _aabb_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\n  }\n\n  _createClass(Node, [{\n    key: \"find\",\n    value: function find(func) {\n      var res = func(this);\n\n      if (res) {\n        if (this.child1) {\n          this.child1.find(func);\n        }\n\n        if (this.child2) {\n          this.child2.find(func);\n        }\n      }\n    }\n  }]);\n\n  return Node;\n}();\n\n;\n\nfunction _createAABBTree(list, first, last, axis) {\n  if (first === last) {\n    return list[first];\n  }\n\n  var node = new Node();\n  _sort_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].qSort(list, first, last, function (a, b) {\n    return a.aabb.min[axis] - b.aabb.min[axis];\n  });\n  var center = (last + first) / 2 | 0;\n  axis = [1, 2, 0][axis];\n  node.child1 = _createAABBTree(list, first, center, axis);\n  node.child2 = _createAABBTree(list, center + 1, last, axis);\n  node.element = null;\n  _aabb_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].add(node.aabb, node.child1.aabb, node.child2.aabb);\n  return node;\n}\n\nvar AABBTree = /*#__PURE__*/function () {\n  function AABBTree() {\n    _classCallCheck(this, AABBTree);\n\n    this.root;\n  }\n\n  _createClass(AABBTree, null, [{\n    key: \"createAABBTree\",\n    value: function createAABBTree(list) {\n      return _createAABBTree(list, 0, list.length - 1, 0);\n    }\n  }]);\n\n  return AABBTree;\n}();\n\n\n;\nAABBTree.Node = Node;\n\n//# sourceURL=webpack://bc/../lib/lib/aabbtree.js?");

/***/ }),

/***/ "../lib/lib/binder.js":
/*!****************************!*\
  !*** ../lib/lib/binder.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Binder; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _watcher_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./watcher.js */ \"../lib/lib/watcher.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n//バインド\n\n\nvar watcher = new _watcher_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n\nvar Bind = /*#__PURE__*/function () {\n  function Bind(node, variable) {\n    _classCallCheck(this, Bind);\n\n    this.node = node;\n    this.attribute_name = \"\";\n    this.variables = [];\n    this.watches = [];\n  }\n\n  _createClass(Bind, [{\n    key: \"feedBack\",\n    value: function feedBack(value) {\n      if (value === undefined) {\n        var node = this.node;\n\n        if (node.getAttribute(\"type\") === \"checkbox\") {\n          value = node.checked;\n        } else if (node.getAttribute(\"type\") === \"radio\") {\n          value = node.value;\n        } else {\n          value = node.value;\n\n          if (node.hasAttribute(\"number\")) {\n            value = Number(value);\n          }\n        }\n      } //バインド変数にコントロールの値をセットする\n\n\n      var val = this.watches[0].setValue(value);\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      //バインドされた変数の値をノード属性にセット\n      var bind = this;\n      var check = false;\n      this.watches.forEach(function (w, idx) {\n        if (w.change_flg) {\n          check = true;\n        }\n      });\n\n      if (!check) {\n        return;\n      }\n\n      var node = bind.node;\n      var value = bind.watches[0].getValue(0);\n\n      if (bind.func) {\n        var old = bind.watches.map(function (w) {\n          return w.old_value;\n        });\n        value = bind.func(old);\n      }\n\n      if (bind.attribute_name !== \"\") {\n        node.setAttribute(bind.attribute_name, value);\n        return;\n      }\n\n      node.setAttribute(\"content\", value);\n\n      switch (node.tagName) {\n        case \"INPUT\":\n        case \"SELECT\":\n        case \"TEXTAREA\":\n          if (node.getAttribute(\"type\") === \"checkbox\") {\n            node.checked = value;\n          }\n\n          if (node.getAttribute(\"type\") === \"radio\") {\n            node.checked = Boolean(value === node.value);\n          } else {\n            node.value = value;\n          }\n\n          _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(node, \"input\");\n          break;\n\n        default:\n          if (value && (value instanceof HTMLElement || value.nodeName)) {\n            node.innerHTML = \"\";\n            node.appendChild(value);\n          } else {\n            node.textContent = value;\n          }\n\n      }\n    }\n  }]);\n\n  return Bind;\n}();\n\nvar Binder = /*#__PURE__*/function () {\n  function Binder() {\n    _classCallCheck(this, Binder);\n\n    this.binds = [];\n    this.variable_root = window;\n  }\n\n  _createClass(Binder, [{\n    key: \"init\",\n    value: function init(_variable_root) {\n      var _this = this;\n\n      //初期化&バインド\n      if (_variable_root) {\n        this.variable_root = _variable_root;\n      } //this.binds=[];\n\n\n      var bindedNodes = document.querySelectorAll(\"*\");\n      bindedNodes.forEach(function (node) {\n        for (var i = 0; i < node.attributes.length; i++) {\n          var attribute_name = node.attributes[i].name;\n          if (attribute_name.indexOf(\"bind:\") !== 0) continue;\n          var variable_names = node.getAttribute(attribute_name);\n          variable_names = variable_names.split(\",\");\n          attribute_name = attribute_name.replace(\"bind:\", \"\");\n          var func = null;\n\n          if (node.hasAttribute(\"bindfunc\")) {\n            func = node.getAttribute(\"bindfunc\");\n            func = new Function('arg', func);\n          }\n\n          _this.bind(node, attribute_name, null, variable_names, func);\n        }\n\n        ;\n      });\n\n      var func = function func() {\n        _this.refresh();\n\n        window.requestAnimationFrame(func);\n      };\n\n      func();\n    }\n  }, {\n    key: \"bind\",\n    value: function bind(node, attribute_name, variable_root, variable_names, func) {\n      var bind = this.binds.find(function (e) {\n        return e.node == node && e.attribute_name == attribute_name;\n      });\n\n      if (bind) {\n        return bind;\n      } //ノードとバインド変数を渡してバインド情報を登録する\n\n\n      bind = new Bind();\n      bind.node = node;\n      bind.attribute_name = attribute_name;\n\n      if (!variable_root) {\n        variable_root = this.variable_root;\n      }\n\n      if (!Array.isArray(variable_names)) {\n        variable_names = [variable_names];\n      }\n\n      variable_names.forEach(function (name) {\n        bind.watches.push(watcher.watch(variable_root, name));\n      });\n      bind.func = func;\n      bind.binder = this;\n      this.binds.push(bind);\n\n      if (node.hasAttribute(\"feedback\")) {\n        var f = node.getAttribute(\"feedback\");\n\n        if (f != null && f != \"\") {\n          bind.feedBack = Function(f);\n        }\n\n        node.addEventListener(\"change\", function () {\n          bind.feedBack();\n        });\n      }\n\n      return bind;\n    }\n  }, {\n    key: \"bindNodes\",\n    value: function bindNodes(node, variable_root) {\n      var _this2 = this;\n\n      var bindedNodes = node.querySelectorAll(\"*\");\n      bindedNodes.forEach(function (node) {\n        for (var i = 0; i < node.attributes.length; i++) {\n          var attribute_name = node.attributes[i].name;\n          if (attribute_name.indexOf(\"bind:\") !== 0) continue;\n          var variable_name = node.getAttribute(attribute_name);\n          attribute_name = attribute_name.replace(\"bind:\", \"\");\n\n          _this2.bind(node, attribute_name, variable_root, variable_name);\n        }\n\n        ;\n      });\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      watcher.refresh(); //バインドしたノードに変数の値をセット\n\n      for (var i = 0; i < this.binds.length; i++) {\n        this.binds[i].refresh();\n      }\n    }\n  }]);\n\n  return Binder;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/binder.js?");

/***/ }),

/***/ "../lib/lib/bsp.js":
/*!*************************!*\
  !*** ../lib/lib/bsp.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _sort_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sort.js */ \"../lib/lib/sort.js\");\n\n\n\nvar Bsp = function () {\n  var Bsp = function Bsp() {\n    this.m = 0; //平面と原点との距離\n\n    this.v = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //平面の法線\n  };\n\n  var ret = Bsp;\n\n  ret.prototype.hitCheck = function (p) {\n    return this.m <= _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(p, this.v);\n  };\n\n  ret.Tree = function () {\n    this.nodes = [];\n    this.rootNode;\n  };\n\n  ret.Node = function () {\n    this.child1 = null;\n    this.child2 = null;\n    this.element = null;\n    this.collision = new Bsp();\n  };\n\n  var searchCount = 0;\n\n  ret.Tree.prototype.getItem = function (p) {\n    searchCount = 0;\n    var result = this.rootNode.getItem(p);\n    this.searchCount = searchCount;\n    return result;\n  };\n\n  ret.Node.prototype.getItem = function (p) {\n    searchCount++;\n\n    if (!this.collision.hitCheck(p)) {\n      return null;\n    }\n\n    if (this.element) {\n      //if(Geono.TETRA_POINT(null,p,this.element.p)){\n      //\treturn this.element;\n      //}\n      var bsps = this.element.bsps;\n\n      for (var i = 0; i < 4; i++) {\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(bsps[i].v, p) - bsps[i].m < 0) {\n          return null;\n        }\n      }\n\n      return this.element;\n    }\n\n    var result = this.child1.getItem(p);\n    if (result) return result;\n    return this.child2.getItem(p);\n  };\n\n  ret.createBspTree = function (items) {\n    var tree = new Bsp.Tree();\n    var n = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n\n    for (var i = 0; i < items.length; i++) {\n      var node = new Bsp.Node();\n      node.element = items[i];\n      tree.nodes.push(node);\n      var t = items[i];\n      var bsps = t.bsps = [];\n\n      for (var j = 0; j < 4; j++) {\n        //4つの面それぞれから対象までの距離を求める\n        var t1 = t.p[j + 1 & 3];\n        var t2 = t.p[j + 2 & 3];\n        var t3 = t.p[j + 3 & 3];\n        var t4 = t.p[j];\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(n, t3, t2, t1);\n        var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(n, t1); //原点から面までの長さ\n\n        var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(n, t4); //原点から対頂点までの長さ\n\n        l2 = 1.0 / (l2 - l1);\n        var bsp = new Bsp();\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(bsp.v, n, l2);\n        bsp.m = l1 * l2;\n        bsps.push(bsp);\n      }\n    }\n\n    var axis = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(1, 0, 0);\n    tree.rootNode = tree._createBspTree(0, tree.nodes.length - 1, axis);\n    return tree;\n  };\n\n  ret.Tree.prototype._createBspTree = function (first, last, pAxis) {\n    //指定範囲の葉ノードを枝分けする\n    var nodes = this.nodes;\n    var node;\n\n    if (first === last) {\n      //1個だけの場合はそのまま葉ノードを使う\n      node = nodes[first];\n    } else {\n      //二個以上ある場合は枝ノード作って追加する\n      node = new Bsp.Node();\n      this.nodes.push(node);\n    } //範囲内の要素を内包？する指定法線の平面を求める\n\n\n    var m = nodes[first].element.calcSupport(pAxis);\n\n    for (var i = first + 1; i <= last; i++) {\n      m = Math.min(m, nodes[i].element.calcSupport(pAxis));\n    }\n\n    node.collision.m = m;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(node.collision.v, pAxis);\n\n    if (first === last) {\n      //1個だけの場合は葉ノード返す\n      return node;\n    }\n\n    var center = (last + first) / 2 | 0; //中央インデックス\n\n    var axis2 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var axis = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //指定範囲の四面体の各面の法線で分割して一番いいやつの法線を採用する\n\n    var min = -99999;\n\n    for (var i = first; i <= last; i++) {\n      var t = nodes[i].element;\n\n      for (var j = 0; j < 4; j++) {\n        //Vec3.cross2(axis,t.p[j],t.p[(j+1)&3],t.p[(j+2)&3]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.nrm(axis, t.bsps[j].v);\n\n        for (var k = first; k <= last; k++) {\n          var n = nodes[k];\n          n.collision.m = n.element.calcSupport(axis);\n        }\n\n        _sort_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].qSort(nodes, first, last, function (a, b) {\n          return a.collision.m - b.collision.m;\n        });\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n        var a = nodes[first].element.calcSupport(axis);\n\n        for (var k = first + 1; k <= center; k++) {\n          a = Math.min(a, nodes[k].element.calcSupport(axis));\n        }\n\n        a = nodes[center + 1].collision.m + a;\n\n        if (min < a) {\n          //より良い軸に変更\n          min = a;\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis2, axis, -1);\n        }\n      }\n    }\n\n    for (var k = first; k <= last; k++) {\n      var n = nodes[k];\n      n.collision.m = n.element.calcSupport(axis2);\n    }\n\n    _sort_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].qSort(nodes, first, last, function (a, b) {\n      return a.collision.m - b.collision.m;\n    });\n    node.child2 = this._createBspTree(center + 1, last, axis2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis2, axis2, -1);\n    node.child1 = this._createBspTree(first, center, axis2);\n    return node;\n  };\n\n  return ret;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Bsp);\n\n//# sourceURL=webpack://bc/../lib/lib/bsp.js?");

/***/ }),

/***/ "../lib/lib/collider/capsule.js":
/*!**************************************!*\
  !*** ../lib/lib/collider/capsule.js ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Capsule; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\n/* harmony import */ var _cylinder_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./cylinder.js */ \"../lib/lib/collider/cylinder.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar Capsule = /*#__PURE__*/function (_Collision) {\n  _inherits(Capsule, _Collision);\n\n  var _super = _createSuper(Capsule);\n\n  //カプセル\n  function Capsule() {\n    var _this;\n\n    _classCallCheck(this, Capsule);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CAPSULE;\n    return _this;\n  }\n\n  _createClass(Capsule, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      var m = this.matrix;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans, m[3], m[4], m[5]);\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(ans, v) < 0) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, ans, -1);\n      }\n\n      ans[0] += m[9];\n      ans[1] += m[10];\n      ans[2] += m[11];\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      //カプセルと線分\n      var min = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n      var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var n2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var l = _cylinder_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].prototype.rayCast.call(this, p0, p1, normal);\n\n      if (min === _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID || l < min) {\n        min = l;\n      }\n\n      var m = this.matrix;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(p, m[3] + m[9], m[4] + m[10], m[5] + m[11]);\n      l = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SPHERE_LINE(p0, p1, p, this.bold, n2);\n\n      if (min === _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID || l < min && l !== _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID) {\n        min = l;\n\n        if (normal) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(normal, n2);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(p, -m[3] + m[9], -m[4] + m[10], -m[5] + m[11]);\n      l = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SPHERE_LINE(p0, p1, p, this.bold, n2);\n\n      if (min === _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID || l < min && l !== _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID) {\n        min = l;\n\n        if (normal) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(normal, n2);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n\n      if (normal && min === _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, 0, 0, 0);\n      }\n\n      return min;\n    }\n  }]);\n\n  return Capsule;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/capsule.js?");

/***/ }),

/***/ "../lib/lib/collider/collider.js":
/*!***************************************!*\
  !*** ../lib/lib/collider/collider.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _aabbtree_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabbtree.js */ \"../lib/lib/aabbtree.js\");\n/* harmony import */ var _sort_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../sort.js */ \"../lib/lib/sort.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../geono.js */ \"../lib/lib/geono.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\n/* harmony import */ var _sphere_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./sphere.js */ \"../lib/lib/collider/sphere.js\");\n/* harmony import */ var _cone_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./cone.js */ \"../lib/lib/collider/cone.js\");\n/* harmony import */ var _cylinder_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cylinder.js */ \"../lib/lib/collider/cylinder.js\");\n/* harmony import */ var _capsule_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./capsule.js */ \"../lib/lib/collider/capsule.js\");\n/* harmony import */ var _cuboid_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./cuboid.js */ \"../lib/lib/collider/cuboid.js\");\n/* harmony import */ var _convexhull_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./convexhull.js */ \"../lib/lib/collider/convexhull.js\");\n/* harmony import */ var _mesh_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./mesh.js */ \"../lib/lib/collider/mesh.js\");\n/* harmony import */ var _triangle_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./triangle.js */ \"../lib/lib/collider/triangle.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _gjk_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./gjk.js */ \"../lib/lib/collider/gjk.js\");\n/* harmony import */ var _convexcast_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./convexcast.js */ \"../lib/lib/collider/convexcast.js\");\n\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar calcClosestPrimitive = _gjk_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"];\nvar DIMENSION = 3; //次元数\n\nvar MIN = Math.min,\n    MAX = Math.max;\nvar INVALID = -9999999; //無効値\n\nvar HitListElem = /*#__PURE__*/_createClass( //接触情報\nfunction HitListElem() {\n  _classCallCheck(this, HitListElem);\n\n  this.pairId = -1; //重なったコリジョン組のID  id1+id2\n\n  this.col1 = null; //コリジョン1\n\n  this.col2 = null; //コリジョン2\n});\n\nvar HitListElemEx = /*#__PURE__*/function (_HitListElem) {\n  _inherits(HitListElemEx, _HitListElem);\n\n  var _super = _createSuper(HitListElemEx);\n\n  //接触情報(接触座標つき)\n  function HitListElemEx() {\n    var _this;\n\n    _classCallCheck(this, HitListElemEx);\n\n    _this = _super.call(this);\n    _this.pos1 = new _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3(); //コリジョン1の接触点\n\n    _this.pos2 = new _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3(); //コリジョン2の接触点\n\n    return _this;\n  }\n\n  return _createClass(HitListElemEx);\n}(HitListElem);\n\n;\n\nvar Collider = function () {\n  var ret = Collider = function Collider() {\n    this.collisions = []; //コリジョンリスト\n\n    this.collisionIndexList = []; //ID保管リスト\n\n    for (var i = 1023; i--;) {\n      this.collisionIndexList.push(i);\n    }\n\n    this.aabbSorts = []; //AABBソートリスト\n\n    this.aabbHitListMain = []; //AABB接触リスト\n\n    this.hitList = []; //接触情報\n\n    this.hitListIndex = 0; //接触数\n\n    for (var i = 0; i < 1024; i++) {\n      this.aabbHitListMain.push(new HitListElem());\n      this.hitList.push(new HitListElemEx());\n    }\n\n    for (var i = 0; i < DIMENSION; i++) {\n      this.aabbSorts.push([]);\n    }\n  };\n\n  ret.INVALID = INVALID;\n  var i = 0;\n  var MESH = ret.MESH = i++,\n      CUBOID = ret.CUBOID = i++,\n      SPHERE = ret.SPHERE = i++,\n      CYLINDER = ret.CYLINDER = i++,\n      CAPSULE = ret.CAPSULE = i++,\n      CONE = ret.CONE = i++,\n      CONVEX_HULL = ret.CONVEX_HULL = i++,\n      TRIANGLE = ret.TRIANGLE = i++;\n  var collisionIndexList;\n\n  ret.prototype.addCollision = function (collision) {\n    //コリジョン登録\n    collision.id = this.collisionIndexList.pop();\n    this.collisions.push(collision);\n\n    for (var i = 0; i < DIMENSION; i++) {\n      this.aabbSorts[i].push(collision);\n    }\n\n    return;\n  };\n\n  ret.prototype.deleteCollision = function (obj) {\n    var collisions = this.collisions;\n\n    for (var i = 0; i < collisions.length; i++) {\n      if (collisions[i] === obj) {\n        this.collisionIndexList.push(collisions[i].id);\n        collisions.splice(i, 1);\n        break;\n      }\n    }\n\n    for (var j = 0; j < 3; j++) {\n      var aabbSort = this.aabbSorts[j];\n\n      for (var i = 0; i < aabbSort.length; i++) {\n        if (aabbSort[i] === obj) {\n          aabbSort.splice(i, 1);\n          break;\n        }\n      }\n    }\n  };\n\n  ret.prototype.sortList = function () {\n    for (var i = 0; i < DIMENSION; i++) {\n      //ソート\n      this.aabbSorts[i].sort(function (a, b) {\n        return a.aabb.min[i] - b.aabb.min[i];\n      });\n    }\n  };\n\n  ret.prototype.calcAABBHitList = function () {\n    var aabbHitLists = new Array(DIMENSION);\n    var aabbHitListsIdx = new Array(DIMENSION);\n\n    for (var i = 1; i < aabbHitLists.length; i++) {\n      aabbHitLists[i] = new Array(1024);\n    }\n\n    var calcAABBHitList = function calcAABBHitList() {\n      var aabbHitListMain = this.aabbHitListMain;\n      this.sortList(); //AABBの重なりチェックx軸\n\n      var aabbHitListMainIdx = 0;\n      var AABBSort = this.aabbSorts[0];\n\n      for (var j = 0; j < AABBSort.length; j++) {\n        var end = AABBSort[j].aabb.max[0];\n\n        for (var k = j + 1; k < AABBSort.length; k++) {\n          if (end <= AABBSort[k].aabb.min[0]) {\n            //AABBの先頭が判定元AABBの終端を超えていたら終了\n            break;\n          }\n\n          if (!(AABBSort[j].groups & AABBSort[k].groups) || AABBSort[j].notgroups & AABBSort[k].notgroups) {\n            //グループが一致しない場合は無視\n            //notグループが一致する場合は無視\n            continue;\n          } //重なっているAABBを追加\n\n\n          if (AABBSort[j].id < AABBSort[k].id) {\n            aabbHitListMain[aabbHitListMainIdx].col1 = AABBSort[j];\n            aabbHitListMain[aabbHitListMainIdx].col2 = AABBSort[k];\n          } else {\n            aabbHitListMain[aabbHitListMainIdx].col1 = AABBSort[k];\n            aabbHitListMain[aabbHitListMainIdx].col2 = AABBSort[j];\n          }\n\n          aabbHitListMain[aabbHitListMainIdx].pairId = Collider.getPairId(AABBSort[j].id, AABBSort[k].id);\n          aabbHitListMainIdx++;\n        }\n      }\n\n      _sort_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].kisu(aabbHitListMain, function (a) {\n        return a.pairId;\n      }, 0, aabbHitListMainIdx - 1);\n\n      for (var i = 1; i < DIMENSION; i++) {\n        //y,z軸それぞれで計算\n        var idx = 0;\n        var AABBSort = this.aabbSorts[i];\n        var aabbHitList = aabbHitLists[i]; //AABBの重なりチェック\n\n        for (var j = 0; j < AABBSort.length; j++) {\n          var end = AABBSort[j].aabb.max[i];\n\n          for (var k = j + 1; k < AABBSort.length; k++) {\n            if (end <= AABBSort[k].aabb.min[i]) {\n              //AABBの先頭が判定元AABBの終端を超えていたら終了\n              break;\n            }\n\n            if (!(AABBSort[j].groups & AABBSort[k].groups) || AABBSort[j].notgroups & AABBSort[k].notgroups) {\n              //グループが一致しない場合は無視\n              //notグループが一致する場合は無視\n              continue;\n            } //重なっているAABBを追加\n\n\n            aabbHitList[idx] = Collider.getPairId(AABBSort[j].id, AABBSort[k].id);\n            idx++;\n          }\n        }\n\n        aabbHitList[idx] = (2 << 16) * (2 << 16); //番兵\n\n        _sort_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].kisu(aabbHitList, null, 0, idx - 1);\n      } //3つの軸すべて重なっているものを抽出\n\n\n      var idx = 0;\n      var idxy = 0;\n      var idxz = 0;\n\n      for (var i = 0; i < aabbHitListMainIdx; i++) {\n        var pairId = aabbHitListMain[i].pairId; //x軸と同じペアIDがy,zにあるかチェック\n\n        for (; aabbHitLists[1][idxy] < pairId; idxy++) {}\n\n        for (; aabbHitLists[2][idxz] < pairId; idxz++) {}\n\n        if (aabbHitLists[1][idxy] == pairId && aabbHitLists[2][idxz] == pairId) {\n          //あった場合追加\n          aabbHitListMain[idx].pairId = aabbHitListMain[i].pairId;\n          aabbHitListMain[idx].col1 = aabbHitListMain[i].col1;\n          aabbHitListMain[idx].col2 = aabbHitListMain[i].col2;\n          idx++;\n        }\n      }\n\n      aabbHitListMain[idx].pairId = -1;\n      return aabbHitListMain;\n    };\n\n    return calcAABBHitList;\n  }(); //コリジョンリストと引数のコリジョンのレイキャスト\n\n\n  ret.prototype.convexCastAll = function (col, v) {\n    var AABBSort = this.aabbSorts[0];\n    this.hitListIndex = 0;\n    var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n\n    for (var j = 0; j < AABBSort.length; j++) {\n      if (!(col.groups & AABBSort[j].groups) || col.notgroups & AABBSort[j].notgroups) {\n        //衝突グループに一致しない場合は無視\n        //not衝突グループに一致する場合は無視\n        continue;\n      }\n\n      if (!_aabb_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].aabbCast(v, col.aabb, AABBSort[j].aabb)) {\n        continue;\n      }\n\n      var a = (0,_convexcast_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"])(v, col, AABBSort[j], ans1, ans2);\n\n      if (a !== INVALID) {\n        var elem = this.hitList[this.hitListIndex];\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos1, ans1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos2, ans2);\n        elem.col1 = col;\n        elem.col2 = AABBSort[j];\n        elem.len = a;\n        this.hitListIndex++;\n      }\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n    return this.hitList;\n  }; //コリジョンリストのレイキャスト\n\n\n  ret.prototype.rayCastAll = function (p, v) {\n    var AABBSort = this.aabbSorts[0];\n    this.hitListIndex = 0;\n    var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var p2 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.add(p2, p, v);\n\n    for (var j = 0; j < AABBSort.length; j++) {\n      var a = AABBSort[j].rayCast(p, p2, ans1);\n\n      if (a !== INVALID) {\n        var elem = this.hitList[this.hitListIndex];\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(elem.pos1, p, v, a);\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos2, ans1);\n        elem.col1 = AABBSort[j];\n        elem.len = a;\n        this.hitListIndex++;\n      }\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n    return this.hitList;\n  }; //コリジョンリストと引数のコリジョンの距離判定\n\n\n  ret.prototype.checkClosestAll = function (col) {\n    var AABBSort = this.aabbSorts[0];\n    this.hitListIndex = 0;\n    var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n\n    for (var j = 0; j < AABBSort.length; j++) {\n      if (col.aabb.max[0] < AABBSort[j].aabb.min[0]) break;\n      if (col.aabb.min[0] > AABBSort[j].aabb.max[0]) continue;\n\n      if (!(col.groups & AABBSort[j].groups) || col.notgroups & AABBSort[j].notgroups) {\n        //グループが一致しない場合は無視\n        //notグループが一致する場合は無視\n        continue;\n      }\n\n      if (Collider.calcClosest(ans1, ans2, col, AABBSort[j]) < 0) {\n        var elem = this.hitList[this.hitListIndex];\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos1, ans1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos2, ans2);\n        elem.col1 = col;\n        elem.col2 = AABBSort[j];\n        this.hitListIndex++;\n      }\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n    return this.hitList;\n  }; //コリジョンリストと引数のコリジョンの接触判定\n\n\n  ret.prototype.checkHitAll = function (col) {\n    var AABBSort = this.aabbSorts[0];\n    this.hitListIndex = 0;\n\n    for (var j = 0; j < AABBSort.length; j++) {\n      if (col.aabb.max[0] < AABBSort[j].aabb.min[0]) break;\n      if (col.aabb.min[0] > AABBSort[j].aabb.max[0]) continue;\n\n      if (!(col.groups & AABBSort[j].groups) || col.notgroups & AABBSort[j].notgroups) {\n        //グループが一致しない場合は無視\n        //notグループが一致する場合は無視\n        continue;\n      }\n\n      if (Collider.calcClosest(null, null, col, AABBSort[j], 1) < 0) {\n        var elem = this.hitList[this.hitListIndex];\n        elem.col1 = col;\n        elem.col2 = AABBSort[j];\n        this.hitListIndex++;\n      }\n    }\n\n    return this.hitList;\n  }; //col1とcol2の接触チェック\n\n\n  ret.checkHit = function (col1, col2) {\n    return Collider.calcClosest(null, null, col1, col2);\n  }; //col1とcol2の最小距離もしくは最大めり込み距離を求める\n\n\n  ret.calcClosest = function (ans1, ans2, col1, col2) {\n    var l = calcClosestWithoutBold(ans1, ans2, col1, col2);\n    var flg = 0;\n\n    if (l > 0) {\n      //接触していない\n      flg = 1;\n    } //距離からそれぞれのオブジェクトの太さ分を考慮したものにする\n\n\n    l -= col1.bold + col2.bold;\n\n    if (!ans1 || !ans2) {\n      //位置が不要な場合は終わり\n      return l;\n    }\n\n    var n = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.sub(n, ans2, ans1);\n\n    if (!flg) {\n      //接触していない場合はベクトルを逆にする\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.mul(n, n, -1);\n    } //接触位置を太さ分ずらす\n\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.norm(n);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(ans1, ans1, n, col1.bold);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(ans2, ans2, n, -col2.bold);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(1);\n    return l;\n  }; //最小距離もしくは最大めり込み距離を求める(太さ未考慮）\n\n\n  var calcClosestWithoutBold = function () {\n    return function (ans1, ans2, col1, col2) {\n      var l = 9999;\n\n      if (col1.type === MESH) {\n        //col1がメッシュの場合\n        l = MESH_ANY(ans1, ans2, col1, col2);\n      } else if (col2.type === MESH) {\n        //col2がメッシュの場合\n        l = MESH_ANY(ans2, ans1, col2, col1);\n      } else {\n        var func = hantei[col1.type * 8 + col2.type];\n\n        if (func) {\n          //専用の関数のある組み合わせの場合\n          if (!ans1 || !ans2) {\n            ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n            ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n            l = func(ans1, ans2, col1, col2);\n            _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n          } else {\n            l = func(ans1, ans2, col1, col2);\n          }\n        } else {\n          //専用の関数がない場合は汎用関数(GJK-EPA)\n          l = calcClosestPrimitive(ans1, ans2, col1, col2);\n        }\n      }\n\n      return l;\n    };\n  }();\n\n  var AABBNode_ANY = function AABBNode_ANY(ans1, ans2, node, col2) {\n    //AABBツリーと何かの判定\n    if (!_aabb_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hitCheck(node.aabb, col2.aabb)) {\n      return 9999999;\n    }\n\n    if (node.element) {\n      return calcClosestWithoutBold(ans1, ans2, node.element, col2);\n    } else {\n      var ans3 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n      var ans4 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n      var l = AABBNode_ANY(ans1, ans2, node.child1, col2);\n      var l2 = AABBNode_ANY(ans3, ans4, node.child2, col2);\n\n      if (l2 < l) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(ans1, ans3);\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(ans2, ans4);\n        l = l2;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n      return l;\n    }\n  };\n\n  var MESH_ANY = function MESH_ANY(ans1, ans2, col1, col2) {\n    //メッシュと何かの判定\n    return AABBNode_ANY(ans1, ans2, col1.aabbTreeRoot, col2);\n  }; //特定の組み合わせ用最近計算アルゴリズム\n\n\n  var hantei = new Array(8 * 8);\n\n  for (var i = 0; i < 8 * 8; i++) {\n    hantei[i] = null;\n  }\n\n  var setHantei = function setHantei(a, b, c) {\n    hantei[b * 8 + a] = function (ans1, ans2, col1, col2) {\n      return c(ans2, ans1, col2, col1);\n    };\n\n    hantei[a * 8 + b] = c;\n  };\n\n  setHantei(SPHERE, SPHERE, function (ans1, ans2, col1, col2) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans1, col1.matrix[9], col1.matrix[10], col1.matrix[11]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans2, col2.matrix[9], col2.matrix[10], col2.matrix[11]);\n    return _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.len(ans1, ans2);\n  });\n  setHantei(CAPSULE, SPHERE, function (ans1, ans2, col1, col2) {\n    var m = col1.matrix;\n    var bV0 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var bV1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(bV0, m[9] + m[3], m[10] + m[4], m[11] + m[5]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(bV1, m[9] - m[3], m[10] - m[4], m[11] - m[5]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans2, col2.matrix[9], col2.matrix[10], col2.matrix[11]);\n    _geono_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].LINE_POINT(ans1, bV0, bV1, ans2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(2);\n    return _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.len(ans1, ans2);\n  });\n  setHantei(TRIANGLE, SPHERE, function (ans1, ans2, col1, col2) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans2, col2.matrix[9], col2.matrix[10], col2.matrix[11]);\n    _geono_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].TRIANGLE_POINT(ans1, col1.v[0], col1.v[1], col1.v[2], ans2);\n    return _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.len(ans1, ans2);\n  });\n  setHantei(CUBOID, SPHERE, function (ans1, ans2, cuboid, sphere) {\n    var axis = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var dVec = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var len = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc(); //中心差分\n\n    dVec[0] = sphere.matrix[9] - cuboid.matrix[9];\n    dVec[1] = sphere.matrix[10] - cuboid.matrix[10];\n    dVec[2] = sphere.matrix[11] - cuboid.matrix[11];\n    var insideFlg = 1; //内包フラグ\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans1, sphere.matrix[9], sphere.matrix[10], sphere.matrix[11]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(ans2, sphere.matrix[9], sphere.matrix[10], sphere.matrix[11]); //球は中心固定\n\n    for (var i = 0; i < DIMENSION; i++) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(axis, cuboid.matrix[i * 3 + 0], cuboid.matrix[i * 3 + 1], cuboid.matrix[i * 3 + 2]); //軸\n\n      var d = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.dot(axis, dVec); //軸に対する差分\n\n      var size = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.dot(axis, axis); //軸の長さ^2\n\n      if (d > size) {\n        //軸より外の場合(正)\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(ans1, ans1, axis, 1 - d / size);\n        insideFlg = 0;\n      } else if (d < -size) {\n        //軸より外の場合(負)\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(ans1, ans1, axis, -(1 + d / size));\n        insideFlg = 0;\n      } else {\n        //内側の場合\n        if (d > 0) {\n          len[i] = (size - d) / _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.scalar(axis);\n        } else {\n          len[i] = (-size - d) / _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.scalar(axis);\n        }\n      }\n    }\n\n    if (insideFlg) {\n      //内側の場合\n      var min = 0;\n\n      for (var i = 1; i < DIMENSION; i++) {\n        if (len[min] * len[min] > len[i] * len[i]) {\n          min = i;\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(axis, cuboid.matrix[min * 3 + 0], cuboid.matrix[min * 3 + 1], cuboid.matrix[min * 3 + 2]); //軸\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.madd(ans1, ans2, axis, len[min] / _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.scalar(axis));\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(3);\n      return -_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.len(ans1, ans2);\n    } else {\n      //外側の場合\n      _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(3);\n      return _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.len(ans1, ans2);\n    }\n  });\n\n  ret.prototype.All = function (disableList, disableListSize) {\n    //総当り\n    var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var n = _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolAlloc();\n    var collisions = this.aabbSorts[0];\n    var start = Date.now();\n    performance.mark(\"aabbStart\"); //AABBで重なっているペアを抽出\n\n    var aabbHitList = this.calcAABBHitList();\n    performance.mark(\"aabbEnd\");\n    var dIdx = 0;\n    _sort_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].kisu(disableList, null, 0, disableListSize - 1);\n    performance.mark(\"collisionStart\");\n    this.hitListIndex = 0;\n\n    for (var i = 0; aabbHitList[i].pairId > 0; i++) {\n      var aabbHit = aabbHitList[i]; //コリジョン無効チェック\n\n      var flg = false;\n\n      for (; disableList[dIdx] > 0; dIdx++) {\n        if (disableList[dIdx] === aabbHit.pairId) {\n          flg = true;\n          break;\n        }\n\n        if (disableList[dIdx] > aabbHit.pairId) {\n          break;\n        }\n      }\n\n      if (flg) {\n        continue;\n      }\n\n      var col1 = aabbHit.col1;\n      var col2 = aabbHit.col2;\n      var l = Collider.calcClosest(ans1, ans2, col1, col2);\n\n      if (l < 0) {\n        var elem = this.hitList[this.hitListIndex];\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos1, ans1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.copy(elem.pos2, ans2);\n        elem.col1 = col1;\n        elem.col2 = col2;\n        elem.pairId = aabbHitList[i].pairId;\n        this.hitListIndex++;\n\n        if (col1.callbackFunc) {\n          col1.callbackFunc(col1, col2, elem.pos1, elem.pos2);\n        }\n\n        if (col2.callbackFunc) {\n          col2.callbackFunc(col2, col1, elem.pos2, elem.pos1);\n        }\n      }\n    }\n\n    this.hitList[this.hitListIndex].col1 = null;\n    this.collisionCount = i;\n    performance.mark(\"collisionEnd\");\n    _vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.poolFree(3);\n  }; //id1とid2のペアIDを求める\n\n\n  ret.getPairId = function (id1, id2) {\n    if (id1 < id2) {\n      return id1 << 16 | id2;\n    } else {\n      return id2 << 16 | id1;\n    }\n  };\n\n  ret.Sphere = _sphere_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"];\n  ret.Cuboid = _cuboid_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"];\n  ret.Cylinder = _cylinder_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"];\n  ret.Cone = _cone_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"];\n  ret.Capsule = _capsule_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"];\n  ret.ConvexHull = _convexhull_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"];\n  ret.Mesh = _mesh_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"];\n  ret.Triangle = _triangle_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"];\n  return ret;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Collider);\n\n//# sourceURL=webpack://bc/../lib/lib/collider/collider.js?");

/***/ }),

/***/ "../lib/lib/collider/collision.js":
/*!****************************************!*\
  !*** ../lib/lib/collider/collision.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Collision; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _convexcast_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./convexcast.js */ \"../lib/lib/collider/convexcast.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar INVALID = -9999999; //無効値\n\nvar reverse = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n\nvar Collision = /*#__PURE__*/function () {\n  function Collision() {\n    _classCallCheck(this, Collision);\n\n    this.aabb = new _aabb_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n    this.bold = 0; //太さ\n\n    this.parent = null;\n    this.matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n    this.inv_matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43();\n    this.groups = 1;\n    this.notgroups = 0;\n    this.callbackFunc = null;\n    this.parent = null;\n    this.name = \"\";\n  }\n\n  _createClass(Collision, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ret, axis) {\n      ret[0] = this.matrix[9];\n      ret[1] = this.matrix[10];\n      ret[2] = this.matrix[11];\n      return;\n    }\n  }, {\n    key: \"calcSupportReverse\",\n    value: function calcSupportReverse(ret, axis) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(reverse, axis, -1);\n      this.calcSupport(ret, reverse);\n      return;\n    }\n  }, {\n    key: \"calcSupportB\",\n    value: function calcSupportB(ret, axis) {\n      //太さを考慮したサポート\n      this.calcSupport(ret, axis);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ret, ret, axis, this.bold / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(axis));\n      return;\n    }\n  }, {\n    key: \"calcSupportReverseB\",\n    value: function calcSupportReverseB(ret, axis) {\n      //太さを考慮したサポート\n      this.calcSupportReverse(ret, axis);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ret, ret, axis, -(this.bold / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(axis)));\n      return;\n    }\n  }, {\n    key: \"calcAABB\",\n    value: function calcAABB(aabb) {\n      if (!aabb) {\n        aabb = this.aabb;\n      } //AABBを求める\n\n\n      var axis = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var ret = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n\n      for (var i = 0; i < DIMENSION; i++) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(axis, 0, 0, 0);\n        axis[i] = 1;\n        this.calcSupport(ret, axis);\n        aabb.max[i] = ret[i] + this.bold;\n        axis[i] = -1;\n        this.calcSupport(ret, axis);\n        aabb.min[i] = ret[i] - this.bold;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      //衝突判定前処理\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.getInv(this.inv_matrix, this.matrix);\n      this.calcAABB();\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      sphere.matrix[9] = p0[0];\n      sphere.matrix[10] = p0[1];\n      sphere.matrix[11] = p0[2];\n      sphere.refresh();\n      var ang = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ang, p1, p0);\n      var l = (0,_convexcast_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(ang, sphere, this, normal);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      return l;\n    }\n  }]);\n\n  return Collision;\n}();\n\n\n;\nvar i = 0;\nCollision.MESH = i++;\nCollision.CUBOID = i++;\nCollision.SPHERE = i++;\nCollision.CYLINDER = i++;\nCollision.CAPSULE = i++;\nCollision.CONE = i++;\nCollision.CONVEX_HULL = i++;\nCollision.TRIANGLE = i++;\nCollision.INVALID = INVALID;\n\nCollision.SPHERE_LINE = function (p0, p1, p2, r, normal) {\n  var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(p, p0, p2);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(d, p1, p0);\n  var A = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(d, d);\n  var B = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(p, d);\n  var C = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(p, p) - r * r;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n\n  if (A === 0) {\n    return Collision.INVALID;\n  }\n\n  var l = B * B - A * C;\n\n  if (l < 0) {\n    return Collision.INVALID;\n  }\n\n  l = (-B - Math.sqrt(l)) / A;\n\n  if (normal) {\n    //交差点の法線\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(normal, p0, d, l);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(normal, normal, p2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(normal);\n  }\n\n  return l;\n};\n\nvar sphere = new Collision();\n_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.set(sphere.matrix, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0);\nsphere.bold = 0;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/collision.js?");

/***/ }),

/***/ "../lib/lib/collider/cone.js":
/*!***********************************!*\
  !*** ../lib/lib/collider/cone.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Cone; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar m_sqrt5 = -1 / Math.sqrt(5);\n\nvar Cone = /*#__PURE__*/function (_Collision) {\n  _inherits(Cone, _Collision);\n\n  var _super = _createSuper(Cone);\n\n  //円錐\n  function Cone() {\n    var _this;\n\n    _classCallCheck(this, Cone);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CONE;\n    return _this;\n  }\n\n  _createClass(Cone, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotMat33Vec3(ans, this.inv_matrix, v);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(ans);\n\n      if (ans[1] < m_sqrt5) {\n        //頂点\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans, 0, 1, 0);\n      } else {\n        //底面\n        ans[1] = 0;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.nrm(ans, ans);\n        ans[1] = 1;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, ans, -1);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(ans, this.matrix, ans);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      //コーンと直線\n      var min = -99999;\n      var max = 99999;\n      var flg = false;\n      var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(p, this.inv_matrix, p0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(d, this.inv_matrix, p1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(d, d, p);\n      var pn = p[1]; //距離\n\n      if (d[1] === 0) {\n        //レイが水平な場合\n        if (pn * pn > 1) {\n          //高さが+-1より大きい場合は接触しない\n          min = 99999;\n        } else {\n          var r = (1 - p) * 0.5; //レイのある高さの半径\n\n          var A = d[0] * d[0] + d[2] * d[2];\n          var B = p[0] * d[0] + p[2] * d[2];\n          var C = p[0] * p[0] + p[2] * p[2] - r * r;\n\n          if (A === 0) {\n            //レイが0ベクトルの場合\n            if (p[0] * p[0] + p[2] * p[2] > r * r) {\n              //半径より外なら接触していない\n              min = 999999;\n            }\n          } else {\n            var l = B * B - A * C;\n\n            if (l < 0) {\n              //判別式負の場合接触しない\n              min = 999999;\n            } else {\n              min = Math.max(min, (-B - Math.sqrt(l)) / A);\n            }\n          }\n        }\n      } else {\n        //コーンの側面\n        p[2] -= 1;\n        var A = 4 / 5 * (d[0] * d[0] + d[1] * d[1] + d[2] * d[2]) - d[1] * d[1];\n        var B = 4 / 5 * (p[0] * d[0] + p[1] * d[1] + p[2] * d[2]) - p[1] * d[1];\n        var C = 4 / 5 * (p[0] * p[0] + p[1] * p[1] + p[2] * p[2]) - p[1] * p[1];\n        var l = B * B - A * C;\n\n        if (l < 0) {\n          //判別式が負の場合接触しない\n          min = 99999;\n        } else {\n          if (A > 0) {\n            min = (-B - Math.sqrt(l)) / A;\n            max = (-B + Math.sqrt(l)) / A;\n          } else if (A < 0) {\n            if (d[2] > 0) {\n              //max = Math.min(max,(-B-Math.sqrt(l))/A);\n              max = (-B + Math.sqrt(l)) / A;\n            } else {\n              //min= Math.max(min,(-B+Math.sqrt(l))/A);\n              min = (-B - Math.sqrt(l)) / A;\n            }\n          } else {\n            if (B < 0) {\n              min = -C / (2 * B);\n            } else {\n              max = -C / (2 * B);\n            }\n          } //高さ接触範囲 +-1\n\n\n          var invz = 1 / d[1];\n\n          if (invz > 0) {\n            max = Math.min(max, (1 - pn) * invz);\n            var min2 = (-1 - pn) * invz;\n\n            if (min2 > min) {\n              min = min2;\n              flg = true;\n            }\n          } else {\n            max = Math.min(max, (-1 - pn) * invz);\n            min = Math.max(min, (1 - pn) * invz);\n          }\n        }\n      }\n\n      if (min > max) {\n        //範囲逆転の場合接触していない\n        min = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n\n        if (normal) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, 0, 0, 0);\n        }\n      } else {\n        if (normal) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(p, p, d, min);\n\n          if (flg) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, 0, -1, 0);\n          } else {\n            var l = this.matrix[9] * this.matrix[9] + this.matrix[10] * this.matrix[10] + this.matrix[11] * this.matrix[11];\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, p[0], 0.5 / l, p[2]);\n          }\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(normal, this.matrix, normal);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(normal);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n      return min;\n    }\n  }]);\n\n  return Cone;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/cone.js?");

/***/ }),

/***/ "../lib/lib/collider/convexcast.js":
/*!*****************************************!*\
  !*** ../lib/lib/collider/convexcast.js ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../geono.js */ \"../lib/lib/geono.js\");\n\n\nvar DIMENSION = 3;\nvar INVALID = -9999999; //無効値\n\nvar TRIANGLE_LINE = function TRIANGLE_LINE(p1, t0, t1, t2) {\n  //原点からの直線が三角と交差するかどうか\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dt = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var ret = 0;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dt, t1, t0);\n  var vs = [t0, t1, t2, t0, t1];\n\n  for (var j = 0; j < 3; j++) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, p1, dt); //線と辺に垂直なベクトル\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dt, vs[j + 2], vs[j + 1]);\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, vs[j]) * _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dt) > 0) {\n      //辺の外の場合はずれ\n      ret |= 1 << j;\n      break;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n  return ret;\n};\n\nfunction convexCast(_t, o1, o2, ans1, ans2) {\n  //凸包o1をo2に_t方向にぶつける\n  if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(_t) === 0) {\n    min = INVALID;\n    return min;\n  }\n\n  var axis = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var v = [];\n  var v1 = [];\n  var t = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(t, _t, -1);\n\n  for (var i = 0; i < DIMENSION + 1; i++) {\n    v.push(_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc());\n    v1.push(_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc());\n  }\n\n  var vbuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(axis, t);\n  var idx = 1;\n  var counter = 0;\n  var ret = INVALID; //最初の点を求める\n  //cast方向で一番近い点\n\n  o1.calcSupportReverseB(v1[0], axis);\n  o2.calcSupportB(v[0], axis);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v[0], v1[0], v[0]); //次の方向はcast方向と最初の点の垂直方向\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(axis, v[0], t);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(axis, t, axis);\n\n  if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[0]) < 0) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n  }\n\n  var vloop = [v[0], v[1], v[2], v[0], v[1], v[2]];\n  var tar = [0 //貫通(使わない)\n  , 2 // 0-1\n  , 0 // 1-2\n  , 1 // 0-1-2\n  , 1 // 2-0\n  , 0 // 2-0-1\n  , 2 // 1-2-0\n  ];\n  var min;\n\n  while (1) {\n    if (isNaN(axis[0])) {\n      console.log(\"NAN\");\n    } //axisの向きで一番近い点をとる\n\n\n    o1.calcSupportReverseB(v1[idx], axis);\n    o2.calcSupportB(v[idx], axis);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v[idx], v1[idx], v[idx]);\n    min = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[0]);\n\n    for (var i = 1; i < idx; i++) {\n      min = Math.min(min, _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[i]));\n    }\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v[idx], axis) > min - 0.001) {\n      //取得した点が現在の最短と一致する場合は終了\n      break;\n    }\n\n    if (idx === 1) {\n      //線分のときはcast方向と垂直方向を軸に取る\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(vbuf, v[0], v[1]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(axis, vbuf, t);\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v[0], axis) < 0) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n      }\n\n      idx++;\n    } else if (idx === 2) {\n      //三角のとき\n      ret = TRIANGLE_LINE(t, v[0], v[1], v[2]);\n\n      if (ret === 0) {\n        //貫通している場合は手前法線方向に4つめの点を取りに行く\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(axis, v[0], v[1], v[2]);\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t) < 0) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n        }\n\n        if (isNaN(axis[0])) {\n          console.log(\"NAN\");\n        }\n\n        idx++;\n      } else {\n        //貫通していない場合は外側の点をとりにいく\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(vloop[tar[ret]], vloop[2]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(vbuf, v[0], v[1]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(axis, vbuf, t);\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v[0], axis) < 0) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n        }\n      }\n    } else {\n      //四面体の手前3つの面のどれを貫通しているか調べる\n      var next = -1;\n\n      for (var i = 0; i < 3; i++) {\n        if (TRIANGLE_LINE(t, v[i], vloop[i + 1], v[3])) {\n          //貫通していない場合はスルー\n          continue;\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(vbuf, v[i], vloop[i + 1], v[3]);\n        var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(vbuf, v[3]) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(vbuf, t);\n        next = i;\n        min = l;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(axis, v[i], vloop[i + 1], v[3]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(vbuf, v[i], vloop[i + 2]);\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(vbuf, axis) > 0) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n        }\n\n        break;\n      }\n\n      if (next >= 0) {\n        //貫通している三角を底辺として次の頂点を取得しにいく\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(vloop[next + 2], v[3]);\n      } else {\n        //どれも貫通していない場合はありえないが\n        //誤差等で起こりうる。その場合はとりあえず終了\n        break;\n      }\n    } //無限ループ対策\n\n\n    counter++;\n\n    if (counter === 20) {\n      console.log(\"lo!!\");\n    }\n\n    if (counter > 21) {\n      console.log(\"loooop!!\");\n      break;\n    }\n  } //その時点が最短\n\n\n  if (idx > 2) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(axis, v[0], v[1], v[2]);\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t) < 0) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n    }\n\n    if (ans1 && !ans2) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans1, axis);\n    }\n\n    var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t);\n\n    if (l !== 0) {\n      min = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[0]) / l;\n    } else {\n      min = 0;\n    }\n\n    if (ans1 && ans2) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, t, min);\n      var ans = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n      _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].triangleWeight(ans, axis, v[0], v[1], v[2]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans1, 0, 0, 0);\n\n      for (var i = 0; i < 3; i++) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans1, ans1, v1[i], ans[i]);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ans2, ans1, axis);\n    }\n  } else {\n    min = INVALID;\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(11);\n  return min;\n}\n\n;\n/* harmony default export */ __webpack_exports__[\"default\"] = (convexCast);\n\n//# sourceURL=webpack://bc/../lib/lib/collider/convexcast.js?");

/***/ }),

/***/ "../lib/lib/collider/convexhull.js":
/*!*****************************************!*\
  !*** ../lib/lib/collider/convexhull.js ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ConvexHull; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\n/* harmony import */ var _collider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _sphere_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sphere.js */ \"../lib/lib/collider/sphere.js\");\n/* harmony import */ var _convexcast_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./convexcast.js */ \"../lib/lib/collider/convexcast.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\nvar sphere = new _sphere_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]();\n_vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.set(sphere.matrix, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0);\nsphere.bold = 0;\n\nvar ConvexHull = /*#__PURE__*/function (_Collision) {\n  _inherits(ConvexHull, _Collision);\n\n  var _super = _createSuper(ConvexHull);\n\n  //凸包\n  function ConvexHull() {\n    var _this;\n\n    _classCallCheck(this, ConvexHull);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].CONVEX_HULL; //this.mesh=null; //メッシュ情報\n\n    _this.poses = []; //頂点座標\n\n    return _this;\n  }\n\n  _createClass(ConvexHull, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      var n = 0;\n      var poses = this.poses;\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v, poses[n]);\n\n      for (var i = 1; i < poses.length; i++) {\n        var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v, poses[i]);\n\n        if (l2 > l) {\n          l = l2;\n          n = i;\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, poses[n]);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      sphere.matrix[9] = p0[0];\n      sphere.matrix[10] = p0[1];\n      sphere.matrix[11] = p0[2];\n      sphere.refresh();\n      var ang = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ang, p1, p0);\n      var l = (0,_convexcast_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(ang, sphere, this, normal);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      return l;\n    }\n  }]);\n\n  return ConvexHull;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/collider/convexhull.js?");

/***/ }),

/***/ "../lib/lib/collider/cuboid.js":
/*!*************************************!*\
  !*** ../lib/lib/collider/cuboid.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Cuboid; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar Cuboid = /*#__PURE__*/function (_Collision) {\n  _inherits(Cuboid, _Collision);\n\n  var _super = _createSuper(Cuboid);\n\n  //直方体\n  function Cuboid() {\n    var _this;\n\n    _classCallCheck(this, Cuboid);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CUBOID;\n    _this.bold = 0;\n    return _this;\n  }\n\n  _createClass(Cuboid, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      var m = this.matrix;\n\n      if (m[0] * v[0] + m[1] * v[1] + m[2] * v[2] < 0) {\n        ans[0] = -1;\n      } else {\n        ans[0] = 1;\n      }\n\n      if (m[3] * v[0] + m[4] * v[1] + m[5] * v[2] < 0) {\n        ans[1] = -1;\n      } else {\n        ans[1] = 1;\n      }\n\n      if (m[6] * v[0] + m[7] * v[1] + m[8] * v[2] < 0) {\n        ans[2] = -1;\n      } else {\n        ans[2] = 1;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(ans, m, ans);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      if (this.bold !== 0) {\n        return _get(_getPrototypeOf(Cuboid.prototype), \"rayCast\", this).call(this, p0, p1, normal);\n      }\n\n      var min = -99999;\n      var max = 99999;\n      var aaa;\n      var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(p, this.inv_matrix, p0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(d, this.inv_matrix, p1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(d, d, p);\n\n      for (var i = 0; i < DIMENSION; i++) {\n        var n = d[i]; //傾き\n\n        var pn = p[i]; //距離\n\n        if (n === 0) {\n          if (pn * pn > 1) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n            return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n          }\n\n          continue;\n        }\n\n        n = 1 / n;\n        max = Math.min(max, (Math.sign(n) - pn) * n);\n        var l = (-Math.sign(n) - pn) * n;\n\n        if (min < l) {\n          min = l;\n          aaa = i;\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n\n      if (min < max) {\n        if (normal) {\n          normal[0] = this.matrix[aaa * 3];\n          normal[1] = this.matrix[aaa * 3 + 1];\n          normal[2] = this.matrix[aaa * 3 + 2];\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(normal, normal, -Math.sign(d[aaa]));\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(normal);\n        }\n\n        return min;\n      } else {\n        return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n      }\n    }\n  }]);\n\n  return Cuboid;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/cuboid.js?");

/***/ }),

/***/ "../lib/lib/collider/cylinder.js":
/*!***************************************!*\
  !*** ../lib/lib/collider/cylinder.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Cylinder; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar Cylinder = /*#__PURE__*/function (_Collision) {\n  _inherits(Cylinder, _Collision);\n\n  var _super = _createSuper(Cylinder);\n\n  //シリンダ\n  function Cylinder() {\n    var _this;\n\n    _classCallCheck(this, Cylinder);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].CYLINDER;\n    return _this;\n  }\n\n  _createClass(Cylinder, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      var m = this.matrix;\n      var l = v[0] * m[3] + v[1] * m[4] + v[2] * m[5];\n\n      if (l < 0) {\n        ans[1] = -1;\n      } else {\n        ans[1] = 1;\n      }\n\n      var x = v[0] * m[0] + v[1] * m[1] + v[2] * m[2];\n      var z = v[0] * m[6] + v[1] * m[7] + v[2] * m[8];\n      l = Math.sqrt(x * x + z * z);\n\n      if (l !== 0) {\n        l = 1 / l;\n      }\n\n      ans[0] = x * l;\n      ans[2] = z * l;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(ans, m, ans);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      //シリンダと直線\n      var min = -99999;\n      var max = 99999;\n      var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(p, this.inv_matrix, p0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(d, this.inv_matrix, p1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(d, d, p); //円柱縦の向き\n\n      var n = d[1]; //傾き\n\n      var pn = p[1]; //距離\n\n      if (n === 0) {\n        if (pn * pn > 1) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n          return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n        }\n      }\n\n      n = 1 / n;\n\n      if (n > 0) {\n        max = Math.min(max, (1 - pn) * n);\n        min = Math.max(min, (-1 - pn) * n);\n      } else {\n        max = Math.min(max, (-1 - pn) * n);\n        min = Math.max(min, (1 - pn) * n);\n      } //円柱の水平方向\n\n\n      var A = d[0] * d[0] + d[2] * d[2];\n      var B = p[0] * d[0] + p[2] * d[2];\n      var C = p[0] * p[0] + p[2] * p[2] - 1 * 1;\n      var flg = false;\n\n      if (A === 0) {\n        if (p[0] * p[0] + p[2] * p[2] > 1) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n          return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n        }\n      } else {\n        var l = B * B - A * C;\n\n        if (l < 0) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n          return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n        }\n\n        var a = (-B - Math.sqrt(l)) / A;\n\n        if (min < a) {\n          min = a;\n          flg = true;\n        }\n\n        max = Math.min(max, (-B + Math.sqrt(l)) / A);\n      }\n\n      if (min > max) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n        return _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n      }\n\n      if (normal) {\n        if (flg) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(p, p, d, min);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, p[0], 0, p[2]);\n        } else {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(normal, 0, p[1], 0);\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(normal, this.matrix, normal);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(normal);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n      return min;\n    }\n  }]);\n\n  return Cylinder;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/cylinder.js?");

/***/ }),

/***/ "../lib/lib/collider/gjk.js":
/*!**********************************!*\
  !*** ../lib/lib/collider/gjk.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../geono.js */ \"../lib/lib/geono.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n //GJKとEPA\n\nvar closestFace = /*#__PURE__*/_createClass(function closestFace() {\n  _classCallCheck(this, closestFace);\n\n  this.v = new Int32Array(3);\n  this.cross = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  this.len = 0;\n});\n\nvar vertices = [];\nvar vertices1 = [];\nvar faces = [];\nvar edges = [];\nvar edgesIndex;\nvar faceIndex;\nvar idx;\n\nfor (var i = 0; i < 256; i++) {\n  vertices.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n  vertices1.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n  faces.push(new closestFace());\n  var edge = new Int32Array(2); //[-1,-1];\n\n  edges.push(edge);\n}\n\nvar line_zero_vec3 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n\nvar line_zero = function line_zero(ans, l1, l2) {\n  //線分と原点との最近点を求める\n  var ret;\n  var dir = line_zero_vec3;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, l2, l1); //線分の向き\n\n  var r = -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, l1);\n\n  if (r <= 0) {\n    //始点未満\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l1);\n    ret = -1;\n  } else {\n    var r2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(dir);\n\n    if (r > r2) {\n      //終点超え\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l2);\n      ret = 1;\n    } else {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, l1, dir, r / r2);\n      ret = 0;\n    }\n  }\n\n  return ret;\n};\n\nvar triangleCheck = function triangleCheck(t1, t2, t3) {\n  //三角形上に原点があるか\n  //ある/0   ない/2,4,6\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(cross, t1, t2, t3);\n  var ts = [t1, t2, t3, t1];\n  var ret = 0;\n\n  for (var i = 0; i < 3; i++) {\n    var v1 = ts[i];\n    var v2 = ts[i + 1];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(cross2, v2, v1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross2, cross, cross2);\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross2, v1) > 0) {\n      ret = i + 1 << 1;\n      break;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n  return ret;\n};\n\nvar triangle_zero = function triangle_zero(ans, t1, t2, t3) {\n  //三角と原点の最近点を求める\n  var dir = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(cross, t1, t2, t3);\n  var ts = [t1, t2, t3, t1, t2];\n  var res = triangleCheck(t1, t2, t3);\n\n  if (res === 0) {\n    //面の上にいる場合\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, cross, _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, t1) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(cross));\n  } else {\n    //辺の外側にいる場合\n    var r = (res >> 1) - 1;\n    var v1 = ts[r];\n    var v2 = ts[r + 1];\n    var v3 = ts[r + 2];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, v2, v1); //線分の向き\n\n    var l = -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v1, dir);\n\n    var _l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, dir);\n\n    if (l < 0) {\n      //辺の始点より外の場合\n      res += line_zero(ans, v1, v3);\n    } else if (l > _l) {\n      //辺の終点より外の場合\n      res += line_zero(ans, v3, v2);\n    } else {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, v1, dir, l / _l);\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n  return res;\n};\n\nvar addFace = function addFace(v1, v2, v3) {\n  //EPAで使う\n  var vs = vertices;\n  var face;\n  var i;\n\n  for (i = 0; i < faceIndex; i++) {\n    if (faces[i].len < 0) {\n      break;\n    }\n  }\n\n  if (i === faceIndex) {\n    faceIndex++;\n  }\n\n  face = faces[i]; //現状4つの距離を計算\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(face.v, v1, v2, v3);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(face.cross, vs[v1], vs[v2], vs[v3]);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.norm(face.cross);\n  face.len = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(face.cross, vs[v1]);\n\n  if (face.len < 0) {\n    face.len *= -1;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(face.cross, face.cross, -1);\n  }\n\n  return face;\n};\n\nfor (var i = 0; i < 128; i++) {\n  var edge = [-1, -1];\n  edges.push(edge);\n}\n\nvar addEdge = function addEdge(v1, v2) {\n  for (var j = 0; j < edgesIndex; j++) {\n    if (edges[j][0] === v1 && edges[j][1] === v2 || edges[j][0] === v2 && edges[j][1] === v1) {\n      //既に同一エッジがある場合は追加せず既存のも無効化\n      edges[j][0] = -1;\n      return;\n    }\n  } //無効インデックスを探す\n\n\n  for (var j = 0; j < edgesIndex; j++) {\n    if (edges[j][0] < 0) {\n      break;\n    }\n  }\n\n  if (j >= edgesIndex) {\n    //エッジ増えたらインデックスを増やす\n    edgesIndex++;\n  }\n\n  var edge = edges[j];\n  edge[0] = v1;\n  edge[1] = v2;\n};\n\nvar calcClosestPrimitive = function calcClosestPrimitive(ans1, ans2, obj1, obj2) {\n  var s = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var s1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var vbuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var axis = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var v = vertices; //ミンコフスキー差の座標\n\n  var v1 = vertices1; //obj2の座標 (v-v1でobj1の座標)\n\n  var distance = -1;\n  var next_change_idx = -1; //次に入れかえる頂点のインデックス\n  //中心\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(axis, obj1.aabb.min, obj1.aabb.max);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(axis, axis, obj2.aabb.min);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(axis, axis, obj2.aabb.max);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -0.5); //1個目の頂点を取る\n\n  obj1.calcSupport(v1[0], axis);\n  obj2.calcSupportReverse(v[0], axis);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v[0], v1[0], v[0]);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(axis, v[0]);\n  idx = 1;\n  next_change_idx = 1;\n  var counter = 0;\n  var hitflg = false;\n\n  while (1) {\n    //axisの向きで一番近い点をとる\n    obj1.calcSupportReverse(s1, axis);\n    obj2.calcSupport(s, axis);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(s, s1, s); //現状の最短を求める\n\n    var min = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v[0], axis);\n\n    for (var i = 1; i < idx; i++) {\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v[i], axis);\n\n      if (l < min) {\n        min = l;\n      }\n    }\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(s, axis) >= min - 0.0000001) {\n      //取得した点が最短と同じなら外判定\n      break;\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v[next_change_idx], s);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v1[next_change_idx], s1);\n\n    if (idx < 4) {\n      idx++;\n    } //現在の取得点から目標点までの最短点を求める\n\n\n    if (idx === 2) {\n      line_zero(axis, v[0], v[1]);\n      min = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(axis);\n\n      if (min === 0) {\n        //接触している場合は適当に垂直な方向をとる\n        axis[0] = -(v[0][1] - v[1][1]);\n        axis[1] = v[0][2] - v[1][2];\n        axis[2] = v[0][0] - v[1][0];\n      }\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[0]) < 0) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n      }\n\n      next_change_idx = 2;\n    } else if (idx === 3) {\n      //\t\tVec3.cross(axis,v[0],v[1],v[2]);\n      triangle_zero(axis, v[0], v[1], v[2]);\n      min = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(axis);\n\n      if (min === 0) {\n        //接触している場合は適当に垂直な方向をとる\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(axis, v[0], v[1], v[2]);\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, v[0]) < 0) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, axis, -1);\n        }\n      }\n\n      next_change_idx = 3;\n    } else {\n      next_change_idx = 0;\n      var min = -1;\n\n      for (var i = 0; i < 4; i++) {\n        //四面体それぞれの面に対して計算\n        var t4 = v[i];\n        var t1 = v[i + 1 & 3];\n        var t2 = v[i + 2 & 3];\n        var t3 = v[i + 3 & 3];\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(vbuf, t1, t2, t3); //面の法線\n\n        var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t1, vbuf); //原点から面までの距離\n\n        var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t4, vbuf) - l1; //面からもうひとつの頂点までの距離\n        //if(l1*l2===0){\n        //\tnext_change_idx=i;\n        //\tVec3.copy(axis,vbuf);\n        //\tif(l1<0){\n        //\t\tVec3.mul(axis,axis,-1);\n        //\t}\n        //\tbreak;\n        //}\n\n        if (l1 * l2 > 0) {\n          //四面体に内包されない\n          var l = triangle_zero(vbuf, t1, t2, t3);\n          var m = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar2(vbuf);\n\n          if (min < 0 || m < min) {\n            min = m;\n            next_change_idx = i;\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(axis, vbuf);\n          }\n        }\n      }\n\n      if (min < 0) {\n        //内包する場合終了\n        hitflg = true;\n        break;\n      } //next_change_idx =farIndex ;\n\n    } //無限ループ対策\n\n\n    counter++;\n\n    if (counter === 32) {\n      console.log(\"gjk!!\");\n    }\n\n    if (counter > 33) {\n      console.log(\"loooop!!\");\n      break;\n    }\n  }\n\n  if (!hitflg) {\n    //内包してない場合の処理\n    distance = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(axis);\n\n    if (ans1 && ans2) {\n      var ans = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //両オブジェクトの最近点算出\n\n      if (idx === 1) {\n        //頂点が1個の場合はそれぞれの頂点が最近点\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans1, v1[0]);\n      } else if (idx === 2) {\n        _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].lineWeight(ans, axis, v[0], v[1]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans1, 0, 0, 0);\n\n        for (var i = 0; i < 3; i++) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans1, ans1, v1[i], ans[i]);\n        }\n      } else {\n        if (idx === 4) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v[next_change_idx], v[3]);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v1[next_change_idx], v1[3]);\n        }\n\n        _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].triangleWeight(ans, axis, v[0], v[1], v[2]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans1, 0, 0, 0);\n\n        for (var i = 0; i < 3; i++) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans1, ans1, v1[i], ans[i]);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ans2, ans1, axis);\n    }\n  } else if (ans1 || ans2) {\n    if (idx < 3) {\n      console.log(\"AAA\");\n    } //内包する場合\n    //EPA\n\n\n    faceIndex = 0;\n    idx = 4;\n    counter = 0;\n\n    for (var i = 0; i < 4; i++) {\n      //現状4つの面を追加\n      addFace(i, i + 1 & 3, i + 2 & 3);\n    }\n\n    var face;\n    var min;\n\n    while (1) {\n      //最短面探索\n      for (var i = 0; i < faceIndex; i++) {\n        if (faces[i].len >= 0) {\n          face = faces[i];\n          min = face.len;\n          break;\n        }\n      }\n\n      for (; i < faceIndex; i++) {\n        if (faces[i].len < min && faces[i].len >= 0) {\n          face = faces[i];\n          min = face.len;\n        }\n      } //サポ射\n\n\n      obj1.calcSupport(s1, face.cross);\n      obj2.calcSupportReverse(s, face.cross);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(s, s1, s); //新たに取得した頂点距離が最短面との距離と同じだった場合は終了\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(s, face.cross) < face.len + 0.0000001) {\n        break;\n      } //終了しなかった場合はその点を追加\n\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v[idx], s);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(v1[idx], s1);\n      edgesIndex = 0;\n\n      for (var i = 0; i < faceIndex; i++) {\n        //追加した頂点に関係する面を探す\n        var face = faces[i];\n\n        if (face.len < 0) {\n          //無効面はスルー\n          continue;\n        } //Vec3.sub(vbuf,s,v[face.v[0]]);\n\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(s, face.cross) - face.len > 0.0000001) {\n          //面のエッジを追加\n          addEdge(face.v[0], face.v[1]);\n          addEdge(face.v[1], face.v[2]);\n          addEdge(face.v[2], face.v[0]); //face削除\n\n          face.len2 = face.len;\n          face.len = -1;\n        }\n      }\n\n      var edgeflg = true;\n\n      for (var i = 0; i < edgesIndex; i++) {\n        if (edges[i][0] < 0) {\n          continue;\n        } //新たなfaceを追加、\n\n\n        addFace(edges[i][0], edges[i][1], idx);\n        edgeflg = false;\n      }\n\n      if (edgeflg) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n        return 0;\n      }\n\n      idx++; //無限ループ対策\n\n      counter++;\n\n      if (counter === 32) {\n        console.log(\"epa!!\");\n      }\n\n      if (counter > 33) {\n        console.log(\"loooop!!\");\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n        return 0;\n      }\n    } //両三角のめり込み点を求める\n\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(axis, face.cross, face.len);\n    var ans = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].triangleWeight(ans, axis, v[face.v[0]], v[face.v[1]], v[face.v[2]]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans1, 0, 0, 0);\n\n    for (var i = 0; i < 3; i++) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans1, ans1, v1[face.v[i]], ans[i]);\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ans2, ans1, axis);\n    distance = -face.len;\n  } else {\n    console.log(\"ARIENAI\");\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n  return distance;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (calcClosestPrimitive);\n\n//# sourceURL=webpack://bc/../lib/lib/collider/gjk.js?");

/***/ }),

/***/ "../lib/lib/collider/mesh.js":
/*!***********************************!*\
  !*** ../lib/lib/collider/mesh.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Mesh; }\n/* harmony export */ });\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _aabbtree_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabbtree.js */ \"../lib/lib/aabbtree.js\");\n/* harmony import */ var _collider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _convexhull_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./convexhull.js */ \"../lib/lib/collider/convexhull.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\n\nvar Mesh = /*#__PURE__*/function (_ConvexHull) {\n  _inherits(Mesh, _ConvexHull);\n\n  var _super = _createSuper(Mesh);\n\n  //メッシュ\n  function Mesh() {\n    var _this;\n\n    _classCallCheck(this, Mesh);\n\n    //メッシュ\n    _this = _super.call(this);\n    _this.type = _collider_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].MESH;\n    _this.triangles = []; //三角ポリゴンセット\n\n    _this.aabbTreeRoot = null;\n    return _this;\n  }\n\n  _createClass(Mesh, [{\n    key: \"refresh\",\n    value: function refresh() {\n      this.calcAABB(); //三角AABB\n\n      var triangles = this.triangles;\n      var nodes = [];\n\n      for (var i = 0; i < triangles.length; i++) {\n        var node = new _aabbtree_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].Node();\n        node.element = triangles[i];\n        nodes.push(node);\n        triangles[i].calcAABB(node.aabb);\n        _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3.copy(triangles[i].aabb.min, node.aabb.min);\n        _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3.copy(triangles[i].aabb.max, node.aabb.max);\n      }\n\n      this.aabbTreeRoot = _aabbtree_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createAABBTree(nodes);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      var min = _collider_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].INVALID;\n      var norm = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3(); //\n      //\t\t\tthis.aabbTreeRoot.find((node)=>{\n      //\t\t\t\tvar res = AABB.hitCheckLine(node.aabb,p0,p1);\n      //\t\t\t\tif(res >=0 && node.element){\n      //\t\t\t\t\tvar l=node.element.rayCast(p0,p1,norm);\n      //\t\t\t\t\tif((l<min || min<0)&& l>0){\n      //\t\t\t\t\t\tmin=l;\n      //\t\t\t\t\t\tif(normal){\n      //\t\t\t\t\t\t\tVec3.copy(normal,norm);\n      //\t\t\t\t\t\t}\n      //\n      //\t\t\t\t\t}\n      //\t\t\t\t\t\n      //\t\t\t\t}\n      //\t\t\t\treturn res;\n      //\t\t\t});\n\n      var triangles = this.triangles;\n\n      for (var i = 0; i < triangles.length; i++) {\n        if (!_aabb_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hitCheckLine(triangles[i].aabb, p0, p1)) {\n          continue;\n        }\n\n        var l = triangles[i].rayCast(p0, p1, norm);\n\n        if ((l < min || min < 0) && l > 0) {\n          min = l;\n\n          if (normal) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3.copy(normal, norm);\n          }\n        }\n      }\n\n      return min;\n    }\n  }]);\n\n  return Mesh;\n}(_convexhull_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/mesh.js?");

/***/ }),

/***/ "../lib/lib/collider/sphere.js":
/*!*************************************!*\
  !*** ../lib/lib/collider/sphere.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Sphere; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _collision_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./collision.js */ \"../lib/lib/collider/collision.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\nvar DIMENSION = 3; //次元数\n\nvar Sphere = /*#__PURE__*/function (_Collision) {\n  _inherits(Sphere, _Collision);\n\n  var _super = _createSuper(Sphere);\n\n  //球\n  function Sphere() {\n    var _this;\n\n    _classCallCheck(this, Sphere);\n\n    _this = _super.call(this);\n    _this.type = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SPHERE;\n    return _this;\n  }\n\n  _createClass(Sphere, [{\n    key: \"calcSupport\",\n    value: function calcSupport(ans, v) {\n      ans[0] = this.matrix[9];\n      ans[1] = this.matrix[10];\n      ans[2] = this.matrix[11];\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      //衝突判定前処理\n      this.calcAABB();\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(p0, p1, normal) {\n      var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(p, this.matrix[9], this.matrix[10], this.matrix[11]);\n      var l = _collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].SPHERE_LINE(p0, p1, p, this.bold, normal);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      return l;\n    }\n  }]);\n\n  return Sphere;\n}(_collision_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/collider/sphere.js?");

/***/ }),

/***/ "../lib/lib/collider/triangle.js":
/*!***************************************!*\
  !*** ../lib/lib/collider/triangle.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Triangle; }\n/* harmony export */ });\n/* harmony import */ var _convexhull_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./convexhull.js */ \"../lib/lib/collider/convexhull.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\nvar Triangle = /*#__PURE__*/function (_ConvexHull) {\n  _inherits(Triangle, _ConvexHull);\n\n  var _super = _createSuper(Triangle);\n\n  function Triangle() {\n    var _this;\n\n    _classCallCheck(this, Triangle);\n\n    _this = _super.call(this);\n\n    _this.poses.push(new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3());\n\n    _this.poses.push(new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3());\n\n    _this.poses.push(new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3());\n\n    return _this;\n  }\n\n  return _createClass(Triangle);\n}(_convexhull_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]);\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/collider/triangle.js?");

/***/ }),

/***/ "../lib/lib/colorpicker.js":
/*!*********************************!*\
  !*** ../lib/lib/colorpicker.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Colorpicker; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _colorselector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./colorselector.js */ \"../lib/lib/colorselector.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\n\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\n\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\"); _classApplyDescriptorSet(receiver, descriptor, value); return value; }\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) { if (descriptor.set) { descriptor.set.call(receiver, value); } else { if (!descriptor.writable) { throw new TypeError(\"attempted to set read only private field\"); } descriptor.value = value; } }\n\n\n\n //カラーピッカー\n\nvar _safe = /*#__PURE__*/new WeakMap();\n\nvar _bindfunc = /*#__PURE__*/new WeakMap();\n\nvar _feedback = /*#__PURE__*/new WeakMap();\n\nvar Colorpicker = /*#__PURE__*/function () {\n  function Colorpicker() {\n    _classCallCheck(this, Colorpicker);\n\n    _classPrivateFieldInitSpec(this, _safe, {\n      writable: true,\n      value: 0\n    });\n\n    _classPrivateFieldInitSpec(this, _bindfunc, {\n      writable: true,\n      value: \"\\nvar value = this.watches[0].getValue();\\nvar hex;\\nhex = Util.rgb2hex(value);\\n\\nreturn hex;\\n\\t\"\n    });\n\n    _classPrivateFieldInitSpec(this, _feedback, {\n      writable: true,\n      value: \"\\nvar cols=new Array(3);\\n\\nUtil.hex2rgb(cols,event.currentTarget.value);\\nvar value = this.watches[0].getValue();\\nvalue[0] = Number(cols[0]);\\nvalue[1] = Number(cols[1]);\\nvalue[2] = Number(cols[2]);\\n\\t\"\n    });\n\n    this.colorselector = new _colorselector_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](false);\n    var parentInput = null; //カラーピッカーが表示されている親コントロール\n  }\n\n  _createClass(Colorpicker, [{\n    key: \"init\",\n    value: function init(nodes) {\n      var _this = this;\n\n      //カラーピッカー要素作成\n      var container = document.createElement(\"div\");\n      container.classList.add(\"colorpickerhdr_form\");\n      container.appendChild(this.colorselector.div);\n      document.body.appendChild(container);\n      this.container = container;\n\n      this.colorselector.changeCallback = function () {\n        _this.changeCallback(_this.parentInput);\n      }; //カラーピッカー表示非表示イベント\n\n\n      container.addEventListener(\"pointerdown\", function (evt) {\n        _classPrivateFieldSet(_this, _safe, 1);\n      });\n      window.addEventListener(\"pointerdown\", function (evt) {\n        if (!_classPrivateFieldGet(_this, _safe)) {\n          container.style.display = \"none\";\n        }\n\n        _classPrivateFieldSet(_this, _safe, 0);\n      }); //ページ読み込み時に className=\"colorpicker\"のinputタグを対象に\n      //カラーピッカーコントロール対応させる\n\n      Array.prototype.forEach.call(nodes, function (e) {\n        var node = e;\n\n        if (node.value === \"\") {\n          node.value = \"ffffff\";\n        }\n\n        node.addEventListener(\"click\", function (evt) {\n          _this.showSelector(evt.currentTarget);\n        });\n        node.addEventListener(\"input\", function (evt) {\n          //内容変更時、背景色とカーソルをリフレッシュする\n          _this.updateStyle(evt.currentTarget);\n        });\n\n        _this.updateStyle(e);\n\n        for (var i = 0; i < node.attributes.length; i++) {\n          var attribute_name = node.attributes[i].name;\n          if (attribute_name.indexOf(\"bind:\") !== 0) continue;\n          node.setAttribute(\"bindfunc\", _classPrivateFieldGet(_this, _bindfunc));\n\n          if (node.hasAttribute(\"feedback\")) {\n            node.setAttribute(\"feedback\", _classPrivateFieldGet(_this, _feedback));\n          }\n\n          break;\n        }\n      });\n    }\n  }, {\n    key: \"updateStyle\",\n    value: function updateStyle(node) {\n      //テキストの内容を背景色にセット\n      var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n      _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].hex2rgb(rgb, node.value);\n      var rgba = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgba(rgb[0] * 255, rgb[1] * 255, rgb[2] * 255, 1);\n      node.style.backgroundImage = \"linear-gradient( 0,\" + rgba + \",\" + rgba + \"),url(css/back.png)\"; //テキスト色を背景色に合わせて変える\n\n      node.style.color = 0.3 * rgb[0] + 0.6 * rgb[1] + 0.1 * rgb[2] < 0.5 ? \"white\" : \"black\";\n    }\n  }, {\n    key: \"changeCallback\",\n    value: function changeCallback(node) {\n      //カラーピッカーで色が選択されたときに元コントロールに反映する処理\n      if (!node) {\n        return;\n      }\n\n      var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n      rgb[0] = this.colorselector.R_txt.value;\n      rgb[1] = this.colorselector.G_txt.value;\n      rgb[2] = this.colorselector.B_txt.value;\n      node.value = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgb2hex(rgb);\n      _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].fireEvent(node, \"change\");\n      this.updateStyle(node);\n    }\n  }, {\n    key: \"showSelector\",\n    value: function showSelector(node) {\n      //インプットボックスがクリックされたときカラーピッカーを表示する\n      this.parentInput = node;\n      var container = this.container; //クリック時、カラーピッカーを表示\n      //parentInput=this;\n\n      container.style.display = \"block\";\n      var rect = node.getBoundingClientRect();\n      container.style.left = rect.left + window.pageXOffset + \"px\";\n      container.style.top = rect.top + rect.height + window.pageYOffset + \"px\"; //カラーピッカーに現在値をセット\n\n      var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n      _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].hex2rgb(rgb, node.value);\n      rgb[3] = 1;\n      this.colorselector.setColor(rgb);\n    }\n  }]);\n\n  return Colorpicker;\n}();\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/colorpicker.js?");

/***/ }),

/***/ "../lib/lib/colorpickerhdr.js":
/*!************************************!*\
  !*** ../lib/lib/colorpickerhdr.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorpickerHDR; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _colorselector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./colorselector.js */ \"../lib/lib/colorselector.js\");\n/* harmony import */ var _colorpicker_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./colorpicker.js */ \"../lib/lib/colorpicker.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\nvar ColorpickerHDR = /*#__PURE__*/function (_Colorpicker) {\n  _inherits(ColorpickerHDR, _Colorpicker);\n\n  var _super = _createSuper(ColorpickerHDR);\n\n  //カラーピッカーHDR\n  function ColorpickerHDR() {\n    var _this;\n\n    _classCallCheck(this, ColorpickerHDR);\n\n    _this = _super.call(this);\n    _this.colorselector = new _colorselector_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](true);\n    return _this;\n  }\n\n  _createClass(ColorpickerHDR, [{\n    key: \"updateStyle\",\n    value: function updateStyle(node) {\n      //テキストの内容を背景色にセット\n      var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n      var sp = node.value.split(\",\");\n      rgb[0] = Number(sp[0]);\n      rgb[1] = Number(sp[1]);\n      rgb[2] = Number(sp[2]);\n      rgb[3] = Number(sp[3]);\n      var rgba = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgba(rgb[0] * 255, rgb[1] * 255, rgb[2] * 255, rgb[3]);\n      node.style.backgroundImage = \"linear-gradient( 0,\" + rgba + \",\" + rgba + \"),url(css/back.png)\";\n      node.style.color = 0.3 * rgb[0] + 0.6 * rgb[1] + 0.1 * rgb[2] < 0.5 ? \"white\" : \"black\";\n    }\n  }, {\n    key: \"changeCallback\",\n    value: function changeCallback(node) {\n      if (!node) {\n        return;\n      }\n\n      node.value = this.colorselector.R_txt.value + \", \" + this.colorselector.G_txt.value + \", \" + this.colorselector.B_txt.value + \", \" + this.colorselector.A_txt.value;\n      _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].fireEvent(node, \"change\");\n      this.updateStyle(node);\n    }\n  }]);\n\n  return ColorpickerHDR;\n}(_colorpicker_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/colorpickerhdr.js?");

/***/ }),

/***/ "../lib/lib/colorselector.js":
/*!***********************************!*\
  !*** ../lib/lib/colorselector.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorSelector; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _slider_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./slider.js */ \"../lib/lib/slider.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./img.js */ \"../lib/lib/img.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n //カラーセレクタHDR\n\nvar img = new _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](128, 128, _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].FORMAT_UINT8);\nvar col = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\nvar col_org = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //色相画像作成\n\nvar img_h = {};\nvar data = img.data;\nvar idx = 0;\n\nfor (var yi = 0; yi < 128; yi++) {\n  col[0] = yi / 128;\n  col[1] = 1;\n  col[2] = 1;\n  _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, col);\n  col[0] = col[0] * 255 | 0;\n  col[1] = col[1] * 255 | 0;\n  col[2] = col[2] * 255 | 0;\n  idx = img.getIndex(0, yi) << 2;\n  data[idx] = col[0];\n  data[idx + 1] = col[1];\n  data[idx + 2] = col[2];\n  data[idx + 3] = 255;\n}\n\nvar h_img_dataurl = null;\nimg.toBlob(function (blob) {\n  //\tURL.revokeObjectURL(h_img_dataurl);\n  h_img_dataurl = URL.createObjectURL(blob);\n  var nodes = document.querySelectorAll(\".cphdr_h_img\");\n\n  for (var i = 0; i < nodes.length; i++) {\n    nodes[i].src = h_img_dataurl;\n  }\n}, \"image/png\", 1.0, 0, 0, 1, 128);\n\nvar ColorSelector = /*#__PURE__*/function () {\n  function ColorSelector(flg) {\n    var _this = this;\n\n    _classCallCheck(this, ColorSelector);\n\n    _defineProperty(this, \"down\", function (e) {\n      if (!(e.buttons & 1)) {\n        _this.drag_from = 0;\n      }\n\n      var hsv = _this.hsv;\n      var rgb = _this.rgb;\n\n      switch (_this.drag_from) {\n        case 1:\n          var rect = _this.sv_img.getBoundingClientRect();\n\n          hsv[2] = e.clientX - rect.left;\n          hsv[1] = e.clientY - rect.top;\n          hsv[2] /= img.width;\n          hsv[1] /= img.height;\n          hsv[1] = 1 - hsv[1];\n          hsv[1] = Math.min(Math.max(hsv[1], 0), 1);\n          hsv[2] = Math.min(Math.max(hsv[2], 0), 1);\n          break;\n\n        case 2:\n          var rect = _this.h_img.getBoundingClientRect();\n\n          hsv[0] = e.clientY - rect.top;\n          hsv[0] = hsv[0] / _this.h_img.height;\n          hsv[0] = Math.min(Math.max(hsv[0], 0), 1);\n\n          _this.redrawSv();\n\n          break;\n\n        default:\n          return;\n      }\n\n      _this.setCursor(hsv);\n\n      var vi = Math.pow(2, Number(_this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(rgb, hsv);\n      _this.R_txt.value = (rgb[0] * vi).toFixed(3);\n      _this.G_txt.value = (rgb[1] * vi).toFixed(3);\n      _this.B_txt.value = (rgb[2] * vi).toFixed(3);\n\n      if (_this.changeCallback) {\n        _this.changeCallback();\n      }\n    });\n\n    this.dispflg = flg;\n    this.div = null;\n    this.sv_img = null;\n    this.h_img = null;\n    this.h_cursor = null;\n    this.s_cursor = null;\n    this.v_cursor = null;\n    this.R_txt = null;\n    this.G_txt = null;\n    this.B_txt = null;\n    this.A_txt = null;\n    this.Vi_txt = null;\n    this.changeCallback = null;\n    this.drag_from = 0;\n    this.rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.hsv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.parentInput = null; //カラーピッカーが表示されている親コントロール\n\n    this.hsv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var html = \"\\n\\t\\t\\t\\t<div class=\\\"div_main\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"sv_parent\\\">\\n\\t\\t\\t\\t\\t\\t<img class=\\\"cphdr_sv_img\\\" draggable=\\\"false\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"cphdr_s_cursor cursor\\\"></div>\\n\\t\\t\\t\\t\\t\\t<div class=\\\"cphdr_v_cursor cursor\\\"></div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t<div class=\\\"sv_parent\\\">\\n\\t\\t\\t\\t\\t\\t<img class=\\\"cphdr_h_img\\\" draggable=\\\"false\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"cphdr_h_cursor cursor\\\" ></div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div id=\\\"txtarea\\\">\\n\\t\\t\\t\\t<div class=\\\"color_status\\\">\\n\\t\\t\\t\\t\\t<ul>\\n\\t\\t\\t\\t\\t<li class=\\\"red\\\">R<input type=\\\"text\\\" class=\\\"cphdr_R_txt\\\" value=\\\"0.8\\\" /></li>\\n\\t\\t\\t\\t\\t<li class=\\\"green\\\">G<input type=\\\"text\\\" class=\\\"cphdr_G_txt\\\" value=\\\"0.2\\\"/></li>\\n\\t\\t\\t\\t\\t<li class=\\\"blue\\\">B<input type=\\\"text\\\" class=\\\"cphdr_B_txt\\\" value=\\\"0.2\\\"/></li>\\n\\t\\t\\t\\t\\t</ul>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div>\\n\\t\\t\\t\\t\\t\\u660E\\u308B\\u3055<input class=\\\"slider cphdr_Vi_txt\\\" min=\\\"-10\\\" max=\\\"10\\\" value=\\\"0\\\" step=\\\"0.01\\\"/>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\tA<input class=\\\"slider cphdr_A_txt\\\" max=\\\"1\\\" value=\\\"1\\\" step=\\\"0.001\\\"/>\\n\\t\\t\\t\\t</div>\\n\\t\\t\";\n    this.div = document.createElement(\"div\");\n    this.div.classList.add(\"colorselector\");\n    this.div.insertAdjacentHTML('beforeend', html);\n    this.sv_img = this.div.querySelector(\".cphdr_sv_img\");\n    this.h_img = this.div.querySelector(\".cphdr_h_img\");\n    this.h_cursor = this.div.querySelector(\".cphdr_h_cursor\");\n    this.s_cursor = this.div.querySelector(\".cphdr_s_cursor\");\n    this.v_cursor = this.div.querySelector(\".cphdr_v_cursor\");\n    this.R_txt = this.div.querySelector(\".cphdr_R_txt\");\n    this.G_txt = this.div.querySelector(\".cphdr_G_txt\");\n    this.B_txt = this.div.querySelector(\".cphdr_B_txt\");\n    this.Vi_txt = this.div.querySelector(\".cphdr_Vi_txt\");\n    this.A_txt = this.div.querySelector(\".cphdr_A_txt\");\n    _slider_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].init(this.div);\n    this.redrawSv(0);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(col, 1, 1, 1);\n    this.setRGB(col);\n\n    if (!flg) {\n      var div = this.div.querySelector(\"#txtarea\");\n      div.style.display = \"none\";\n    }\n\n    this.div.querySelector(\".color_status\").addEventListener(\"change\", function () {\n      _this.changeColor();\n\n      if (_this.changeCallback) {\n        _this.changeCallback();\n      }\n    });\n    this.A_txt.addEventListener(\"change\", function () {\n      _this.changeColor();\n\n      if (_this.changeCallback) {\n        _this.changeCallback();\n      }\n    });\n    this.Vi_txt.addEventListener(\"change\", function () {\n      var vi = Math.pow(2, Number(_this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, _this.hsv);\n      _this.R_txt.value = (col[0] * vi).toFixed(3);\n      _this.G_txt.value = (col[1] * vi).toFixed(3);\n      _this.B_txt.value = (col[2] * vi).toFixed(3);\n\n      if (_this.changeCallback) {\n        _this.changeCallback();\n      }\n    });\n    this.sv_img.parentNode.addEventListener(\"pointerdown\", function (e) {\n      _this.drag_from = 1;\n\n      _this.down(e);\n    });\n    this.h_img.parentNode.addEventListener(\"pointerdown\", function (e) {\n      _this.drag_from = 2;\n\n      _this.down(e);\n    });\n    window.addEventListener(\"pointermove\", this.down);\n  }\n\n  _createClass(ColorSelector, [{\n    key: \"redrawSv\",\n    value: function redrawSv() {\n      var _this2 = this;\n\n      var idx = 0;\n      col[0] = this.hsv[0];\n      col[1] = 1;\n      col[2] = 1;\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col_org, col);\n      var data = img.data;\n      var alpha = Number(this.A_txt.value) * 255;\n\n      for (var yi = 0; yi < img.height; yi++) {\n        var yf = yi / img.height;\n        col[0] = (1 - col_org[0]) * yf + col_org[0];\n        col[1] = (1 - col_org[1]) * yf + col_org[1];\n        col[2] = (1 - col_org[2]) * yf + col_org[2];\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, col, 255 / img.width);\n\n        for (var xi = 0; xi < img.width; xi++) {\n          data[idx] = col[0] * xi;\n          data[idx + 1] = col[1] * xi;\n          data[idx + 2] = col[2] * xi;\n          data[idx + 3] = alpha;\n          idx += 4;\n        }\n      }\n\n      img.toBlob(function (blob) {\n        URL.revokeObjectURL(_this2.sv_img.src);\n        _this2.sv_img.src = URL.createObjectURL(blob);\n      }, \"image/png\");\n    }\n  }, {\n    key: \"setColor\",\n    value: function setColor(c) {\n      this.R_txt.value = c[0];\n      this.G_txt.value = c[1];\n      this.B_txt.value = c[2];\n      this.A_txt.value = c[3];\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(this.A_txt, \"input\");\n      this.changeColor();\n    }\n  }, {\n    key: \"changeColor\",\n    value: function changeColor() {\n      var rgb = this.rgb;\n      var hsv = this.hsv;\n      rgb[0] = Number(this.R_txt.value);\n      rgb[1] = Number(this.G_txt.value);\n      rgb[2] = Number(this.B_txt.value);\n      var max = Math.max(Math.max(rgb[0], Math.max(rgb[1], rgb[2])), 1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, rgb, 1 / max);\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgb2hsv(hsv, col);\n      this.redrawSv();\n      this.setCursor(hsv);\n      this.Vi_txt.value = Math.log2(max);\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(this.Vi_txt, \"input\");\n    }\n  }, {\n    key: \"setRGB\",\n    value: function setRGB(col) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(this.rgb, col);\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgb2hsv(this.hsv, this.rgb);\n      this.setCursor(this.hsv);\n    }\n  }, {\n    key: \"setCursor\",\n    value: function setCursor(hsv) {\n      this.h_cursor.style.top = hsv[0] * 127 - 1 + \"px\";\n      this.s_cursor.style.top = (1 - hsv[1]) * 127 - 1 + \"px\";\n      this.v_cursor.style.left = hsv[2] * 127 - 1 + \"px\";\n    }\n  }]);\n\n  return ColorSelector;\n}();\n\n\n; //window.addEventListener(\"load\",colorselector.init,false);\n\n//# sourceURL=webpack://bc/../lib/lib/colorselector.js?");

/***/ }),

/***/ "../lib/lib/datastream.js":
/*!********************************!*\
  !*** ../lib/lib/datastream.js ***!
  \********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ DataStream; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\nvar DataStream = /*#__PURE__*/function () {\n  function DataStream(arraybuffer, offset, length) {\n    _classCallCheck(this, DataStream);\n\n    if (typeof arraybuffer === \"number\") {\n      this.byteBuffer = new Uint8Array(arraybuffer);\n    } else {\n      if (length) {\n        this.byteBuffer = new Uint8Array(arraybuffer, offset, length);\n      } else {\n        this.byteBuffer = new Uint8Array(arraybuffer);\n      }\n    }\n\n    this.dv = new DataView(this.byteBuffer.buffer, this.byteBuffer.byteOffset, this.byteBuffer.byteLength);\n    this.idx = 0;\n  }\n\n  _createClass(DataStream, [{\n    key: \"getByteIndex\",\n    value: function getByteIndex() {\n      return this.idx >>> 3;\n    }\n  }, {\n    key: \"fill\",\n    value: function fill(value, n) {\n      //nバイト書き込む\n      for (var i = 0; i < n; i++) {\n        this.setUint8(value);\n      }\n\n      return;\n    }\n  }, {\n    key: \"setInt32\",\n    value: function setInt32(value, le) {\n      this.dv.setInt32(this.idx >> 3, value, le);\n      this.idx += 32;\n      return;\n    }\n  }, {\n    key: \"getInt32\",\n    value: function getInt32(le) {\n      var ret = this.dv.getInt32(this.idx >> 3, le);\n      this.idx += 32;\n      return ret;\n    }\n  }, {\n    key: \"setUint8\",\n    value: function setUint8(value) {\n      this.dv.setUint8(this.idx >> 3, value);\n      this.idx += 8;\n    }\n  }, {\n    key: \"getUint8\",\n    value: function getUint8(le) {\n      var ret = this.dv.getUint8(this.idx >> 3, le);\n      this.idx += 8;\n      return ret;\n    }\n  }, {\n    key: \"setUint32\",\n    value: function setUint32(value, le) {\n      this.dv.setUint32(this.idx >> 3, value, le);\n      this.idx += 32;\n      return;\n    }\n  }, {\n    key: \"getUint32\",\n    value: function getUint32(le) {\n      var ret = this.dv.getUint32(this.idx >> 3, le);\n      this.idx += 32;\n      return ret;\n    }\n  }, {\n    key: \"setUint16\",\n    value: function setUint16(value, le) {\n      this.dv.setUint16(this.idx >> 3, value, le);\n      this.idx += 16;\n      return;\n    }\n  }, {\n    key: \"getUint16\",\n    value: function getUint16(le) {\n      var ret = this.dv.getUint16(this.idx >> 3, le);\n      this.idx += 16;\n      return ret;\n    }\n  }, {\n    key: \"setUint64\",\n    value: function setUint64(value, le) {\n      var h = value / (65536 * 65536) | 0;\n      var l = value & 0xffffffff;\n\n      if (le) {\n        this.setUint32(l, le);\n        this.setUint32(h, le);\n      } else {\n        this.setUint32(h, le);\n        this.setUint32(l, le);\n      }\n    }\n  }, {\n    key: \"getUint64\",\n    value: function getUint64(le) {\n      var ret = this.getUint32(le);\n      var ret2 = this.getUint32(le);\n\n      if (le) {\n        return (ret2 << 32) + ret;\n      } else {\n        return (ret << 32) + ret2;\n      }\n    }\n  }, {\n    key: \"setFloat32\",\n    value: function setFloat32(value, le) {\n      this.dv.setFloat32(this.idx >> 3, value, le);\n      this.idx += 32;\n    }\n  }, {\n    key: \"getFloat32\",\n    value: function getFloat32(le) {\n      var ret = this.dv.getFloat32(this.idx >> 3, le);\n      this.idx += 32;\n      return ret;\n    }\n  }, {\n    key: \"setBytes\",\n    value: function setBytes(bytes) {\n      for (var si = 0; si < bytes.length; si++) {\n        this.setUint8(bytes[si]);\n      }\n\n      return;\n    }\n  }, {\n    key: \"getBytes\",\n    value: function getBytes(length) {\n      var array = new Uint8Array(length);\n\n      for (var si = 0; si < length; si++) {\n        array[si] = this.getUint8();\n      }\n\n      return array;\n    }\n  }, {\n    key: \"setTextBuf\",\n    value: function setTextBuf(str, flg) {\n      var utf8array = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(str);\n      var dv = this.dv;\n\n      for (var si = 0; si < utf8array.length; si++) {\n        this.setUint8(utf8array[si]);\n      }\n\n      if (flg) {\n        this.setUint8(0);\n      }\n\n      return;\n    }\n  }, {\n    key: \"readTextBuf\",\n    value: function readTextBuf() {\n      var dv = this.dv;\n      var array = [];\n      var a;\n\n      while ((a = dv.getUint8(this.idx >> 3)) !== 0) {\n        array.push(a);\n        this.idx += 1 << 3;\n      }\n\n      this.idx += 1 << 3;\n      return _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(array);\n    }\n  }, {\n    key: \"setFloat16\",\n    value: function setFloat16(value, le) {\n      var dv = this.dv;\n      var s = -Math.sign(value) + 1 >> 1;\n      var val = Math.abs(value);\n      var e = Math.floor(Math.log2(val));\n      val = val / Math.pow(2, e) - 1;\n      var u = s << 15 | e + 15 << 10 | val * 1024 & 1023;\n      this.setUint16(u, le); //\t\tthis.idx-=16;\n      //\t\tvar val2= this.readFloat16(le);\n    }\n  }, {\n    key: \"readFloat16\",\n    value: function readFloat16(le) {\n      var dv = this.dv;\n      var data = this.getUint16(le);\n      if (data === 0) return 0.0;\n      var sign = data >> 15 & 1;\n      sign = 1 - sign * 2;\n      var idx = (data >> 10 & 31) - 15;\n      var b = (data & 1023) * 1.0 / 1024.0 + 1.0;\n      return sign * b * Math.pow(2.0, idx);\n    }\n  }, {\n    key: \"outputBit\",\n    value: function outputBit(bit) {\n      //1ビットouput_bufferに書き込む\n      //書き込んだあとindexを1ビットすすめる\n      this.byteBuffer[this.idx >> 3] &= ~(1 << (this.idx & 7));\n      this.byteBuffer[this.idx >> 3] |= bit << (this.idx & 7);\n      this.idx++;\n    }\n  }, {\n    key: \"outputBits\",\n    value: function outputBits(bits, len) {\n      //ビット列をoutput_bufferに書き込む\n      for (var i = 0; i < len; i++) {\n        this.outputBit(bits >> i & 1);\n      }\n    }\n  }, {\n    key: \"outputBitsReverse\",\n    value: function outputBitsReverse(bits, len) {\n      //ビット列を逆順(上位ビットから順番)にoutput_bufferに書き込む\n      //ハフマン符号格納用\n      for (var i = len - 1; i >= 0; i--) {\n        this.outputBit(bits >> i & 1);\n      }\n    }\n  }, {\n    key: \"readBit\",\n    value: function readBit() {\n      //bufferからoutput_indexの位置のビットを読み込み\n      //読み込んだあとoutput_indexを1つすすめる\n      var bit = this.byteBuffer[this.idx >> 3] >> (this.idx & 7) & 1;\n      this.idx++;\n      return bit;\n    }\n  }, {\n    key: \"readBits\",\n    value: function readBits(len) {\n      //output_bufferからlen分読み込み\n      var bits = 0;\n\n      for (var i = 0; i < len; i++) {\n        bits = bits | this.readBit() << i;\n      }\n\n      return bits;\n    }\n  }, {\n    key: \"readBitsReverse\",\n    value: function readBitsReverse(len) {\n      //output_bufferからlen分読み込み\n      //読み込んだビットは高次ビットから格納される\n      //ハフマン符号読み込み用\n      var bits = 0;\n\n      for (var i = 0; i < len; i++) {\n        bits = bits << 1 | this.readBit();\n      }\n\n      return bits;\n    }\n  }]);\n\n  return DataStream;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/datastream.js?");

/***/ }),

/***/ "../lib/lib/deflate.js":
/*!*****************************!*\
  !*** ../lib/lib/deflate.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Deflate; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"../lib/lib/datastream.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\nvar clen_huffmans = []; //データ長データ用ハフマン符号情報\n\nvar lit_huffmans = []; //リテラル/長さ用ハフマン符号情報\n\nvar dist_huffmans = []; //距離用ハフマン符号情報\n\nvar MAX_BITS = 15; //ハフマン符号に使う最大ビット長\n\nvar Deflate = /*#__PURE__*/function () {\n  function Deflate() {\n    _classCallCheck(this, Deflate);\n  }\n\n  _createClass(Deflate, null, [{\n    key: \"compress\",\n    value: function compress(arrayBuffer, comp_mode, block) {\n      //deflate圧縮を行う\n      var result; //ブロックを作成\n\n      if (!block) {\n        result = encBlock(arrayBuffer, 0, arrayBuffer.length, 1, comp_mode);\n      } else {\n        result = [];\n        var idx = 0;\n\n        while (idx < arrayBuffer.length) {\n          var size = Math.min(block, arrayBuffer.length - idx);\n\n          if (idx + size >= arrayBuffer.length) {\n            final = 1;\n          } else {\n            final = 0;\n          }\n\n          a = encBlock(arrayBuffer, idx, size, final, comp_mode);\n          result = result.concat(a);\n          idx += size;\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"expand\",\n    value: function expand(compress_array_buffer, offset, length) {\n      //Deflate圧縮された情報を伸長する\n      var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](compress_array_buffer, offset, length);\n      var decdata = [];\n      var bfinal = 0; //最終ブロックを伸長した後はループを抜ける\n\n      while (!bfinal) {\n        bfinal = ds.readBit();\n        var compless_type = ds.readBits(2);\n\n        if (compless_type === 0) {\n          //無圧縮\n          if (ds.idx & 7) {\n            ds.idx = (ds.idx & ~7) + 8;\n          } else {\n            ds.idx = ds.idx & ~7;\n          }\n\n          var len = ds.readBits(16);\n          ds.readBits(16);\n\n          for (var i = 0; i < len; i++) {\n            decdata.push(ds.readBits(8));\n          } //ds.idx+=len*8;\n\n        } else if (compless_type === 1 || compless_type === 2) {\n          var lenlist = [];\n\n          if (compless_type === 1) {\n            //固定ハフマン\n            for (var i = 0; i <= 143; i++) {\n              lenlist[i] = 8;\n            }\n\n            for (var i = 144; i <= 255; i++) {\n              lenlist[i] = 9;\n            }\n\n            for (var i = 256; i <= 279; i++) {\n              lenlist[i] = 7;\n            }\n\n            for (var i = 280; i <= 287; i++) {\n              lenlist[i] = 8;\n            }\n\n            lit_huffmans = createHuffmans(lenlist);\n            lenlist = [];\n\n            for (var i = 0; i <= 31; i++) {\n              lenlist[i] = 5;\n            }\n\n            dist_huffmans = createHuffmans(lenlist);\n          } else {\n            //ダイナミックハフマン\n            var hlit = ds.readBits(5);\n            var hdist = ds.readBits(5);\n            var hclen = ds.readBits(4); //コード長コード復号\n\n            var idx = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\n            for (var i = 0; i < idx.length; i++) {\n              if (i < hclen + 4) {\n                lenlist[idx[i]] = ds.readBits(3);\n              } else {\n                lenlist[idx[i]] = 0;\n              }\n            }\n\n            var clen_huffmans = createHuffmans(lenlist); //長さビット長リスト復元\n            //距離ビット長リスト復元\n\n            var lenlist2 = decodeClen(ds, hlit + hdist + 258, clen_huffmans);\n            lenlist = lenlist2.slice(0, hlit + 257);\n            lit_huffmans = createHuffmans(lenlist);\n            lenlist = lenlist2.slice(hlit + 257);\n            dist_huffmans = createHuffmans(lenlist);\n          }\n\n          while (1) {\n            var value = readHuffman(ds, lit_huffmans);\n\n            if (value < 256) {\n              //リテラル\n              decdata.push(value);\n            } else {\n              if (value == 256) {\n                //終了符号\n                break;\n              } //長さ\n\n\n              if (value === 285) {\n                value = 255;\n              } else {\n                var extra_bits = value - 261;\n\n                if (extra_bits >= 0) {\n                  extra_bits = extra_bits >> 2;\n                  value = value - 257;\n                  var offset = 4 + extra_bits * 4;\n                  var extra_data = ds.readBits(extra_bits);\n                  value = (value - offset << extra_bits) + (4 << extra_bits) + extra_data;\n                } else {\n                  value = value - 257;\n                }\n              } //len=value+3;\n\n\n              decdata.push(-(value + 3)); //-len\n              //距離\n\n              value = readHuffman(ds, dist_huffmans);\n              extra_bits = value - 2;\n\n              if (extra_bits >= 0) {\n                extra_bits = extra_bits >> 1;\n                var offset = 2 + extra_bits * 2;\n                var extra_data = ds.readBits(extra_bits);\n                value = (value - offset << extra_bits) + (2 << extra_bits) + extra_data;\n              } //dist=value+1;\n\n\n              decdata.push(value + 1); //dist\n            }\n          }\n\n          decdata = expandLZ77(decdata);\n        }\n      }\n\n      return decdata;\n    }\n  }]);\n\n  return Deflate;\n}();\n\n\n\nvar encBlock = function encBlock(src, offset, size, _final, comp_type) {\n  //1ブロック分出力する\n  //出力用ストリーム\n  var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(size * 2)); //元サイズの2倍くらいあれば多分大丈夫\n  //BFINAL\n\n  ds.outputBit(_final); //complession type\n\n  ds.outputBits(comp_type, 2);\n\n  if (comp_type === 0) {\n    //無圧縮モード\n    //バイト頭まで移動\n    if (ds.idx & 7) {\n      ds.idx = (ds.idx & ~7) + 8;\n    } else {\n      ds.idx = dx.idx & ~7;\n    }\n\n    var len = size;\n    ds.outputBits(len, 16);\n    ds.outputBits(~len, 16);\n\n    for (var i = 0; i < src.length; i++) {\n      ds.outputBits(src[i + offset], 8);\n    }\n  } else {\n    var lit_list = []; //リテラル/長さ用のハフマン符号を作るための符号長リスト\n\n    var dist_list = []; //距離用のハフマン符号を作るための符号長リスト\n\n    var clen_list = []; //符号長用のハフマン符号リストを作成\n    //LZ77圧縮を行う\n\n    var lz77 = compressLZ77(src, offset, size);\n\n    if (comp_type === 1) {\n      //固定ハフマン符号圧縮\n      //リテラル/長さ用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 9;\n      }\n\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 7;\n      }\n\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 8;\n      } //距離用のハフマン符号を作るための符号長リスト\n\n\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      }\n    } else if (comp_type === 2) {\n      //カスタムハフマン符号圧縮\n      //符号長用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i < 19; i++) {\n        clen_list.push(5);\n      } //符号長用のハフマン符号リストを作成\n\n\n      clen_huffmans = createHuffmans(clen_list); //リテラル/長さ用のハフマン符号を作るための符号長リスト\n\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 9;\n      }\n\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 8;\n      }\n\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 7;\n      } //距離用のハフマン符号を作るための符号長リスト\n      //for(var i=0;i<=10;i++){ dist_list[i]=4;}\n      //for(var i=11;i<=20;i++){ dist_list[i]=5;}\n      //for(var i=21;i<=31;i++){ dist_list[i]=6;}\n\n\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      } //リテラル/長さ用符号長リスト要素数を出力\n\n\n      ds.outputBits(lit_list.length - 257, 5); //距離用符号長リスト要素数を出力\n\n      ds.outputBits(dist_list.length - 1, 5); //符号長ハフマン符号用符号長リスト要素数を出力\n\n      ds.outputBits(clen_list.length - 4, 4); //符号長リストから符号長用ハフマン符号を作成\n\n      for (var i = 0; i < clen_list.length; i++) {\n        ds.outputBits(clen_list[i], 3);\n      } //符号長用ハフマン符号を用いてリテラル/長さ符号長リストを出力\n\n\n      var enc = encodeClen(lit_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans); //符号長用ハフマン符号を用いて距離符号長リストを出力\n\n      enc = encodeClen(dist_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans);\n    } //符号長リストからリテラル/長さハフマン符号を作成\n\n\n    lit_huffmans = createHuffmans(lit_list); //符号長リストから距離ハフマン符号を作成\n\n    dist_huffmans = createHuffmans(dist_list); //LZ77で圧縮されたデータをハフマン符号化し出力\n\n    for (var i = 0; i < lz77.length; i++) {\n      //if(!isNaN(src[i])){\n      if (lz77[i] >= 0) {\n        //リテラルの場合、リテラル/長さ用ハフマン符号を使って出力\n        outputHuffman(ds, lz77[i], lit_huffmans);\n      } else {\n        //繰り返し情報の場合、長さ、距離を符号+拡張情報の形に変えた後\n        //それぞれのハフマン符号を使って出力\n        //長さを符号+拡張情報化\n        var len = -lz77[i];\n        i++;\n        var dist = lz77[i];\n        var extra_bits = 0;\n        var extra_data = 0;\n        var code = 285;\n\n        if (len < 258) {\n          extra_bits = (Math.log2(Math.max(len - 3, 4)) | 0) - 2;\n          code = extra_bits * 4 + (len - 3 >> extra_bits) + 257;\n          extra_data = len - 3 & (1 << extra_bits) - 1;\n        } //長さ符号をハフマン符号を使って出力\n\n\n        outputHuffman(ds, code, lit_huffmans); //拡張情報はそのまま出力\n\n        ds.outputBits(extra_data, extra_bits); //距離を符号+拡張情報化\n\n        extra_bits = (Math.log2(Math.max(dist - 1, 2)) | 0) - 1;\n        code = extra_bits * 2 + (dist - 1 >> extra_bits);\n        var extra_data = dist - 1 & (1 << extra_bits) - 1; //距離符号をハフマン符号を使って出力\n\n        outputHuffman(ds, code, dist_huffmans); ///拡張情報はそのまま出力\n\n        ds.outputBits(extra_data, extra_bits);\n      }\n    } //ブロック終了符号(256)をリテラル/長さハフマン符号を使って出力\n\n\n    outputHuffman(ds, 256, lit_huffmans);\n  } //サイズぴったしに切り抜く\n  //\t\tvar result = new Uint8Array(Math.ceil(ds.idx/8));\n  //\t\tfor(var i=0;i<result.length;i++){\n  //\t\t\tresult[i]=ds.byteBuffer[i];\n  //\t\t}\n  //\t\treturn result;\n\n\n  return Array.from(ds.byteBuffer).slice(0, Math.ceil(ds.idx / 8));\n};\n\nvar createHuffmans = function createHuffmans(lenlist) {\n  //ビット長リストからハフマン符号情報を作成する\n  var enc_huffmans = [];\n  var max_bits = 0;\n\n  for (var i = 0; i < lenlist.length; i++) {\n    var t = {};\n    t.Len = lenlist[i];\n    t.Code = 0;\n    enc_huffmans.push(t);\n\n    if (max_bits < lenlist[i]) {\n      max_bits = lenlist[i];\n    }\n  }\n\n  var bl_count = new Array(max_bits + 1);\n\n  for (var i = 0; i < bl_count.length; i++) {\n    bl_count[i] = 0;\n  }\n\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    bl_count[enc_huffmans[i].Len]++;\n  }\n\n  var code = 0;\n  var next_code = new Array(max_bits + 1);\n  bl_count[0] = 0;\n\n  for (var bits = 1; bits < next_code.length; bits++) {\n    code = code + bl_count[bits - 1] << 1;\n    next_code[bits] = code;\n  }\n\n  for (var n = 0; n < enc_huffmans.length; n++) {\n    var len = enc_huffmans[n].Len;\n\n    if (len != 0) {\n      enc_huffmans[n].Code = next_code[len];\n      next_code[len]++;\n    }\n  }\n\n  var dec_huffmans = {};\n\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    if (enc_huffmans[i].Len) {\n      dec_huffmans[enc_huffmans[i].Code] = i;\n    }\n  }\n\n  var huffmans = {};\n  huffmans.enc_huffmans = enc_huffmans;\n  huffmans.dec_huffmans = dec_huffmans;\n  return huffmans;\n};\n\nvar readHuffman = function readHuffman(dv, tree) {\n  //ハフマン符号のどれかに一致するまで\n  //output_bufferから1バイトずつ読みこみ\n  //一致したハフマン符号をデコードした値を返す\n  var dec_huffmans = tree.dec_huffmans;\n  var enc_huffmans = tree.enc_huffmans;\n\n  for (var i = 1; i <= MAX_BITS; i++) {\n    var value = dv.readBitsReverse(i);\n    var deccode = dec_huffmans[value];\n\n    if (deccode != null) {\n      if (enc_huffmans[deccode].Len === i) {\n        return deccode;\n      }\n    }\n\n    dv.idx -= i; //バッファのインデックスを戻す\n  }\n\n  return null;\n};\n\nvar encodeClen = function encodeClen(lenlist) {\n  //符号長リストを0~18の符号列に変換する\n  var clen = [];\n\n  for (var i = 0; i < lenlist.length; i++) {\n    var target = lenlist[i];\n    var count = 1;\n\n    for (; count + i < lenlist.length && target === lenlist[i + count]; count++) {}\n\n    i += count - 1;\n\n    if (target === 0) {\n      while (count) {\n        if (count < 3) {\n          clen.push(0);\n          count -= 1;\n        } else if (count < 11) {\n          clen.push(17);\n          clen.push(count - 3);\n          count = 0;\n        } else if (count < 139) {\n          clen.push(18);\n          clen.push(count - 11);\n          count = 0;\n        } else {\n          clen.push(18);\n          clen.push(127);\n          count -= 138;\n        }\n      }\n    } else {\n      clen.push(target);\n      count -= 1;\n\n      while (count) {\n        if (count < 3) {\n          clen.push(target);\n          count -= 1;\n        } else if (count < 7) {\n          clen.push(16);\n          clen.push(count - 3);\n          count = 0;\n        } else {\n          clen.push(16);\n          clen.push(3);\n          count -= 6;\n        }\n      }\n    }\n  }\n\n  return clen;\n};\n\nvar decodeClen = function decodeClen(ds, size, clen_huffmans) {\n  //ハフマン符号化された0~18の符号列から\n  //符号長リストを復元する\n  var lenlist = [];\n\n  while (1) {\n    if (lenlist.length >= size) {\n      break;\n    }\n\n    var value = readHuffman(ds, clen_huffmans);\n\n    if (value <= 15) {\n      lenlist.push(value);\n    } else if (value === 16) {\n      //直前値3~6コピー\n      var extra = ds.readBits(2);\n      var org = lenlist[lenlist.length - 1];\n\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(org);\n      }\n    } else if (value === 17) {\n      //3~10ゼロ埋め\n      var extra = ds.readBits(3);\n\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(0);\n      }\n    } else if (value === 18) {\n      //11~138ゼロ埋め\n      var extra = ds.readBits(7);\n\n      for (var j = 0; j < extra + 11; j++) {\n        lenlist.push(0);\n      }\n    }\n  }\n\n  return lenlist;\n};\n\nvar outputHuffman = function outputHuffman(ds, value, tree) {\n  //値をハフマン符号化しoutput_bufferに書き込む\n  var t = tree.enc_huffmans[value];\n  ds.outputBitsReverse(t.Code, t.Len);\n};\n\nvar outputClen = function outputClen(ds, src, tree) {\n  //コード長をハフマン符号化しoutput_bufferに書き込む\n  for (var i = 0; i < src.length; i++) {\n    var value = src[i];\n\n    if (value <= 15) {\n      outputHuffman(ds, value, tree);\n    } else if (value === 16) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 2);\n    } else if (value === 17) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 3);\n    } else if (value === 18) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 7);\n    }\n  }\n};\n\nvar Queue = /*#__PURE__*/function () {\n  function Queue() {\n    _classCallCheck(this, Queue);\n\n    this.front = [];\n    this.behind = [];\n  }\n\n  _createClass(Queue, [{\n    key: \"push\",\n    value: function push(value) {\n      this.front.push(value);\n    }\n  }, {\n    key: \"shift\",\n    value: function shift() {\n      if (this.behind.length === 0) {\n        var buf = this.behind;\n        this.behind = this.front;\n        this.front = buf;\n        this.behind.reverse();\n      }\n\n      return this.behind.pop();\n    }\n  }, {\n    key: \"each\",\n    value: function each(f) {\n      for (var i = this.behind.length; i--;) {\n        if (f(this.behind[i])) {\n          return;\n        }\n      }\n\n      for (var i = 0; i < this.front.length; i++) {\n        if (f(this.front[i])) {\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"each_inv1\",\n    value: function each_inv1(f) {\n      var i = this.front.length;\n      if (i > 0) i--;\n\n      for (; i--;) {\n        if (f(this.front[i])) {\n          return;\n        }\n      }\n\n      i = 0;\n\n      if (this.front.length === 0) {\n        i = 1;\n      }\n\n      for (; i < this.behind.length; i++) {\n        if (f(this.behind[i])) {\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"each_inv\",\n    value: function each_inv(f) {\n      var flg = false;\n\n      for (var i = this.front.length; i--;) {\n        if (f(this.front[i])) {\n          return;\n        }\n      }\n\n      for (var i = 0; i < this.behind.length; i++) {\n        if (f(this.behind[i])) {\n          return;\n        }\n      }\n    }\n  }]);\n\n  return Queue;\n}();\n\nvar setmap = function setmap(maps, u8a, i) {\n  var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n\n  if (!(key in maps)) {\n    maps[key] = new Queue();\n  }\n\n  maps[key].push(i);\n};\n\nvar removemap = function removemap(maps, u8a, i) {\n  maps[(u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2]].shift();\n};\n\nvar compressLZ77 = function compressLZ77(u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var dataview = new DataView(u8a.buffer);\n  var i = Math.max(0, offset - 32768);\n\n  for (; i < offset; i++) {\n    setmap(maps, u8a, i);\n  }\n\n  var imax = size - 2;\n\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var offseti = offset + i;\n    var dist = 0;\n    var len_max = 2;\n    var kmax = Math.min(size - i, 258) + offseti;\n    var kmax2 = kmax - 4;\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n    if (map) map.each_inv(function (f) {\n      var j = offseti - f;\n      var k = offseti;\n\n      for (; k < kmax2; k += 4) {\n        if (dataview.getUint32(k) !== dataview.getUint32(k - j)) {\n          break;\n        }\n      }\n\n      for (; k < kmax; k++) {\n        if (dataview.getUint8(k) !== dataview.getUint8(k - j)) {\n          break;\n        }\n      }\n\n      if (k - offseti <= len_max) {\n        return false;\n      }\n\n      dist = j;\n      len_max = k - offseti;\n\n      if (k === kmax) {\n        return true;\n      }\n    });\n\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1; //マップ追加\n\n      for (j = 0; j < len_max; j++) {\n        setmap(maps, u8a, j + offseti);\n      } //マップ削除\n\n\n      var jmax = offseti - 32768 + len_max;\n      j = Math.max(0, offseti - 32768);\n\n      for (; j < jmax; j++) {\n        removemap(maps, u8a, j);\n      }\n    } else {\n      result[idx] = u8a[offseti]; //マップ追加\n\n      setmap(maps, u8a, offseti); //マップ削除\n\n      var j = offseti - 32768;\n\n      if (j >= 0) {\n        removemap(maps, u8a, j);\n      }\n    }\n\n    idx++;\n  }\n\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n\n  result.length = idx;\n  return result;\n};\n\nvar compressLZ77_ = function compressLZ77_(u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var i = Math.max(0, offset - 32768);\n\n  for (; i < imax; i++) {\n    var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n\n    if (!maps[key]) {\n      maps[key] = [];\n    }\n\n    maps[key].push(i);\n  }\n\n  var imax = size - 2;\n\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var dist = 0;\n    var len_max = 2;\n    var offseti = offset + i;\n    var kmax = Math.min(size - i, 258);\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n\n    for (var m = map.length; m--;) {\n      var j = offseti - map[m];\n\n      if (j <= 0) {\n        continue;\n      }\n\n      if (j > 32768) {\n        continue;\n      }\n\n      ;\n      var offsetj = offseti - j;\n      var k = 3;\n\n      for (; k < kmax; k++) {\n        if (u8a[offseti + k] !== u8a[offsetj + k]) {\n          break;\n        }\n      }\n\n      if (k <= len_max) {\n        continue;\n      }\n\n      dist = j;\n      len_max = k;\n\n      if (len_max === kmax) {\n        break;\n      }\n    }\n\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1;\n    } else {\n      result[idx] = u8a[offseti];\n    }\n\n    idx++;\n  }\n\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n\n  result.length = idx;\n  return result;\n};\n\nvar expandLZ77 = function expandLZ77(data, exist_data) {\n  //LZ77圧縮データを伸長する\n  var decoded_data;\n\n  if (exist_data) {\n    decoded_data = exist_data;\n  } else {\n    decoded_data = [];\n  }\n\n  for (var i = 0; i < data.length; i++) {\n    if (data[i] >= 0) {\n      //リテラルの場合そのまま出力\n      decoded_data.push(data[i]);\n    } else {\n      //繰り返しの場合それを出力\n      var len = -data[i];\n      i++;\n      var dist = data[i];\n      var idx = decoded_data.length - dist;\n\n      for (var j = 0; j < len; j++) {\n        decoded_data.push(decoded_data[idx + j]);\n      }\n    }\n  }\n\n  return decoded_data;\n};\n\nvar formatBinary = function formatBinary(array_buffer) {\n  var src = new Uint8Array(array_buffer);\n  var result = \"\";\n\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    result += ('00000000' + src[i].toString(2)).slice(-8);\n  }\n\n  return result;\n};\n\nvar formatHuffmans = function formatHuffmans(huffmans) {\n  var result = \"\";\n\n  for (var i = 0; i < huffmans.length && i < 3; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    result += ('0000000000' + huffmans[i].Code.toString(2)).slice(-huffmans[i].Len);\n  }\n\n  return result;\n};\n\nvar format = function format(src) {\n  //\n  var result = \"\";\n\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n\n    if (isNaN(src[i])) {\n      result += \"&lt;\" + src[i].len.toString(10) + \",\" + src[i].dist.toString(10) + \"&gt;\";\n    } else {\n      result += src[i].toString(10);\n    }\n  }\n\n  return result;\n};\n\n//# sourceURL=webpack://bc/../lib/lib/deflate.js?");

/***/ }),

/***/ "../lib/lib/delaunay.js":
/*!******************************!*\
  !*** ../lib/lib/delaunay.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./geono.js */ \"../lib/lib/geono.js\");\n\n\n\nvar Delaunay = function () {\n  var Delaunay = {};\n  var ret = Delaunay;\n\n  var Triangle = function Triangle() {\n    this.pIdx = [-1, -1, -1, -1];\n    this.p = [-1, -1, -1, -1];\n    this.center = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.r = 0;\n  };\n\n  Triangle.prototype.calcSupport = function (axis) {\n    var m = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(this.p[0], axis);\n\n    for (var j = 1; j < 4; j++) {\n      m = Math.min(m, _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(this.p[j], axis));\n    }\n\n    return m;\n  };\n\n  ret.create = function (points) {\n    var triangles = []; //内包矩形算出\n\n    var min = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var max = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(min, points[0]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(max, points[0]);\n\n    for (var i = 1; i < points.length; i++) {\n      min[0] = Math.min(min[0], points[i][0]);\n      min[1] = Math.min(min[1], points[i][1]);\n      min[2] = Math.min(min[2], points[i][2]);\n      max[0] = Math.max(max[0], points[i][0]);\n      max[1] = Math.max(max[1], points[i][1]);\n      max[2] = Math.max(max[2], points[i][2]);\n    } //最外三角作成\n\n\n    var ans = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(ans, max, min);\n    var r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(ans) * 10;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, min, ans, 0.5);\n    points.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(points[points.length - 1], ans[0] + r, ans[1] - r, ans[2] + r);\n    points.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(points[points.length - 1], ans[0] - r, ans[1] - r, ans[2] + r);\n    points.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(points[points.length - 1], ans[0], ans[1] + r, ans[2] + r);\n    points.push(new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3());\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(points[points.length - 1], ans[0], ans[1], ans[2] - r);\n    var t = new Triangle();\n    var l = points.length;\n    t.pIdx[0] = l - 4;\n    t.pIdx[1] = l - 3;\n    t.pIdx[2] = l - 2;\n    t.pIdx[3] = l - 1;\n    _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getOuterCenter3(t.center, points[t.pIdx[0]], points[t.pIdx[1]], points[t.pIdx[2]], points[t.pIdx[3]]);\n    t.r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(t.center, points[t.pIdx[0]]);\n    triangles.push(t);\n    var addlist;\n\n    var checkList = function checkList(n) {\n      for (var k = 0; k < addlist.length; k++) {\n        var e = addlist[k];\n\n        if (e.pIdx[0] == n.pIdx[2] && e.pIdx[1] == n.pIdx[1] && e.pIdx[2] == n.pIdx[0] || e.pIdx[0] == n.pIdx[1] && e.pIdx[1] == n.pIdx[0] && e.pIdx[2] == n.pIdx[2] || e.pIdx[0] == n.pIdx[0] && e.pIdx[1] == n.pIdx[2] && e.pIdx[2] == n.pIdx[1] || e.pIdx[2] == n.pIdx[2] && e.pIdx[1] == n.pIdx[1] && e.pIdx[0] == n.pIdx[0] || e.pIdx[2] == n.pIdx[1] && e.pIdx[1] == n.pIdx[0] && e.pIdx[0] == n.pIdx[2] || e.pIdx[2] == n.pIdx[0] && e.pIdx[1] == n.pIdx[2] && e.pIdx[0] == n.pIdx[1]) {\n          addlist.splice(k, 1);\n          return;\n        }\n\n        ;\n      }\n\n      addlist.push(n);\n    };\n\n    for (var i = 0; i < points.length - 4; i++) {\n      addlist = [];\n\n      for (var j = triangles.length; j--;) {\n        var t = triangles[j];\n\n        if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(t.center, points[i]) < t.r - 0.01) {\n          var idx = [0, 1, 2, 3, 0, 1];\n\n          for (var k = 0; k < 4; k++) {\n            var n = new Triangle();\n            n.pIdx[0] = t.pIdx[idx[k]];\n            n.pIdx[1] = t.pIdx[idx[k + 1]];\n            n.pIdx[2] = t.pIdx[idx[k + 2]];\n            n.pIdx[3] = i;\n            checkList(n);\n          }\n\n          triangles.splice(j, 1);\n        }\n      }\n\n      for (var j = 0; j < addlist.length; j++) {\n        var t = addlist[j];\n        _geono_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getOuterCenter3(t.center, points[t.pIdx[0]], points[t.pIdx[1]], points[t.pIdx[2]], points[t.pIdx[3]]);\n\n        if (!isNaN(t.center[0])) {\n          t.r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(t.center, points[t.pIdx[0]]);\n          triangles.push(t);\n        }\n      }\n    } //最外三角削除\n\n\n    l = points.length - 4;\n\n    for (var j = triangles.length; j--;) {\n      var t = triangles[j];\n\n      if (t.pIdx[0] >= l || t.pIdx[1] >= l || t.pIdx[2] >= l || t.pIdx[3] >= l) {\n        triangles.splice(j, 1);\n      }\n    }\n\n    points.splice(l, 4); //三角錘の法線が外に向くように修正\n\n    var n = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var n2 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n\n    for (var j = triangles.length; j--;) {\n      var t = triangles[j];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(n, points[t.pIdx[0]], points[t.pIdx[1]], points[t.pIdx[2]]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(n2, points[t.pIdx[3]], points[t.pIdx[0]]);\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(n, n2) > 0) {\n        var s = t.pIdx[0];\n        t.pIdx[0] = t.pIdx[1];\n        t.pIdx[1] = s;\n      }\n\n      for (var i = 0; i < 4; i++) {\n        t.p[i] = points[t.pIdx[i]];\n      }\n    }\n\n    return triangles;\n  };\n\n  return Delaunay;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Delaunay);\n\n//# sourceURL=webpack://bc/../lib/lib/delaunay.js?");

/***/ }),

/***/ "../lib/lib/fpsman.js":
/*!****************************!*\
  !*** ../lib/lib/fpsman.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Fpsman; }\n/* harmony export */ });\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\n\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\n\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\"); _classApplyDescriptorSet(receiver, descriptor, value); return value; }\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) { if (descriptor.set) { descriptor.set.call(receiver, value); } else { if (!descriptor.writable) { throw new TypeError(\"attempted to set read only private field\"); } descriptor.value = value; } }\n\nvar _fps = /*#__PURE__*/new WeakMap();\n\nvar _spf = /*#__PURE__*/new WeakMap();\n\nvar _fpserror = /*#__PURE__*/new WeakMap();\n\nvar _fpserrordelta = /*#__PURE__*/new WeakMap();\n\nvar _nextsleep = /*#__PURE__*/new WeakMap();\n\nvar _mainfunc = /*#__PURE__*/new WeakMap();\n\nvar Fpsman = /*#__PURE__*/function () {\n  //1frameあたりの時間[ms]\n  //蓄積誤差[ms]\n  //1secあたりの想定誤差[ms]\n  //次回実行時間\n  //1frameごとに実行する関数\n  function Fpsman(fps, mainfunc) {\n    var _this = this;\n\n    _classCallCheck(this, Fpsman);\n\n    _classPrivateFieldInitSpec(this, _fps, {\n      writable: true,\n      value: void 0\n    });\n\n    _classPrivateFieldInitSpec(this, _spf, {\n      writable: true,\n      value: void 0\n    });\n\n    _classPrivateFieldInitSpec(this, _fpserror, {\n      writable: true,\n      value: void 0\n    });\n\n    _classPrivateFieldInitSpec(this, _fpserrordelta, {\n      writable: true,\n      value: void 0\n    });\n\n    _classPrivateFieldInitSpec(this, _nextsleep, {\n      writable: true,\n      value: void 0\n    });\n\n    _classPrivateFieldInitSpec(this, _mainfunc, {\n      writable: true,\n      value: void 0\n    });\n\n    _defineProperty(this, \"mainloop\", function () {\n      var nowTime = performance.now(); //現在時間\n\n      var dt = _classPrivateFieldGet(_this, _nextsleep) - nowTime; //想定時間との差異\n      //時間差異が1frameぶんより大きい場合は次回の呼び出し時間を補正する\n\n      if (dt > _classPrivateFieldGet(_this, _spf)) dt = _classPrivateFieldGet(_this, _spf);\n      if (dt < -_classPrivateFieldGet(_this, _spf)) dt = -_classPrivateFieldGet(_this, _spf); //ミリ秒で割り切れない分の誤差の端数処理\n\n      _classPrivateFieldSet(_this, _fpserror, _classPrivateFieldGet(_this, _fpserror) + _classPrivateFieldGet(_this, _fpserrordelta));\n\n      if (_classPrivateFieldGet(_this, _fpserror) >= _classPrivateFieldGet(_this, _fps)) {\n        //時間誤差が1msを超えたら次回1ms増やす\n        _classPrivateFieldSet(_this, _fpserror, _classPrivateFieldGet(_this, _fpserror) - _classPrivateFieldGet(_this, _fps));\n\n        dt += 1;\n      } //次回実行時間\n\n\n      _classPrivateFieldSet(_this, _nextsleep, nowTime + _classPrivateFieldGet(_this, _spf) + dt);\n\n      _classPrivateFieldGet(_this, _mainfunc).call(_this); //メイン処理\n\n\n      nowTime = performance.now(); //現在時間再取得\n\n      dt = Math.max(1, _classPrivateFieldGet(_this, _nextsleep) - nowTime); //次回実行時間の差異を取得(最低1ms)\n\n      setTimeout(_this.mainloop, dt);\n    });\n\n    this.setFps(fps);\n\n    _classPrivateFieldSet(this, _mainfunc, mainfunc);\n  }\n\n  _createClass(Fpsman, [{\n    key: \"setFps\",\n    value: function setFps(fps) {\n      if (_classPrivateFieldGet(this, _fps) === fps) {\n        return;\n      }\n\n      _classPrivateFieldSet(this, _fps, fps | 0);\n\n      _classPrivateFieldSet(this, _spf, 1000 / _classPrivateFieldGet(this, _fps) | 0);\n\n      _classPrivateFieldSet(this, _fpserror, 0);\n\n      _classPrivateFieldSet(this, _fpserrordelta, 1000 % _classPrivateFieldGet(this, _fps));\n\n      _classPrivateFieldSet(this, _nextsleep, 0);\n    }\n  }]);\n\n  return Fpsman;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/fpsman.js?");

/***/ }),

/***/ "../lib/lib/geono.js":
/*!***************************!*\
  !*** ../lib/lib/geono.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Geono; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\nvar Geono = /*#__PURE__*/function () {\n  function Geono() {\n    _classCallCheck(this, Geono);\n  }\n\n  _createClass(Geono, null, [{\n    key: \"getOuterCenter\",\n    value: function getOuterCenter(ans, p0, p1, p2) {\n      //外接円の中心\n      var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p2, p1);\n      var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p2, p0);\n      var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len2(p0, p1);\n      var A = a * (b + c - a);\n      var B = b * (c + a - b);\n      var C = c * (a + b - c);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(ans, p0, A);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(ans, ans, p1, B);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.madd(ans, ans, p2, C);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(ans, ans, 1 / (A + B + C));\n    }\n  }, {\n    key: \"getOuterCenter3_sub\",\n    value: function getOuterCenter3_sub(ans, p0, p1, p2) {\n      var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p1);\n      var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p0);\n      var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p1);\n      var A = a * (b + c - a);\n      var B = b * (c + a - b);\n      var C = c * (a + b - c);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, p0, A);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p1, B);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p2, C);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, ans, 1 / (A + B + C));\n    }\n  }, {\n    key: \"getOuterCenter3\",\n    value: function getOuterCenter3(ans, p0, p1, p2, p3) {\n      //外接球の中心\n      var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p1);\n      var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p0);\n      var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p1);\n      var d = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p0, p3);\n      var e = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p1, p3);\n      var f = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(p2, p3);\n      var K = a * d * (e + f - a) + b * e * (f + a - e) + c * f * (a + e - f) - 2 * a * e * f;\n      var L = a * d * (b + f - d) + b * e * (f + d - b) + c * f * (d + b - f) - 2 * d * b * f;\n      var M = a * d * (e + c - d) + b * e * (c + d - e) + c * f * (d + e - c) - 2 * d * e * c;\n      var N = a * d * (b + c - a) + b * e * (c + a - b) + c * f * (a + b - c) - 2 * a * b * c;\n\n      if (Math.abs(K + L + M + N) > 0.00001) {\n        var det = 1 / (K + L + M + N);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(ans, p0, K * det);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p1, L * det);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p2, M * det);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, ans, p3, N * det);\n      } else {\n        ans[0] = NaN; //Geono.getOuterCenter3_sub(ans,p0,p1,p2);\n      } //Vec3.mul(ans,ans,1/(K+L+M+N));\n\n    }\n  }, {\n    key: \"LINE_POINT\",\n    value: function LINE_POINT(ans, l1, l2, p1) {\n      //線分と点の最近点\n      var dir = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, l2, l1); //線分の向き\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p1, l1); //線分と点の差\n\n      var r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, dpos);\n\n      if (r <= 0) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l1);\n      } else {\n        var r2 = dir[0] * dir[0] + dir[1] * dir[1] + dir[2] * dir[2];\n\n        if (r > r2) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(ans, l2);\n        } else {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, l1, dir, r / r2);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n      return _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len2(ans, p1);\n    }\n  }, {\n    key: \"calcSquarePos\",\n    value: function calcSquarePos(ans, A, B, C, D, P) {\n      //四角ABCD内の点Pを(0~1,0~1)座標に変換\n      var BA = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var CD = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var AP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var DP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var n = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross3(n, A, C, B, D); //四角の法線\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BA, B, A);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(CD, C, D);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(AP, A, P);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(DP, D, P);\n      var a = 0;\n      var b = 0;\n      var c = 0;\n\n      for (var i = 0; i < 3; i++) {\n        var i1 = (i + 1) % 3;\n        var i2 = (i + 2) % 3;\n        a += (BA[i1] * CD[i2] - BA[i2] * CD[i1]) * n[i];\n        b += (BA[i1] * DP[i2] + AP[i1] * CD[i2] - (BA[i2] * DP[i1] + AP[i2] * CD[i1])) * n[i];\n        c += (AP[i1] * DP[i2] - AP[i2] * DP[i1]) * n[i];\n      }\n\n      var t;\n\n      if (!a) {\n        t = -c / b;\n      } else {\n        if (b * b - 4 * a * c < 0) {\n          t = -b / (2 * a);\n        } else {\n          t = (-b + Math.sqrt(b * b - 4 * a * c)) / (2 * a);\n        }\n\n        var AD = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(AD, A, D);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(AD, AD, n);\n        var BC = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BC, B, C);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(BC, n, BC);\n        var BP = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(BP, B, P);\n\n        if (t < 0 && _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(AD, AP) > 0 || t > 1 && _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(BC, BP) > 0) {\n          t = (-b - Math.sqrt(b * b - 4 * a * c)) / (2 * a);\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(3);\n      }\n\n      ans[0] = t;\n      var FE = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var PE = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(FE, D, CD, t);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(FE, FE, BA, -t);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(FE, FE, A);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(PE, BA, t);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(PE, PE, A);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(PE, P, PE);\n      ans[1] = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(PE, FE) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(FE, FE);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(7);\n      return t;\n    }\n  }, {\n    key: \"TETRA_POINT\",\n    value: function TETRA_POINT(ans, p, v) {\n      var vbuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var flg = true;\n\n      for (var i = 0; i < 4; i++) {\n        //4つの面それぞれから対象までの距離を求める\n        var t1 = v[i + 1 & 3];\n        var t2 = v[i + 2 & 3];\n        var t3 = v[i + 3 & 3];\n        var t4 = v[i];\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(vbuf, t1, t2, t3); //Vec3.sub(d,p,t1);\n\n        var l0 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t1, vbuf); //面までの距離\n\n        var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(p, vbuf) - l0; //点までの距離\n\n        var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(t4, vbuf) - l0; //もうひとつの頂点までの距離\n\n        if (l2 * l2 <= 0.0000000001 || l1 * l2 < 0) {\n          //四面体に内包されない\n          flg = false;\n          break;\n        }\n\n        if (ans) {\n          ans[i] = l1 / l2;\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      return flg;\n    }\n  }]);\n\n  return Geono;\n}();\n\n_defineProperty(Geono, \"LINE_LINE\", function (a1, a2, p1, p2, p3, p4) {\n  //線分と線分の最近点\n  var dir1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dir2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var l;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir1, p2, p1); //線分1の向き\n\n  if (!(dir1[0] || dir1[1] || dir1[2])) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p1);\n    this.LINE_POINT(a2, p3, p4, a1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    return;\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir2, p4, p3); // 線分2の向き\n\n  if (!(dir2[0] || dir2[1] || dir2[2])) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p3);\n    this.LINE_POINT(a1, p1, p2, a2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    return;\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, dir2); //垂直ベクトル\n\n  if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(cross)) {\n    //2直線に垂直な方向から見たときの交点\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir2, cross); //線分2に垂直かつ線分1に並行?なベクトル\n\n    var l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dir1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p3, p1);\n    var r1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos); //線分1の交差比率\n\n    if (r1 * l1 >= 0 && r1 * r1 <= l1 * l1) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, dir2); //垂直ベクトル\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross, dir1, cross); //線分1に垂直かつ線分2に並行?なベクトル\n\n      var l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dir2);\n      var r2 = -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos); //線分2の交差比率\n\n      if (r2 * l2 >= 0 && r2 * r2 <= l2 * l2) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a1, p1, dir1, r1 / l1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(a2, p3, dir2, r2 / l2);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n        return;\n      }\n    }\n  }\n\n  var min = this.LINE_POINT(dpos, p1, p2, p3);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, dpos);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p3);\n  var l = this.LINE_POINT(dpos, p1, p2, p4);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, dpos);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, p4);\n  }\n\n  l = this.LINE_POINT(dpos, p3, p4, p1);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, dpos);\n  }\n\n  l = this.LINE_POINT(dpos, p3, p4, p2);\n\n  if (l < min) {\n    min = l;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a1, p2);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a2, dpos);\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n});\n\n_defineProperty(Geono, \"TRIANGLE_POINT\", function (ans, t1, t2, t3, p1) {\n  //三角と点の最近点\n  var dir = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  cross[0] = t2[1] * t3[2] - t2[2] * t3[1] + t1[2] * (-t2[1] + t3[1]) + t1[1] * (t2[2] - t3[2]);\n  cross[1] = t2[2] * t3[0] - t2[0] * t3[2] + t1[0] * (-t2[2] + t3[2]) + t1[2] * (t2[0] - t3[0]);\n  cross[2] = t2[0] * t3[1] - t2[1] * t3[0] + t1[1] * (-t2[0] + t3[0]) + t1[0] * (t2[1] - t3[1]);\n  var ts = [t1, t2, t3, t1, t2];\n\n  for (var i = 0; i < 3; i++) {\n    var v1 = ts[i];\n    var v2 = ts[i + 1];\n    var v3 = ts[i + 2];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, p1, v1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dir, v2, v1); //線分の向き\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross2, cross, dir); //法線と線分に垂直なベクトル\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross2, dpos) <= 0) {\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dpos, dir);\n\n      var _l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dir, dir);\n\n      if (l < 0) {\n        this.LINE_POINT(ans, v1, v3, p1);\n      } else if (l > _l) {\n        this.LINE_POINT(ans, v2, v3, p1);\n      } else {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, v1, dir, l / _l);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n      return;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(ans, p1, cross, -_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos) / (cross[0] * cross[0] + cross[1] * cross[1] + cross[2] * cross[2]));\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n});\n\n_defineProperty(Geono, \"TRIANGLE_LINE\", function (t1, t2, t3, l1, l2) {\n  //三角と線分の最近点\n  var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var pos2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  var cross2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(cross, t1, t2, t3);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, t1, l1); //線開始点とポリゴンの距離\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(pos2, l2, l1); //線開始点とポリゴンの距離\n\n  var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, dpos) / _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross, pos2);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(pos2, l1, pos2, l); //面と線の交点\n\n  var ts = [t1, t2, t3, t1];\n\n  for (var j = 0; j < 3; j++) {\n    var v1 = ts[j];\n    var v2 = ts[j + 1];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, v2, v1); //線分の向き\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(cross2, cross, dpos); //法線と線分に垂直なベクトル\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, pos2, v1);\n\n    if (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(cross2, dpos) <= 0) {\n      //辺の外の場合はずれ\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n      return 99999;\n    }\n  }\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n  return l;\n});\n\n_defineProperty(Geono, \"lineWeight\", function (ans, p0, t0, t1) {\n  //p0がt1t2各頂点にどれくらい近いか\n  var axis = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(axis, t0, t1);\n\n  if (axis[0] === 0 && axis[1] === 0) {\n    ans[0] = 1;\n    ans[1] = 0;\n    return;\n  }\n\n  var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t0);\n  var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, p0);\n  var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t1);\n  ans[0] = (b - a) / (c - a);\n  ans[1] = 1 - ans[0];\n});\n\n_defineProperty(Geono, \"triangleWeight\", function (ans, p0, t0, t1, t2) {\n  //p0がt1t2t3各頂点にどれくらい近いか\n  var t = [t0, t1, t2, t0, t1];\n  var axis = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  var axis2 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(ans, 1, 0, 0);\n\n  for (var i = 0; i < 3; i++) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(axis, t[i + 1], t[i + 2]);\n\n    if (axis[0] === 0 && axis[1] === 0 && axis[2] === 0) {\n      //ゼロベクトルの場合\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(axis, t[i], t[i + 1]);\n    } else {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross2(axis2, t[i], t[i + 1], t[i + 2]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(axis, axis, axis2);\n    }\n\n    var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t[i + 1]);\n    var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, p0);\n    var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(axis, t[i]);\n\n    if (c - a !== 0) {\n      ans[i] = (b - a) / (c - a);\n    }\n  }\n});\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/geono.js?");

/***/ }),

/***/ "../lib/lib/img.js":
/*!*************************!*\
  !*** ../lib/lib/img.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Img; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _openexr_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./openexr.js */ \"../lib/lib/openexr.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\nvar ctx, canvas, ctx_imagedata;\ncanvas = document.createElement('canvas');\ncanvas.width = 1;\ncanvas.height = 1;\nctx = canvas.getContext('2d');\nctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\nvar FORMAT_FLOAT32 = 0;\nvar FORMAT_UINT8 = 1;\nvar ret_data = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\n\nvar add = function add(dst, src, idx, idx2, idx3, r) {\n  //var a2 = src[idx2+3];\n  //var a3 = src[idx3+3];\n  dst[idx + 0] += (src[idx2 + 0] + src[idx3 + 0]) * r;\n  dst[idx + 1] += (src[idx2 + 1] + src[idx3 + 1]) * r;\n  dst[idx + 2] += (src[idx2 + 2] + src[idx3 + 2]) * r;\n  dst[idx + 3] += (src[idx2 + 3] + src[idx3 + 3]) * r;\n};\n\nvar mul = function mul(dst, idx) {\n  var a = dst[idx + 3];\n\n  if (a === 0 || a === 1) {\n    return;\n  }\n\n  a = 1 / a;\n  dst[idx + 0] *= a;\n  dst[idx + 1] *= a;\n  dst[idx + 2] *= a;\n};\n\nvar Img = /*#__PURE__*/function () {\n  //イメージ\n  function Img(_x, _y, format) {\n    _classCallCheck(this, Img);\n\n    _defineProperty(this, \"toDataURL\", function (p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toDataURL(p1, p2);\n    });\n\n    _defineProperty(this, \"toBlob\", function (f, p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toBlob(f, p1, p2);\n    });\n\n    _defineProperty(this, \"toBMP\", function () {\n      var height = this.height;\n      var width = this.width;\n      var l = height * (width * 4 + 1 >>> 2 << 2) * 2 + 14 + 40;\n      var dv = new DataStream(l); //0x0000　(2)\tbfType\tファイルタイプ　通常は'BM'\n\n      dv.setTextBuf(\"BM\", 0); //0x0002　(4)\tbfSize\tファイルサイズ (byte)\n\n      dv.setUint32(l, true); //0x0006　(2)\tbfReserved1\t予約領域　常に 0\n\n      dv.setUint16(0, true); //0x0008　(2)\tbfReserved2\t予約領域　常に 0\n\n      dv.setUint16(0, true); //0x000A　(4)\tbfOffBits\tファイル先頭から画像データまでのオフセット (byte)\n\n      dv.setUint32(12 + 42, true); //ヘッダサイズ\n\n      dv.setUint32(40, true); //画像幅\n\n      dv.setUint32(this.width, true); //画像高さ\n\n      dv.setUint32(this.height, true); //プレーン数\n\n      dv.setUint16(1, true); //1画素あたり\n\n      dv.setUint16(32, true); //圧縮\n\n      dv.setUint32(0, true); //画像サイズ\n\n      dv.setUint32(this.data.length, true); //横解像度\n\n      dv.setUint32(0, true); //縦解像度\n\n      dv.setUint32(0, true); //パレット\n\n      dv.setUint32(0, true); //重要パレット\n\n      dv.setUint32(0, true);\n      var data = this.data;\n\n      switch (this.format) {\n        case 1:\n          for (var yi = height; yi--;) {\n            var idx = yi * width << 2;\n\n            for (var xi = 0; xi < width; xi++) {\n              dv.setUint8(data[idx + 2], true);\n              dv.setUint8(data[idx + 1], true);\n              dv.setUint8(data[idx + 0], true);\n              dv.setUint8(data[idx + 3], true);\n              idx += 4;\n            }\n          }\n\n          break;\n\n        default:\n          break;\n      } //var blob = new Blob([dv.byteBuffer], {type: \"application/octet-stream\"});\n      //return  window.URL.createObjectURL(blob);\n\n\n      return dv.byteBuffer; //var b64= btoa(String.fromCharCode.apply(null,dv.byteBuffer));\n      //return \"data:image/bmp;base64,\"+b64;\n    });\n\n    if (!_x) {\n      _x = 0;\n      _y = 0;\n    }\n\n    this.width = _x;\n    this.height = _y;\n    this.data = null;\n    this.format = format;\n\n    if (this.width) {\n      switch (this.format) {\n        case FORMAT_UINT8:\n          this.imagedata = ctx.createImageData(this.width, this.height);\n          this.data = this.imagedata.data; //new Uint8Array(this.width*this.height<<2);\n\n          this.rgba = new Uint32Array(this.data.buffer);\n          break;\n\n        default:\n          this.data = new Float32Array(this.width * this.height << 2);\n          break;\n      }\n    }\n  }\n\n  _createClass(Img, [{\n    key: \"scan\",\n    value: function scan(f, x, y, w, h) {\n      var data = this.data;\n\n      if (x === undefined) {\n        x = 0;\n        y = 0;\n        w = this.width;\n        h = this.height;\n      }\n\n      for (var yi = 0; yi < h; yi++) {\n        var idx = this.getIndex(x, yi + y) << 2;\n\n        for (var xi = 0; xi < w; xi++) {\n          f(data, idx, x + xi, y + yi); //data[idx ] =  ret_data[0];\n          //data[idx+1] = ret_data[1];\n          //data[idx+2] = ret_data[2];\n          //data[idx+3] = ret_data[3];\n\n          idx += 4;\n        }\n      }\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h) {\n      Img.copy(this, dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h);\n    }\n  }, {\n    key: \"getIndex\",\n    value: function getIndex(x, y) {\n      return y * this.width + x;\n    }\n  }, {\n    key: \"getIndexLoop\",\n    value: function getIndexLoop(x, y) {\n      var xx = x % this.width;\n      var yy = y % this.height;\n      if (xx < 0) xx += this.width;\n      if (yy < 0) yy += this.height;\n      return yy * this.width + xx;\n    }\n  }, {\n    key: \"createExr\",\n    value: function createExr(compression) {\n      var img = this;\n      var obj = {};\n      obj.width = img.width;\n      obj.height = img.height;\n      obj.attributes = [];\n      obj.attributes[\"compression\"] = compression;\n      obj.attributes[\"dataWindow\"] = {\n        xMin: 0,\n        yMin: 0,\n        xMax: img.width - 1,\n        yMax: img.height - 1\n      };\n      obj.attributes[\"displayWindow\"] = {\n        xMin: 0,\n        yMin: 0,\n        xMax: img.width - 1,\n        yMax: img.height - 1\n      };\n      obj.attributes[\"lineOrder\"] = 0;\n      obj.attributes[\"pixelAspectRatio\"] = 1;\n      obj.attributes[\"screenWindowCenter\"] = [0, 0];\n      obj.attributes[\"screenWindowWidth\"] = 1; //\t\tobj.attributes[\"chromaticities\"]=[0.1,0.1,0.1,0.2,0.3,0.4,0.5,0.6];\n\n      var size = img.width * img.height;\n      var channels = [];\n\n      for (var i = 0; i < 4; i++) {\n        var channel = {};\n        channel.data = new Float32Array(size);\n        channel.pixel_type = 1;\n        channel.pLiner = 0;\n        channel.reserved = 0;\n        channel.xSampling = 1;\n        channel.ySampling = 1;\n        channels.push(channel);\n      }\n\n      channels[0].name = \"A\";\n      channels[1].name = \"B\";\n      channels[2].name = \"G\";\n      channels[3].name = \"R\";\n      var img_data = img.data;\n\n      for (var i = 0; i < size; i++) {\n        var idx = i << 2;\n        channels[0].data[i] = img_data[idx + 3];\n        channels[1].data[i] = img_data[idx + 2];\n        channels[2].data[i] = img_data[idx + 1];\n        channels[3].data[i] = img_data[idx + 0];\n      }\n\n      obj.attributes.channels = channels;\n      return _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].toArrayBuffer(obj);\n    }\n  }, {\n    key: \"fill\",\n    value: function fill(r, g, b, a, x, y, w, h) {\n      var data = this.data;\n\n      if (x === undefined) {\n        var size = data.length;\n\n        for (var i = 0; i < size; i += 4) {\n          data[idx + 0] = r;\n          data[idx + 1] = g;\n          data[idx + 2] = b;\n          data[idx + 3] = a;\n        }\n      } else {\n        var img_width = this.width;\n        var bottom = Math.min(this.height, y + h);\n        var right = Math.min(img_width, x + w);\n\n        for (var yi = y; yi < bottom; yi++) {\n          var idx = yi * img_width + x << 2;\n          var max = yi * img_width + right << 2;\n\n          for (; idx < max; idx += 4) {\n            data[idx + 0] = r;\n            data[idx + 1] = g;\n            data[idx + 2] = b;\n            data[idx + 3] = a;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"clear\",\n    value: function clear(x, y, w, h) {\n      //透明でクリア\n      var data = this.data;\n\n      if (x === undefined) {\n        var size = data.length;\n        data.fill(0);\n      } else {\n        var img_width = this.width;\n        var bottom = Math.min(this.height, y + h);\n        var right = Math.min(img_width, x + w);\n\n        for (var yi = y; yi < bottom; yi++) {\n          var idx = yi * img_width + x << 2;\n          var max = yi * img_width + right << 2;\n          data.fill(0, idx, max); //\t\t\t\tfor(;idx<max;idx+=4){\n          //\t\t\t\t\tdata[idx+0]=1;\n          //\t\t\t\t\tdata[idx+1]=1;\n          //\t\t\t\t\tdata[idx+2]=1;\n          //\t\t\t\t\tdata[idx+3]=0;\n          //\t\t\t\t}\n        }\n      }\n    }\n  }, {\n    key: \"toCanvas\",\n    value: function toCanvas(x, y, w, h) {\n      if (x === undefined) {\n        x = 0;\n        y = 0;\n        w = this.width;\n        h = this.height;\n      }\n\n      canvas.width = w;\n      canvas.height = h;\n      ctx.putImageData(this.toImageData(), 0, 0, x, y, w, h);\n      return canvas;\n    }\n  }, {\n    key: \"toImageData\",\n    value: function toImageData() {\n      var ctx_imagedata;\n      var data = this.data;\n\n      switch (this.format) {\n        case FORMAT_UINT8:\n          ctx_imagedata = this.imagedata; //for(var yi=0;yi<this.height;yi++){\n          //\tfor(var xi=0;xi<this.width;xi++){\n          //\t\tvar idx=yi*this.width + xi<<2;\n          //\t\tfor(var ii=0;ii<4;ii++){\n          //\t\t\tctx_imagedata.data[idx+ii]=data[idx+ii];\n          //\t\t}\n          //\t}\n          //}\n\n          break;\n\n        default:\n          ctx_imagedata = ctx.createImageData(this.width, this.height);\n\n          for (var yi = 0; yi < this.height; yi++) {\n            for (var xi = 0; xi < this.width; xi++) {\n              var idx = yi * this.width + xi << 2;\n\n              for (var ii = 0; ii < 4; ii++) {\n                ctx_imagedata.data[idx + ii] = data[idx + ii] * 255.0;\n              }\n            }\n          }\n\n          break;\n      }\n\n      return ctx_imagedata;\n    }\n  }, {\n    key: \"gauss\",\n    value: function gauss(d, size, left, top, w, h) {\n      if (!size) return;\n      var src = this;\n      d = Math.max(1, d);\n      var MAX = size | 0;\n\n      if (buffer_img.data.length < src.data.length) {\n        buffer_img = new Img(src.width, src.height);\n      }\n\n      buffer_img.width = src.width;\n      buffer_img.height = src.height;\n      var dst = buffer_img;\n      var right = left + w - 1;\n      var bottom = top + h - 1; //係数作成\n\n      var weight = new Array(MAX);\n      var t = 0.0;\n\n      for (var i = 0; i < weight.length; i++) {\n        var r = i;\n        var we = Math.exp(-(r * r) / (2 * d * d));\n        weight[i] = we;\n\n        if (i > 0) {\n          we *= 2.0;\n        }\n\n        t += we;\n      }\n\n      for (i = 0; i < weight.length; i++) {\n        weight[i] /= t;\n      }\n\n      var height = src.height;\n      var width = src.width;\n      var data = src.data;\n      var dstdata = dst.data; //横ぼかし\n\n      var top2 = Math.max(0, top - size);\n      var bottom2 = Math.min(src.height, bottom + size + 1);\n\n      for (var y = top2; y < bottom2; y++) {\n        var yidx = y * width;\n\n        for (var idx = yidx + left << 2, idxmax = yidx + (right + 1) << 2; idx < idxmax; idx += 4) {\n          var a = data[idx + 3];\n          data[idx + 0] *= a;\n          data[idx + 1] *= a;\n          data[idx + 2] *= a;\n        }\n\n        var x = left;\n        var idx = yidx + left << 2;\n        var max = yidx + right + 1 << 2;\n        var r = weight[0];\n        var maxidx = y * width + (width - 1) << 2;\n        var minidx = y * width << 2;\n\n        for (; idx < max; idx += 4) {\n          dstdata[idx + 0] = data[idx + 0] * r;\n          dstdata[idx + 1] = data[idx + 1] * r;\n          dstdata[idx + 2] = data[idx + 2] * r;\n          dstdata[idx + 3] = data[idx + 3] * r;\n        }\n\n        max = Math.min(MAX, right + 1);\n\n        for (; x < max; x++) {\n          var idx = yidx + x << 2;\n          var idx2 = idx;\n          var idx3 = idx;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 = Math.max(idx2 - 4, minidx);\n            idx3 = Math.min(idx3 + 4, maxidx);\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n\n        max = Math.min(width - MAX, right + 1);\n\n        for (; x < max; x++) {\n          var idx = yidx + x << 2;\n          var idx2 = idx;\n          var idx3 = idx;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 -= 4;\n            idx3 += 4;\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n\n        var max = Math.min(right + 1, width);\n\n        for (; x < max; x++) {\n          var idx = yidx + x << 2;\n          var idx2 = idx;\n          var idx3 = idx;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 = Math.max(idx2 - 4, minidx);\n            idx3 = Math.min(idx3 + 4, maxidx);\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n      } //縦ぼかし\n\n\n      data = dst.data;\n      dstdata = src.data;\n\n      for (var x = left; x < right + 1; x++) {\n        var width4 = width << 2;\n        var idx = top * width + x << 2;\n        var max = (bottom + 1) * width + x << 2;\n        var r = weight[0];\n\n        for (; idx < max; idx += width * 4) {\n          dstdata[idx + 0] = data[idx + 0] * r;\n          dstdata[idx + 1] = data[idx + 1] * r;\n          dstdata[idx + 2] = data[idx + 2] * r;\n          dstdata[idx + 3] = data[idx + 3] * r;\n        }\n\n        y = top;\n        max = Math.min(MAX, bottom + 1);\n        var maxidx = (height - 1) * width + x << 2;\n        var minidx = x << 2;\n\n        for (; y < max; y++) {\n          idx = y * width + x << 2;\n          idx2 = idx;\n          idx3 = idx;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 = Math.max(idx2 - width4, minidx);\n            idx3 = Math.min(idx3 + width4, maxidx);\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n\n        max = Math.min(height - MAX, bottom + 1);\n\n        for (; y < max; y++) {\n          idx = y * width + x << 2;\n          var idx2 = idx;\n          var idx3 = idx;\n          var aaa = width << 2;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 -= width4;\n            idx3 += width4;\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n\n        max = Math.min(height, bottom + 1);\n\n        for (; y < max; y++) {\n          idx = y * width + x << 2;\n          idx2 = idx;\n          idx3 = idx;\n\n          for (var i = 1; i < MAX; i++) {\n            idx2 = Math.max(idx2 - width4, minidx);\n            idx3 = Math.min(idx3 + width4, maxidx); //var idx2= Math.max(y-i,0) *width+ x  <<2;\n            //var idx3= Math.min(y+i,height-1)*width+x <<2;\n\n            var r = weight[i];\n            dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n            dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n            dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n            dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n          }\n        }\n\n        for (var idx = top * width + x << 2, idxmax = (bottom + 1) * width + x << 2; idx < idxmax; idx += 4 * width) {\n          var a = dstdata[idx + 3];\n\n          if (a > 0 && a < 1) {\n            a = 1 / a;\n            dstdata[idx + 0] *= a;\n            dstdata[idx + 1] *= a;\n            dstdata[idx + 2] *= a;\n          }\n        }\n      }\n    }\n  }], [{\n    key: \"copy\",\n    value: function copy(dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h, f) {\n      var dst_data = dst.data;\n      var dst_width = dst.width;\n      var src_data = src.data;\n      var src_width = src.width;\n\n      if (src_w + src_x > src.width) {\n        src_w = src.width - src_x;\n      }\n\n      if (src_h + src_y > src.height) {\n        src_h = src.height - src_y;\n      }\n\n      var left = dst_x;\n      var right = dst_x + src_w;\n      var top = dst_y;\n      var bottom = dst_y + src_h;\n\n      if (src_x < 0) {\n        left -= src_x;\n        src_x = 0;\n      }\n\n      if (src_y < 0) {\n        top -= src_y;\n        src_y = 0;\n      }\n\n      if (left < 0) {\n        src_x -= left;\n        left = 0;\n      }\n\n      if (top < 0) {\n        src_y -= top;\n        top = 0;\n      }\n\n      if (right > dst.width) {\n        right = dst.width;\n      }\n\n      if (bottom > dst.height) {\n        bottom = dst.height;\n      }\n\n      if (dst.type === FORMAT_UINT8 && src.type === FORMAT_UINT8) {\n        for (var yi = top; yi < bottom; yi++) {\n          var dst_idx = dst.getIndex(left, yi);\n          var src_idx = src.getIndex(src_x, src_y + yi - top);\n\n          for (var xi = left; xi < right; xi++) {\n            dst.rgba[dst_idx] = src.rgba[src_idx];\n            dst_idx++;\n            src_idx++;\n          }\n        }\n      } else {\n        for (var yi = top; yi < bottom; yi++) {\n          var dst_idx = dst.getIndex(left, yi);\n          var src_idx = src.getIndex(src_x, src_y + yi - top);\n          dst_idx <<= 2;\n          src_idx <<= 2;\n\n          for (var xi = left; xi < right; xi++) {\n            dst_data[dst_idx + 0] = src_data[src_idx + 0];\n            dst_data[dst_idx + 1] = src_data[src_idx + 1];\n            dst_data[dst_idx + 2] = src_data[src_idx + 2];\n            dst_data[dst_idx + 3] = src_data[src_idx + 3];\n            dst_idx += 4;\n            src_idx += 4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"loadImg\",\n    value: function loadImg(url, format, func) {\n      if (typeof url !== \"string\") {\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadFile(url, function (url) {\n          Img.loadImg(url, format, func);\n        });\n        return null;\n      }\n\n      var image = new Image();\n      image.src = url;\n      var img = new Img();\n      img.name = url;\n      img.format = format;\n\n      image.onload = function (e) {\n        img.width = image.width;\n        img.height = image.height;\n\n        if (canvas.width < img.width || canvas.height < img.height) {\n          //開いた画像がキャンバスより大きい場合は広げる\n          if (canvas.width < img.width) {\n            canvas.width = img.width;\n          }\n\n          if (canvas.height < img.height) {\n            canvas.height = img.height;\n          }\n\n          ctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\n        } //ピクセルデータ取得\n\n\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(image, 0, 0);\n        var data = ctx.getImageData(0, 0, img.width, img.height).data;\n\n        switch (img.format) {\n          case 1:\n            img.data = new Uint8Array(img.width * img.height * 4);\n            img.rgba = new Uint32Array(img.data.buffer);\n\n            for (var di = 0; di < img.width * img.height * 4; di++) {\n              img.data[di] = data[di];\n            }\n\n            break;\n\n          default:\n            img.data = new Float32Array(img.width * img.height * 4);\n            var r = 1.0 / 255.0;\n\n            for (var di = 0; di < img.width * img.height * 4; di++) {\n              img.data[di] = data[di] * r;\n            }\n\n        }\n\n        if (func) {\n          func(img);\n        }\n      };\n\n      return img;\n    }\n  }, {\n    key: \"loadExr\",\n    value: function loadExr(url, format, func) {\n      var img = new Img();\n\n      var f = function f(buffer) {\n        var obj = {};\n        _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fromArrayBuffer(obj, buffer);\n        img.width = obj.width;\n        img.height = obj.height;\n        img.data = new Float32Array(img.width * img.height * 4); //RGBAチャンネルの情報をdataにセットする\n\n        var channels = obj.attributes.channels;\n        var data = img.data;\n        var cindex = {};\n        cindex[\"R\"] = -1;\n        cindex[\"G\"] = -1;\n        cindex[\"B\"] = -1;\n        cindex[\"A\"] = -1;\n\n        for (var i = 0; i < channels.length; i++) {\n          cindex[channels[i].name] = i;\n        }\n\n        var r = cindex[\"R\"];\n        var g = cindex[\"G\"];\n        var b = cindex[\"B\"];\n        var size = img.width * img.height * 4;\n\n        for (var i = 0; i < size; i += 4) {\n          data[i] = channels[r].data[i >> 2];\n          data[i + 1] = channels[g].data[i >> 2];\n          data[i + 2] = channels[b].data[i >> 2];\n        }\n\n        var a = cindex[\"A\"];\n\n        if (a >= 0) {\n          for (var i = 0; i < size; i += 4) {\n            data[i + 3] = channels[a].data[i >> 2];\n          }\n        } else {\n          for (var i = 0; i < size; i += 4) {\n            data[i + 3] = 1;\n          }\n        }\n\n        if (func) {\n          func(img);\n        }\n      };\n\n      if (typeof url === \"string\") {\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n          f(buffer);\n        });\n      } else {\n        if (url.byteLength) {\n          f(url);\n        } else {\n          _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n            f(buffer);\n          });\n        }\n      }\n\n      return img;\n    }\n  }]);\n\n  return Img;\n}();\n\n_defineProperty(Img, \"FORMAT_FLOAT32\", 0);\n\n_defineProperty(Img, \"FORMAT_UINT8\", 1);\n\n\nvar buffer_img = new Img(1024, 1024);\n\n//# sourceURL=webpack://bc/../lib/lib/img.js?");

/***/ }),

/***/ "../lib/lib/ono3d.js":
/*!***************************!*\
  !*** ../lib/lib/ono3d.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Ono3d; }\n/* harmony export */ });\n/* harmony import */ var _engine_engine_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../engine/engine.js */ \"../lib/engine/engine.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _rastgl_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rastgl.js */ \"../lib/lib/rastgl.js\");\n/* harmony import */ var _sort_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sort.js */ \"../lib/lib/sort.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nvar att_types = {};\nvar uni_types = {};\n\nvar setUniform = function setUniform(gl, uni, value, num) {\n  if (!uni) return;\n  var l = uni.location;\n\n  switch (uni.type) {\n    case \"int\":\n      gl.uniform1i(l, value);\n      break;\n\n    case \"float\":\n      gl.uniform1f(l, value);\n      break;\n\n    case \"float[]\":\n      gl.uniform1fv(l, value);\n\n    case \"vec3\":\n      gl.uniform3fv(l, value);\n      break;\n\n    case \"mat3\":\n      gl.uniformMatrix3fv(l, false, value);\n      break;\n\n    case \"mat4\":\n      gl.uniformMatrix4fv(l, false, value);\n      break;\n\n    case \"sampler2D\":\n      if (num == 2) {\n        gl.activeTexture(gl.TEXTURE2);\n      } else if (num == 5) {\n        gl.activeTexture(gl.TEXTURE5);\n      } else {\n        gl.activeTexture(gl.TEXTURE0 + num);\n      }\n\n      gl.uniform1i(uni.location, num);\n\n      if (value) {\n        gl.bindTexture(gl.TEXTURE_2D, value.glTexture);\n      } else {\n        gl.bindTexture(gl.TEXTURE_2D, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].dummyTexture); //テクスチャ未指定の場合はダミーを設定\n      }\n\n      break;\n\n    default:\n      break;\n  }\n};\n\nvar mat = new Float32Array(9);\nvar fa = new Float32Array(3);\n\nvar _PI = 1.0 / Math.PI;\n\nvar gl;\nvar shaders;\nvar currentpath = \"./lib/\"; //Util.getCurrent();\n\nvar i,\n    RF_OUTLINE = i = 1,\n    RF_DOUBLE_SIDED = ++i;\nvar DEFAULT_VERTEX_DATA_SIZE = 20 * 4;\nvar TEXSIZE = 1024;\n\nvar LightSource = function LightSource() {\n  this.matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n  this.viewmatrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n  this.viewmatrix2 = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n  this.color = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n  this.type;\n  this.power = 1;\n};\n\nvar Environment = function Environment() {\n  this.name = \"\";\n  this.envTexture = \"\";\n  this.sun = new LightSource();\n  this.area = new LightSource();\n};\n\nvar Material = function Material() {\n  this.name = \"\";\n  this.baseColor = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3(); //乱反射色 \n\n  this.baseColorMap = null; //ベースカラーテクスチャ\n\n  this.opacity = 1.0; //不透明度\n\n  this.metallic = 0.0; //全反射強度\n\n  this.metalColor = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3(); //反射色\n\n  this.roughness = 1.0; //反射粗度\n\n  this.ior = 0.0; //屈折率\n\n  this.subRoughness = 0.0; //透明粗度\n\n  this.emt = 0.0; //自己発光強度\n\n  this.pbrMap = null; //pbrテクスチャ\n\n  this.hightMap = null; //法線マップテクスチャ\n\n  this.hightMapPower = 0.0; //法線マップ強度\n\n  this.lightMap = null;\n  this.offsetx = 0.0; //uvオフセット\n\n  this.offsety = 0.0; //\n\n  this.uv = \"\";\n  this.bold = 1.0; //太さ\n\n  this.shader = \"\"; //シェーダ\n};\n\nvar Face = function Face() {\n  this.vertices = new Uint16Array(3);\n  this.environments = new Array(2);\n  this.environmentRatio = 0.0;\n};\n\nvar Line = function Line() {\n  this.bold = 1;\n  this.pos = [];\n  this.pos[0] = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n  this.pos[1] = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n  this.material = 0;\n};\n\nvar perspectiveMatrix = function perspectiveMatrix(mat, left, right, top, bottom, zn, zf) {\n  if (zn == null) {\n    //省略されている場合\n    zf = bottom;\n    zn = top;\n    top = right * zn;\n    bottom = -top;\n    right = left * zn;\n    left = -right;\n  } //透視行列を作る \n\n\n  _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(mat, 2 * zn / (right - left), 0, 0, 0, 0, 2 * zn / (top - bottom), 0, 0, (right + left) / (right - left), (top + bottom) / (top - bottom), -(zn + zf) / (zf - zn), -1.0, 0, 0, -2 * zn * zf / (zf - zn), 0);\n};\n\nvar Ono3d = /*#__PURE__*/function () {\n  function Ono3d() {\n    _classCallCheck(this, Ono3d);\n\n    _defineProperty(this, \"drawLine\", function (start, size) {\n      if (size === 0) return;\n      var ono3d = this;\n      var material;\n      var lines = ono3d.lines;\n      var shader = this.shaders[\"plain\"];\n      var i = 0;\n      var a = _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4.poolAlloc();\n      material = lines[start].material;\n      Ono3d.encode(a, material.baseColor);\n      gl.uniform4f(shader.unis[\"uColor\"].location, a[0], a[1], a[2], a[3]); //if(!globalParam.windows){\n\n      if (!globalParam.windows) {\n        gl.lineWidth(material.bold);\n      }\n\n      ono3d.stereoDraw(function () {\n        gl.uniformMatrix4fv(shader.unis[\"projectionMatrix\"].location, false, ono3d.pvMatrix);\n        gl.drawArrays(gl.LINES, start * 2, size * 2);\n      });\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4.poolFree(1);\n    });\n\n    this.rf = 0;\n    this.smoothing = 0;\n    this.viewMatrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n    this.worldMatrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n    this.targetMatrix = this.worldMatrix;\n    this.projectionMatrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44();\n    this.pvMatrix = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44(); //new Array(16);//new Mat44()\n\n    this.persx;\n    this.persy;\n    this.lines_index = 0;\n    this.vertices_index = 0;\n    this.faces_index = 0;\n    this.vertices_static_index = 0;\n    this.faces_static_index = 0;\n    this.materials_static_index = 0;\n    this.viewport = new Array(4);\n    this.viewport[0] = 0;\n    this.viewport[1] = 0;\n    this.viewport[2] = 100;\n    this.viewport[3] = 100;\n    this.znear = 0.1;\n    this.zfar = 80;\n    this.aov = 1;\n    this.renderTarget;\n    this.canvasTarget;\n    this.bold = 1.0;\n    this.lineColor = new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4();\n    this.transTextures = [null, null];\n    this.transTextureIndex = 0;\n    this.env2Texture = null;\n    this.shadowTexture = null;\n    this.envbufTexture = null;\n    var i,\n        RENDERFACES_MAX = 4096;\n    this.materials = [];\n\n    for (i = 0; i < 256; i++) {\n      this.materials.push(new Material());\n    }\n\n    this.environments = [];\n\n    for (i = 0; i < 8; i++) {\n      this.environments.push(new Environment());\n    }\n\n    this.lines = new Array(RENDERFACES_MAX);\n    this.faces = new Array(RENDERFACES_MAX);\n\n    for (i = this.faces.length; i--;) {\n      this.faces[i] = new Face();\n      this.lines[i] = new Line();\n    }\n\n    this.stackTransMatrix = new Array();\n    this.stackIndex = 0;\n\n    for (var i = 32; i--;) {\n      this.stackTransMatrix.push(new _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44());\n    } //this.clear();\n\n\n    this.faces_index = this.faces_static_index;\n    this.lines_index = 0;\n    this.vertices_index = this.vertices_static_index;\n    this.materials_index = this.materials_static_index;\n  }\n\n  _createClass(Ono3d, [{\n    key: \"setStatic\",\n    value: function setStatic() {\n      this.faces_static_index = 0; //this.faces_index;\n\n      this.vertices_static_index = this.vertices_index;\n      this.materials_static_index = this.materials_index;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.faces_index = this.faces_static_index;\n      this.lines_index = 0;\n      this.vertices_index = this.vertices_static_index;\n      this.materials_index = this.materials_static_index;\n    }\n  }, {\n    key: \"stereoDraw\",\n    value: function stereoDraw(func) {\n      var x = this.viewport[0];\n      var y = this.viewport[1];\n      var WIDTH = this.viewport[2];\n      var HEIGHT = this.viewport[3];\n\n      if (globalParam.stereomode == 0) {\n        globalParam.gl.viewport(x, y, WIDTH, HEIGHT);\n        perspectiveMatrix(this.projectionMatrix, this.aov, this.aov * HEIGHT / WIDTH, this.znear, this.zfar);\n        _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.dot(this.pvMatrix, this.projectionMatrix, this.viewMatrix);\n        func();\n      } else {\n        var p = 1.0;\n        var q = (1 - p) * 0.5;\n        var stereo;\n        WIDTH = WIDTH / 2;\n        globalParam.gl.viewport(WIDTH * q, HEIGHT * q, WIDTH * p, HEIGHT * p);\n        stereo = globalParam.stereo;\n        perspectiveMatrix(this.projectionMatrix, this.aov, this.aov * HEIGHT / WIDTH, this.znear, this.zfar);\n        this.projectionMatrix[8] = 0; //stereo/10;\n\n        this.projectionMatrix[12] = stereo;\n        _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.dot(this.pvMatrix, this.projectionMatrix, this.viewMatrix);\n        func();\n        this.projectionMatrix[12] *= -1;\n        _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.dot(this.pvMatrix, this.projectionMatrix, this.viewMatrix);\n        globalParam.gl.viewport(WIDTH + WIDTH * q, HEIGHT * q, WIDTH * p, HEIGHT * p);\n        func();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render(camerap) {\n      var ono3d = this;\n      var viewx, viewy, vieww, viewh;\n      viewx = ono3d.viewport[0];\n      viewy = ono3d.viewport[1];\n      vieww = ono3d.viewport[2];\n      viewh = ono3d.viewport[3]; //メインシェーダを設定\n\n      for (var mi = 0; mi < this.materials_index; mi++) {\n        var material = this.materials[mi];\n\n        if (material.shader && material.shader !== \"\") {\n          continue;\n        }\n\n        material.shader = Ono3d.calcMainShaderName(material);\n      } //マテリアルリストをシェーダごとに分ける\n\n\n      _sort_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].qSort(this.materials, this.materials_static_index, this.materials_index - 1, function (a, b) {\n        return a.blend_method < b.blend_method || a.shader < b.shader ? -1 : a.blend_method > b.blend_method || a.shader > b.shader ? 1 : 0;\n      }); //描画ポリゴンをマテリアル,環境 順に並べる\n\n      for (var i = 0; i < this.materials_index; i++) {\n        this.materials[i].index = i;\n      }\n\n      for (var i = 0; i < this.environments_index; i++) {\n        this.environments[i].index = i;\n      }\n\n      var faces = ono3d.faces;\n      var facesize = ono3d.faces_index;\n\n      for (var i = 0; i < facesize; i++) {\n        faces[i].materialIndex = (faces[i].material.opacity !== 1.0) * (0x1 << 8 + 8 + 8) + (faces[i].environments[1].index << 8 + 8) + (faces[i].environments[0].index << 8) + faces[i].material.index;\n      } //faces.sort(function(a,b){return a.materialIndex-b.materialIndex;});\n\n\n      _sort_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].qSort(faces, this.faces_static_index, facesize - 1, function (a, b) {\n        return a.materialIndex - b.materialIndex;\n      });\n      var vertexDataSize = 20;\n      var vindex = 0;\n      var oldIndex = -1;\n      var linesize = ono3d.lines_index; //GPUに渡すバッファ\n\n      var buff = this.verticesFloat32Array;\n      var idxbuff = this.indexBuffer;\n      var idxsize = 0; //面データセット\n      // マテリアルごとにインデックスをつくる\n\n      var materialIndexes = [];\n\n      for (var i = 0; i < facesize; i++) {\n        var renderface = faces[i];\n\n        if (oldIndex != renderface.materialIndex) {\n          materialIndexes.push(i);\n          oldIndex = renderface.materialIndex;\n        }\n\n        idxbuff[idxsize] = renderface.vertices[0];\n        idxbuff[idxsize + 1] = renderface.vertices[1];\n        idxbuff[idxsize + 2] = renderface.vertices[2];\n        idxsize += 3;\n      }\n\n      materialIndexes.push(facesize);\n      vindex += vertexDataSize * 3 * facesize; //線データセット\n\n      var lines = ono3d.lines;\n\n      for (var i = 0; i < linesize; i++) {\n        lines[i].materialIndex = lines[i].material.index;\n      }\n\n      _sort_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].qSort(lines, 0, this.lines_index - 1, function (a, b) {\n        return a.materialIndex - b.materialIndex;\n      });\n      var vertex;\n      var lineoffset = facesize * 3 * vertexDataSize;\n\n      for (var i = 0; i < linesize; i++) {\n        var idx = i * 6 + lineoffset;\n        var pos = lines[i].pos[0];\n        buff[idx] = pos[0];\n        buff[idx + 1] = pos[1];\n        buff[idx + 2] = pos[2];\n        pos = lines[i].pos[1];\n        buff[idx + 3] = pos[0];\n        buff[idx + 4] = pos[1];\n        buff[idx + 5] = pos[2];\n      }\n\n      vindex += 6 * linesize; //データをGPUに転送\n\n      gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].glbuffer);\n      var voff = this.vertices_static_index * vertexDataSize;\n      gl.bufferSubData(gl.ARRAY_BUFFER, voff * 4, new Float32Array(this.verticesFloat32Array.buffer, voff * 4, vindex));\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].glIdxBuffer);\n      gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, new Uint16Array(idxbuff.buffer, 0, idxsize)); //シャドウマップ描画\n\n      var lightSource = null;\n\n      if (globalParam.shadow) {\n        lightSource = this.environments[0].sun;\n      }\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer);\n      this.setViewport(0, 0, 1024, 1024);\n      gl.clearColor(1., 16.0 / 255.0, 1., 16.0 / 255.0);\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n      if (lightSource && facesize) {\n        var shader = this.shaders[\"shadow\"];\n        gl.useProgram(shader.program);\n        gl.depthMask(true);\n        gl.enable(gl.DEPTH_TEST);\n        gl.cullFace(gl.FRONT);\n        gl.disable(gl.BLEND);\n        setUniform(gl, shader.unis[\"projectionMatrix\"], lightSource.viewmatrix);\n        gl.vertexAttribPointer(shader.atts[\"aPos\"].location, 3, gl.FLOAT, false, DEFAULT_VERTEX_DATA_SIZE, 0);\n        gl.drawElements(gl.TRIANGLES, facesize * 3, gl.UNSIGNED_SHORT, 0);\n      }\n\n      gl.cullFace(gl.BACK);\n      Ono3d.copyImage(this.shadowTexture, 0, 0, 0, 0, 1024, 1024);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer);\n      this.setViewport(0, 0, 1024, 1024);\n      _engine_engine_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].shadowGauss(1024, 1024, 1000, this.shadowTexture, 0, 0, 1, 1);\n      Ono3d.copyImage(this.shadowTexture, 0, 0, 0, 0, 1024, 1024);\n      gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].glbuffer);\n      globalParam.stereo = -globalParam.stereoVolume * globalParam.stereomode * 0.4; //シェーダごとにレンダリング\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.depthMask(true);\n      gl.enable(gl.DEPTH_TEST);\n      this.setViewport(viewx, viewy, vieww, viewh);\n      fa[0] = camerap[0];\n      fa[1] = camerap[1];\n      fa[2] = camerap[2];\n      mat[0] = this.viewMatrix[0];\n      mat[1] = this.viewMatrix[1];\n      mat[2] = this.viewMatrix[2];\n      mat[3] = this.viewMatrix[4];\n      mat[4] = this.viewMatrix[5];\n      mat[5] = this.viewMatrix[6];\n      mat[6] = this.viewMatrix[8];\n      mat[7] = this.viewMatrix[9];\n      mat[8] = this.viewMatrix[10];\n      gl.enable(gl.DEPTH_TEST);\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      gl.disable(gl.BLEND);\n      gl.cullFace(gl.BACK);\n      gl.enable(gl.CULL_FACE);\n      var lineOpacityIndex = linesize; //不透明ポリゴン描画\n\n      var opacityIndex = materialIndexes.length;\n\n      for (var i = 0; i < materialIndexes.length - 1; i++) {\n        if (faces[materialIndexes[i]].material.opacity !== 1.0) {\n          opacityIndex = i;\n          break;\n        }\n\n        var j = i + 1;\n\n        for (; j < materialIndexes.length - 1; j++) {\n          if (faces[materialIndexes[i]].material.shader != faces[materialIndexes[j]].material.shader) {\n            break;\n          }\n\n          if (faces[materialIndexes[j]].material.opacity !== 1.0) {\n            break;\n          }\n        }\n\n        this.renderShader(materialIndexes[i], materialIndexes[j] - materialIndexes[i], 0);\n        i = j - 1;\n      } //環境跨ぎポリゴンチェック\n\n\n      var idx = -1;\n\n      for (var i = 0; i < opacityIndex; i++) {\n        var renderface = faces[materialIndexes[i]];\n\n        if (renderface.materialIndex & 0xf << 8 + 8) {\n          idx = i;\n          break;\n        }\n      }\n\n      if (idx >= 0) {\n        //環境跨ぎポリゴンある場合はもう一回レンダリング\n        Ono3d.copyImage({\n          glTexture: _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fTexture\n        }, 0, 0, viewx, viewy, vieww, viewh);\n        gl.clearColor(0.0, 0.0, 0.0, 0.0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n\n        for (var i = idx; i < opacityIndex - 1; i++) {\n          var j = i + 1;\n\n          for (; j < materialIndexes.length - 1; j++) {\n            if (faces[materialIndexes[i]].material.shader != faces[materialIndexes[j]].material.shader) {\n              break;\n            }\n          }\n\n          this.renderShader(materialIndexes[i], materialIndexes[j] - materialIndexes[i], 1);\n          i = j - 1;\n        }\n\n        Ono3d.copyImage(this.env2Texture, 0, 0, viewx, viewy, vieww, viewh); //合成\n\n        var addShader = this.shaders[\"add\"];\n        gl.useProgram(addShader.program);\n        setUniform(gl, addShader.unis[\"uSampler2\"], this.env2Texture, 1);\n        setUniform(gl, addShader.unis[\"v1\"], 1.0);\n        setUniform(gl, addShader.unis[\"v2\"], 1.0);\n        gl.viewport(viewx, viewy, vieww, viewh);\n        Ono3d.postEffect({\n          glTexture: _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fTexture\n        }, 0, 0, vieww / 1024, viewh / 1024, addShader);\n        gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].glbuffer);\n      } //線描画\n\n\n      var i = 0;\n      var materialIndex;\n      var shader = this.shaders[\"plain\"];\n      gl.enable(gl.DEPTH_TEST);\n      gl.disable(gl.BLEND);\n      gl.useProgram(shader.program);\n      gl.vertexAttribPointer(shader.atts[\"aPos\"].location, 3, gl.FLOAT, false, 0, ono3d.faces_index * DEFAULT_VERTEX_DATA_SIZE * 3);\n\n      while (i < linesize) {\n        if (lines[i].material.opacity !== 1.0) {\n          lineOpacityIndex = i;\n          break;\n        }\n\n        materialIndex = lines[i].materialIndex;\n        var j = i + 1;\n\n        for (j; j < linesize; j++) {\n          if (lines[j].materialIndex !== materialIndex) {\n            break;\n          }\n        }\n\n        this.drawLine(i, j - i);\n        i = j;\n      }\n\n      if (opacityIndex >= materialIndexes.length) {\n        //透明ポリゴンがない場合は終了\n        return;\n      }\n\n      gl.depthMask(false);\n      gl.disable(gl.DEPTH_TEST); //不透明レンダリング結果からラフネス別テクスチャ作成\n\n      var transTexture = this.transTextures[this.transTextureIndex];\n      Ono3d.copyImage(transTexture, 0, 0, viewx, viewy, vieww, viewh);\n      this.transTextureIndex = 1 - this.transTextureIndex;\n      transTexture = this.transTextures[this.transTextureIndex];\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer); //gl.clearColor(1., 1., 1.,0.5);\n      //gl.clear(gl.DEPTH_BUFFER_BIT|gl.COLOR_BUFFER_BIT);\n\n      gl.disable(gl.DEPTH_TEST);\n      var size = TEXSIZE;\n      gl.disable(gl.BLEND);\n\n      for (var i = 1; i < 4; i++) {\n        size >>= 1;\n        gl.viewport(0, 0, size, size * 0.5);\n        Ono3d.gauss(size, size * 0.5, 100, transTexture, 0, (TEXSIZE - size * 2) / TEXSIZE, size * 2 / TEXSIZE, size / TEXSIZE);\n        Ono3d.copyImage(transTexture, 0, 1024 - size, 0, 0, size, size * 0.5);\n      }\n\n      size >>= 1;\n      var s = Math.pow(0.5, 4);\n      gl.viewport(0, 0, TEXSIZE * s, TEXSIZE * s * 0.5);\n      var environment = this.environments[0];\n      this.drawCelestialSphere(environment.envTexture, 0, 1 - s, s, s * 0.5);\n      Ono3d.copyImage(transTexture, 0, (1 - s) * TEXSIZE, 0, 0, TEXSIZE * s, TEXSIZE * s * 0.5);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      Ono3d.copyImage(transTexture, 0, 0, 0, 0, vieww, viewh); //透明ポリゴン描画\n\n      gl.viewport(viewx, viewy, vieww, viewh);\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthMask(true);\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      gl.disable(gl.BLEND);\n      gl.cullFace(gl.BACK);\n      gl.enable(gl.CULL_FACE);\n      gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].glbuffer); //シェーダごとにレンダリング\n\n      for (var i = opacityIndex; i < materialIndexes.length - 1; i++) {\n        var j = i + 1;\n\n        for (; j < materialIndexes.length - 1; j++) {\n          if (faces[materialIndexes[i]].material.shader != faces[materialIndexes[j]].material.shader) {\n            break;\n          }\n        }\n\n        this.renderShader(materialIndexes[i], materialIndexes[j] - materialIndexes[i], 0);\n        i = j - 1;\n      } //線描画\n\n\n      var i = lineOpacityIndex;\n      var materialIndex;\n      gl.enable(gl.DEPTH_TEST);\n      gl.disable(gl.BLEND);\n      var shader = this.shaders[\"plain\"];\n      gl.useProgram(shader.program);\n      gl.vertexAttribPointer(shader.atts[\"aPos\"].location, 3, gl.FLOAT, false, 0, ono3d.faces_index * DEFAULT_VERTEX_DATA_SIZE * 3);\n\n      while (i < linesize) {\n        materialIndex = lines[i].materialIndex;\n        var j = i + 1;\n\n        for (j; j < linesize; j++) {\n          if (lines[j].materialIndex !== materialIndex) {\n            break;\n          }\n        }\n\n        this.drawLine(i, j - i);\n        i = j;\n      }\n    }\n  }, {\n    key: \"renderShader\",\n    value: function renderShader(start, size, envIdx) {\n      var arr = this.faces;\n      var i = start;\n      var material = arr[start].material;\n      var name = material.shader;\n      var shader = this.shaders[name];\n\n      if (!shader.program) {\n        return;\n      }\n\n      var atts = shader.atts;\n      var unis = shader.unis;\n      gl.useProgram(shader.program);\n      var attribPointerList = [{\n        name: \"aPos\",\n        size: 3\n      }, {\n        name: \"aNormal\",\n        size: 3\n      }, {\n        name: \"aSvec\",\n        size: 3\n      }, {\n        name: \"aTvec\",\n        size: 3\n      }, {\n        name: \"aUv\",\n        size: 2\n      }, {\n        name: \"aEnvRatio\",\n        size: 1\n      }, {\n        name: \"aUv2\",\n        size: 2\n      }, {\n        name: \"aLightProbe\",\n        size: 3\n      }];\n      setUniform(gl, unis[\"anglePos\"], fa); //setUniform(gl,unis[\"uViewMat\"],mat);\n      //attribute設定\n\n      var offset = 0;\n      attribPointerList.forEach(function (e) {\n        var att = atts[e.name];\n\n        if (att) {\n          var att_type = att.type;\n          gl.vertexAttribPointer(att.location, att_type.size, att_type.type, false, DEFAULT_VERTEX_DATA_SIZE, offset * 4);\n        }\n\n        offset += e.size;\n      });\n      setUniform(gl, unis[\"uEnvIndex\"], envIdx);\n      var oldEnv = null; //シャドウマップ\n\n      if (globalParam.shadow) {\n        setUniform(gl, unis[\"uShadowmap\"], this.shadowTexture, 1);\n      } else {\n        setUniform(gl, unis[\"uShadowmap\"], _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].dummyTexture, 1);\n      } //透過マップ\n\n\n      var transTexture = this.transTextures[this.transTextureIndex];\n      setUniform(gl, unis[\"uTransMap\"], transTexture, 4);\n\n      while (i < start + size) {\n        var j = i;\n        var env = arr[i].environments[envIdx];\n\n        if (i == start || arr[i].environments[envIdx] != arr[Math.max(i - 1, 0)].environments[envIdx]) {\n          //レンダリング環境が変わるタイミングで関連の変数をセット\n          var environment = arr[i].environments[envIdx];\n          gl.uniform3f(unis[\"uLight\"].location, environment.sun.matrix[8], environment.sun.matrix[9], environment.sun.matrix[10]);\n          setUniform(gl, unis[\"uLightColor\"], environment.sun.color); //gl.uniform3fv(unis[\"uLightColor\"].location,environment.sun.color);\n\n          setUniform(gl, unis[\"uAmbColor\"], new Float32Array(environment.area.color));\n          var lightSource = environment.sun;\n          setUniform(gl, unis[\"lightMat\"], lightSource.viewmatrix); //反射マップ\n\n          if (environment.envTexture) {\n            setUniform(gl, unis[\"uEnvMap\"], environment.envTexture, 3);\n          } else {\n            setUniform(gl, unis[\"uEnvMap\"], env.envTexture, 3);\n          }\n        } //同一マテリアルである最後のポリゴンのインデックスを探す\n\n\n        var materialIndex = arr[i].materialIndex;\n\n        for (j = i + 1; j < start + size; j++) {\n          if (arr[j].materialIndex !== materialIndex) {\n            break;\n          }\n        }\n\n        material = arr[i].material; //マテリアルごとの設定\n\n        gl.uniform3f(unis[\"uBaseCol\"].location, material.baseColor[0], material.baseColor[1], material.baseColor[2]);\n        setUniform(gl, unis[\"uOpacity\"], material.opacity);\n        setUniform(gl, unis[\"uEmi\"], material.emt);\n        setUniform(gl, unis[\"uMetallic\"], material.metallic); //反射強度,反射ラフネス,透過ラフネス,屈折率\n\n        gl.uniform4f(unis[\"uPbr\"].location, material.specular, material.roughness, material.subRoughness, material.ior);\n        gl.activeTexture(gl.TEXTURE0); //カラーテクスチャ\n\n        gl.uniform1i(unis[\"uBaseColMap\"].location, 0);\n\n        if (material.baseColorMap) {\n          gl.bindTexture(gl.TEXTURE_2D, material.baseColorMap.glTexture);\n        } else {\n          gl.bindTexture(gl.TEXTURE_2D, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].dummyTexture); //テクスチャ未指定の場合はダミーを設定\n        } //ハイトマップ\n\n\n        setUniform(gl, unis[\"uNormalMap\"], material.hightMap, 2);\n\n        if (material.hightMap) {\n          setUniform(gl, unis[\"uNormpow\"], material.hightMapPower);\n          setUniform(gl, unis[\"uHightBase\"], material.hightBase);\n        } else {\n          setUniform(gl, unis[\"uNormpow\"], 0);\n          setUniform(gl, unis[\"uHightBase\"], 0.5);\n        } //表面粗さ、反射率、屈折率、内部粗さ\n\n\n        setUniform(gl, unis[\"uPbrMap\"], material.pbrMap, 5);\n\n        if (material.pbrMap) {\n          setUniform(gl, unis[\"uPbrPow\"], 1.0);\n        } else {\n          setUniform(gl, unis[\"uPbrPow\"], 0);\n        }\n\n        if (material.orgMap) {\n          //とくしゅ\n          setUniform(gl, unis[\"orgMap\"], material.orgMap, 6);\n        } else {\n          //ライトマップ\n          setUniform(gl, unis[\"uLightMap\"], material.lightMap, 6);\n        }\n\n        var pvMatrix = this.pvMatrix;\n        this.stereoDraw(function () {\n          gl.uniformMatrix4fv(unis[\"projectionMatrix\"].location, false, pvMatrix);\n          gl.drawElements(gl.TRIANGLES, (j - i) * 3, gl.UNSIGNED_SHORT, i * 3 * 2); //gl.drawArrays(gl.TRIANGLES, i*3, (j-i)*3);\n        });\n        i = j;\n      }\n    }\n  }, {\n    key: \"drawCelestialSphere\",\n    value:\n    /** 環境マップを背景として描画 **/\n    function drawCelestialSphere(image, x, y, w, h) {\n      if (!w) {\n        x = 0;\n        y = 0;\n        w = 1;\n        h = 1;\n      }\n\n      var x = this.viewport[0];\n      var y = this.viewport[1];\n      var WIDTH = this.viewport[2];\n      var HEIGHT = this.viewport[3];\n      globalParam.gl.viewport(x, y, WIDTH, HEIGHT);\n      perspectiveMatrix(this.projectionMatrix, this.aov, this.aov * HEIGHT / WIDTH, this.znear, this.zfar);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.dot(this.pvMatrix, this.projectionMatrix, this.viewMatrix);\n      var shader = this.shaders[\"celestialsphere\"];\n      var mat44 = new Array(16);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.copy(mat44, this.viewMatrix);\n      mat44[12] = 0;\n      mat44[13] = 0;\n      mat44[14] = 0;\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.dot(mat44, this.projectionMatrix, mat44);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.getInv(mat44, mat44);\n      gl.useProgram(shader.program);\n      gl.uniformMatrix4fv(shader.unis[\"projectionMatrix\"].location, false, new Float32Array(mat44));\n      Ono3d.postEffect(image, x, y, w, h, shader);\n    }\n    /** 環境マップから拡散環境マップをつくる **/\n\n  }, {\n    key: \"rough\",\n    value: function rough(dst, _rough, src, x, y, w, h) {\n      if (x == null) {\n        x = 0;\n        y = 0;\n        w = 1;\n        h = 1;\n      }\n\n      var shader = this.shaders[\"rough\"];\n      var width = dst.width;\n      var height = dst.height;\n      gl.viewport(0, 0, width, height);\n      gl.disable(gl.BLEND);\n      gl.clearColor(0., 0., 0., 0.0);\n      gl.clear(gl.DEPTH_BUFFER_BIT | gl.COLOR_BUFFER_BIT);\n      gl.enable(gl.DEPTH_TEST);\n      gl.useProgram(shader.program);\n      gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fullposbuffer);\n      gl.vertexAttribPointer(shader.atts[\"aPos\"].location, 2, gl.FLOAT, false, 0, 0);\n      var unis = shader.unis;\n      var max = 1;\n\n      if (_rough == 0.0) {\n        max = 1;\n      }\n\n      if (_rough >= 1.0) {\n        _rough = 0.999;\n      }\n\n      gl.activeTexture(gl.TEXTURE1);\n      gl.uniform1i(shader.unis[\"uDst\"].location, 1);\n      gl.bindTexture(gl.TEXTURE_2D, dst.glTexture);\n      gl.uniform1f(shader.unis[\"uRough\"].location, 1.0 - Math.cos(_rough * Math.PI * 0.5)); //gl.uniform1f(shader.unis[\"uRough\"],0.0);\n\n      for (var i = 0; i < max; i++) {\n        gl.uniform1f(shader.unis[\"uSeed\"].location, Math.random() * 15.7);\n        gl.uniform1f(shader.unis[\"uPow\"].location, 1.0 / (i + 1.0)); //gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);\n\n        Ono3d.postEffect(src, x, y, w, h, shader);\n        Ono3d.copyImage(dst, 0, 0, 0, 0, width, height);\n      }\n    }\n    /** (x,y,z)座標でキューブマップ作成 **/\n\n  }, {\n    key: \"createCubeMap\",\n    value: function createCubeMap(image, x, y, z, size, func) {\n      this.setViewport(0, 0, size, size);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null); //\t\tvar WIDTH=this.viewport[2];\n      //\t\tvar HEIGHT=this.viewport[3];\n      //\t\tperspectiveMatrix(this.projectionMatrix,this.aov,this.aov*HEIGHT/WIDTH\n      //\t\t\t\t,this.znear,this.zfar);\n\n      perspectiveMatrix(this.projectionMatrix, 1, 1, 0.01, 100); //前、右\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, x, -y, z, 1);\n      func(0, 0, size, size);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, 0, z, -y, -x, 1);\n      func(size, 0, size, size);\n      Ono3d.copyImage(image, 0, size, 0, 0, size * 2, size); //後、左\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -x, -y, -z, 1);\n      func(0, 0, size, size);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, 0, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 0, -z, -y, x, 1);\n      func(size, 0, size, size);\n      Ono3d.copyImage(image, size * 2, size, 0, 0, size * 2, size); //下、上\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, -1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, x, -z, -y, 1);\n      func(0, 0, size, size);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(this.viewMatrix, -1, 0, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, x, z, y, 1);\n      func(size, 0, size, size);\n      Ono3d.copyImage(image, 0, 0, 0, 0, size * 2, size); //y軸反転\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer);\n      var y = size * 2 / image.height;\n      var x = size * 4 / image.width;\n      this.setViewport(0, 0, size * 4, size * 2);\n      Ono3d.drawCopy(0, 0, 1, 1, image, 0, y, x, -y);\n      Ono3d.copyImage(image, 0, 0, 0, 0, size * 4, size * 2);\n    }\n  }, {\n    key: \"createEnv\",\n    value: function createEnv(tex, x, y, z, func) {\n      var size = 256;\n\n      if (!tex) {\n        tex = Ono3d.createTexture(size, size);\n      }\n\n      var envBuf = this.envbufTexture;\n      gl.bindTexture(gl.TEXTURE_2D, tex.glTexture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT); //キューブマップ作成\n\n      this.createCubeMap(envBuf, x, y, z, size, func); //極座標化\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer);\n      this.setViewport(0, 0, size, size * 0.5);\n      Ono3d.postEffect(envBuf, 0, 0, 1, 1, shaders[\"cube2polar\"]);\n      Ono3d.copyImage(tex, 0, 0, 0, 0, size, size * 0.5);\n      var texsize = tex.width;\n      var width = texsize;\n      var height = texsize * 0.5;\n      width >>= 1;\n      height >>= 1;\n      var envs = [0.06, 0.24, 0.54, 1.0]; //i^2*0.06\n\n      for (var i = 0; i < envs.length; i++) {\n        var rough = envs[i];\n        var tex2 = Ono3d.createTexture(width, height);\n        gl.bindTexture(gl.TEXTURE_2D, tex2.glTexture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        this.setViewport(0, 0, width, height);\n        this.rough(tex2, rough, tex, 0, 0, 1, 0.5);\n        Ono3d.gauss(width, height, 10, tex2, 0, 0, 1, 1, width, height);\n        Ono3d.copyImage(tex2, 0, 0, 0, 0, width, height);\n        Ono3d.copyImage(tex, 0, texsize - height * 2, 0, 0, width, height);\n        Ono3d.copyImage(tex, width, texsize - height * 2, 0, 0, width, height);\n        Ono3d.copyImage(tex, texsize - width, texsize - height * 2, 0, 0, width, height);\n        width >>= 1;\n        height >>= 1;\n        gl.deleteTexture(tex2.glTexture);\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      return tex;\n    }\n  }, {\n    key: \"setLine\",\n    value: function setLine(p0, p1, material) {\n      //線追加\n      var renderLine = this.lines[this.lines_index];\n      renderLine.material = material;\n      this.lines_index++;\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3.copy(renderLine.pos[0], p0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3.copy(renderLine.pos[1], p1);\n    }\n  }, {\n    key: \"init\",\n    value: function init(_canvas, _ctx) {\n      gl = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].gl;\n      this.gl = gl;\n      this.clear();\n      att_types[\"vec2\"] = {\n        size: 2,\n        type: gl.FLOAT\n      };\n      att_types[\"vec3\"] = {\n        size: 3,\n        type: gl.FLOAT\n      };\n      att_types[\"vec4\"] = {\n        size: 4,\n        type: gl.FLOAT\n      };\n      att_types[\"float\"] = {\n        size: 1,\n        type: gl.FLOAT\n      };\n      this.renderTarget = _ctx;\n      this.canvasTarget = _canvas;\n      this.transTextures[0] = Ono3d.createTexture(TEXSIZE, TEXSIZE);\n      this.transTextures[1] = Ono3d.createTexture(TEXSIZE, TEXSIZE);\n      this.env2Texture = Ono3d.createTexture(TEXSIZE, TEXSIZE);\n      this.shadowTexture = Ono3d.createTexture(TEXSIZE, TEXSIZE);\n      gl.bindTexture(gl.TEXTURE_2D, this.shadowTexture.glTexture); //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n      this.envbufTexture = Ono3d.createTexture(1024, 512);\n      this.indexBuffer = new Uint16Array(_rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].VERTEX_MAX);\n      this.verticesFloat32Array = new Float32Array(_rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].VERTEX_MAX * 20);\n      this.shaders = [];\n      shaders = this.shaders;\n      var filenames = [\"shadow_dec\", \"shadow\", \"plain\", \"half\", \"multiadd\", \"fill\", \"add\", \"average\", \"average2\", \"average3\", \"decode\", \"rough\", \"celestialsphere\", \"envset\", \"gauss\", \"normal\", \"cube2polar\" //,\"cube2lightfield\",\"cube2lightfield2\",\"cube2lightfield3\"\n      ];\n\n      for (var i = 0; i < filenames.length; i++) {\n        var filename = filenames[i];\n        this.shaders[filename] = Ono3d.loadShader(currentpath + \"shader/\" + filename + \".shader\");\n      }\n\n      Ono3d.plainShader = Ono3d.createShader(\" \\\n\t\t\t[vertexshader] \\\n\t\t\tattribute vec2 aPos; \\\n\t\t\tuniform vec2 uPosScale; \\\n\t\t\tuniform vec2 uPosOffset; \\\n\t\t\t\tuniform vec2 uUvScale; \\\n\t\t\tuniform vec2 uUvOffset; \\\n\t\t\tvarying vec2 vUv; \\\n\t\t\tvoid main(void){ \\\n\t\t\t\tgl_Position = vec4(aPos * uPosScale + uPosOffset,1.0,1.0); \\\n\t\t\t\tvUv = (aPos+ 1.0) * 0.5 * uUvScale +  uUvOffset; \\\n\t\t\t} \\\n\t\t\t[fragmentshader] \\\n\t\t\tvarying lowp vec2 vUv; \\\n\t\t\tuniform sampler2D uSampler; \\\n\t\t\tvoid main(void){ \\\n\t\t\t\tgl_FragColor= texture2D(uSampler,vUv); \\\n\t\t\t} \");\n      Ono3d.loadMainShader();\n\n      for (var i = 0; i < 6; i++) {\n        gl.activeTexture(gl.TEXTURE0 + i);\n      }\n    }\n  }, {\n    key: \"setViewport\",\n    value: function setViewport(x, y, width, height) {\n      this.viewport[0] = x;\n      this.viewport[1] = y;\n      this.viewport[2] = width;\n      this.viewport[3] = height;\n      gl.viewport(x, y, width, height);\n    }\n  }]);\n\n  return Ono3d;\n}();\n\n\nOno3d.Material = Material;\nOno3d.Face = Face;\nOno3d.RF_OUTLINE = RF_OUTLINE;\nOno3d.RF_DOUBLE_SIDED = RF_DOUBLE_SIDED; //-x~x,-y~y,zn~zf\n\nOno3d.calcOrthoMatrix = function (mat, x, y, zn, zf) {\n  _vector_js__WEBPACK_IMPORTED_MODULE_4__.Mat44.set(mat, -1.0 / x, 0, 0, 0, 0, 1.0 / y, 0, 0.0, 0, 0, 2.0 / (zf - zn), 0.0, 0, 0, -(zf + zn) / (zf - zn), 1.0);\n};\n\nOno3d.calcMainShaderName = function (material) {\n  //マテリアルの各種設定を有効化したシェーダを取得\n  var options = [\"lightMap\", \"opacity\", \"specular\", \"hightMapPower\", \"pbrMap\"];\n  var num = 0;\n\n  for (var oi = 0; oi < options.length; oi++) {\n    if (options[oi] === \"opacity\") {\n      if (material[options[oi]] !== 1.0) {\n        num |= 1 << oi;\n      }\n    } else {\n      if (material[options[oi]]) {\n        num |= 1 << oi;\n      }\n    }\n  }\n\n  if (material[\"metallic\"]) {\n    num |= 1 << 2;\n  }\n\n  if (!shaders[\"main_\" + num]) {\n    Ono3d.createMainShader(num);\n  }\n\n  return \"main_\" + num;\n};\n\nOno3d.loadTexture = function (path, func) {\n  return _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImage(path, 0, function (image) {\n    if (!image.glTexture) {\n      image.glTexture = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(image);\n    }\n\n    if (func) {\n      func(image);\n    }\n  });\n};\n\nOno3d.createTexture = function (width, height) {\n  var image = {};\n  image.width = width;\n  image.height = height;\n  image.glTexture = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createTexture(null, width, height);\n  return image;\n};\n\nOno3d.loadBumpTexture = function (path, func) {\n  return Ono3d.loadTexture(path, function (image) {\n    if (!image.bumpInitFlg) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].frameBuffer);\n      gl.viewport(0, 0, image.width, image.height);\n      Ono3d.initNormal(image);\n      Ono3d.copyImage(image, 0, 0, 0, 0, image.width, image.height);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      image.bumpInitFlg = true;\n    }\n\n    if (func) {\n      func(image);\n    }\n  });\n};\n\nOno3d.createShader = function (txt) {\n  var shader = {};\n  txt = txt.replace(\"[common]\", \"\");\n  txt = \" \\n \\\n\t\t\t#pragma optionNV(inline all) \\n \\\n\t\t\t#pragma optionNV(unroll all)  \\n\" + txt;\n  var sss = txt.match(/\\[vertexshader\\]([\\s\\S]*)\\[fragmentshader\\]([\\s\\S]*)/);\n  var vs = sss[1];\n  var fs = sss[2];\n  fs = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commonFunction + _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].textureRGBE + \"\\n\" + fs;\n  var unis = txt.match(/uniform .+?;/g);\n  var gl = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].gl;\n  var program = shader.program = _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].setShaderProgram(vs, fs);\n  var atts = (vs + fs).match(/attribute .+?;/g);\n  shader.atts = {};\n\n  for (var i = 0; i < atts.length; i++) {\n    var res = atts[i].match(/(\\S+)\\s+(\\S+)\\s*;/);\n    var nam = res[2];\n    var type = att_types[res[1]];\n    var att = {\n      location: gl.getAttribLocation(program, nam),\n      type: type\n    };\n    shader.atts[nam] = att;\n\n    if (att.location >= 0) {\n      gl.enableVertexAttribArray(att.location);\n      gl.vertexAttribPointer(att.location, 1, gl.FLOAT, false, 0, 0);\n    }\n  }\n\n  shader.unis = {};\n\n  for (var i = 0; i < unis.length; i++) {\n    var res = unis[i].match(/(\\S+)\\s+([^\\[\\s]+)\\S*\\s*;/);\n    var nam = res[2];\n    var uni = {};\n    uni.location = gl.getUniformLocation(shader.program, nam);\n    uni.type = res[1];\n    res = unis[i].match(/\\[\\d+\\]/);\n\n    if (res) {\n      uni.type += \"[]\";\n    }\n\n    shader.unis[nam] = uni;\n  }\n\n  return shader;\n};\n\nOno3d.calcST = function (s, t, p0, p1, p2, u0, v0, u1, v1, u2, v2) {\n  var du1 = u1 - u0;\n  var dv1 = v1 - v0;\n  var du2 = u2 - u0;\n  var dv2 = v2 - v0;\n  var dx1 = p1[0] - p0[0];\n  var dy1 = p1[1] - p0[1];\n  var dz1 = p1[2] - p0[2];\n  var dx2 = p2[0] - p0[0];\n  var dy2 = p2[1] - p0[1];\n  var dz2 = p2[2] - p0[2];\n  var d2 = du1 * dv2 - du2 * dv1;\n\n  if (d2 === 0) {} else {\n    d2 = 1 / d2;\n    s[0] = -(dv1 * dx2 - dv2 * dx1) * d2;\n    s[1] = -(dv1 * dy2 - dv2 * dy1) * d2;\n    s[2] = -(dv1 * dz2 - dv2 * dz1) * d2;\n    t[0] = (du1 * dx2 - du2 * dx1) * d2;\n    t[1] = (du1 * dy2 - du2 * dy1) * d2;\n    t[2] = (du1 * dz2 - du2 * dz1) * d2;\n  }\n\n  return false;\n};\n\nOno3d.loadShader = function (path, func) {\n  var s = {};\n  _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadText(path, function (txt) {\n    try {\n      var shader = Ono3d.createShader(txt);\n      shader.name = path;\n      var keys = Object.keys(shader);\n\n      for (var i = 0; i < keys.length; i++) {\n        s[keys[i]] = shader[keys[i]];\n      }\n    } catch (e) {\n      alert(path + \"\\n\" + e.message);\n    }\n  });\n  return s;\n};\n\nOno3d.createMainShader = function (num) {\n  var path = currentpath + \"shader/main.shader\";\n  var shader = null;\n\n  try {\n    var options = [\"lightmap\", \"transmission\", \"reflect\", \"height\", \"pbr\"];\n    var txt = Ono3d.main_shader_org;\n\n    for (var j = 0; j < options.length; j++) {\n      //各種機能を有効/無効化\n      if (num & 1 << j) {\n        var re = new RegExp(\"/\\\\*\\\\[\" + options[j] + \"\\\\]\", \"g\");\n        txt = txt.replace(re, \"\");\n        re = new RegExp(\"\\\\[\" + options[j] + \"\\\\]\\\\*/\", \"g\");\n        txt = txt.replace(re, \"\");\n      } else {\n        var re = new RegExp(\"/\\\\*\\\\[\" + options[j] + \"\\\\][\\\\s\\\\S]*?\\\\[\" + options[j] + \"\\\\]\\\\*/\", \"g\");\n        txt = txt.replace(re, \"\");\n      }\n    }\n\n    if (!(num & 1)) {\n      //ライトマップが有効ではない場合は\n      //ライトプローブ関連行を有効化\n      var re = new RegExp(\"/\\\\*\\\\[\" + \"lightprobe\" + \"\\\\]\", \"g\");\n      txt = txt.replace(re, \"\");\n      re = new RegExp(\"\\\\[\" + \"lightprobe\" + \"\\\\]\\\\*/\", \"g\");\n      txt = txt.replace(re, \"\");\n    } else {\n      //ライトプローブ関連行を無効化\n      var re = new RegExp(\"/\\\\*\\\\[lightprobe\\\\][\\\\s\\\\S]*?\\\\[lightprobe\\\\]\\\\*/\", \"g\");\n      txt = txt.replace(re, \"\");\n    }\n\n    shader = Ono3d.createShader(txt);\n    shaders[\"main_\" + num] = shader;\n  } catch (e) {\n    alert(path + \"\\n\" + e.message);\n  }\n\n  return shader;\n};\n\nOno3d.loadMainShader = function () {\n  var path = currentpath + \"shader/main.shader\";\n  _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadText(path, function (txt_org) {\n    Ono3d.main_shader_org = txt_org;\n  });\n  return;\n};\n\nOno3d.copyImage = function (target, tx, ty, x, y, w, h) {\n  gl.bindTexture(gl.TEXTURE_2D, target.glTexture);\n  gl.copyTexSubImage2D(gl.TEXTURE_2D, 0, tx, ty, x, y, w, h);\n};\n\nOno3d.postEffect = function (src, u, v, w, h, sh) {\n  gl.disable(gl.DEPTH_TEST);\n  gl.depthMask(false);\n\n  if (!sh.program) {\n    return;\n  }\n\n  gl.useProgram(sh.program);\n  var unis = sh.unis;\n  var atts = sh.atts;\n  if (unis[\"uUvScale\"]) gl.uniform2f(unis[\"uUvScale\"].location, w, h);\n  if (unis[\"uUvOffset\"]) gl.uniform2f(unis[\"uUvOffset\"].location, u, v);\n  if (unis[\"uUnit\"]) gl.uniform2f(unis[\"uUnit\"].location, 1.0 / src.width, 1.0 / src.height);\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, src.glTexture);\n  if (unis[\"uSampler\"]) gl.uniform1i(unis[\"uSampler\"].location, 0);\n  gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fullposbuffer);\n  gl.vertexAttribPointer(atts[\"aPos\"].location, 2, gl.FLOAT, false, 0, 0);\n  gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fullposbuffer);\n  gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);\n};\n\nOno3d.packFloat = function (dst, src) {\n  var m = Math.max(src[0], Math.max(src[1], src[2]));\n  var idx = Math.ceil(Math.log(m + 0.01) / Math.log(2.0));\n  m = 1.0 / Math.pow(2.0, idx);\n  dst[0] = src[0] * m;\n  dst[1] = src[1] * m;\n  dst[2] = src[2] * m;\n  dst[3] = (idx + 128.0) / 255.0;\n};\n\nOno3d.unpackFloat = function (dst, src) {\n  dst[0] = src[0] * (1 - ((src[3] >> 7 & 1) << 1));\n  dst[1] = src[1] * (1 - ((src[3] >> 6 & 1) << 1));\n  dst[2] = src[2] * (1 - ((src[3] >> 5 & 1) << 1));\n  var idx = Math.floor((src[3] & 0x1f) - 16.0);\n  var m = Math.pow(2.0, idx);\n  dst[0] = dst[0] * m;\n  dst[1] = dst[1] * m;\n  dst[2] = dst[2] * m;\n};\n\nOno3d.encode = function (dst, src) {\n  var m = Math.max(src[0], Math.max(src[1], src[2]));\n  var idx = Math.ceil(Math.log(m + 0.01) / Math.log(2.0));\n  m = 1.0 / Math.pow(2.0, idx);\n  dst[0] = src[0] * m;\n  dst[1] = src[1] * m;\n  dst[2] = src[2] * m;\n  dst[3] = (idx + 128.0) / 255.0;\n};\n\nOno3d.decode2 = function (dst, src) {\n  var idx = Math.floor(src[2] * 256.0 - 128.0);\n  var idx2 = Math.floor(src[3] * 256.0 - 128.0);\n  var m = Math.pow(2.0, idx);\n  dst[0] = src[0] * Math.pow(2.0, idx);\n  dst[1] = src[1] * Math.pow(2.0, idx2);\n};\n/** 単純な画像コピー **/\n\n\nOno3d.drawCopy = function (dx, dy, dw, dh, image, sx, sy, sw, sh) {\n  if (sw == null) {\n    sh = image;\n    image = dx;\n    sx = dx = dy;\n    sy = sy = dw;\n    sw = dw = dh;\n    dh = sh;\n  }\n\n  var shader = this.plainShader;\n  var unis = shader.unis;\n  gl.useProgram(shader.program);\n  gl.uniform2f(unis[\"uPosScale\"].location, dw, dh);\n  gl.uniform2f(unis[\"uPosOffset\"].location, dx, dy);\n  Ono3d.postEffect(image, sx, sy, sw, sh, shader);\n};\n/** ガウスぼかし **/\n\n\nOno3d.gauss = function (width, height, d, src, x, y, w, h) {\n  //係数作成\n  var weight = new Array(5);\n  var t = 0.0;\n\n  for (var i = 0; i < weight.length; i++) {\n    var r = 1.0 + 2.0 * i;\n    var we = Math.exp(-0.5 * (r * r) / d);\n    weight[i] = we;\n\n    if (i > 0) {\n      we *= 2.0;\n    }\n\n    t += we;\n  }\n\n  for (i = 0; i < weight.length; i++) {\n    weight[i] /= t;\n  }\n\n  var shader = shaders[\"gauss\"];\n  var args = shader.unis;\n  gl.useProgram(shader.program);\n  gl.uniform1fv(args[\"weight\"].location, weight);\n  gl.bindBuffer(gl.ARRAY_BUFFER, _rastgl_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fullposbuffer); //横ぼかし\n\n  gl.uniform2f(args[\"uAxis\"].location, 1 / width * w, 0);\n  Ono3d.postEffect(src, x, y, w, h, shader);\n  Ono3d.copyImage(src, 0, 0, 0, 0, width, height); //縦ぼかし\n\n  gl.uniform2f(args[\"uAxis\"].location, 0, 1 / src.height);\n  Ono3d.postEffect(src, 0, 0, width / src.width, height / src.height, shader);\n};\n/** 法線マップ初期設定 (ハイトマップから法線マップに変換する)**/\n\n\nOno3d.initNormal = function (src) {\n  var shader = shaders[\"normal\"];\n  gl.bindTexture(gl.TEXTURE_2D, src.glTexture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.disable(gl.BLEND);\n  gl.disable(gl.DEPTH_TEST);\n  gl.useProgram(shader.program);\n  Ono3d.postEffect(src, 0, 0, 1, 1, shader);\n  Ono3d.copyImage(src, 0, 0, 0, 0, src.width, src.height); //this.setViewport(0,0,512,1024);\n  //Ono3d.gauss(src.width,src.height,100\n  //\t,src,0,0,1.0,1.0,src.width,src.height); \n  //Ono3d.copyImage(transTexture,0,0,0,0,512,1024);\n};\n\nOno3d.LightSource = LightSource;\nOno3d.perspectiveMatrix = perspectiveMatrix;\n\n//# sourceURL=webpack://bc/../lib/lib/ono3d.js?");

/***/ }),

/***/ "../lib/lib/onophy/cloth.js":
/*!**********************************!*\
  !*** ../lib/lib/onophy/cloth.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Cloth; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _phyobj_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phyobj.js */ \"../lib/lib/onophy/phyobj.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/lib/onophy/rigidbody.js\");\n/* harmony import */ var _onophy_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../geono.js */ \"../lib/lib/geono.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\n\n\nvar MIN = Math.min;\nvar MAX = Math.max;\nvar AIR_DAMPER = 1;\nvar DIMENSION = 3;\n\nvar Cloth = /*#__PURE__*/function (_RigidBody) {\n  _inherits(Cloth, _RigidBody);\n\n  var _super = _createSuper(Cloth);\n\n  //クロスシミュ\n  function Cloth(v, e, f) {\n    var _this;\n\n    _classCallCheck(this, Cloth);\n\n    _this = _super.call(this);\n    _this.type = _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CLOTH;\n    _this.bold = 0.015;\n    _this.points = []; //頂点位置\n\n    _this.edges = []; //エッジ\n\n    _this.bends = [];\n    _this.faces = []; //面\n\n    _this.facesSort = [];\n    _this.structual_stiffness = 0; //構造\n\n    _this.bending_stiffness = 0; //まげ\n\n    _this.spring_damping = 5; //ばね抵抗\n\n    _this.air_damping = 0; //空気抵抗\n\n    _this.vel_damping = 0; //速度抵抗\n\n    _this.restitution = 0; //反発係数\n\n    _this.friction = 0.1;\n    _this.inv_pointMass;\n\n    for (var i = 0; i < v; i++) {\n      _this.points.push(new Point());\n\n      _this.points[i].cloth = _assertThisInitialized(_this);\n    }\n\n    for (var i = 0; i < e; i++) {\n      _this.edges.push(new Edge());\n\n      _this.edges[i].cloth = _assertThisInitialized(_this);\n    }\n\n    for (var i = 0; i < f; i++) {\n      _this.faces.push(new Face());\n\n      _this.faces[i].cloth = _assertThisInitialized(_this);\n\n      _this.facesSort.push(_this.faces[i]);\n    }\n\n    _this.aabb = new _aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\n    return _this;\n  }\n\n  _createClass(Cloth, [{\n    key: \"addBend\",\n    value: function addBend(point1, point2) {\n      var bends = this.bends;\n\n      if (point1 === point2) {\n        return 0;\n      }\n\n      var i, imax;\n\n      for (i = 0, imax = bends.length; i < imax; i++) {\n        if (bends[i].point1 === point1 && bends[i].point2 === point2 || bends[i].point1 === point2 && bends[i].point2 === point1) {\n          return 0;\n        }\n      }\n\n      for (i = 0, imax = this.edges.length; i < imax; i++) {\n        if (this.edges[i].point1 === point1 && this.edges[i].point2 === point2 || this.edges[i].point1 === point2 && this.edges[i].point2 === point1) {\n          return 0;\n        }\n      }\n\n      var bend = new Edge();\n      bends.push(bend);\n      bend.cloth = this;\n      bend.point1 = point1;\n      bend.point2 = point2;\n      return 1;\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      var edges = this.edges;\n\n      for (var i = 0; i < edges.length; i++) {\n        for (var j = i + 1; j < edges.length; j++) {\n          if (edges[i].point1 === edges[j].point1) {\n            this.addBend(edges[i].point2, edges[j].point2);\n          } else if (this.edges[i].point1 === edges[j].point2) {\n            this.addBend(edges[i].point2, edges[j].point1);\n          } else if (edges[i].point2 === edges[j].point1) {\n            this.addBend(edges[i].point1, edges[j].point2);\n          } else if (this.edges[i].point2 === edges[j].point2) {\n            this.addBend(edges[i].point1, edges[j].point1);\n          }\n        }\n      }\n\n      for (var i = 0; i < this.bends.length; i++) {\n        this.bends[i].len = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.len(this.bends[i].point1.location, this.bends[i].point2.location);\n      }\n\n      this.inv_pointMass = 1 / (this.mass / this.points.length);\n    }\n  }, {\n    key: \"rayCast\",\n    value: function rayCast(res, p0, p1) {\n      var faces = this.faces;\n      var poses = this.points999;\n      var min = 9999999;\n\n      for (var i = 0; i < faces.length; i++) {\n        var face = faces[i];\n\n        if (!_aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].hitCheckLine(face.aabb, p0, p1)) {\n          continue;\n        }\n\n        var t0 = face.points[0].location;\n        var t1 = face.points[1].location;\n        var t2 = face.points[2].location;\n        var l = _geono_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].TRIANGLE_LINE(face.points[0].location, face.points[1].location, face.points[2].location, p0, p1);\n\n        if (l < min) {\n          min = l;\n          res.face = face;\n          res.p1 = face.points[0];\n          res.p2 = face.points[1];\n          res.p3 = face.points[2];\n        }\n\n        if (face.idxnum === 4) {\n          l = _geono_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].TRIANGLE_LINE(face.points[0].location, face.points[2].location, face.points[3].location, p0, p1);\n\n          if (l < min) {\n            min = l;\n            res.face = face;\n            res.p1 = face.points[0];\n            res.p2 = face.points[2];\n            res.p3 = face.points[3];\n          }\n        }\n      }\n\n      return min;\n    }\n  }, {\n    key: \"getPhyFace\",\n    value: function getPhyFace(p1, p2, p3, face, ans2) {\n      var phyFace = Cloth.disablePhyFace.pop();\n      var v1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var v2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      phyFace.cloth = this;\n      phyFace.face = face;\n      phyFace.p[0] = p1;\n      phyFace.p[1] = p2;\n      phyFace.p[2] = p3; //ポリゴン接点から各頂点の影響比率を求める\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v1, p2.location, p1.location);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v2, p3.location, p1.location);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(v1, v1, v2);\n      var p = [p1.location, p2.location, p3.location, p1.location, p2.location];\n\n      for (var k = 0; k < DIMENSION; k++) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v2, p[k + 2], p[k + 1]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(v2, v1, v2);\n        var a = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v2, p[k + 1]);\n        var b = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v2, p[k]);\n        var c = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(v2, ans2);\n        phyFace.ratio[k] = (a - c) / (a - b);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n      return phyFace;\n    }\n  }, {\n    key: \"calcPre\",\n    value: function calcPre(onophy) {\n      //AABB計算\n      this.aabb.min.set(this.points[0].location);\n      this.aabb.max.set(this.points[0].location);\n\n      for (var i = 0; i < this.faces.length; i++) {\n        //ポリゴン毎のAABB計算\n        var face = this.faces[i];\n\n        if (face.idxnum === 4) {\n          _aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].createFromPolygon(face.aabb, face.points[0].location, face.points[1].location, face.points[2].location, face.points[3].location);\n        } else {\n          _aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].createFromPolygon(face.aabb, face.points[0].location, face.points[1].location, face.points[2].location);\n        }\n\n        for (var j = 0; j < DIMENSION; j++) {\n          face.aabb.min[j] -= this.bold;\n          face.aabb.max[j] += this.bold;\n        }\n\n        for (var j = 0; j < DIMENSION; j++) {\n          this.aabb.min[j] = MIN(this.aabb.min[j], face.aabb.min[j]);\n          this.aabb.max[j] = MAX(this.aabb.max[j], face.aabb.max[j]);\n        }\n      }\n\n      this.facesSort.sort(function (a, b) {\n        return a.aabb.min[0] - b.aabb.min[0];\n      }); //剛体との衝突判定\n\n      var list = onophy.collider.aabbSorts[0];\n      var triangle = new _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].Triangle();\n      triangle.bold = this.bold;\n      var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var v1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var v2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n\n      for (var i = 0; i < list.length; i++) {\n        if (list[i].type === _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].MESH) {\n          continue;\n        }\n\n        if (list[i].aabb.min[0] > this.aabb.max[0]) {\n          break;\n        }\n\n        if (!_aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].hitCheck(list[i].aabb, this.aabb)) {\n          continue;\n        }\n\n        for (var j = 0; j < this.faces.length; j++) {\n          var face = this.faces[j];\n\n          if (!_aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].hitCheck(face.aabb, list[i].aabb)) {\n            continue;\n          }\n\n          for (var k = 0; k < face.idxnum - 2; k++) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(triangle.poses[0], face.points[0].location);\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(triangle.poses[1], face.points[1].location);\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(triangle.poses[2], face.points[2].location);\n            triangle.aabb = face.aabb;\n            var l = _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].calcClosest(ans1, ans2, list[i], triangle);\n\n            if (l < 0) {\n              var phyFace = this.getPhyFace(face.points[0], face.points[1 + k], face.points[2 + k], face, ans2); //衝突計算用の板ポリ\n\n              onophy.registHitConstraint(list[i].parent, ans1, phyFace, ans2);\n            }\n          }\n        }\n      }\n\n      this.inv_pointMass = 1 / (this.mass / this.points.length);\n\n      for (var i = 0; i < this.edges.length; i++) {\n        //エッジ拘束\n        this.edges[i].calcPre();\n      }\n\n      for (var i = 0; i < this.bends.length; i++) {\n        this.bends[i].calcPre(1);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    }\n  }, {\n    key: \"calcCollision\",\n    value: function calcCollision(target, onophy) {\n      //衝突判定\n      if (!_aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].hitCheck(target.aabb, this.aabb)) {\n        return;\n      }\n\n      var triangle = new _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].Triangle();\n      var triangle2 = new _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].Triangle();\n      triangle.bold = this.bold;\n      triangle2.bold = target.bold;\n      var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var trueans1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var trueans2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var trueface, trueface2;\n      var sflg1, sflg2;\n      var ii = 0;\n\n      for (var i = 0; i < this.facesSort.length; i++) {\n        var min = 99999;\n        var face = this.facesSort[i]; //if(!AABB.hitCheck(face.aabb,target.aabb)){\n        //\tcontinue;\n        //}\n\n        triangle.aabb = face.aabb;\n\n        for (var j = ii; j < target.facesSort.length; j++) {\n          var face2 = target.facesSort[j];\n\n          if (face.aabb.min[0] > face2.aabb.max[0]) {\n            ii = j;\n            continue;\n          }\n\n          if (face.aabb.max[0] < face2.aabb.min[0]) {\n            break;\n          }\n\n          if (!_aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].hitCheck(face.aabb, face2.aabb)) {\n            continue;\n          }\n\n          triangle2.aabb = face2.aabb;\n\n          for (var fan = 0; fan < face.idxnum - 2; fan++) {\n            triangle.poses[0] = face.points[0].location;\n            triangle.poses[1] = face.points[1 + fan].location;\n            triangle.poses[2] = face.points[2 + fan].location;\n\n            for (var fan2 = 0; fan2 < face2.idxnum - 2; fan2++) {\n              triangle2.poses[0] = face2.points[0].location;\n              triangle2.poses[1] = face2.points[1 + fan2].location;\n              triangle2.poses[2] = face2.points[2 + fan2].location;\n              var l = _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].calcClosest(ans1, ans2, triangle, triangle2);\n\n              if (l < min) {\n                min = l;\n                trueface = face;\n                trueface2 = face2;\n                sflg1 = fan;\n                sflg2 = fan2;\n                _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(trueans1, ans1);\n                _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(trueans2, ans2);\n              }\n            }\n          }\n        }\n\n        if (min < 0) {\n          var face = trueface;\n          var face2 = trueface2;\n          var phyFace = this.getPhyFace(face.points[0], face.points[1 + sflg1], face.points[2 + sflg1], face, trueans1);\n          var phyFace2 = this.getPhyFace(face2.points[0], face2.points[1 + sflg2], face2.points[2 + sflg2], face2, trueans2);\n          onophy.registHitConstraint(phyFace, trueans1, phyFace2, trueans2);\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    }\n  }, {\n    key: \"calcConstraintPre\",\n    value: function calcConstraintPre() {\n      var mass = this.mass / this.points.length;\n\n      for (var i = 0; i < this.edges.length; i++) {\n        this.edges[i].calcConstraintPre(mass);\n      }\n    }\n  }, {\n    key: \"calcConstraint\",\n    value: function calcConstraint() {\n      var mass = this.mass / this.points.length;\n\n      for (var i = 0; i < this.edges.length; i++) {\n        this.edges[i].calcConstraint(mass);\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(dt) {\n      var mass = this.mass / this.points.length;\n      AIR_DAMPER = Math.pow(1 - 0.24 * this.air_damping, dt);\n\n      for (var i = 0; i < this.points.length; i++) {\n        this.points[i].update(dt, mass);\n      }\n    }\n  }]);\n\n  return Cloth;\n}(_rigidbody_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n\n;\n\nvar Point = function () {\n  var Point = function Point() {\n    this.v = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.oldv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.location = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.rotV = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.rotq = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    this.fix = false;\n  };\n\n  var ret = Point;\n\n  ret.prototype.update = function (dt) {\n    if (this.fix) {\n      return;\n    }\n\n    var rq = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n    var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(this.rotV);\n\n    if (l > 0) {\n      var d = 1 / l;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.fromRotVector(rq, l * dt, this.rotV[0] * d, this.rotV[1] * d, this.rotV[2] * d);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qdot(this.rotq, rq, this.rotq);\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.location, this.location, this.v, dt);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.v, this.v, AIR_DAMPER);\n    this.v[1] -= this.cloth.onophy.GRAVITY * dt;\n  };\n\n  return ret;\n}();\n\nvar Edge = function () {\n  var Edge = function Edge() {\n    this.point1 = null;\n    this.point2 = null;\n    this.impulse = 0;\n    this.len;\n    this.n = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.offset = 0;\n    this.cloth = null;\n  };\n\n  var ret = Edge;\n\n  ret.prototype.calcPre = function (flg) {\n    var dv = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, this.point2.location, this.point1.location);\n    var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(dv);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.nrm(this.n, dv);\n\n    if (flg) {\n      l = -(this.len - l) * this.cloth.bending_stiffness;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(dv, this.n, l * this.cloth.onophy.dt * this.cloth.inv_pointMass);\n\n      if (!this.point1.fix) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.v, this.point1.v, dv);\n      }\n\n      if (!this.point2.fix) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(this.point2.v, this.point2.v, dv);\n      }\n    } else {\n      this.offset = -(this.len - l) * this.cloth.structual_stiffness; //位置補正\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n  };\n\n  ret.prototype.calcConstraintPre = function () {\n    var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, this.n, this.impulse * this.cloth.inv_pointMass);\n\n    if (!this.point1.fix) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.v, this.point1.v, impulse);\n    }\n\n    if (!this.point2.fix) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(this.point2.v, this.point2.v, impulse);\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n  };\n\n  ret.prototype.calcConstraint = function (m) {\n    var dv = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n    var old = this.impulse;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, this.point2.v, this.point1.v);\n    this.impulse += (_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dv, this.n) + this.offset) * (m * m / (m + m));\n    this.impulse *= 0.98; //やわらか拘束\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, this.n, (this.impulse - old) * this.cloth.inv_pointMass);\n\n    if (!this.point1.fix) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.v, this.point1.v, impulse);\n    }\n\n    if (!this.point2.fix) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(this.point2.v, this.point2.v, impulse);\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(2);\n  };\n\n  return ret;\n}();\n\nvar Face = /*#__PURE__*/_createClass(function Face() {\n  _classCallCheck(this, Face);\n\n  this.points = [null, null, null];\n  this.aabb = new _aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\n  this.cloth = null;\n});\n\n;\nCloth.Point = Point;\nCloth.Face = Face;\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/cloth.js?");

/***/ }),

/***/ "../lib/lib/onophy/onophy.js":
/*!***********************************!*\
  !*** ../lib/lib/onophy/onophy.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _collider_collider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _phyobj_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phyobj.js */ \"../lib/lib/onophy/phyobj.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/lib/onophy/rigidbody.js\");\n/* harmony import */ var _phyface_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./phyface.js */ \"../lib/lib/onophy/phyface.js\");\n/* harmony import */ var _cloth_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./cloth.js */ \"../lib/lib/onophy/cloth.js\");\n/* harmony import */ var _softbody_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./softbody.js */ \"../lib/lib/onophy/softbody.js\");\n/* harmony import */ var _spring_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./spring.js */ \"../lib/lib/onophy/spring.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\n\n\n\n\nvar OnoPhy = function () {\n  var MIN = Math.min;\n  var MAX = Math.max;\n  var REPETITION_MAX = 10; //繰り返しソルバ最大回数\n\n  var DT; //ステップ時間\n\n  var CFM = 0.99; //柔らかい拘束\n\n  var ERP = 0.1 * 60.0; //めり込み補正値\n\n  var OnoPhy = function OnoPhy() {\n    this.rigidBodies = []; //剛体\n\n    this.springs = []; //ばね\n\n    this.clothes = []; //布\n\n    this.joints = []; //ジョイント\n\n    this.repetition = 0; //ソルバ繰り返した回数\n\n    this.collider = new _collider_collider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](); //コライダ\n\n    this.hitConstraints = []; //コリジョン接触情報\n\n    this.disableList = new Array(1024); //コリジョン無効リスト\n\n    this.ANGDAMP = 0; //回転摩擦\n\n    this.LINDAMP = 0; //平行移動摩擦\n\n    this.GRAVITY = 9.81; //重力加速度\n  };\n\n  var ret = OnoPhy;\n  var i = 0;\n\n  ret.prototype.init = function () {\n    //剛体削除\n    var rigidBodies = this.rigidBodies;\n\n    for (var i = rigidBodies.length; i--;) {\n      var rigidBody = rigidBodies[i]; //コリジョンを削除\n\n      if (rigidBody.collision) {\n        this.collider.deleteCollision(rigidBody.collision);\n      }\n\n      rigidBodies.splice(i, 1);\n    } //ジョイント削除\n\n\n    var joints = this.joints;\n\n    for (var i = joints.length; i--;) {\n      joints.splice(i, 1);\n    } //スプリングオブジェクト削除\n\n\n    var springs = this.springs;\n\n    for (var i = springs.length; i--;) {\n      springs.splice(i, 1);\n    }\n  };\n\n  ret.RigidBody = _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n\n  var Constraint = function () {\n    //拘束クラス\n    var Constraint = function Constraint() {\n      this.obj1 = null; //接触物体1\n\n      this.obj2 = null; //接触物体2\n\n      this.pos1 = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //接触位置1\n\n      this.pos2 = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //接触位置2\n\n      this.impulse = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //衝撃\n\n      this.axisM = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33();\n      this.axis = []; //接触法線と従法線\n\n      this.axis[0] = new Float32Array(this.axisM.buffer, 0, 3);\n      this.axis[1] = new Float32Array(this.axisM.buffer, 4 * 3, 3);\n      this.axis[2] = new Float32Array(this.axisM.buffer, 4 * 6, 3);\n      this.coeffM = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33(); // impulse = coeffM x a\n\n      this.offset = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //めり込み位置補正用\n    };\n\n    var ret = Constraint;\n\n    ret.prototype.calcDiffVelocity = function (dv) {\n      //二点間の速度差を求める\n      var calcBuf = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n      this.obj1.calcVelocity(dv, this.pos1);\n      this.obj2.calcVelocity(calcBuf, this.pos2);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dv, calcBuf, dv);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n    };\n\n    ret.prototype.addImpulse = function (impulse) {\n      //二点に直線の力を加える\n      var mem = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n      this.obj1.addImpulse(this.pos1, impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(mem, impulse, -1);\n      this.obj2.addImpulse(this.pos2, mem);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n    };\n\n    ret.prototype.addImpulse2 = function (impulse) {\n      //二点に直線の力を加える\n      var mem = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n      this.obj1.addImpulse2(this.pos1, impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(mem, impulse, -1);\n      this.obj2.addImpulse2(this.pos2, mem);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n    };\n\n    ret.prototype.addImpulseR = function (impulse) {\n      //二点に回転の力を加える\n      var mem = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n      this.obj1.addImpulseR(impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(mem, impulse, -1);\n      this.obj2.addImpulseR(mem);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n    };\n\n    var calcEffic = ret.calcEffic = function (v, m, X) {\n      // 制限1軸の場合の係数行列を求める\n      // F=(vX/((MX)X)X\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v, m, X);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(v, X, 1 / _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(v, X));\n    };\n\n    var calcEffic2 = ret.calcEffic2 = function (v1, v2, m, X, Y) {\n      // 制限2軸の場合の係数行列を求める\n      //F = ((vX*MYY-vYMYX)X - (vxMXY-vYMXX)Y) / (MXX*MYY - MXY*MYX) \n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v1, m, X);\n      var mxx = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(v1, X);\n      var mxy = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(v1, Y);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v1, m, Y);\n      var myx = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(v1, X);\n      var myy = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(v1, Y);\n      var denom = 1 / (mxx * myy - mxy * myx);\n      v1[0] = (myy * X[0] - myx * Y[0]) * denom;\n      v1[1] = (myy * X[1] - myx * Y[1]) * denom;\n      v1[2] = (myy * X[2] - myx * Y[2]) * denom;\n      v2[0] = (-mxy * X[0] + mxx * Y[0]) * denom;\n      v2[1] = (-mxy * X[1] + mxx * Y[1]) * denom;\n      v2[2] = (-mxy * X[2] + mxx * Y[2]) * denom;\n    };\n\n    var calcEffic3 = ret.calcEffic3 = function (v1, v2, v3, m, X, Y, Z) {\n      // 制限3軸の場合の係数行列を求める\n      //F = M^-1 v\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.getInv(m, m);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.calcTranspose(m, m);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v1, m, X);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v2, m, Y);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(v3, m, Z);\n    };\n\n    ret.prototype.calcEfficM = function (m) {\n      //接触点に力を加えたときどれだけ加速するかを計算するための行列を求める\n      var mat1 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolAlloc();\n      this.obj1.calcEfficM(mat1, this.pos1);\n      this.obj2.calcEfficM(m, this.pos2);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.add(m, m, mat1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolFree(1);\n    };\n\n    return ret;\n  }();\n\n  var HitConstraint = /*#__PURE__*/function (_Constraint) {\n    _inherits(HitConstraint, _Constraint);\n\n    var _super = _createSuper(HitConstraint);\n\n    //物体の接触拘束\n    function HitConstraint() {\n      var _this;\n\n      _classCallCheck(this, HitConstraint);\n\n      _this = _super.call(this);\n      _this.pos1ex = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //接触相対位置1\n\n      _this.pos2ex = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //接触相対位置2\n\n      _this.impulseR = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //回転摩擦関係\n\n      _this.rM = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33();\n      _this.fricCoe = 0; //2物体間の摩擦係数\n\n      return _this;\n    }\n\n    _createClass(HitConstraint, [{\n      key: \"calcPre\",\n      value: function calcPre() {\n        var obj1 = this.obj1;\n        var obj2 = this.obj2;\n        var dv = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var nM = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolAlloc();\n\n        if (!obj1.fix) {\n          obj1.impFlg = 1;\n        }\n\n        if (!obj2.fix) {\n          obj2.impFlg = 1;\n        } //法線方向と従法線方向\n        //Vec3.sub(this.axis[0],this.pos2,this.pos1);\n\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.norm(this.axis[0]);\n        this.axis[1][0] = this.axis[0][2];\n        this.axis[1][1] = this.axis[0][0];\n        this.axis[1][2] = -this.axis[0][1];\n        this.axis[2][0] = -this.axis[0][1];\n        this.axis[2][1] = this.axis[0][2];\n        this.axis[2][2] = this.axis[0][0]; //for(var i=0;i<3;i++){\n        //\tfor(var j=0;j<3;j++){\n        //\t\tthis.axisM[i*3+j]=this.axis[i][j];\n        //\t}\n        //}\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.add(this.rM, obj1.getInvInertiaTensor(), obj2.getInvInertiaTensor());\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.getInv(this.rM, this.rM); //位置補正\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(this.offset, this.pos2, this.pos1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.nrm(dv, this.offset);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.offset, this.offset, dv, -0.00); //少しだけめりこみを残す\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.offset, this.offset, ERP * 0.1); //めり込み補正係数\n        //2物体間の摩擦係数\n\n        this.fricCoe = obj1.getFriction() * obj2.getFriction(); //反発力\n\n        this.calcDiffVelocity(dv); //速度差\n\n        if (OnoPhy.special) {\n          var rest = obj1.getRestitution() * obj2.getRestitution();\n\n          if (rest !== 0) {\n            rest = 1 / rest;\n          }\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.offset, this.offset, this.axis[0], _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(dv, this.axis[0]) * rest * 0.015);\n        } else {\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.offset, this.offset, this.axis[0], _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(dv, this.axis[0]) * (obj1.getRestitution() * obj2.getRestitution())); //反発分\n        } //加速に必要な力を求めるための行列\n\n\n        this.calcEfficM(nM); //垂直方向\n\n        var coeff = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var coeff2 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        Constraint.calcEffic(coeff, nM, this.axis[0]);\n\n        for (var i = 0; i < 3; i++) {\n          this.coeffM[i * 3] = coeff[i];\n        } //水平方向\n\n\n        Constraint.calcEffic2(coeff, coeff2, nM, this.axis[1], this.axis[2]);\n\n        for (var i = 0; i < 3; i++) {\n          this.coeffM[i * 3 + 1] = coeff[i];\n          this.coeffM[i * 3 + 2] = coeff2[i];\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(2); //次のフレームでの持続判定に使うための相対位置\n\n        obj1.getExPos(this.pos1ex, this.pos1);\n        obj2.getExPos(this.pos2ex, this.pos2);\n        this.counter++;\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolFree(1);\n      }\n    }, {\n      key: \"calcConstraintPre\",\n      value: function calcConstraintPre() {\n        //前処理\n        this.calcPre();\n        var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(impulse, 0, 0, 0);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.axisM, this.impulse);\n        this.addImpulse(impulse);\n        this.addImpulseR(this.impulseR);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n      }\n    }, {\n      key: \"calcConstraint\",\n      value: function calcConstraint() {\n        var dv = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc(); //法線方向\n\n        var o = this.impulse[0]; //前の値\n\n        var old2 = this.impulse[1]; //前の値\n\n        var old3 = this.impulse[2]; //前の値\n\n        this.calcDiffVelocity(dv); //衝突点の速度差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(dv, dv, this.offset); //位置補正分\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.coeffM, dv);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(this.impulse, this.impulse, impulse);\n        this.impulse[0] = MAX(this.impulse[0], 0); //撃力が逆になった場合は無しにする\n\n        this.impulse[0] *= CFM; //やわらか拘束補正\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(impulse, this.axis[0], this.impulse[0] - o);\n        this.addImpulse(impulse); //撃力差分を剛体の速度に反映\n        //従法線方向(摩擦力)\n\n        var max = this.impulse[0] * this.fricCoe; //法線撃力から摩擦最大量を算出\n\n        var maxr = max * 0.01; //法線撃力から最大転がり抵抗を算出\n\n        if (dv[0] * dv[0] + dv[1] * dv[1] + dv[2] * dv[2] > 0.0001) {\n          max *= 0.9; //静止していない場合はちょっと減らす\n        }\n\n        var l = this.impulse[1] * this.impulse[1] + this.impulse[2] * this.impulse[2];\n\n        if (l > max * max) {\n          //摩擦力が最大量を上回る場合は最大量でセーブ\n          l = max / Math.sqrt(l);\n          this.impulse[1] *= l;\n          this.impulse[2] *= l;\n        }\n\n        if (OnoPhy.special) {\n          this.impulse[1] *= -1;\n          this.impulse[2] *= -1;\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(impulse, this.axis[1], this.impulse[1] - old2);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(impulse, impulse, this.axis[2], this.impulse[2] - old3);\n        this.addImpulse(impulse); //差分摩擦力を速度に反映\n        //転がり抵抗\n\n        var old = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(old, this.impulseR);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dv, this.obj2.rotV, this.obj1.rotV);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(dv, dv, this.axis[0], -_vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(dv, this.axis[0])); //摩擦方向の力\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.rM, dv);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(this.impulseR, this.impulseR, impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(impulse, this.impulseR);\n        var l = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(impulse, impulse);\n\n        if (l > maxr * maxr) {\n          //摩擦力が最大量を上回る場合は最大量でセーブ\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.impulseR, this.impulseR, impulse, maxr / Math.sqrt(l) - 1);\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.impulseR, this.impulseR, CFM);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(impulse, this.impulseR, old);\n        this.addImpulseR(impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(3);\n      }\n    }]);\n\n    return HitConstraint;\n  }(Constraint);\n\n  ;\n  var disableHitConstraints = [];\n\n  for (var i = 0; i < 1024; i++) {\n    disableHitConstraints.push(new HitConstraint());\n  }\n\n  var fv = [];\n\n  for (var i = 0; i < 3; i++) {\n    fv.push(new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3());\n  }\n\n  var a = new Array(3);\n  var b = new Array(3);\n\n  var LinConstraint = /*#__PURE__*/function (_Constraint2) {\n    _inherits(LinConstraint, _Constraint2);\n\n    var _super2 = _createSuper(LinConstraint);\n\n    //並進速度拘束\n    function LinConstraint() {\n      var _this2;\n\n      _classCallCheck(this, LinConstraint);\n\n      _this2 = _super2.call(this);\n      _this2.lim = new Array(3);\n      _this2.motorMax = 0; //モーター最大力\n\n      _this2.bane = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      return _this2;\n    }\n\n    _createClass(LinConstraint, [{\n      key: \"calcPre\",\n      value: function calcPre() {\n        var m = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolAlloc();\n        this.calcEfficM(m);\n        this.calcCoeffM(m);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolFree(1);\n        return;\n      }\n    }, {\n      key: \"calcConstraintPre\",\n      value: function calcConstraintPre() {\n        this.calcPre(); //ウォームスタート\n\n        var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.axisM, this.impulse);\n        this.addImpulse(impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n      }\n    }, {\n      key: \"calcConstraint\",\n      value: function calcConstraint() {\n        var old = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(old, this.impulse); //現在の拘束力保存\n\n        this.calcDiffVelocity(impulse); //速度差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(impulse, impulse, this.offset); //位置差(めり込み)補正分追加\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.coeffM, impulse); //速度差位置差0にするための力算出\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(this.impulse, this.impulse, impulse); //合計の力に加える\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.impulse, this.impulse, CFM); //やわらか拘束補正\n\n        for (var i = 0; i < OnoPhy.DIMENSION; i++) {\n          //与える力の制限\n          if (this.motorMax !== 0 && i === 0) {\n            //モーター最大力積を超えないようにする\n            this.impulse[i] = MAX(this.impulse[i], this.motorMax);\n          } else {\n            //片方のみ制限の場合は逆方向の力は加えない\n            if (!this.lim[i]) {\n              this.impulse[i] = MAX(this.impulse[i], 0);\n            }\n          }\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(impulse, this.impulse, old); //前回との力の差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.axisM, impulse); //力を向きをワールド座標に変換\n\n        this.addImpulse(impulse); //オブジェクトに力を加える\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(2);\n      }\n    }, {\n      key: \"calcCoeffM\",\n      value: function calcCoeffM(m) {\n        var idx = 0;\n\n        for (var i = 0; i < OnoPhy.DIMENSION; i++) {\n          if (_vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.scalar(this.axis[i])) {\n            a[idx] = this.axis[i];\n            b[idx] = fv[i];\n            idx++;\n          } else {\n            fv[i].fill(0);\n          }\n        }\n\n        if (idx == 1) {\n          Constraint.calcEffic(b[0], m, a[0]);\n        } else if (idx == 2) {\n          Constraint.calcEffic2(b[0], b[1], m, a[0], a[1]);\n        } else if (idx == 3) {\n          Constraint.calcEffic3(b[0], b[1], b[2], m, a[0], a[1], a[2]);\n        }\n\n        for (var i = 0; i < OnoPhy.DIMENSION; i++) {\n          this.coeffM[i] = fv[i][0];\n          this.coeffM[i + 3] = fv[i][1];\n          this.coeffM[i + 6] = fv[i][2];\n        }\n      }\n    }]);\n\n    return LinConstraint;\n  }(Constraint);\n\n  ;\n  var vec = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n  var m = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33();\n  var impulse = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n\n  var AngConstraint = /*#__PURE__*/function (_LinConstraint) {\n    _inherits(AngConstraint, _LinConstraint);\n\n    var _super3 = _createSuper(AngConstraint);\n\n    //回転速度拘束\n    function AngConstraint() {\n      _classCallCheck(this, AngConstraint);\n\n      return _super3.call(this);\n    }\n\n    _createClass(AngConstraint, [{\n      key: \"calcPre\",\n      value: function calcPre() {\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.add(m, this.obj1.inv_inertiaTensor, this.obj2.inv_inertiaTensor);\n        this.calcCoeffM(m);\n        return;\n      }\n    }, {\n      key: \"calcConstraintPre\",\n      value: function calcConstraintPre() {\n        this.calcPre();\n        var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(impulse, this.axisM, this.impulse);\n        this.addImpulseR(impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(1);\n      }\n    }, {\n      key: \"calcConstraint\",\n      value: function calcConstraint() {\n        var old = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var imp = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(old, this.impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(imp, this.obj2.rotV, this.obj1.rotV); //回転速度差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(imp, imp, this.offset); //補正\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(imp, this.coeffM, imp);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(this.impulse, this.impulse, imp);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.impulse, this.impulse, CFM);\n\n        for (var i = 0; i < OnoPhy.DIMENSION; i++) {\n          //与える力の制限\n          var a = this.impulse[i];\n\n          if (this.motorMax !== 0 && i === 0) {\n            //モーター最大力積を超えないようにする\n            if (a > this.motorMax) {\n              this.impulse[i] = this.motorMax;\n            }\n\n            if (a < -this.motorMax) {\n              this.impulse[i] = -this.motorMax;\n            }\n          } else {\n            //逆方向の力は加えない\n            if (a < 0) {\n              this.impulse[i] = 0;\n            }\n          }\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(imp, this.impulse, old);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dotVec3(imp, this.axisM, imp);\n        this.addImpulseR(imp);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(2);\n      }\n    }]);\n\n    return AngConstraint;\n  }(LinConstraint);\n\n  ;\n\n  var Joint = /*#__PURE__*/function () {\n    function Joint() {\n      _classCallCheck(this, Joint);\n\n      this.use_breaking = 0;\n      this.breaking_threshold = 0.0; //これ以上力が加わるとジョイントがなくなる(未実装)\n\n      this.disable_collisions = false; //ジョイントされたオブジェクト同士の衝突可否\n\n      this.enabled = false; //有効無効\n\n      this.object1 = null; //被ジョイントオブジェクト\n\n      this.object2 = null;\n      this.matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43(); //ジョイントとオブジェクトとのオフセット行列\n\n      this.matrix2 = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43(); //位置制限\n\n      this.use_limit_lin = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.limit_lin_lower = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.limit_lin_upper = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.use_spring = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.spring_damping = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //バネダンパ\n\n      this.spring_stiffness = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //バネ力\n\n      this.use_motor_lin = 0;\n      this.motor_lin_max_impulse = 1; //直線モーター力上限\n\n      this.motor_lin_target_velocity = 1; //モーター速度\n      //角度制限\n\n      this.use_limit_ang = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.limit_ang_lower = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //角度制限\n\n      this.limit_ang_upper = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.use_spring_ang = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.spring_damping_ang = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3(); //角度バネダンパ\n\n      this.spring_stiffness_ang = new _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3();\n      this.use_motor_ang = 0;\n      this.motor_ang_max_impulse = 1; //角度モーター力上限\n\n      this.motor_ang_target_velocity = 1; //モーター角速度\n      //拘束オブジェクト\n\n      this.linConstraint = new LinConstraint();\n      this.angConstraint = new AngConstraint();\n    }\n\n    _createClass(Joint, [{\n      key: \"setConstraint\",\n      value: function setConstraint() {\n        var vec = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var dp = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var dv = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n        var trueq = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.poolAlloc();\n        var quat = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.poolAlloc();\n        var rotmat = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolAlloc();\n        var bM = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.poolAlloc();\n        var bM2 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.poolAlloc();\n        var axis;\n        var object1 = this.object1;\n        var object2 = this.object2; //ジョイント位置\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.dot(bM, this.object1.matrix, this.matrix);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.dot(bM2, this.object2.matrix, this.matrix2);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(this.linConstraint.pos1, bM[9], bM[10], bM[11]);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(this.linConstraint.pos2, bM2[9], bM2[10], bM2[11]); //ジョイント角度\n\n        for (var i = 0; i < 3; i++) {\n          var j = i * 3;\n          var l = 1 / Math.sqrt(bM[j] * bM[j] + bM[j + 1] * bM[j + 1] + bM[j + 2] * bM[j + 2]);\n          bM[i * 3] = bM[j] * l;\n          bM[i * 3 + 1] = bM[j + 1] * l;\n          bM[i * 3 + 2] = bM[j + 2] * l;\n          l = 1 / Math.sqrt(bM2[j] * bM2[j] + bM2[j + 1] * bM2[j + 1] + bM2[j + 2] * bM2[j + 2]);\n          bM2[i * 3] = bM2[j] * l;\n          bM2[i * 3 + 1] = bM2[j + 1] * l;\n          bM2[i * 3 + 2] = bM2[j + 2] * l;\n        }\n\n        if (this.parent === this.object1) {//Mat33.copy(rotmat,bM);\n          //Mat33.copy(bM,bM2);\n          //Mat33.copy(bM2,rotmat);\n        } else {//\t\t\t\tVec4.toMat33(obj1m,bM2);\n          //\t\t\t\tMat33.copy(obj2m,bM);\n        }\n\n        this.linConstraint.obj1 = object1;\n        this.linConstraint.obj2 = object2;\n        this.angConstraint.obj1 = object1;\n        this.angConstraint.obj2 = object2; //差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dp, this.linConstraint.pos2, this.linConstraint.pos1); //位置差\n\n        this.linConstraint.calcDiffVelocity(dv); //速度差\n        //位置制限\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(this.linConstraint.offset, 0, 0, 0);\n\n        for (var i = 0; i < OnoPhy.DIMENSION; i++) {\n          //軸\n          axis = this.linConstraint.axis[i];\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(axis, bM[i * 3], bM[i * 3 + 1], bM[i * 3 + 2]); //ばね\n\n          if (this.use_spring[i]) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(vec, axis, DT * _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(axis, dp) * this.spring_stiffness[i]);\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(vec, vec, axis, DT * _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(axis, dv) * this.spring_damping[i]);\n            this.linConstraint.addImpulse2(vec);\n          }\n\n          if (this.use_limit_lin[i]) {\n            //位置差\n            var l = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(axis, dp); //制限範囲を超えている場合\n\n            if (l < this.limit_lin_lower[i]) {\n              l = this.limit_lin_lower[i] - l;\n              _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, -1);\n            } else if (l > this.limit_lin_upper[i]) {\n              l = l - this.limit_lin_upper[i];\n            } else {\n              _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, 0);\n            }\n\n            if (this.limit_lin_lower[i] == this.limit_lin_upper[i]) {\n              //両制限の場合フラグを立てる\n              this.linConstraint.lim[i] = 1;\n            } else {\n              this.linConstraint.lim[i] = 0;\n            }\n\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.linConstraint.offset, this.linConstraint.offset, axis, l); //本来の位置\n          } else {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, 0);\n          }\n\n          if (this.use_motor_lin && i === 0) {\n            this.linConstraint.motorMax = this.motor_lin_max_impulse;\n          }\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.linConstraint.offset, this.linConstraint.offset, ERP);\n\n        if (this.use_motor_lin) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.linConstraint.offset, this.linConstraint.offset, this.linConstraint.axis[0], this.motor_lin_target_velocity); //モータ影響\n        } //角度制限\n\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.getInv(rotmat, bM);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.dot(rotmat, rotmat, bM2); //差分回転行列\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.getEuler(dp, rotmat); //オイラー角に変換\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dv, this.object2.rotV, this.object1.rotV); //回転速度差\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.set(trueq, 1, 0, 0, 0);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(this.angConstraint.bane, 0, 0, 0);\n\n        for (var ii = 0; ii < OnoPhy.DIMENSION; ii++) {\n          var i = ii; //if(ii==1)i=2;\n          //if(ii==2)i=1;\n\n          axis = this.angConstraint.axis[i]; //軸の向き\n\n          if (i === 0) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(axis, bM2[0], bM2[1], bM2[2]);\n          } else if (i === 2) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(axis, bM[3], bM[4], bM[5]);\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(vec, bM2[0], bM2[1], bM2[2]);\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.cross(axis, vec, axis);\n          } else if (i === 1) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(axis, bM[3], bM[4], bM[5]); //Vec3.set(vec,bM2[0],bM2[1],bM2[2]);\n            //Vec3.cross(axis,vec,axis);\n            //Vec3.cross(axis,axis,vec);\n          }\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.norm(axis); //Vec3.mul(axis,axis,-1);\n          //角度\n\n          var d = dp[i];\n\n          if (this.use_spring_ang[i]) {\n            //ばね\n            var vv = this.angConstraint.bane;\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(vv, vv, axis, d * this.spring_stiffness_ang[i] * DT); //角度差\n\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(vv, vv, axis, _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(dv, axis) * this.spring_damping_ang[i] * DT); //this.angConstraint.addImpulseR(vec);\n          }\n\n          if (this.use_limit_ang[i]) {\n            //制限範囲を超えている場合\n            if (d < this.limit_ang_lower[i]) {\n              d = this.limit_ang_lower[i] - d;\n              _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, -1);\n            } else if (d > this.limit_ang_upper[i]) {\n              d = d - this.limit_ang_upper[i];\n            } else {\n              _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, 0);\n            }\n\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.fromRotVector(quat, d, axis[0], axis[1], axis[2]);\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.qdot(trueq, trueq, quat);\n          } else {\n            _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(axis, axis, 0);\n          }\n\n          if (this.use_motor_ang && i === 0) {\n            //回転モーター\n            this.angConstraint.motorMax = this.motor_ang_max_impulse;\n          }\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.toTorque(this.angConstraint.offset, trueq); //クォータニオンから回転ベクトルを求める\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.mul(this.angConstraint.offset, this.angConstraint.offset, ERP);\n\n        if (this.use_motor_ang) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(this.angConstraint.offset, this.angConstraint.offset, this.angConstraint.axis[0], this.motor_ang_target_velocity); //モータ影響\n        }\n\n        if (!object1.fix) {\n          object1.impFlg = true;\n        }\n\n        if (!object2.fix) {\n          object2.impFlg = true;\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(3);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec4.poolFree(2);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat33.poolFree(1);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.poolFree(2);\n      }\n    }, {\n      key: \"calcConstraintPre\",\n      value: function calcConstraintPre() {\n        this.linConstraint.calcConstraintPre();\n        this.angConstraint.calcConstraintPre();\n      }\n    }, {\n      key: \"calcConstraint\",\n      value: function calcConstraint() {\n        this.linConstraint.calcConstraint();\n        this.angConstraint.calcConstraint();\n      }\n    }, {\n      key: \"bane\",\n      value: function bane() {\n        this.angConstraint.addImpulseR(this.angConstraint.bane);\n      }\n    }]);\n\n    return Joint;\n  }();\n\n  ;\n  ret.Joint = Joint;\n\n  ret.prototype.createRigidBody = function () {\n    var phyobj = new _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n    phyobj.parent = this;\n    this.rigidBodies.push(phyobj);\n    return phyobj;\n  };\n\n  ret.prototype.addPhyObj = function (phyObj) {\n    phyObj.onophy = this;\n\n    if (phyObj.type === OnoPhy.RIGID) {\n      this.rigidBodies.push(phyObj);\n      this.collider.addCollision(phyObj.collision);\n    } else {\n      this.clothes.push(phyObj);\n    }\n  };\n\n  ret.prototype.deleteRigidBody = function (object) {\n    //オブジェクト削除\n    var rigidBodies = this.rigidBodies;\n\n    for (var i = rigidBodies.length; i--;) {\n      if (rigidBodies[i] === object) {\n        //コリジョンを削除\n        if (object.collision) {\n          this.deleteCollision(object.collision);\n        }\n\n        rigidBodies.splice(i, 1);\n        break;\n      }\n    }\n  };\n\n  ret.prototype.createJoint = function () {\n    var joint = new Joint();\n    this.joints.push(joint);\n    return joint;\n  };\n\n  ret.prototype.addJoint = function (joint) {\n    this.joints.push(joint);\n  };\n\n  ret.prototype.deleteJoint = function (joint) {\n    //ジョイント削除\n    var joints = this.joints;\n\n    for (var i = joints.length; i--;) {\n      if (joints[i] === joint) {\n        joints.splice(i, 1);\n        break;\n      }\n    }\n  };\n\n  ret.prototype.add = function (obj) {\n    switch (obj.constructor) {\n      case _spring_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]:\n        this.springs.push(obj);\n        break;\n    }\n  };\n\n  ret.prototype.remove = function (obj) {\n    switch (obj.constructor) {\n      case _spring_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]:\n        this.springs.forEach(function (obj2, idx, arr) {\n          if (obj2 === obj) {\n            arr.splice(idx, 1);\n            return false;\n          }\n        });\n        break;\n    }\n  };\n\n  ret.prototype.createSpring = function () {\n    //スプリングオブジェクト作成\n    var res = new _spring_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\n    this.springs.push(res);\n    return res;\n  };\n\n  ret.prototype.deleteSpring = function (obj) {\n    //スプリングオブジェクト削除\n    var springs = this.springs;\n\n    for (var i = 0; i < springs.length; i++) {\n      if (springs[i] === obj) {\n        springs.splice(i, 1);\n        break;\n      }\n    }\n  };\n\n  ret.prototype.removeHitConstraint = function (i) {\n    //削除\n    var hitConstraint = this.hitConstraints[i];\n    this.hitConstraints.splice(i, 1);\n\n    if (hitConstraint.obj1.type === OnoPhy.FACE) {\n      _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].disablePhyFace.push(hitConstraint.obj1);\n    }\n\n    if (hitConstraint.obj2.type === OnoPhy.FACE) {\n      _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].disablePhyFace.push(hitConstraint.obj2);\n    }\n\n    disableHitConstraints.push(hitConstraint);\n  };\n\n  ret.prototype.readjustHitConstraint = function (target) {\n    var obj1 = target.obj1;\n    var obj2 = target.obj2;\n    var pos1 = target.pos1;\n    var pos2 = target.pos2;\n    var hitConstraint;\n    var hitConstraints = this.hitConstraints; //座標が近いやつはまとめる\n\n    for (var i = hitConstraints.length; i--;) {\n      hitConstraint = hitConstraints[i];\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.len2(hitConstraint.pos1, pos1) < 0.01 && _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.len2(hitConstraint.pos2, pos2) < 0.01) {\n        if (hitConstraint === target) {\n          continue;\n        } //力をまとめる\n\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(target.impulse, target.impulse, hitConstraint.impulse);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(target.impulseR, target.impulseR, hitConstraint.impulseR); //削除\n\n        this.removeHitConstraint(i);\n      }\n    }\n\n    if (!(obj1.type === OnoPhy.RIGID && obj2.type === OnoPhy.RIGID)) {\n      return;\n    } //同一の組み合わせが一定以上の場合は古いやつから消して一定数以下にする\n\n\n    var count = 0;\n    var max = 8;\n\n    for (var i = hitConstraints.length; i--;) {\n      hitConstraint = hitConstraints[i];\n\n      if (hitConstraint.obj1 !== obj1 || hitConstraint.obj2 !== obj2) {\n        continue;\n      }\n\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.dot(hitConstraint.axis[0], target.axis[0]) < 0) {\n        //めり込み方向が反対の場合は削除\n        this.removeHitConstraint(i);\n        continue;\n      }\n\n      count++;\n\n      if (count > max) {\n        //一定数以上なので削除\n        this.removeHitConstraint(i);\n      }\n    }\n  };\n\n  ret.prototype.registHitConstraint = function () {\n    return function (obj1, pos1, obj2, pos2, hitConstraint) {\n      if (_vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.len2(pos1, pos2) === 0) {\n        //例外\n        return null;\n      }\n\n      if (!hitConstraint) {\n        //新しく取得する場合\n        hitConstraint = disableHitConstraints.pop();\n        this.hitConstraints.push(hitConstraint);\n        hitConstraint.obj1 = obj1;\n        hitConstraint.obj2 = obj2;\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(hitConstraint.impulse, 0, 0, 0);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.set(hitConstraint.impulseR, 0, 0, 0);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(hitConstraint.pos1, pos1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(hitConstraint.pos2, pos2);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(hitConstraint.axis[0], pos2, pos1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.norm(hitConstraint.axis[0]);\n      hitConstraint.counter = 0;\n      return hitConstraint;\n    };\n  }();\n  /** dt秒シミュレーションを進める **/\n\n\n  ret.prototype.calc = function (dt) {\n    this.DT = dt;\n    DT = dt; //ステップ時間をグローバルに格納\n\n    this.dt = dt;\n    var rigidBodies = this.rigidBodies; //剛体配列\n\n    var dv = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n\n    for (i = this.rigidBodies.length; i--;) {\n      //判定用行列更新\n      this.rigidBodies[i].calcPre();\n    }\n\n    var idx = 0;\n\n    for (var i = 0; i < this.joints.length; i++) {\n      //コリジョン無効リスト作成\n      if (this.joints[i].disable_collisions) {\n        //ジョイント接続されたもの同士の接触無効\n        this.disableList[idx] = _collider_collider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getPairId(this.joints[i].object1.collision.id, this.joints[i].object2.collision.id);\n        idx++;\n      }\n    }\n\n    this.disableList[idx] = -1; //すべてのコリジョンの衝突判定\n\n    this.collider.All(this.disableList, idx);\n    var hitList = this.collider.hitList;\n\n    for (var i = 0; hitList[i].col1; i++) {\n      //接触拘束作成\n      var hit = hitList[i]; //if(!hit.col1.parent.moveflg && !hit.col2.parent.moveflg){\n      //\tcontinue;\n      //}\n\n      if (hit.col1.parent && hit.col2.parent) {\n        var hitConstraint = this.registHitConstraint(hit.col1.parent, hit.pos1, hit.col2.parent, hit.pos2);\n\n        if (hitConstraint) {\n          this.readjustHitConstraint(hitConstraint);\n        }\n      }\n    }\n\n    for (var i = 0; i < this.joints.length; i++) {\n      //ジョイント拘束セット+ばね\n      this.joints[i].setConstraint();\n    }\n\n    for (i = this.springs.length; i--;) {\n      //バネ処理\n      this.springs[i].calc(dt);\n    }\n\n    for (var i = 0; i < this.joints.length; i++) {\n      //バネ処理\n      this.joints[i].bane();\n    }\n\n    for (i = this.clothes.length; i--;) {\n      //クロス処理\n      this.clothes[i].calcPre(this);\n    }\n\n    for (var i = 0; i < this.clothes.length; i++) {\n      for (var j = i + 1; j < this.clothes.length; j++) {//クロス同士の接触処理\n        //\tthis.clothes[i].calcCollision(this.clothes[j],this);\n      }\n    } //衝突情報の持続判定\n\n\n    var ans1 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n    var ans2 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n    var ans4 = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n    var t = _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolAlloc();\n\n    for (var i = 0; i < this.hitConstraints.length; i++) {\n      var hitConstraint = this.hitConstraints[i];\n      var obj1 = hitConstraint.obj1;\n      var obj2 = hitConstraint.obj2; //if(!obj1.moveflg && !obj2.moveflg){\n      //\tcontinue;\n      //}\n\n      if (hitConstraint.counter === 0) {\n        //接触1フレーム目は無視\n        continue;\n      }\n\n      if (obj1.type !== OnoPhy.RIGID || obj2.type !== OnoPhy.RIGID) {\n        if (obj1.type === OnoPhy.FACE) {\n          _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].disablePhyFace.push(hitConstraint.obj1);\n        }\n\n        if (obj2.type === OnoPhy.FACE) {\n          _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].disablePhyFace.push(hitConstraint.obj2);\n        }\n\n        this.hitConstraints.splice(i, 1);\n        disableHitConstraints.push(hitConstraint);\n        i--;\n        continue;\n      } //前回の衝突点の現在位置を求めてめり込み具合を調べる\n\n\n      var l, l2;\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.dotVec3(ans1, obj1.matrix, hitConstraint.pos1ex);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(t, ans1, hitConstraint.axis[0]);\n      l = obj2.collision.rayCast(ans1, t);\n\n      if (l === _collider_collider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].INVALID) {\n        l = 999;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(ans2, ans1, hitConstraint.axis[0], -l);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Mat43.dotVec3(ans4, obj2.matrix, hitConstraint.pos2ex);\n      _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.add(t, ans4, hitConstraint.axis[0]);\n      l2 = obj1.collision.rayCast(ans4, t);\n\n      if (l2 === _collider_collider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].INVALID) {\n        l2 = 999;\n      }\n\n      if (l2 < l) {\n        //めり込みが大きい方を採用\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(ans2, ans4);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.madd(ans1, ans2, hitConstraint.axis[0], l2);\n        l = l2;\n      }\n\n      if (l >= 0) {\n        //めり込んでいない場合は削除\n        this.hitConstraints.splice(i, 1);\n        disableHitConstraints.push(hitConstraint);\n        i--;\n      } else {\n        //持続処理\n        this.registHitConstraint(obj1, ans1, obj2, ans2, hitConstraint);\n      }\n    }\n\n    for (i = this.rigidBodies.length; i--;) {\n      //重力\n      var obj = rigidBodies[i];\n      if (obj.fix) continue;\n      obj.v[1] += -this.GRAVITY * dt;\n    } //繰り返しソルバ\n\n\n    performance.mark(\"impulseStart\");\n    var repetition;\n    var constraints = []; //拘束を一つの配列にまとめる\n\n    Array.prototype.push.apply(constraints, this.hitConstraints);\n    Array.prototype.push.apply(constraints, this.joints);\n    var clothes = this.clothes; //Array.prototype.push.apply(constraints,this.clothes);\n\n    for (var i = 0; i < constraints.length; i++) {\n      //ウォームスタート処理\n      constraints[i].calcConstraintPre();\n    }\n\n    for (repetition = 0; repetition < REPETITION_MAX; repetition++) {\n      //繰り返し最大数まで繰り返して撃力を収束させる\n      var impnum = 0;\n\n      for (i = rigidBodies.length; i--;) {\n        //現在の速度を保存\n        var o = rigidBodies[i];\n\n        if (!o.impFlg) {\n          continue;\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(o.oldv, o.v);\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.copy(o.oldrotV, o.rotV);\n        impnum++;\n      }\n\n      for (var i = 0; i < constraints.length; i++) {\n        constraints[i].calcConstraint();\n      } //収束チェック\n\n\n      var sum = 0;\n\n      for (i = rigidBodies.length; i--;) {\n        var o = rigidBodies[i];\n\n        if (!o.impFlg) {\n          continue;\n        }\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dv, o.oldv, o.v);\n        sum += dv[0] * dv[0] + dv[1] * dv[1] + dv[2] * dv[2];\n        _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.sub(dv, o.oldrotV, o.rotV);\n        sum += dv[0] * dv[0] + dv[1] * dv[1] + dv[2] * dv[2];\n      }\n\n      if (sum <= 0.000001 * impnum && repetition > 1) {\n        break;\n      }\n    }\n\n    for (var i = 0; i < clothes.length; i++) {\n      //ウォームスタート処理\n      clothes[i].calcConstraintPre();\n    }\n\n    for (var j = 0; j < 4; j++) {\n      for (var i = 0; i < clothes.length; i++) {\n        clothes[i].calcConstraint();\n      }\n    }\n\n    this.repetition = repetition;\n    performance.mark(\"impulseEnd\"); //this.LINDAMP = Math.pow(1.0-0.4,dt);\n\n    this.LINDAMP = Math.pow(1.0 - 0.3, dt);\n    this.ANGDAMP = Math.pow(1.0 - 0.3, dt);\n\n    if (OnoPhy.special) {\n      this.LINDAMP = 1 / this.LINDAMP;\n      this.ANGDAMP = 1 / this.ANGDAMP;\n    }\n\n    for (i = rigidBodies.length; i--;) {\n      rigidBodies[i].update(dt);\n    }\n\n    for (i = this.clothes.length; i--;) {\n      this.clothes[i].update(dt);\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_7__.Vec3.poolFree(5);\n    return;\n  };\n\n  return ret;\n}();\n\nvar i = 0;\nOnoPhy.RIGID = i++; //剛体\n\nOnoPhy.CLOTH = i++; //布およびソフトボディ（バネメッシュ）\n\nOnoPhy.FACE = i++; //メッシュのうちの1フェイス\n\nOnoPhy.Spring_MESH = i++; //バネメッシュ\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (OnoPhy);\nvar disablePhyFace = _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].disablePhyFace = []; //接触時のダミー板\n\nfor (i = 0; i < 1024; i++) {\n  disablePhyFace.push(new _phyface_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]());\n}\n\nOnoPhy.DIMENSION = 3; //次元\n\nOnoPhy.Cloth = _cloth_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"];\nOnoPhy.SoftBody = _softbody_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]; //export Spring;\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/onophy.js?");

/***/ }),

/***/ "../lib/lib/onophy/phyface.js":
/*!************************************!*\
  !*** ../lib/lib/onophy/phyface.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PhyFace; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _phyobj_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phyobj.js */ \"../lib/lib/onophy/phyobj.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/lib/onophy/rigidbody.js\");\n/* harmony import */ var _onophy_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./onophy.js */ \"../lib/lib/onophy/onophy.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\nvar MIN = Math.min;\nvar MAX = Math.max;\n\nvar PhyFace = /*#__PURE__*/function (_PhyObj) {\n  _inherits(PhyFace, _PhyObj);\n\n  var _super = _createSuper(PhyFace);\n\n  function PhyFace() {\n    var _this;\n\n    _classCallCheck(this, PhyFace);\n\n    _this = _super.call(this);\n    _this.p = new Array(3); //new Vec3();\n\n    _this.face = null;\n    _this.bold = 0;\n    _this.cloth = null;\n    _this.ratio = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    _this.type = _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].FACE;\n    return _this;\n  }\n\n  _createClass(PhyFace, [{\n    key: \"calcVelocity\",\n    value: function calcVelocity(dv) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(dv, this.p[0].v, this.ratio[0]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(dv, dv, this.p[1].v, this.ratio[1]);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(dv, dv, this.p[2].v, this.ratio[2]);\n    }\n  }, {\n    key: \"addImpulse\",\n    value: function addImpulse(pos, impulse) {\n      for (var i = 0; i < _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].DIMENSION; i++) {\n        if (!this.p[i].fix) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.p[i].v, this.p[i].v, impulse, this.ratio[i] * this.cloth.inv_pointMass);\n        }\n      }\n    }\n  }, {\n    key: \"addImpulse2\",\n    value: function addImpulse2(pos, impulse) {\n      for (var i = 0; i < _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].DIMENSION; i++) {\n        if (!this.p[i].fix) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.p[i].v, this.p[i].v, impulse, this.ratio[i] * this.cloth.inv_pointMass);\n        }\n      }\n    }\n  }, {\n    key: \"calcEfficM\",\n    value: function calcEfficM(m) {\n      var r = 0;\n\n      for (var i = 0; i < _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].DIMENSION; i++) {\n        if (!this.p[i].fix) {\n          r += this.ratio[i] * this.ratio[i];\n        }\n      }\n\n      r *= this.cloth.inv_pointMass;\n      m[0] = m[4] = m[8] = r;\n      m[1] = m[2] = m[3] = m[5] = m[6] = m[7] = 0;\n    }\n  }, {\n    key: \"getFriction\",\n    value: function getFriction() {\n      return this.cloth.friction;\n    }\n  }, {\n    key: \"getRestitution\",\n    value: function getRestitution() {\n      return this.cloth.restitution;\n    }\n  }, {\n    key: \"getInvInertiaTensor\",\n    value: function getInvInertiaTensor() {\n      return _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.ZERO;\n    }\n  }, {\n    key: \"getExPos\",\n    value: function getExPos(a, b) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(a, this.ratio);\n    }\n  }]);\n\n  return PhyFace;\n}(_phyobj_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/phyface.js?");

/***/ }),

/***/ "../lib/lib/onophy/phyobj.js":
/*!***********************************!*\
  !*** ../lib/lib/onophy/phyobj.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PhyObj; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\nvar PhyObj = /*#__PURE__*/function () {\n  //物理オブジェクト\n  function PhyObj() {\n    _classCallCheck(this, PhyObj);\n\n    this.rotV = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //回転速度\n\n    this.oldrotV = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //角運動量(古い)\n\n    this.type = 0;\n    this.impFlg = false;\n    this.points = [];\n  }\n\n  _createClass(PhyObj, [{\n    key: \"addImpulse\",\n    value: function addImpulse() {}\n  }, {\n    key: \"addImpulseR\",\n    value: function addImpulseR() {}\n  }]);\n\n  return PhyObj;\n}();\n\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/phyobj.js?");

/***/ }),

/***/ "../lib/lib/onophy/rigidbody.js":
/*!**************************************!*\
  !*** ../lib/lib/onophy/rigidbody.js ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ RigidBody; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _phyobj_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phyobj.js */ \"../lib/lib/onophy/phyobj.js\");\n/* harmony import */ var _onophy_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../collider/collider.js */ \"../lib/lib/collider/collider.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\nvar MIN = Math.min;\nvar MAX = Math.max;\n\nvar RigidBody = /*#__PURE__*/function (_PhyObj) {\n  _inherits(RigidBody, _PhyObj);\n\n  var _super = _createSuper(RigidBody);\n\n  //剛体オブジェクト\n  function RigidBody() {\n    var _this;\n\n    _classCallCheck(this, RigidBody);\n\n    _this = _super.call(this); //物理オブジェクト\n\n    _this.name; //オブジェクト名称\n\n    _this.type = _onophy_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].RIGID;\n    _this.fix = 1; //1固定 0挙動計算対象\n\n    _this.moveflg = 1;\n    _this.matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43(); //オブジェクトの姿勢等\n\n    _this.inv_matrix = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43(); //逆行列\n\n    _this.collision = null; //コリジョン\n\n    _this.collisionSize = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //コリジョンの大きさ\n\n    _this.mass = 1.0; //質量\n\n    _this.inv_mass = 0; //質量の逆数\n\n    _this.COMBase = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //初期姿勢での重心\n\n    _this.COM = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //重心\n\n    _this.inertiaTensorBase = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33(); //初期姿勢での慣性テンソル\n\n    _this.inertiaTensor = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33(); //慣性テンソル\n\n    _this.inv_inertiaTensor = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33(); //慣性テンソルの逆行列\n\n    _this.friction = 0.2; //摩擦力(動摩擦力)\n\n    _this.restitution = 0; //反発係数\n\n    _this.location = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //位置\n\n    _this.scale = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //スケール\n\n    _this.rotq = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4(); //回転状態(クォータニオン)\n\n    _this.v = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //速度\n\n    _this.oldv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //計算前の速度\n\n    return _this;\n  }\n\n  _createClass(RigidBody, [{\n    key: \"calcPre\",\n    value: function calcPre() {\n      //ステップ前処理\n      var rotL = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolAlloc();\n      var m = this.matrix; //位置サイズクォータニオンから行列と逆行列をつくる\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.fromLSR(m, this.location, this.scale, this.rotq); //慣性テンソルと角速度から前ステップの角運動量を求める\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(rotL, this.inertiaTensor, this.rotV); //現在の傾きと直交慣性モーメントから慣性テンソルを求める\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.toMat33(r, this.rotq);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dot(this.inertiaTensor, r, this.inertiaTensorBase);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.getInv(r, r);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dot(this.inertiaTensor, this.inertiaTensor, r);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.getInv(this.inv_inertiaTensor, this.inertiaTensor); //前ステップの角運動量から角速度を求める\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(this.rotV, this.inv_inertiaTensor, rotL); //重心位置\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.rotVec3(this.COM, this.rotq, this.COMBase);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.COM, this.COM, this.location);\n      this.refreshCollision();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolFree(1);\n    }\n  }, {\n    key: \"refreshInertia\",\n    value: function refreshInertia() {\n      //剛体の細かいパラメータを計算する\n      if (!this.collision) {\n        return;\n      }\n\n      var type = this.collision.type;\n      var obj = this.parent.object;\n      var sx = obj.bound_box[3] * obj.scale[0];\n      var sy = obj.bound_box[4] * obj.scale[1];\n      var sz = obj.bound_box[5] * obj.scale[2]; //慣性テンソルベースの計算\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.mul(this.inertiaTensorBase, this.inertiaTensorBase, 0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.COMBase, 0, 0, 0);\n\n      switch (type) {\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CAPSULE:\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CYLINDER:\n          var a = MAX(sx, sz);\n          var l = sy * 2;\n          var xz = a * a / 4.0 + l * l / 12.0;\n          this.inertiaTensorBase[0] = xz;\n          this.inertiaTensorBase[4] = 1 / 2 * a * a;\n          this.inertiaTensorBase[8] = xz;\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CUBOID:\n          this.inertiaTensorBase[0] = 1 / 3 * (sy * sy + sz * sz);\n          this.inertiaTensorBase[4] = 1 / 3 * (sx * sx + sz * sz);\n          this.inertiaTensorBase[8] = 1 / 3 * (sx * sx + sy * sy);\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CONE:\n          var r = MAX(sx, sy);\n          var xy = 3 / 80 * (4.0 * r * r + 4 * sz * sz);\n          var z = 3 / 10 * r * r;\n          this.inertiaTensorBase[0] = xy;\n          this.inertiaTensorBase[4] = xy;\n          this.inertiaTensorBase[8] = z;\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.COMBase, 0, 0, -sz * 0.5);\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CONVEX_HULL:\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].MESH:\n          var faces = this.mesh.faces;\n          var vertices = this.mesh.vertices;\n          var S = 0; //総体積\n\n          var PS = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc(); //体積*重心\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(PS, 0, 0, 0);\n          var p = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc(); //部分の重心\n\n          var p1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc(); //四面体の頂点(４つ目は原点)\n\n          var p2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n          var p3 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n          var I = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolAlloc(); //慣性モーメント\n\n          for (var i = 0; i < faces.length; i++) {\n            //ポリゴン数分ループ\n            for (var j = 0; j < faces[i].idxnum - 2; j++) {\n              //trianglefan対応\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.vecmul(p1, vertices[faces[i].idx[0]].pos, obj.scale);\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.vecmul(p2, vertices[faces[i].idx[1 + j]].pos, obj.scale);\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.vecmul(p3, vertices[faces[i].idx[2 + j]].pos, obj.scale);\n              var s = (p1[1] * p2[2] * p3[0] + p1[2] * p2[0] * p3[1] + p1[0] * p2[1] * p3[2] - p1[2] * p2[1] * p3[0] - p1[0] * p2[2] * p3[1] - p1[1] * p2[0] * p3[2]) * (1 / 6); //部分体積\n\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(p, p1, p2);\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(p, p, p3);\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(p, p, 0.25); //部分重心\n\n              calcInertia(I, p1, p2, p3); //慣性テンソル係数\n\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(PS, PS, p, s); //重心*体積 の合計\n\n              S += s; //体積の合計\n              //慣性テンソル比*体積\n              //慣性テンソル係数*質量としたいところだが質量を求めるためには\n              //体積比が必要だが総体積がわからないため先に部分体積だけを掛けておく\n\n              _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.madd(this.inertiaTensorBase, this.inertiaTensorBase, I, s);\n            }\n          }\n\n          if (S !== 0) {\n            S = 1 / S;\n          }\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.COMBase, PS, S); //重心\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.mul(this.inertiaTensorBase, this.inertiaTensorBase, S); //重心周りの慣性テンソル\n\n          calcTranslateInertia(I, this.COMBase); //重心ズレ分の慣性テンソル\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.madd(this.inertiaTensorBase, this.inertiaTensorBase, I, -1); //中心周りの慣性テンソル\n\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(5);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolFree(1);\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].SPHERE:\n        default:\n          var a = MAX(sx, MAX(sy, sz));\n          var i = 2.0 / 5.0 * a * a;\n          this.inertiaTensorBase[0] = i;\n          this.inertiaTensorBase[4] = i;\n          this.inertiaTensorBase[8] = i;\n          break;\n      }\n\n      this.inv_mass = 1.0 / this.mass;\n\n      if (this.fix === 1) {\n        this.mass = 9999999;\n        this.inv_mass = 0;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.mul(this.inertiaTensorBase, this.inertiaTensorBase, this.mass);\n    }\n  }, {\n    key: \"refreshCollision\",\n    value: function refreshCollision() {\n      //コリジョンの状態を更新\n      //\n      var m = this.matrix;\n      var collision = this.collision;\n      if (!collision) return;\n      var sx = this.collisionSize[0] * this.scale[0];\n      var sy = this.collisionSize[1] * this.scale[1];\n      var sz = this.collisionSize[2] * this.scale[2];\n      collision.bold = this.bold;\n\n      switch (collision.type) {\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].SPHERE:\n          var bold = MAX(MAX(sx, sy), sz);\n          sx = sy = sz = 0;\n          collision.bold += bold;\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CAPSULE:\n          var bold = Math.max(sx, sz);\n          sy = Math.max(this.collisionSize[1] * this.scale[1] - bold, 0);\n          collision.bold += bold;\n          break;\n\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].MESH:\n        case _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CONVEX_HULL:\n          var vertices = this.mesh.vertices;\n\n          for (var i = 0; i < vertices.length; i++) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(collision.poses[i], m, vertices[i].pos);\n          }\n\n          sx = this.scale[0];\n          sy = this.scale[1];\n          sz = this.scale[2];\n          break;\n      }\n\n      var scale = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(scale, sx, sy, sz);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.fromLSR(collision.matrix, this.location, scale, this.rotq);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n\n      if (this.fix) {\n        collision.notgroups = 1;\n      } else {\n        collision.notgroups = 0;\n      }\n\n      if (collision.type !== _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].MESH || !collision.aabbTreeRoot || collision.type === _collider_collider_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].MESH && !this.fix) {\n        collision.refresh();\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(dt) {\n      //状態更新\n      if (this.fix) {\n        //固定オブジェクトは何もしない\n        return;\n      }\n\n      var rq = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n      var bV0 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.rotV, this.rotV, this.onophy.ANGDAMP); //回転摩擦\n\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(this.rotV);\n\n      if (l > 0) {\n        //角速度がある場合回転処理を行う\n        //角速度ベクトルから今回回転分のクォータニオンを求める\n        var d = 1 / l;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.fromRotVector(rq, l * dt, this.rotV[0] * d, this.rotV[1] * d, this.rotV[2] * d);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qdot(this.rotq, rq, this.rotq); //姿勢のクォータニオンにかける\n        //オブジェクト中心と重心のズレ補正\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(bV0, this.COM, this.location);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.rotVec3(bV0, rq, bV0);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(bV0, this.COM, bV0);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(bV0, bV0, this.location);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.location, this.location, bV0);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.v, this.v, this.onophy.LINDAMP); //平行移動摩擦\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.location, this.location, this.v, dt); //移動量を足す\n\n      this.impFlg = 0;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1); //this.calcPre();\n    }\n  }, {\n    key: \"calcEfficM\",\n    value: function calcEfficM(m, r1) {\n      //点r1に力を加えたとき点がどれだけ加速するかを計算するための行列を求める\n      var r = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var R1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(r, r1, this.COM);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.set(R1, 0, r[2], -r[1], -r[2], 0, r[0], r[1], -r[0], 0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dot(m, R1, this.inv_inertiaTensor);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dot(m, m, R1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.mul(m, m, -1);\n      m[0] += this.inv_mass;\n      m[4] += this.inv_mass;\n      m[8] += this.inv_mass;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.poolFree(1);\n    }\n  }, {\n    key: \"calcVelocity\",\n    value: function calcVelocity(v, pos) {\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(v, pos, this.COM);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(v, this.rotV, v);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(v, v, this.v);\n    }\n  }, {\n    key: \"addImpulse\",\n    value: function addImpulse(pos, impulse) {\n      //衝撃を与える\n      if (this.fix) {\n        //固定の場合は無視\n        return;\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.v, this.v, impulse, this.inv_mass); //並行\n      //回転\n\n      var addimpulseBuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(addimpulseBuf, pos, this.COM); //重心からの差\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(addimpulseBuf, addimpulseBuf, impulse); //角運動量\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(addimpulseBuf, this.inv_inertiaTensor, addimpulseBuf); //角加速度\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.rotV, this.rotV, addimpulseBuf); //角速度に加える\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n    }\n  }, {\n    key: \"addImpulse2\",\n    value: function addImpulse2(pos, impulse) {\n      //衝撃を与える\n      if (this.fix) {\n        //固定の場合は無視\n        return;\n      }\n\n      var v1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var v2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var dpos = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var l1, l2;\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(v1, impulse, this.inv_mass); //並行\n\n      l1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(v1); //回転\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dpos, pos, this.COM); //重心からの差\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(v2, dpos, impulse); //角運動量\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(v2, this.inv_inertiaTensor, v2); //角加速度\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(dpos, dpos, v2);\n      l2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(dpos);\n\n      if (l1 + l2) {\n        var l = 1 / (l1 + l2);\n        l1 *= l;\n        l2 *= l;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.v, this.v, v1, l1); //並行\n\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.rotV, this.rotV, v2, l2); //角速度に加える\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(3);\n    }\n  }, {\n    key: \"addImpulseR\",\n    value: function addImpulseR(impulse) {\n      //衝撃を与える(回転のみ\n      if (this.fix) {\n        //固定の場合は無視\n        return;\n      }\n\n      var addimpulseBuf = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.dotVec3(addimpulseBuf, this.inv_inertiaTensor, impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.rotV, this.rotV, addimpulseBuf);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(1);\n    }\n  }, {\n    key: \"getExPos\",\n    value: function getExPos(a, b) {\n      //ワールド座標を剛体のローカル座標にする\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.getInv(this.inv_matrix, this.matrix);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(a, this.inv_matrix, b);\n    }\n  }, {\n    key: \"getFriction\",\n    value: function getFriction() {\n      //摩擦力を返す\n      return this.friction;\n    }\n  }, {\n    key: \"getRestitution\",\n    value: function getRestitution() {\n      //反発係数を返す\n      return this.restitution;\n    }\n  }, {\n    key: \"getInvInertiaTensor\",\n    value: function getInvInertiaTensor() {\n      //逆慣性テンソルを返す\n      return this.inv_inertiaTensor;\n    }\n  }]);\n\n  return RigidBody;\n}(_phyobj_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n\n\n;\n\nvar calcTranslateInertia = function calcTranslateInertia(I, v) {\n  //平行移動の慣性テンソルを求める\n  var x = v[0];\n  var y = v[1];\n  var z = v[2];\n  I[0] = y * y + z * z;\n  I[1] = -x * y;\n  I[2] = -x * z;\n  I[3] = -y * x;\n  I[4] = x * x + z * z;\n  I[5] = -y * z;\n  I[6] = -z * x;\n  I[7] = -z * y;\n  I[8] = x * x + y * y;\n};\n\nvar calcInertia = function calcInertia(I, a, b, c) {\n  //頂点a,b,c,0で構成される単位重量(1グラム)の\n  //四面体の慣性テンソルを求める\n  var kx = a[0] + b[0] + c[0];\n  var kxx = a[0] * a[0] + b[0] * b[0] + c[0] * c[0];\n  var kxy = a[0] * a[1] + b[0] * b[1] + c[0] * c[1];\n  var ky = a[1] + b[1] + c[1];\n  var kyy = a[1] * a[1] + b[1] * b[1] + c[1] * c[1];\n  var kyz = a[1] * a[2] + b[1] * b[2] + c[1] * c[2];\n  var kz = a[2] + b[2] + c[2];\n  var kzz = a[2] * a[2] + b[2] * b[2] + c[2] * c[2];\n  var kxz = a[2] * a[0] + b[2] * b[0] + c[2] * c[0];\n  I[0] = ky * ky + kyy + kz * kz + kzz;\n  I[1] = -(kx * ky + kxy);\n  I[2] = -(kx * kz + kxz);\n  I[3] = -(kx * ky + kxy);\n  I[4] = kx * kx + kxx + kz * kz + kzz;\n  I[5] = -(ky * kz + kyz);\n  I[6] = -(kx * kz + kxz);\n  I[7] = -(ky * kz + kyz);\n  I[8] = kx * kx + kxx + ky * ky + kyy;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.mul(I, I, 1 / 20);\n};\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/rigidbody.js?");

/***/ }),

/***/ "../lib/lib/onophy/softbody.js":
/*!*************************************!*\
  !*** ../lib/lib/onophy/softbody.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ SoftBody; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _phyobj_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phyobj.js */ \"../lib/lib/onophy/phyobj.js\");\n/* harmony import */ var _rigidbody_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rigidbody.js */ \"../lib/lib/onophy/rigidbody.js\");\n/* harmony import */ var _onophy_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _collider_collider_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../collider/collider.js */ \"../lib/lib/collider/collider.js\");\n/* harmony import */ var _geono_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../geono.js */ \"../lib/lib/geono.js\");\n/* harmony import */ var _aabb_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../aabb.js */ \"../lib/lib/aabb.js\");\n/* harmony import */ var _cloth_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cloth.js */ \"../lib/lib/onophy/cloth.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\n\n\n\nvar MIN = Math.min;\nvar MAX = Math.max;\nvar AIR_DAMPER = 1;\nvar DIMENSION = 3;\n\nvar SoftBody = /*#__PURE__*/function (_Cloth) {\n  _inherits(SoftBody, _Cloth);\n\n  var _super = _createSuper(SoftBody);\n\n  function SoftBody(v, e, f) {\n    var _this;\n\n    _classCallCheck(this, SoftBody);\n\n    _this = _super.call(this);\n    _this.type = _onophy_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].CLOTH;\n    _this.bold = 0.015;\n    _this.points = []; //頂点位置\n\n    _this.edges = []; //エッジ\n\n    _this.bends = []; //曲がり抵抗\n\n    _this.faces = []; //面\n\n    _this.facesSort = [];\n    _this.structual_stiffness = 400; //構造\n\n    _this.bending_stiffness = 0; //まげ\n\n    _this.spring_damping = 5; //ばね抵抗\n\n    _this.air_damping = 0; //空気抵抗\n\n    _this.vel_damping = 0; //速度抵抗\n\n    _this.restitution = 0; //反発係数\n\n    _this.friction = 0.1;\n\n    for (var i = 0; i < v; i++) {\n      _this.points.push(new _cloth_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].Point());\n\n      _this.points[i].cloth = _assertThisInitialized(_this);\n    }\n\n    for (var i = 0; i < e; i++) {\n      _this.edges.push(new Edge());\n\n      _this.edges[i].cloth = _assertThisInitialized(_this);\n    }\n\n    for (var i = 0; i < f; i++) {\n      _this.faces.push(new _cloth_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].Face());\n\n      _this.faces[i].cloth = _assertThisInitialized(_this);\n\n      _this.facesSort.push(_this.faces[i]);\n    }\n\n    _this.aabb = new _aabb_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]();\n    return _this;\n  }\n\n  _createClass(SoftBody, [{\n    key: \"init\",\n    value: function init() {\n      var points = this.points;\n      var edges = this.edges;\n\n      for (var i = 0; i < points.length; i++) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.set(points[i].rotq, 0, 0, 0, 1);\n      }\n\n      for (var i = 0; i < edges.length; i++) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(edges[i].sabun, edges[i].point2.location, edges[i].point1.location);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(edges[i].sabun, edges[i].sabun, 0.5);\n        edges[i].point1.rotq[0] *= -1;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.rotVec3(edges[i].sabun, edges[i].point1.rotq, edges[i].sabun);\n        edges[i].point1.rotq[0] *= -1;\n      }\n\n      this.inv_pointMass = 1 / (this.mass / this.points.length);\n    }\n  }, {\n    key: \"calcPre\",\n    value: function calcPre(onophy) {\n      _cloth_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].prototype.calcPre.call(this, onophy);\n    }\n  }, {\n    key: \"calcConstraintPre\",\n    value: function calcConstraintPre() {}\n  }, {\n    key: \"calcConstraint\",\n    value: function calcConstraint(m) {}\n  }]);\n\n  return SoftBody;\n}(_cloth_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"]);\n\n\n;\n\nvar Edge = /*#__PURE__*/function () {\n  function Edge() {\n    _classCallCheck(this, Edge);\n\n    this.point1 = null;\n    this.point2 = null;\n    this.len;\n    this.sabun = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.cloth = null;\n    this.impulse = 0;\n    this.n = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n  }\n\n  _createClass(Edge, [{\n    key: \"calcPre\",\n    value: function calcPre() {\n      var pos1 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var pos2 = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var dv = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var impulse = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var rotq = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolAlloc();\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.rotVec3(pos1, this.point1.rotq, this.sabun);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.rotVec3(pos2, this.point2.rotq, this.sabun);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(dv, pos1, pos2);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, this.point2.location, dv);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, dv, this.point1.location);\n      var l = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(dv);\n\n      if (l !== 0) {\n        l *= this.cloth.push * 3000;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, dv, 1 / l);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, this.point2.v, this.point1.v);\n        l += _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dv, impulse) * this.cloth.damping;\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, impulse, l * this.cloth.inv_pointMass * this.cloth.onophy.dt);\n\n        if (!this.point1.fix) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.v, this.point1.v, impulse);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(dv, pos1, impulse);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.rotV, this.point1.rotV, dv); //回転\n        }\n\n        if (!this.point2.fix) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, impulse, -1);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point2.v, this.point2.v, impulse);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(dv, pos2, -1);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.cross(dv, dv, impulse);\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point2.rotV, this.point2.rotV, dv); //回転\n        }\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.qmdot(rotq, this.point2.rotq, this.point1.rotq, -1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.toTorque(impulse, rotq);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(impulse, impulse, this.cloth.onophy.DT * this.cloth.inv_pointMass * this.cloth.bending_stiffness * 2);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.add(this.point1.rotV, this.point1.rotV, impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(this.point2.rotV, this.point2.rotV, impulse);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.point1.rotV, this.point1.rotV, 0.999);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(this.point2.rotV, this.point2.rotV, 0.999);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.poolFree(1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(4);\n    }\n  }]);\n\n  return Edge;\n}();\n\n;\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/softbody.js?");

/***/ }),

/***/ "../lib/lib/onophy/spring.js":
/*!***********************************!*\
  !*** ../lib/lib/onophy/spring.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Spring; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _onophy_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./onophy.js */ \"../lib/lib/onophy/onophy.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar Spring = /*#__PURE__*/function () {\n  //�΂�\n  function Spring() {\n    _classCallCheck(this, Spring);\n\n    this.defaultLength = 0; //�f�t�H���g����\n\n    this.k = 1; //�΂˒萔\n\n    this.c = 0; //�_���p�W��\n\n    this.p0 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�΂ː�[1���W\n\n    this.p1 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�΂ː�[2���W\n\n    this._p0 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�O��̍��W\n\n    this._p1 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�O��̍��W\n\n    this.con1Obj = null; //�ڑ��I�u�W�F�N�g1\n\n    this.con1Pos = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�I�u�W�F�N�g�ڑ����W\n\n    this.con2Obj = null; //�ڑ��I�u�W�F�N�g2\n\n    this.con2Pos = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(); //�I�u�W�F�N�g�ڑ����W\n  }\n\n  _createClass(Spring, [{\n    key: \"calc\",\n    value: function calc(dt) {\n      var dv = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var dp = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc();\n      var n = _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolAlloc(); //�ڑ��_\n\n      if (this.con1) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(this.p0, this.con1.matrix, this.con1Pos);\n        this.con1.calcVelocity(dp, this.p0);\n      } else {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dp, this.p0, this._p0);\n      }\n\n      if (this.con2) {\n        if (this.con2.type === _onophy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].FACE) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(this.p1, 0, 0, 0);\n\n          for (var i = 0; i < 3; i++) {\n            _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(this.p1, this.p1, this.con2.p[i].location, this.con2.ratio[i]);\n          }\n        } else {\n          _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat43.dotVec3(this.p1, this.con2.matrix, this.con2Pos);\n        }\n\n        this.con2.calcVelocity(dv, this.p1);\n      } else {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, this.p1, this._p1);\n      } //���x��\n\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dv, dv, dp); //�ʒu��\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.sub(dp, this.p1, this.p0); //�o�l����\n\n      var defaultLength = this.defaultLength; //�o�l�̂ї�\n\n      var l = -defaultLength + _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.scalar(dp);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.nrm(n, dp); //�o�l����\n\n      var damp = this.c * _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.dot(dv, n); //�_���p��\n\n      var spr = l * this.f; //�o�l��\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(n, n, (damp + spr) * dt);\n\n      if (this.con1) {\n        //Vec3.sub(dp,this.p0,this.con1.location);\n        this.con1.addImpulse2(this.p0, n);\n      }\n\n      if (this.con2) {\n        //Vec3.sub(dp,this.p1,this.con2.location);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(n, n, -1);\n        this.con2.addImpulse2(this.p1, n);\n      }\n\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(this._p0, this.p0);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.copy(this._p1, this.p1);\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.poolFree(3);\n    }\n  }]);\n\n  return Spring;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/onophy/spring.js?");

/***/ }),

/***/ "../lib/lib/openexr.js":
/*!*****************************!*\
  !*** ../lib/lib/openexr.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ OpenEXR; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"../lib/lib/datastream.js\");\n/* harmony import */ var _zlib_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./zlib.js */ \"../lib/lib/zlib.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\n\nvar OpenEXR = /*#__PURE__*/function () {\n  function OpenEXR() {\n    _classCallCheck(this, OpenEXR);\n  }\n\n  _createClass(OpenEXR, null, [{\n    key: \"toArrayBuffer\",\n    value: function toArrayBuffer(obj) {\n      var channels = obj.attributes.channels;\n      var width = obj.attributes.dataWindow.xMax - obj.attributes.dataWindow.xMin + 1;\n      var height = obj.attributes.dataWindow.yMax - obj.attributes.dataWindow.yMin + 1;\n      var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](height * (8 + 8 + width * 2 * channels.length) + 400); //Magic Number\n\n      dv.setUint32(20000630, true); //Version Field\n\n      dv.setUint16(2, true);\n      dv.setUint16(0, true); //header\n\n      var attributes = obj.attributes;\n      var keys = Object.keys(attributes);\n\n      for (var ai = 0; ai < keys.length; ai++) {\n        var attribute_name = keys[ai];\n        var attribute = attributes[attribute_name];\n        dv.setTextBuf(attribute_name, true);\n        var attribute_type = \"\";\n        var attribute_size_index = 0;\n\n        switch (attribute_name) {\n          case \"channels\":\n            attribute_type = \"chlist\";\n            break;\n\n          case \"compression\":\n            attribute_type = \"compression\";\n            break;\n\n          case \"dataWindow\":\n          case \"displayWindow\":\n            attribute_type = \"box2i\";\n            break;\n\n          case \"lineOrder\":\n            attribute_type = \"lineOrder\";\n            break;\n\n          case \"pixelAspectRatio\":\n            attribute_type = \"float\";\n            break;\n\n          case \"screenWindowCenter\":\n            attribute_type = \"v2f\";\n            break;\n\n          case \"screenWindowWidth\":\n            attribute_type = \"float\";\n            break;\n\n          case \"chromaticities\":\n            attribute_type = \"chromaticities\";\n            break;\n        }\n\n        dv.setTextBuf(attribute_type, true);\n        attribute_size_index = dv.idx;\n        dv.idx += 32;\n\n        if (attribute_type === \"box2i\") {\n          dv.setInt32(attribute.xMin, true);\n          dv.setInt32(attribute.yMin, true);\n          dv.setInt32(attribute.xMax, true);\n          dv.setInt32(attribute.yMax, true);\n        } else if (attribute_type === \"box2f\") {\n          dv.setFloat32(attribute.xMin, true);\n          dv.setFloat32(attribute.yMin, true);\n          dv.setFloat32(attribute.xMax, true);\n          dv.setFloat32(attribute.yMax, true);\n        } else if (attribute_type === \"chlist\") {\n          channels = attribute;\n\n          for (var ci = 0; ci < channels.length; ci++) {\n            var channel = channels[ci];\n            dv.setTextBuf(channel.name, true);\n            dv.setInt32(channel.pixel_type, true); //pixel type\n\n            dv.setUint8(channel.pLiner, true); //pliner\n\n            dv.setUint8(0, true); //reserved\n\n            dv.setUint8(0, true); //reserved\n\n            dv.setUint8(0, true); //reserved\n\n            dv.setInt32(channel.xSampling, true); //xSampling\n\n            dv.setInt32(channel.ySampling, true); //YSampling\n          }\n\n          dv.setTextBuf(\"\", true);\n        } else if (attribute_type === \"compression\") {\n          dv.setUint8(attribute);\n        } else if (attribute_type === \"double\") {\n          dv.setFloat64(attribute, true);\n        } else if (attribute_type === \"float\") {\n          dv.setFloat32(attribute, true);\n        } else if (attribute_type === \"int\") {\n          dv.setInt32(attribute, true);\n        } else if (attribute_type === \"lineOrder\") {\n          dv.getUint8(0, true);\n        } else if (attribute_type === \"string\") {\n          dv.setTextBuf(attribute, true);\n        } else if (attribute_type === \"v2i\") {\n          dv.setInt32(attribute[0], true);\n          dv.setInt32(attribute[1], true);\n        } else if (attribute_type === \"v2f\") {\n          dv.setFloat32(attribute[0], true);\n          dv.setFloat32(attribute[1], true);\n        } else if (attribute_type === \"chromaticities\") {\n          for (var vi = 0; vi < 8; vi++) {\n            dv.setFloat32(attribute[vi], true);\n          }\n        }\n\n        var a = dv.idx;\n        dv.idx = attribute_size_index;\n        dv.setUint32((a - attribute_size_index >> 3) - 4, true);\n        dv.idx = a;\n      }\n\n      dv.setTextBuf(\"\", true);\n      var offset_scan_line_idx = dv.idx;\n      dv.idx += 64 * obj.height;\n      var data_idx = dv.idx;\n      var line_size = obj.width * 2 * channels.length;\n      var linemax = 1;\n\n      if (obj.attributes.compression === 3) {\n        linemax = 16;\n      }\n\n      var data_stream = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(line_size * linemax));\n\n      for (var li = 0; li < height;) {\n        data_idx = dv.idx;\n        dv.idx = offset_scan_line_idx;\n        dv.setUint64(data_idx >> 3, true);\n        offset_scan_line_idx = dv.idx;\n        dv.idx = data_idx;\n        dv.setUint32(li, true);\n        data_stream.idx = 0;\n        var linemax_ = Math.min(linemax, height - li);\n\n        for (var l = 0; l < linemax_; l++) {\n          var idx = li * width;\n\n          for (var ci = 0; ci < channels.length; ci++) {\n            var channel_data = channels[ci].data;\n\n            for (var xi = 0; xi < width; xi++) {\n              data_stream.setFloat16(channel_data[idx + xi], true);\n            }\n          }\n\n          li++;\n        }\n\n        var data = new Uint8Array(data_stream.dv.buffer, 0, linemax_ * line_size);\n\n        if (obj.attributes.compression) {\n          var offset = data.length >> 1;\n          var data2 = new Uint8Array(data.length);\n\n          for (var di = 0; di < offset; di++) {\n            //上位バイトと下位バイトを分ける\n            data2[di] = data[di << 1];\n            data2[di + offset] = data[(di << 1) + 1];\n          }\n\n          for (var di = data2.length - 1; di > 0; di--) {\n            //差分情報作成\n            data2[di] = data2[di] - data2[di - 1] + 128 & 0xff;\n          }\n\n          data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compress(data2, 1);\n        }\n\n        dv.setUint32(data.length, true);\n        dv.setBytes(data);\n      }\n\n      return dv.byteBuffer.buffer.slice(0, dv.idx >> 3);\n    }\n  }, {\n    key: \"fromArrayBuffer\",\n    value: function fromArrayBuffer(obj, arrayBuffer) {\n      var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](arrayBuffer); //Magic Number\n\n      var c = dv.getUint32(true);\n\n      if (c !== 20000630) {\n        alert(\"exrファイルのマジックナンバーと違う\");\n        return;\n      } //Version Field\n\n\n      c = dv.getUint16(true); //if(c !== 2){\n      //\talert(\"SIngle-part scan line 以外は対応してません\");\n      //\treturn;\n      //}\n\n      var cc = dv.getUint16(true); //dv.idx+=2<<3;\n      //header\n\n      var attributes = [];\n\n      while (1) {\n        var attribute_name = dv.readTextBuf();\n\n        if (attribute_name === \"\") {\n          //空文字ならヘッダー終了\n          break;\n        }\n\n        var attribute_type = dv.readTextBuf();\n        var value = null;\n        var attribute_size = dv.getUint32(true);\n        var idxOld = dv.idx;\n\n        if (attribute_type === \"box2i\") {\n          value = {};\n          value.xMin = dv.getInt32(true);\n          value.yMin = dv.getInt32(true);\n          value.xMax = dv.getInt32(true);\n          value.yMax = dv.getInt32(true);\n        } else if (attribute_type === \"box2f\") {\n          value = {};\n          value.xMin = dv.getFloat32(true);\n          value.yMin = dv.getFloat32(true);\n          value.xMax = dv.getFloat32(true);\n          value.yMax = dv.getFloat32(true);\n        } else if (attribute_type === \"chlist\") {\n          value = [];\n\n          while (1) {\n            var ch = [];\n            ch.name = dv.readTextBuf();\n\n            if (ch.name === \"\") {\n              break;\n            }\n\n            ch.pixel_type = dv.getInt32(true);\n            ch.pLinear = dv.getUint8(true);\n            ch.reserved = dv.getUint8(true);\n            dv.idx += 2 << 3;\n            ch.xSampling = dv.getInt32(true);\n            ch.ySampling = dv.getInt32(true);\n            value.push(ch);\n          }\n        } else if (attribute_type === \"compression\") {\n          value = dv.getUint8(true);\n        } else if (attribute_type === \"double\") {\n          value = dv.getFloat64(true);\n        } else if (attribute_type === \"float\") {\n          value = dv.getFloat32(true);\n        } else if (attribute_type === \"int\") {\n          value = dv.getInt32(true);\n        } else if (attribute_type === \"lineOrder\") {\n          value = dv.getUint8(true);\n        } else if (attribute_type === \"string\") {\n          value = \"\";\n\n          for (var i = 0; i < attribute_size; i++) {\n            value += String.fromCharCode(dv.getUint8(true));\n          } //\t\t\tidx+=value.length+1;\n\n        } else if (attribute_type === \"v2i\") {\n          value = [];\n          value.push(dv.getInt32(true));\n          value.push(dv.getInt32(true));\n        } else if (attribute_type === \"v2f\") {\n          value = [];\n          value.push(dv.getFloat32(true));\n          value.push(dv.getFloat32(true));\n        } else if (attribute_type === \"chromaticities\") {\n          value = [];\n\n          for (var vi = 0; vi < 8; vi++) {\n            value.push(dv.getFloat32(true));\n          }\n        }\n\n        attributes[attribute_name] = value;\n        dv.idx = idxOld + (attribute_size << 3);\n      } //データ部\n\n\n      var channels = attributes.channels;\n      obj.width = attributes.dataWindow.xMax - attributes.dataWindow.xMin + 1;\n      obj.height = attributes.dataWindow.yMax - attributes.dataWindow.yMin + 1;\n      var datasize = obj.width * obj.height; //メモリ確保\n\n      for (var i = 0; i < channels.length; i++) {\n        var channel = channels[i];\n\n        if (channel.pixel_type === 0) {\n          channel.data = new Uint8Array(datasize);\n        }\n\n        if (channel.pixel_type === 1) {\n          channel.data = new Float32Array(datasize);\n        }\n\n        if (channel.pixel_type === 2) {\n          channel.data = new Float32Array(datasize);\n        }\n      } //ライン読み込み\n\n\n      for (var i = 0; i < obj.height; i++) {\n        var offset = dv.getUint64(true);\n        var oldIdx = dv.idx;\n        dv.idx = offset << 3;\n        var y = dv.getUint32(true);\n        var pixel_data_size = dv.getUint32(true);\n        var linedata;\n        var linemax = 1;\n\n        if (attributes.compression === 0) {\n          linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n        }\n\n        if (attributes.compression === 2 || attributes.compression === 3) {\n          //zip展開\n          var data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].expand(dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n        }\n\n        if (attributes.compression === 3) {\n          linemax = Math.min(obj.height - y, 16); //compression=3のときは16行固定\n        }\n\n        if (attributes.compression === 3 || attributes.compression === 2) {\n          //zip圧縮されていた場合はデータが加工されているので復元\n          var data2 = new Uint8Array(data.length);\n\n          for (var di = 1; di < data.length; di++) {\n            //差分情報から実際の値を復元\n            data[di] = data[di - 1] - 128 + data[di] & 0xff;\n          }\n\n          var offset = data.length >> 1;\n\n          for (var di = 0; di < offset; di++) {\n            //上位バイトと下位バイトをくっつける\n            data2[di << 1] = data[di];\n            data2[(di << 1) + 1] = data[di + offset];\n          }\n\n          linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](data2.buffer);\n        }\n\n        for (var line = 0; line < linemax; line++) {\n          for (var ci = 0; ci < channels.length; ci++) {\n            var channel = channels[ci];\n            var data = channel.data;\n            var didx = (y + line) * obj.width;\n\n            if (channel.pixel_type == 0) {\n              for (var xi = 0; xi < obj.width; xi++) {\n                channel.data[didx + xi] = linedata.getUint8(true);\n              }\n            } else if (channel.pixel_type == 1) {\n              for (var xi = 0; xi < obj.width; xi++) {\n                channel.data[didx + xi] = linedata.readFloat16(true);\n              }\n            } else if (channel.pixel_type == 2) {\n              for (var xi = 0; xi < obj.width; xi++) {\n                channel.data[didx + xi] = linedata.getFloat32(true);\n              }\n            }\n          }\n        }\n\n        dv.idx = oldIdx;\n        i += linemax - 1;\n      }\n\n      obj.attributes = attributes;\n    }\n  }]);\n\n  return OpenEXR;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/openexr.js?");

/***/ }),

/***/ "../lib/lib/rastgl.js":
/*!****************************!*\
  !*** ../lib/lib/rastgl.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vector.js */ \"../lib/lib/vector.js\");\n\n\n\n\n\nvar Rastgl = function () {\n  var currentpath = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getCurrent();\n\n  var ret = function ret() {};\n\n  var FACE_MAX = ret.FACE_MAX = 4096 * 2;\n  var VERTEX_MAX = ret.VERTEX_MAX = FACE_MAX * 3;\n  var gl;\n  var renderBuffer;\n  var frameBuffer;\n  var fTexture;\n  ret.dummyTexture;\n  var fullposbuffer;\n\n  var ShaderCompileException = function ShaderCompileException(message) {\n    this.message = message;\n    this.name = \"UserException\";\n  };\n\n  var setShaderProgram = ret.setShaderProgram = function (vs, fs) {\n    //シェーダをコンパイルする\n    // Vertex shader\n    var vshader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vshader, vs);\n    gl.compileShader(vshader);\n\n    if (!gl.getShaderParameter(vshader, gl.COMPILE_STATUS)) {\n      throw new ShaderCompileException(gl.getShaderInfoLog(vshader));\n    } // Fragment shader\n\n\n    var fshader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fshader, fs);\n    gl.compileShader(fshader);\n\n    if (!gl.getShaderParameter(fshader, gl.COMPILE_STATUS)) {\n      throw new ShaderCompileException(gl.getShaderInfoLog(fshader));\n    } // Create shader program\n\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vshader);\n    gl.attachShader(program, fshader);\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new ShaderCompileException(gl.getProgramInfoLog(program));\n    }\n\n    gl.useProgram(program);\n    return program;\n  };\n\n  var createTexture = ret.createTexture = function (image, x, y) {\n    var neheTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, neheTexture);\n\n    if (image) {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n    } else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, x, y, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    } //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    //gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return neheTexture;\n  };\n\n  ret.subTexture = function (texture, x, y, w, h, data) {\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, w, h, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  };\n\n  ret.init = function (_gl) {\n    gl = _gl;\n    ret.gl = _gl;\n\n    try {\n      //メインフレームバッファ\n      gl.clearColor(0.0, 0.0, 0.0, 0.0);\n      gl.clearDepth(1.0);\n      gl.enable(gl.DEPTH_TEST);\n      gl.depthFunc(gl.LEQUAL);\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      gl.enable(gl.CULL_FACE); //作業用フレームバッファ\n\n      ret.frameBuffer = frameBuffer = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n      renderBuffer = gl.createRenderbuffer();\n      gl.bindRenderbuffer(gl.RENDERBUFFER, renderBuffer);\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, 1024, 1024);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderBuffer); //作業用テクスチャ\n\n      ret.fTexture = fTexture = createTexture(null, 1024, 1024);\n      gl.bindTexture(gl.TEXTURE_2D, fTexture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, fTexture, 0);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n      console.log(gl.getRenderbufferParameter(gl.RENDERBUFFER, gl.RENDERBUFFER_DEPTH));\n      gl.clearColor(1.0, 1.0, 1.0, 1.0);\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      ret.dummyTexture = createTexture(null, 1, 1);\n      gl.bindTexture(gl.TEXTURE_2D, ret.dummyTexture);\n      gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 0, 0, 1, 1, 0);\n      gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    } catch (e) {\n      return true;\n    }\n\n    ret.glIdxBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ret.glIdxBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(VERTEX_MAX), gl.DYNAMIC_DRAW);\n    ret.glbuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, ret.glbuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(VERTEX_MAX * 20), gl.DYNAMIC_DRAW);\n    ret.fullposbuffer = gl.createBuffer();\n    fullposbuffer = ret.fullposbuffer;\n    gl.bindBuffer(gl.ARRAY_BUFFER, ret.fullposbuffer);\n    var buffer = new Float32Array(8);\n    buffer[0] = -1;\n    buffer[1] = -1;\n    buffer[2] = 1;\n    buffer[3] = -1;\n    buffer[4] = 1;\n    buffer[5] = 1;\n    buffer[6] = -1;\n    buffer[7] = 1;\n    gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.STATIC_DRAW);\n    return false;\n  };\n\n  var idx = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3();\n  var num = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3();\n\n  ret.packR11G11B10 = function (result, raw) {\n    //浮動小数をR11G11B10にパック\n    idx[0] = Math.floor(Math.log(Math.max(raw[0], 0.00001)));\n    idx[1] = Math.floor(Math.log(Math.max(raw[1], 0.00001)));\n    idx[2] = Math.floor(Math.log(Math.max(raw[2], 0.00001)));\n    idx[0] = Math.max(Math.min(idx[0], 16.0), -15.0);\n    idx[1] = Math.max(Math.min(idx[1], 16.0), -15.0);\n    idx[2] = Math.max(Math.min(idx[2], 16.0), -15.0);\n    num[0] = Math.max(raw[0] * Math.pow(2, -idx[0]) - 1.0, 0.0);\n    num[1] = Math.max(raw[1] * Math.pow(2, -idx[1]) - 1.0, 0.0);\n    num[2] = Math.max(raw[2] * Math.pow(2, -idx[2]) - 1.0, 0.0);\n    var geta = 15.0;\n    result[0] = (idx[0] + geta << 3) + Math.floor(num[0] * 8);\n    result[1] = (idx[1] + geta << 3) + Math.floor(num[1] * 8);\n    result[2] = (idx[2] + geta << 3) + Math.floor(Math.trunc(num[0] * 8) * 8);\n    result[3] = (num[2] * 32 << 3) + Math.floor(Math.trunc(num[1] * 8) * 8);\n    _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4.mul(result, result, 1 / 255);\n  };\n\n  ret.commonFunction = \" \\n \\\n\t\tprecision mediump float;  \\n \\\n\t\tconst mediump float geta = 15.0; \\n \\\n\t\tlowp vec4 packR11G11B10(mediump vec3 raw){ \\n \\\n\t\t\tmediump vec3 idx = floor(log2(max(raw,0.00001))); \\n \\\n\t\t\tidx = max(min(idx,16.0),-15.0); \\n \\\n\t\t\tmediump vec3 num = max((raw*exp2(-idx) -1.0),0.0) ;\\n \\\n\t\t\treturn (vec4((idx +geta),floor(num.b * 32.0))*8.0\\n \\\n\t\t\t\t+ floor(vec4(num.rg,fract(num.rg * 8.0))*8.0) \\n \\\n\t\t\t)/255.0; \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 unpackR11G11B10(lowp vec4 raw){ \\n \\\n\t\t\tmediump vec4 lo = floor(raw*255.0+0.5)/8.0; \\n \\\n\t\t\tmediump vec4 hi= floor(lo); \\n \\\n\t\t\tlo -=  hi; \\n \\\n\t\t\treturn  (vec3(lo.rg + lo.ba/8.0,hi.a/32.0) +1.0) \\n \\\n\t\t\t\t* exp2(hi.rgb-geta); \\n \\\n\t\t} \\n \\\n\t\tlowp vec4 packRGBE(mediump vec3 src){ \\n \\\n\t\t\tmediump float idx = ceil(log2(max(max(src.r,max(src.g,src.b)),0.000001))); \\n \\\n\t\t\treturn vec4(src/ exp2(idx),(idx+128.0)/255.0); \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 unpackRGBE(lowp vec4 src){ \\n \\\n\t\t\treturn src.rgb * exp2(floor(src.a*255.5 - 128.0)); \\n \\\n\t\t} \\n \\\n\t\tconst mediump vec3 v1286432 = vec3(128.0,64.0,32.0); \\n\\\n\t\tlowp vec4 packFloat(mediump vec3 src){ \\n \\\n\t\t\tmediump vec3 abs_src= abs(src) ; \\n \\\n\t\t\tfloat idx = clamp(ceil(log2( \\n \\\n\t\t\t\tmax(max(abs_src.r,max(abs_src.g,abs_src.b)),0.0002) \\n \\\n\t\t\t\t)),-geta,31.0-geta); \\n \\\n\t\t\treturn vec4(abs_src / exp2(idx) \\n \\\n\t\t\t\t,(dot(max(-sign(src),0.0),v1286432)+(idx+geta))/255.0); \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 unpackFloat(lowp vec4 src){ \\n \\\n\t\t\tmediump float e = floor(src.a*255.5); \\n \\\n\t\t\treturn src.rgb \\n \\\n\t\t\t\t* (1.0 -mod(floor(e/v1286432),2.0)*2.0)  \\n \\\n\t\t\t\t* exp2(mod(e,32.0) - geta); \\n \\\n\t\t} \\n \\\n\t\tlowp vec2 packUFP16(mediump float raw){ \\n \\\n\t\t\tif(raw==0.0)return vec2(0.0,0.0); \\n \\\n\t\t\tmediump float idx = clamp(floor(log2(raw)),-geta,31.0-geta);  \\n \\\n\t\t\tmediump float f = (raw /exp2(idx) -1.0)*256.0; \\n \\\n\t\t\treturn vec2(floor(f),floor(fract(f)*8.0)*32.0 + (idx+geta))/255.0; \\n \\\n\t\t} \\n \\\n\t\tmediump float unpackUFP16(lowp vec2 src){ \\n \\\n\t\t\tif(src.r==0.0 && src.g==0.0)return 0.0; \\n \\\n\t\t\treturn (dot(floor(src.rg* vec2(255.5,255.5/32.0)) \\n \\\n\t\t\t\t,vec2(1.0/256.0,1.0/(256.0*8.0))) +1.0) \\n \\\n\t\t\t\t* exp2(mod(floor(src.g*255.5),32.0)-geta); \\n \\\n\t\t} \\n \\\n\t\tlowp vec2 packUXP16(mediump float ff){ \\n \\\n\t\t\tlowp vec2 color; \\n \\\n\t\t\tmediump float f = ff*255.0; \\n \\\n\t\t\tcolor.r = floor(f); \\n \\\n\t\t\tf=(f-color.r)*255.0; \\n \\\n\t\t\tcolor.g = floor(f); \\n \\\n \\n \\\n\t\t\treturn color*(1.0/255.0); \\n \\\n\t\t} \\n \\\n\t\tmediump float unpackUXP16(lowp vec2 src){ \\n \\\n\t\t\treturn (src.r*256.0  + src.g)/256.0; \\n \\\n\t\t} \\n \\\n\t\tmediump vec2 decodeFull_(lowp vec4 src){ \\n \\\n\t\t\treturn vec2(unpackUFP16(src.rg),unpackUFP16(src.ba)); \\n \\\n\t\t} \\n \\\n\t\tmediump vec2 decodeVec2(sampler2D tex,vec2 texsize,vec2 uv){ \\n \\\n\t\t\tvec2 unit = 1.0/texsize; \\\n\t\t\tuv += - 0.5 * unit; \\\n\t \t\tvec2 r = fract(uv*texsize); \\n \\\n\t\t\treturn mix(mix(decodeFull_(texture2D(tex,uv)) \\n \\\n\t\t\t\t\t,decodeFull_(texture2D(tex,uv+vec2(unit.x,0.0))),r.x) \\n \\\n\t\t\t\t,mix(decodeFull_(texture2D(tex,uv+vec2(0.0,unit.y))) \\n \\\n\t\t\t\t\t,decodeFull_(texture2D(tex,uv+unit)),r.x) \\n \\\n\t\t\t\t,r.y); \\n \\\n\t\t} \\n \\\n\t\tconst mediump float PI =3.14159265359;  \\n \\\n\t\tfloat atan2(in float y, in float x) { \\n \\\n\t\t\treturn x == 0.0 ? sign(y)*PI/2.0 : atan(y, x); \\n \\\n\t\t} \\n \\\n\t\tconst mediump float _PI =1.0/3.14159265359; \\n \\\n\t\tvec2 angle2uv(vec3 angle) { \\n \\\n\t\t\treturn vec2(atan2(angle.z,angle.x)*_PI*0.5 + 0.5  \\n \\\n\t\t\t\t,-atan2(angle.y,length(angle.xz))*_PI + 0.5); \\n \\\n\t\t} \\n \\\n\t\tvec3 uv2angle(vec2 uv) { \\n \\\n\t\t\tvec3 va; \\n \\\n\t\t\tva.y = sin((0.5-uv.y)*PI); \\n \\\n\t\t\tfloat l = sqrt(1.0-va.y*va.y); \\n \\\n\t\t\tfloat r = (-uv.x*2.0-0.5)* PI; \\n \\\n\t\t\tva.x = sin(r)*l; \\n \\\n\t\t\tva.z = cos(r)*l; \\n \\\n\t\t\treturn va; \\n \\\n\t\t} \\n \\\n\t\tlowp vec4 encode(mediump vec3 src){ \\n \\\n\t\t\treturn packR11G11B10(src); \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 decode(vec4 src){ \\n \\\n\t\t\treturn unpackR11G11B10(src); \\n \\\n\t\t} \\n \\\n\t\";\n  ret.textureRGBE = \" \\n \\\n\t\tmediump vec3 textureRGBE(sampler2D tex,vec2 texsize,vec2 uv){ \\n \\\n\t\t\tvec2 unit = 1.0/texsize; \\\n\t\t\tuv = uv - 0.5 * unit; \\\n\t \t\tvec2 r = fract(uv*texsize); \\n \\\n\t\t\treturn mix(mix(unpackRGBE(texture2D(tex,uv)) \\n \\\n\t\t\t\t\t,unpackRGBE(texture2D(tex,uv+unit*vec2(1.0,0.0))),r.x) \\n \\\n\t\t\t\t,mix(unpackRGBE(texture2D(tex,uv+unit*vec2(0.0,1.0))) \\n \\\n\t\t\t\t\t,unpackRGBE(texture2D(tex,uv+unit)),r.x) \\n \\\n\t\t\t\t,r.y); \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 textureR11G11B10(sampler2D tex,vec2 texsize,vec2 uv){ \\n \\\n\t\t\tvec2 unit = 1.0/texsize; \\\n\t\t\tuv = uv - 0.5 * unit; \\\n\t \t\tvec2 r = fract(uv*texsize); \\n \\\n\t\t\treturn mix(mix(unpackR11G11B10(texture2D(tex,uv)) \\n \\\n\t\t\t\t\t,unpackR11G11B10(texture2D(tex,uv+vec2(unit.x,0.0))),r.x) \\n \\\n\t\t\t\t,mix(unpackR11G11B10(texture2D(tex,uv+vec2(0.0,unit.y))) \\n \\\n\t\t\t\t\t,unpackR11G11B10(texture2D(tex,uv+unit)),r.x) \\n \\\n\t\t\t\t,r.y); \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 textureDecode(sampler2D tex,vec2 texsize,vec2 uv){ \\n \\\n\t\t\tvec2 unit = 1.0/texsize; \\\n\t\t\tuv = uv - 0.5 * unit; \\\n\t \t\tvec2 r = fract(uv*texsize); \\n \\\n\t\t\treturn mix(mix(decode(texture2D(tex,uv)) \\n \\\n\t\t\t\t\t,decode(texture2D(tex,uv+vec2(unit.x,0.0))),r.x) \\n \\\n\t\t\t\t,mix(decode(texture2D(tex,uv+vec2(0.0,unit.y))) \\n \\\n\t\t\t\t\t,decode(texture2D(tex,uv+unit)),r.x) \\n \\\n\t\t\t\t,r.y).rgb; \\n \\\n\t\t} \\n \\\n\t\tmediump vec3 textureTri(sampler2D texture,vec2 size,vec2 uv,float w){ \\n \\\n\t\t\tfloat refx = pow(0.5,floor(w));  \\n \\\n\t\t\tuv.t = max(min(uv.t,0.5-0.5/(refx*size.y)),0.5/(refx*size.y)); \\n \\\n\t\t\tmediump vec3 refCol = textureDecode(texture,size,uv*refx + vec2(0.0,1.0-refx));  \\n \\\n\t\t\tmediump vec3 q = textureDecode(texture,size,uv*refx*0.5 + vec2(0.0,1.0-refx*0.5));  \\n \\\n\t\t\treturn mix(refCol,q,fract(w)); \\n \\\n\t\t} \\n \\\n\t\";\n  return ret;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Rastgl);\n\n//# sourceURL=webpack://bc/../lib/lib/rastgl.js?");

/***/ }),

/***/ "../lib/lib/slider.js":
/*!****************************!*\
  !*** ../lib/lib/slider.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Slider; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nvar drag_target = null; //ドラッグ時処理\n\nvar drag = function drag(evt) {\n  if (!evt) {\n    evt = window.event;\n  }\n\n  if (!(evt.buttons & 1)) {\n    drag_target = null;\n  }\n\n  if (!drag_target) {\n    return;\n  }\n\n  var slider = drag_target;\n  var tumami = drag_target.tumami;\n  var mizo = slider.mizo;\n  var left = evt.clientX;\n  var rect = mizo.getBoundingClientRect();\n  var width = tumami.offsetWidth / 2 * 0;\n  var value = Math.round(left - rect.left - width);\n  value /= mizo.clientWidth;\n  value = Math.max(Math.min(value, 1), 0);\n  value = value * (slider.max - slider.min) + slider.min;\n\n  if (slider.step) {\n    value = Math.ceil(value / slider.step) * slider.step;\n  }\n\n  slider.input.value = value;\n  slider.setTumami();\n  _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(slider.input, \"change\");\n  return false;\n};\n\nvar createDiv = function createDiv(slider) {\n  return div;\n};\n\nvar replace = function replace(node, slider) {\n  //対象のノードオブジェクトをスライダに置き換える\n  node.parentNode.replaceChild(slider.node, node); //node.setAttribute(\"class\",\"js-text\");\n\n  node.classList.remove(\"slider\");\n  node.setAttribute(\"number\", \"\");\n  node.setAttribute(\"type\", \"text\");\n  slider.node.replaceChild(node, slider.input);\n  slider.input = node;\n  node.addEventListener(\"input\", slider.changeValue); //input.id=node.id;\n\n  slider.min = Number(node.getAttribute(\"min\"));\n  slider.max = Number(node.getAttribute(\"max\"));\n\n  if (slider.min === slider.max) {\n    slider.max = slider.min + 1;\n  }\n\n  slider.step = Number(node.getAttribute(\"step\"));\n  slider.setTumami();\n};\n\nvar Slider = /*#__PURE__*/_createClass( //スライダーコントロール\nfunction Slider() {\n  var _this = this;\n\n  _classCallCheck(this, Slider);\n\n  _defineProperty(this, \"setTumami\", function () {\n    var slider = _this;\n    var tumami = _this.tumami;\n    var mizo = _this.mizo;\n    var value = Number(_this.input.value);\n    value = (value - slider.min) / (slider.max - slider.min);\n    var max = mizo.offsetWidth;\n    var w = tumami.offsetWidth;\n    if (w == 0) w = 15;\n    if (max == 0) max = 100;\n    tumami.style.left = value * max - w / 2 + 'px';\n  });\n\n  _defineProperty(this, \"changeValue\", function () {\n    _this.setTumami();\n  });\n\n  this.min = 0;\n  this.max = 1;\n  this.step = 0.1; //テキストエリア+スライダー\n\n  var div = document.createElement(\"span\");\n  div.setAttribute(\"class\", \"js-slider\");\n  div.insertAdjacentHTML('beforeend', \"<input type=\\\"text\\\"  class=\\\"js-text\\\">\\n\\t\\t\\t\\t<div class=\\\"js-slider3\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"js-slider2\\\" ></span>\\n\\t\\t\\t\\t\\t<input type=\\\"button\\\"  class=\\\"tumami\\\">\\n\\t\\t\\t\\t</div> \");\n  this.input = div.querySelector('.js-text'); //溝\n\n  this.mizo = div.querySelector('.js-slider3'); //クリック時ツマミ移動\n\n  this.mizo.addEventListener(\"pointerdown\", function (evt) {\n    drag_target = _this;\n    drag(evt);\n    drag_target = null;\n  });\n\n  var _tumami = div.querySelector('.tumami');\n\n  this.tumami = _tumami; //ドラッグ開始\n\n  _tumami.addEventListener(\"pointerdown\", function (evt) {\n    drag_target = _this;\n    evt.stopPropagation();\n  }); //デフォルト処理無効\n\n\n  _tumami.addEventListener(\"touchmove\", function (evt) {\n    evt.preventDefault();\n  }); //値直接変更時にツマミ反映\n\n\n  this.node = div;\n  this.setTumami();\n});\n\n_defineProperty(Slider, \"init\", function (dom) {\n  if (!dom) {\n    dom = document;\n  }\n\n  var e = dom.querySelectorAll('input.slider');\n\n  for (var i = 0; i < e.length; i += 1) {\n    var node = e[i];\n    var slider = new Slider();\n    replace(node, slider);\n  }\n});\n\n\nwindow.addEventListener(\"pointermove\", drag);\nwindow.addEventListener(\"load\", function (e) {\n  Slider.init();\n});\n\n//# sourceURL=webpack://bc/../lib/lib/slider.js?");

/***/ }),

/***/ "../lib/lib/sort.js":
/*!**************************!*\
  !*** ../lib/lib/sort.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n\n\nvar Sort = function () {\n  var ret = function ret() {}; //�o�P�b�g�\\�[�g�p�o�b�t�@\n\n\n  var backet = new Array(16); //2^4\n\n  var backetIndex = new Array(16);\n\n  for (var i = 0; i < backet.length; i++) {\n    backet[i] = new Array(1024); //�傫���͓K��(�ǂ��Ȃ�)\n  }\n\n  ret.backetSort = function (arr, n, func, first, last) {\n    //��\\�[�g�̂��߂̃o�P�b�g�\\�[�g\n    //\n    for (var i = 0; i < backet.length; i++) {\n      //�o�P�c�C���f�b�N�X������\n      backetIndex[i] = 0;\n    }\n\n    if (!func) {\n      func = function func(a) {\n        return a;\n      };\n    }\n\n    for (var i = first; i <= last; i++) {\n      //������߂��̃o�P�c�ɓ����\n      var a = func(arr[i]) >> n & 15;\n      backet[a][backetIndex[a]] = arr[i];\n      backetIndex[a]++;\n    }\n\n    var arrIndex = first;\n\n    for (var i = 0; i < backet.length; i++) {\n      //�o�P�c������o���ĕ��ׂ�\n      for (var j = 0; j < backetIndex[i]; j++) {\n        arr[arrIndex] = backet[i][j];\n        arrIndex++;\n      }\n    }\n  };\n\n  ret.kisu = function (arr, func, first, last) {\n    //��\\�[�g\n    for (var n = 0; n < 32; n += 4) {\n      //������4�r�b�g�������Ɍv8��o�P�c�\\�[�g����\n      this.backetSort(arr, n, func, first, last);\n    }\n  }; //�N�C�b�N�\\�[�g\n\n\n  ret.qSort = function (target, first, last, func) {\n    if (last <= first) {\n      return;\n    }\n\n    var i = first,\n        j = last,\n        p = target[last + 1 + first >> 1],\n        buf;\n\n    while (1) {\n      while (func(target[i], p) < 0) {\n        i++;\n      }\n\n      while (func(target[j], p) > 0) {\n        j--;\n      }\n\n      if (i >= j) break;\n      buf = target[i];\n      target[i] = target[j];\n      target[j] = buf;\n      i++;\n      j--;\n\n      if (i > last || j < first) {\n        break;\n      }\n    }\n\n    this.qSort(target, first, i - 1, func);\n    this.qSort(target, j + 1, last, func);\n    return;\n  };\n\n  return ret;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Sort);\n\n//# sourceURL=webpack://bc/../lib/lib/sort.js?");

/***/ }),

/***/ "../lib/lib/spherical_harmonics/sh.js":
/*!********************************************!*\
  !*** ../lib/lib/spherical_harmonics/sh.js ***!
  \********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ SH; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../vector.js */ \"../lib/lib/vector.js\");\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar SH = /*#__PURE__*/_createClass(function SH() {\n  _classCallCheck(this, SH);\n});\n\n\n;\n\nvar kaijo = function kaijo(n) {\n  //階乗\n  var result = 1;\n\n  for (var i = n; i > 0; i--) {\n    result *= i;\n  }\n\n  return result;\n};\n\nvar kaijo2 = function kaijo2(n) {\n  //二重階乗\n  if (n < 0) {\n    return kaijo2(n + 2) / (n + 2);\n  }\n\n  var result = 1;\n\n  for (var i = n; i > 0; i -= 2) {\n    result *= i;\n  }\n\n  return result;\n};\n\nvar K = function K(l, m) {\n  //(2l+1)(l-|m|)!/(4π)(l+|m|)!\n  var a = (2 * l + 1) / (4 * Math.PI);\n  var b = kaijo(l - Math.abs(m)) / kaijo(l + Math.abs(m));\n  return Math.sqrt(a * b);\n};\n\nvar P = function P(l, m, x) {\n  //ルジャンドルの陪関数\n  if (m === l) {\n    return Math.pow(-1, m) * kaijo2(2 * m - 1) * Math.pow(1 - x * x, m / 2);\n  }\n\n  if (m + 1 === l) {\n    return (2 * m + 1) * x * P(m, m, x);\n  }\n\n  return ((2 * l - 1) * x * P(l - 1, m, x) - (l + m - 1) * P(l - 2, m, x)) / (l - m);\n};\n\nSH.A = function (l) {\n  if (l == 1) {\n    return 2 / 3;\n  } else if (l & 1) {\n    return 0;\n  } else {\n    return 2 * Math.pow(-1, l / 2 - 1) / ((l + 2) * (l - 1)) * (kaijo(l) / (Math.pow(2, l) * Math.pow(kaijo(l / 2), 2)));\n  }\n\n  return 0;\n};\n\nSH.Y = function (l, m, theta, pi) {\n  //球面調和関数\n  if (m > 0) {\n    return Math.sqrt(2) * K(l, m) * Math.cos(m * pi) * P(l, m, Math.cos(theta));\n  } else if (m < 0) {\n    return Math.sqrt(2) * K(l, m) * Math.sin(-m * pi) * P(l, -m, Math.cos(theta));\n  } else {\n    return K(l, 0) * P(l, 0, Math.cos(theta));\n  }\n}; //---------ここから下高速化関数-------------\n//l<=2までの係数を積分で求めるときに使う(最後にencode2_2()を行わないといけない)\n\n\nSH.encode2xyz = function (cs, src, x, y, z) {\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[0], cs[0], src, 1);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[1], cs[1], src, x);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[2], cs[2], src, y);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[3], cs[3], src, z);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[4], cs[4], src, x * z);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[5], cs[5], src, x * y);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[6], cs[6], src, 3 * y * y - 1);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[7], cs[7], src, z * y);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(cs[8], cs[8], src, z * z - x * x);\n};\n\nSH.encode2 = function (cs, src, theta, pi) {\n  var y = Math.cos(theta);\n  var x = Math.sin(pi) * Math.sin(theta);\n  var z = Math.cos(pi) * Math.sin(theta);\n  this.encode2xyz(cs, src, x, y, z);\n}; //l<=2までの係数重み付け\n\n\nvar Y00Y00 = 1;\nvar Y10Y10 = 3;\nvar Y20Y20 = 5 / 4;\nvar Y21Y21 = 15;\nvar Y22Y22 = 15 / 4;\n\nSH.encode2_2 = function (cs) {\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[0], cs[0], Y00Y00);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[1], cs[1], Y10Y10);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[2], cs[2], Y10Y10);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[3], cs[3], Y10Y10);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[4], cs[4], Y21Y21);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[5], cs[5], Y21Y21);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[6], cs[6], Y20Y20);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[7], cs[7], Y21Y21);\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[8], cs[8], Y22Y22);\n}; //encode2の結果から復元\n\n\nSH.decode2xyz = function (result, cs, x, y, z) {\n  var c4 = x * z;\n  var c5 = x * y;\n  var c6 = 3 * y * y - 1;\n  var c7 = z * y;\n  var c8 = z * z - x * x;\n\n  for (var i = 0; i < 3; i++) {\n    result[i] = cs[0][i] + cs[1][i] * x + cs[2][i] * y + cs[3][i] * z + cs[4][i] * c4 + cs[5][i] * c5 + cs[6][i] * c6 + cs[7][i] * c7 + cs[8][i] * c8;\n  }\n};\n\nSH.decode2 = function (result, cs, theta, pi) {\n  var y = Math.cos(theta);\n  var x = Math.sin(pi) * Math.sin(theta);\n  var z = Math.cos(pi) * Math.sin(theta);\n  this.decode2xyz(result, cs, x, y, z);\n};\n\nSH.mulA = function (cs) {\n  var a = this.A(0);\n  var next = 1;\n\n  for (var i = 0; i < cs.length; i++) {\n    if (i > next * next) {\n      a = this.A(next);\n      next++;\n    }\n\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(cs[i], cs[i], a);\n  }\n}; //------係数をそこそこ効率よく求める----------\n\n\nSH.encode3 = function (cs, src, lmax, theta, pi) {\n  var cos = Math.cos(theta);\n  var sin = Math.sin(theta);\n  var m = 0;\n  var P = Math.pow(-1, m) * kaijo2(2 * m - 1) * Math.pow(sin, m);\n  var oldP = 0;\n\n  for (var l = m; l < lmax; l++) {\n    if (l === m + 1) {\n      oldP = P;\n      P = (2 * m + 1) * cos * P;\n    } else if (l > m + 1) {\n      var oldoldP = oldP;\n      oldP = P;\n      P = ((2 * l - 1) * cos * oldP - (l + m - 1) * oldoldP) / (l - m);\n    }\n\n    var c = cs[(l + 1) * l + m];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(c, c, src, P);\n  }\n\n  for (m = 1; m < lmax; m++) {\n    var P = Math.pow(-1, m) * kaijo2(2 * m - 1) * Math.pow(sin, m);\n    var oldP = 0;\n    var cosp = Math.cos(m * pi);\n    var sinp = Math.sin(m * pi);\n\n    for (var l = m; l < lmax; l++) {\n      if (l === m + 1) {\n        oldP = P;\n        P = (2 * m + 1) * cos * P;\n      } else if (l > m + 1) {\n        var oldoldP = oldP;\n        oldP = P;\n        P = ((2 * l - 1) * cos * oldP - (l + m - 1) * oldoldP) / (l - m);\n      }\n\n      var c = cs[(l + 1) * l + m];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(c, c, src, P * cosp);\n      c = cs[(l + 1) * l - m];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(c, c, src, P * sinp);\n    }\n  }\n};\n\nvar K2 = function K2(l, m) {\n  var a = 2 * l + 1;\n  var b = kaijo(l - m) / kaijo(l + m);\n  return a * b;\n};\n\nSH.encode3_2 = function (cs, lmax) {\n  for (var l = 0; l < lmax; l++) {\n    for (var m = 0; m <= l; m++) {\n      var c = cs[(l + 1) * l + m];\n\n      if (m === 0) {\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(c, c, K2(l, m));\n      } else {\n        var a = 2 * K2(l, m);\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(c, c, a);\n        c = cs[(l + 1) * l - m];\n        _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(c, c, a);\n      }\n    }\n  }\n};\n\nSH.decode3 = function (result, cs, lmax, theta, pi) {\n  var cos = Math.cos(theta);\n  var sin = Math.sin(theta);\n  var m = 0;\n  var P = Math.pow(-1, m) * kaijo2(2 * m - 1) * Math.pow(sin, m);\n  var oldP = 0;\n  _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.set(result, 0, 0, 0);\n\n  for (var l = m; l < lmax; l++) {\n    if (l === m + 1) {\n      oldP = P;\n      P = (2 * m + 1) * cos * P;\n    } else if (l > m + 1) {\n      var oldoldP = oldP;\n      oldP = P;\n      P = ((2 * l - 1) * cos * oldP - (l + m - 1) * oldoldP) / (l - m);\n    }\n\n    var c = cs[(l + 1) * l + m];\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(result, result, c, P);\n  }\n\n  for (m = 1; m < lmax; m++) {\n    var P = Math.pow(-1, m) * kaijo2(2 * m - 1) * Math.pow(sin, m);\n    var oldP = 0;\n    var cosp = Math.cos(m * pi);\n    var sinp = Math.sin(m * pi);\n\n    for (var l = m; l < lmax; l++) {\n      if (l === m + 1) {\n        oldP = P;\n        P = (2 * m + 1) * cos * P;\n      } else if (l > m + 1) {\n        var oldoldP = oldP;\n        oldP = P;\n        P = ((2 * l - 1) * cos * oldP - (l + m - 1) * oldoldP) / (l - m);\n      }\n\n      var c = cs[(l + 1) * l + m];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(result, result, c, P * cosp);\n      c = cs[(l + 1) * l - m];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.madd(result, result, c, P * sinp);\n    }\n  }\n}; //l<=2のとき計算を高速化\n\n\nvar Y00 = 1 / 2 * Math.sqrt(1 / Math.PI);\nvar Y10 = 1 / 2 * Math.sqrt(3 / Math.PI);\nvar Y11 = Math.sqrt(3 / (4 * Math.PI));\nvar Y20 = 1 / 4 * Math.sqrt(5 / Math.PI);\nvar Y22 = 3 / 2 * Math.sqrt(5 / (3 * Math.PI));\n\nSH.Y_2 = function (l, m, theta, pi) {\n  if (l > 2) {\n    return this.Y(l, m, theta, pi);\n  }\n\n  var y = Math.cos(theta);\n  var x = Math.sin(pi) * Math.sin(theta);\n  var z = Math.cos(pi) * Math.sin(theta);\n\n  if (l == 0 && m == 0) {\n    return Y00;\n  } else if (l == 1 && m == 0) {\n    return Y10 * y;\n  } else if (l == 1 && m == -1) {\n    return Y11 * x;\n  } else if (l == 1 && m == 1) {\n    return Y11 * z;\n  } else if (l == 2 && m == 0) {\n    return Y20 * (3 * y * y - 1);\n  } else if (l == 2 && m == -1) {\n    return Y22 * x * y;\n  } else if (l == 2 && m == 1) {\n    return Y22 * z * y;\n  } else if (l == 2 && m == -2) {\n    return Y22 * x * z;\n  } else if (l == 2 && m == 2) {\n    return Y22 / 2 * (z * z - x * x);\n  }\n};\n\nvar As = [];\n\nfor (var i = 0; i < 9; i++) {\n  var a = SH.A(i);\n  As.push(a);\n}\n\n//# sourceURL=webpack://bc/../lib/lib/spherical_harmonics/sh.js?");

/***/ }),

/***/ "../lib/lib/util.js":
/*!**************************!*\
  !*** ../lib/lib/util.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Util; }\n/* harmony export */ });\n/* harmony import */ var _fpsman_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fpsman.js */ \"../lib/lib/fpsman.js\");\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nwindow.globalParam = {};\nvar myIE = document.all; //IEflg\n\nvar ua = window.navigator.userAgent.toLowerCase();\n\nif (ua.indexOf(\"windows\" !== -1)) {\n  globalParam.windows = 1;\n}\n\nvar i = 0,\n    keymap = new Array(256);\n[37, 38, 39, 40, ' '.charCodeAt(0), 'X'.charCodeAt(0), 'C'.charCodeAt(0), 'V'.charCodeAt(0), 'A'.charCodeAt(0), 'W'.charCodeAt(0), 'D'.charCodeAt(0), 'S'.charCodeAt(0), 'F'.charCodeAt(0), 'G'.charCodeAt(0), 'H'.charCodeAt(0), 'J'.charCodeAt(0)].forEach(function (e, idx) {\n  keymap[e] = idx;\n});\nvar virtualPad = null;\nvar virtualPadP = null;\nvar virtualBtn = null;\n\nvar Util = /*#__PURE__*/function () {\n  function Util() {\n    _classCallCheck(this, Util);\n  }\n\n  _createClass(Util, null, [{\n    key: \"getLoadingCount\",\n    value: function getLoadingCount() {\n      return Util.loadingCount;\n    }\n  }, {\n    key: \"mainloop\",\n    value: function mainloop() {\n      var dx, dy;\n      Util.tap = 0;\n\n      if (Util.pressOn) {\n        Util.pressCount = Util.pressCount + 1;\n\n        if (Util.pressCount == 1) {\n          Util.oldcursorX2 = Util.cursorX;\n          Util.oldcursorY2 = Util.cursorY;\n          Util.oldcursorX = Util.cursorX;\n          Util.oldcursorY = Util.cursorY;\n        }\n      } else if (Util.pressCount > 0) {\n        dx = Util.cursorX - Util.oldcursorX2;\n        dy = Util.cursorY - Util.oldcursorY2;\n\n        if (Util.pressCount < 10 && dx * dx + dy * dy < 16) {\n          Util.tap = 1;\n        }\n\n        Util.pressCount = -1;\n      } else Util.pressCount = 0;\n\n      if (Util.pressOnRight) {\n        Util.pressCountRight += 1;\n      } else {\n        Util.pressCountRight = 0;\n      } //if(loadingCount ==0){\n\n\n      Util.mainfunc(); //}\n\n      Util.oldcursorX = Util.cursorX;\n      Util.oldcursorY = Util.cursorY;\n      var i;\n\n      for (i = Util.keyflag.length; i--;) {\n        Util.keyflagOld[i] = Util.keyflag[i];\n      }\n    }\n  }, {\n    key: \"loadImage\",\n    value: function loadImage(url, norepeat, func) {\n      var image = new Image();\n      var flg = true;\n      if (globalParam.files) for (var i = 0, f; f = globalParam.files[i]; i++) {\n        if (escape(f.name) == url) {\n          //ローカルファイルの場合\n          var reader = new FileReader();\n\n          reader.onload = function (e) {\n            image.src = e.target.result;\n          };\n\n          reader.readAsDataURL(f);\n          flg = false;\n          break;\n        }\n      }\n\n      if (flg) {\n        //リモートファイルの場合\n        image.src = url;\n      } //ロードカウンタを増やす\n\n\n      Util.loadingCount++;\n\n      image.onerror = function () {\n        //エラーの場合減らす\n        Util.loadingCount--;\n      };\n\n      console.log(\"load start\", url); //読み込みが終わっていない場合はイベントリスナ登録\n\n      image.addEventListener(\"load\", function (e) {\n        if (!image.pat) {\n          console.log(\"load end\", image); //ロード処理(1回のみ)\n          //ロードカウンタを減らす\n\n          Util.loadingCount--;\n\n          if (norepeat) {\n            image.pat = Util.ctx.createPattern(image, \"no-repeat\");\n          } else {\n            image.pat = Util.ctx.createPattern(image, \"repeat\");\n          }\n\n          Util.imagedatacontext.clearRect(0, 0, Util.imagedatacanvas.width, Util.imagedatacanvas.height);\n          Util.imagedatacontext.drawImage(image, 0, 0);\n\n          if (Util.imagedatacontext.getImageData) {\n            image.imagedata = Util.imagedatacontext.getImageData(0, 0, image.width, image.height);\n          }\n        }\n\n        if (func) {\n          //コールバック指定がある場合は行う\n          func(image);\n        }\n      });\n      return image;\n    }\n  }, {\n    key: \"loadText\",\n    value: function loadText(url, callback) {\n      var flg = true;\n      var filename_ex = url.match(\"([^/]+?)([\\?#;].*)?$\")[1];\n\n      if (globalParam.files) {\n        for (var i = 0, f; f = globalParam.files[i]; i++) {\n          if (escape(f.name) == filename_ex) {\n            var reader = new FileReader();\n\n            reader.onload = function (e) {\n              var buf = e.target.result;\n\n              if (callback) {\n                callback(buf);\n              }\n            };\n\n            reader.readAsText(f);\n            flg = false;\n            break;\n          }\n        }\n      }\n\n      if (!flg) {\n        return null;\n      }\n\n      var request = Util.createXMLHttpRequest();\n      request.open(\"GET\", url, true);\n\n      request.onload = function (e) {\n        if (request.status == 200 || request.status == 304) {\n          var buf = request.responseText;\n\n          if (callback) {\n            callback(buf);\n          }\n        } else {\n          if (callback) {\n            callback(null);\n          }\n        }\n\n        Util.loadingCount--;\n        console.log(\"loadtext end\", Util.loadingCount);\n      };\n\n      request.onerror = function (e) {\n        if (callback) {\n          callback(null);\n        }\n\n        Util.loadingCount--;\n        console.log(\"loadtext failed\", Util.loadingCount);\n      };\n\n      console.log(\"loadtext start\", url);\n      Util.loadingCount++;\n      request.send(\"\");\n      return request;\n    }\n  }, {\n    key: \"loadFile\",\n    value: function loadFile(file, callback) {\n      var reader = new FileReader();\n\n      reader.onload = function (e) {\n        if (callback) {\n          callback(e.target.result);\n        }\n      };\n\n      reader.readAsDataURL(file);\n    }\n  }, {\n    key: \"loadBinary\",\n    value: function loadBinary(url, _callback) {\n      if (typeof url !== \"string\") {\n        Util.loadFile(url, function (url) {\n          Util.loadBinary(url, _callback);\n        });\n        return null;\n      }\n\n      var callback = _callback;\n\n      var cfunc = function cfunc(buf) {\n        if (callback) {\n          callback(buf);\n        }\n\n        Util.loadingCount--;\n        console.log(\"loadbinary end\", Util.loadingCount);\n      };\n\n      console.log(\"loadbinary start\", url);\n      Util.loadingCount++;\n      var request = Util.createXMLHttpRequest();\n      request.open(\"GET\", url, true);\n      request.responseType = \"arraybuffer\";\n\n      request.onload = function (e) {\n        cfunc(request.response);\n      };\n\n      request.send(\"\");\n    }\n  }, {\n    key: \"rgb\",\n    value: function rgb(r, g, b) {\n      r = (0x100 | r * 255).toString(16);\n      g = (0x100 | g * 255).toString(16);\n      b = (0x100 | b * 255).toString(16);\n      return \"#\" + r.slice(-2) + g.slice(-2) + b.slice(-2);\n    }\n  }, {\n    key: \"str2rgba\",\n    value: function str2rgba(rgba, str) {\n      var sp = str.split(\",\");\n      rgba[0] = Number(sp[0]);\n      rgba[1] = Number(sp[1]);\n      rgba[2] = Number(sp[2]);\n      rgba[3] = Number(sp[3]);\n      return rgba;\n    }\n  }, {\n    key: \"rgba\",\n    value: function rgba(r, g, b, a) {\n      return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n    }\n  }, {\n    key: \"hsv2rgb\",\n    value: function hsv2rgb(rgb, hsv) {\n      //hsvをrgbに変換\n      var f;\n      var i, p, q, t;\n      var v = hsv[2];\n      var h = hsv[0];\n      var s = hsv[1];\n      i = (h * 6 | 0) % 6;\n      f = h * 6 - (h * 6 | 0);\n      p = v * (1.0 - s);\n      q = v * (1.0 - s * f);\n      t = v * (1.0 - s * (1.0 - f));\n\n      switch (i) {\n        case 0:\n          rgb[0] = v;\n          rgb[1] = t;\n          rgb[2] = p;\n          break;\n\n        case 1:\n          rgb[0] = q;\n          rgb[1] = v;\n          rgb[2] = p;\n          break;\n\n        case 2:\n          rgb[0] = p;\n          rgb[1] = v;\n          rgb[2] = t;\n          break;\n\n        case 3:\n          rgb[0] = p;\n          rgb[1] = q;\n          rgb[2] = v;\n          break;\n\n        case 4:\n          rgb[0] = t;\n          rgb[1] = p;\n          rgb[2] = v;\n          break;\n\n        case 5:\n          rgb[0] = v;\n          rgb[1] = p;\n          rgb[2] = q;\n          break;\n      }\n\n      return rgb;\n    }\n  }, {\n    key: \"rgb2hex\",\n    value: function rgb2hex(rgb) {\n      //rgbを16進数の文字列に変換\n      var r = (0x100 | rgb[0] * 255).toString(16);\n      var g = (0x100 | rgb[1] * 255).toString(16);\n      var b = (0x100 | rgb[2] * 255).toString(16);\n      return r.slice(-2) + g.slice(-2) + b.slice(-2);\n    }\n  }, {\n    key: \"rgb2hsv\",\n    value: function rgb2hsv(hsv, rgb) {\n      //rgbをhsvに変換\n      var max = Math.max(rgb[0], Math.max(rgb[1], rgb[2]));\n      var min = Math.min(rgb[0], Math.min(rgb[1], rgb[2]));\n\n      if (max == min) {\n        hsv[0] = 0;\n      } else if (max == rgb[0]) {\n        hsv[0] = 1 / 6 * (rgb[1] - rgb[2]) / (max - min) + 1;\n      } else if (max == rgb[1]) {\n        hsv[0] = 1 / 6 * (rgb[2] - rgb[0]) / (max - min) + 2 / 6;\n      } else if (max == rgb[2]) {\n        hsv[0] = 1 / 6 * (rgb[0] - rgb[1]) / (max - min) + 4 / 6;\n      }\n\n      hsv[0] -= hsv[0] | 0;\n\n      if (max == 0) {\n        hsv[1] = 0;\n      } else {\n        hsv[1] = (max - min) / max;\n      }\n\n      hsv[2] = max;\n      return hsv;\n    }\n  }, {\n    key: \"init\",\n    value: function init(canvas, canvasgl, _inputarea) {\n      Util.canvasgl = canvasgl;\n      Util.canvas = canvas;\n\n      if (!Util.canvas || !Util.canvas.getContext) {\n        return false;\n      }\n\n      Util.SCREEN_W = Util.canvas.getAttribute('width');\n      Util.SCREEN_H = Util.canvas.getAttribute('height');\n      Util.ctx = Util.canvas.getContext('2d');\n      Util.ctx.clearRect(0, 0, Util.SCREEN_W, Util.SCREEN_H);\n      Util.imagedatacanvas = Util.createCanvas(1024, 1024);\n      Util.imagedatacontext = Util.imagedatacanvas.getContext('2d');\n      var inputarea = _inputarea;\n\n      if (inputarea) {\n        inputarea.onselect = function () {\n          return false;\n        };\n\n        inputarea.onselectstart = function () {\n          return false;\n        };\n      }\n\n      var setCursor = function setCursor(x, y) {\n        var target = Util.canvasgl;\n        var scalex = 0;\n        var scaley = 0;\n\n        if (target.clientWidth > 0) {\n          scalex = target.width / target.clientWidth;\n          scaley = target.height / target.clientHeight;\n        }\n\n        var rect = target.getBoundingClientRect(); //if(e.currentTarget.getBoundingClientRect){\n        //}\n\n        Util.cursorX = (x - rect.left) * scalex;\n        Util.cursorY = (y - rect.top) * scaley;\n      };\n\n      var tap = function tap() {};\n\n      var tapout = function tapout() {\n        Util.padX = 0;\n        Util.padY = 0;\n        virtualPad.style.display = \"none\";\n      };\n\n      Util.mouseMove = function (elem, func) {\n        if (!elem) return;\n        elem.addEventListener(\"pointermove\", function (e) {\n          e = e || window.event;\n          func(e);\n          e.preventDefault();\n        }, false);\n      };\n\n      Util.mouseDown = function (elem, func) {\n        if (!elem) return;\n        elem.addEventListener(\"pointerdown\", function (e) {\n          e = e || window.event;\n          func(e);\n          e.preventDefault();\n        });\n      };\n\n      Util.mouseUp = function (elem, func) {\n        elem.addEventListener(\"pointerup\", function (e) {\n          e = e || window.event;\n          func(e);\n        });\n      };\n\n      Util.mouseMove(inputarea, function (e) {\n        setCursor(e.pageX, e.pageY);\n\n        if (virtualPad.style.display === \"block\") {\n          var target = e.currentTarget;\n          Util.padX = (e.cursorX - virtualPad.offsetLeft) / virtualPad.offsetWidth * 2 - 1;\n          Util.padY = (e.cursorY - virtualPad.offsetTop) / virtualPad.offsetHeight * 2 - 1;\n          var l = Util.padX * Util.padX + Util.padY * Util.padY;\n\n          if (l > 1.0) {\n            l = Math.sqrt(l);\n            Util.padX = Util.padX / l;\n            Util.padY = Util.padY / l; //\t\t\t\t\tvirtualPad.style.left = e.relativeX - Util.padX * virtualPad.offsetWidth*0.5 + \"px\";\n            //\t\t\t\t\tvirtualPad.style.top= e.relativeY - Util.padY * virtualPad.offsetHeight*0.5 + \"px\";\n          }\n\n          setPad();\n        }\n      });\n      Util.mouseDown(inputarea, function (e) {\n        setCursor(e.pageX, e.pageY);\n\n        switch (e.button) {\n          case 0:\n            Util.pressOn = 1;\n            break;\n\n          case 2:\n            Util.pressOnRight = 1;\n            break;\n        }\n      });\n      Util.mouseUp(window, function (e) {\n        setCursor(e.pageX, e.pageY);\n\n        switch (e.button) {\n          case 0:\n            Util.pressOn = 0;\n            tapout();\n            break;\n\n          case 2:\n            Util.pressOnRight = 0;\n            break;\n        }\n\n        Util.keyflag[4] = 0;\n      }); //バーチャルパッド\n\n      var setPad = function setPad() {\n        virtualPadP.style.left = (Util.padX + 1.0) * 50 + \"%\";\n        virtualPadP.style.top = (Util.padY + 1.0) * 50 + \"%\";\n      };\n\n      var varea = document.getElementById(\"vertualPadArea\");\n      Util.mouseDown(varea, function (e) {\n        switch (e.button) {\n          case 0:\n            virtualPad.style.display = \"block\";\n            Util.padX = 0;\n            Util.padY = 0; //\t\t\t\tvirtualPad.style.left = e.relativeX+\"px\";\n            //\t\t\t\tvirtualPad.style.top= e.relativeY+ \"px\";\n\n            setPad();\n            e.stopPropagation();\n            break;\n        }\n      });\n\n      if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {} else {\n        var wheelfunc = function wheelfunc(e) {\n          e = e || window.event;\n\n          if (e.wheelDelta) {\n            Util.wheelDelta = e.wheelDelta / 120;\n            if (window.opera) Util.wheelDelta = -Util.wheelDelta;\n          } else if (e.detail) {\n            Util.wheelDelta = -e.detail / 3;\n          }\n\n          if (e.preventDefault) e.preventDefault(); //e.returnValue = false\n        };\n\n        if (window.addEventListener) window.addEventListener('DOMMouseScroll', wheelfunc, {\n          passive: true\n        });else if (document.attachEvent) document.attachEvent('onmousewheel', wheelfunc);else if (inputarea) inputarea.onmousewheel = wheelfunc;\n\n        document.body.onkeydown = function (e) {\n          e = e || window.event;\n          var code = e.keyCode;\n\n          if (Util.keymap[code] != null) {\n            Util.keyflag[Util.keymap[code]] = 1;\n          }\n\n          if (code == 13) {\n            Util.canvasgl.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n\n            if (window.parent.screen.width / Util.canvasgl.width > window.parent.screen.height / Util.canvasgl.height) {\n              canvasgl.style.width = \"auto\";\n              canvasgl.style.height = \"100%\";\n            } else {\n              canvasgl.style.width = \"100%\";\n              canvasgl.style.height = \"auto\";\n            }\n          }\n        };\n\n        document.body.onkeyup = function (e) {\n          e = e || window.event;\n          var code = e.keyCode;\n\n          if (Util.keymap[code] != null) {\n            Util.keyflag[Util.keymap[code]] = 0;\n          }\n        };\n\n        document.body.onblur = function (e) {\n          e = e || window.event;\n          var code = e.keyCode;\n\n          for (var i = 0; i < Util.keyflag.length; i++) {\n            Util.keyflag[i] = 0;\n          }\n        };\n      }\n\n      virtualPad = document.createElement(\"div\");\n      virtualPad.style.backgroundColor = \"#ff0000\";\n      virtualPad.style.opacity = \"0.3\";\n      virtualPad.style.width = \"256px\";\n      virtualPad.style.height = \"256px\";\n      virtualPad.style.position = \"absolute\";\n      virtualPad.style.left = \"10px\";\n      virtualPad.style.top = \"10px\";\n      virtualPad.style.borderRadius = \"50%\";\n      virtualPad.style.zIndex = \"10\";\n      virtualPad.style.display = \"none\";\n      virtualPad.style.marginLeft = \"-128px\";\n      virtualPad.style.marginTop = \"-128px\";\n      if (inputarea) inputarea.appendChild(virtualPad);\n      virtualPadP = document.createElement(\"div\");\n      virtualPadP.style.backgroundColor = \"#00ff00\";\n      virtualPadP.style.width = \"32px\";\n      virtualPadP.style.height = \"32px\";\n      virtualPadP.style.position = \"absolute\";\n      virtualPadP.style.borderRadius = \"50%\";\n      virtualPadP.style.marginLeft = \"-16px\";\n      virtualPadP.style.marginTop = \"-16px\";\n      virtualPad.appendChild(virtualPadP);\n      virtualBtn = document.createElement(\"div\");\n      virtualBtn.style.backgroundColor = \"#0000ff\";\n      virtualBtn.style.opacity = \"0.25\";\n      virtualBtn.style.width = \"256px\";\n      virtualBtn.style.height = \"256px\";\n      virtualBtn.style.position = \"absolute\";\n      virtualBtn.style.right = \"10%\";\n      virtualBtn.style.bottom = \"20%\";\n      virtualBtn.style.borderRadius = \"50%\";\n      virtualBtn.style.zIndex = \"100\";\n      virtualBtn.style.display = \"none\";\n      virtualBtn.innerHTML = \"jump\";\n      if (inputarea) inputarea.appendChild(virtualBtn);\n\n      if (Util.enableVirtualBtn) {\n        virtualBtn.style.display = \"inline\";\n      }\n\n      if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n        virtualBtn.addEventListener(\"touchstart\", function (e) {\n          e = e || window.event;\n          Util.keyflag[4] = 1;\n        }, false);\n        window.addEventListener(\"touchend\", function (e) {\n          e = e || window.event;\n          Util.keyflag[4] = 0;\n        }, false);\n        virtualBtn.addEventListener(\"touchmove\", function (e) {}, false);\n        virtualBtn.addEventListener(\"touchend\", function (e) {\n          Util.keyflag[4] = 0;\n        }, false);\n      } else {\n        virtualBtn.onmousedown = function (e) {\n          e = e || window.event;\n          Util.keyflag[4] = 1; //e.stopPropagation();\n        };\n\n        virtualBtn.onmouseup = function (e) {\n          e = e || window.event;\n          Util.keyflag[4] = 0;\n        };\n      }\n    }\n  }, {\n    key: \"setFps\",\n    value: function setFps(argfps, mf) {\n      Util.mainfunc = mf;\n      Util.fpsman = new _fpsman_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](argfps, function () {\n        Util.mainloop();\n      });\n      Util.pressCount = 0;\n    }\n  }, {\n    key: \"drawText\",\n    value: function drawText(target, x, y, text, img, sizex, sizey) {\n      var dx = x;\n      var dy = y;\n      var i, max;\n      var sx, sy;\n\n      for (i = 0, max = text.length; i < max; i++) {\n        sx = text.charCodeAt(i) - 32;\n        sy = (sx >> 4) * sizex;\n        sx = (sx & 0xf) * sizey;\n        target.drawImage(img, sx, sy, sizex, sizey, dx, dy, sizex, sizey);\n        dx = dx + sizex;\n      }\n    }\n  }, {\n    key: \"convertURLcode\",\n    value: function convertURLcode(str) {\n      var imax = str.length,\n          jmax,\n          i,\n          j,\n          charcode,\n          percent = '%'.charCodeAt(0),\n          decode = \"\",\n          sub;\n\n      for (i = 0; i < imax; i++) {\n        charcode = str.charCodeAt(i);\n\n        if (charcode == percent) {\n          i++;\n          charcode = parseInt(str.slice(i, i + 2), 16);\n\n          if ((charcode & 0xF0) == 0xE0) {\n            jmax = 2;\n            charcode = charcode & 0xf;\n          } else if ((charcode & 0xE0) == 0xC0) {\n            jmax = 1;\n            charcode = charcode & 0x1f;\n          } else {\n            jmax = 0;\n          }\n\n          i += 1;\n\n          for (j = 0; j < jmax; j++) {\n            i += 2;\n            charcode <<= 6;\n            charcode |= parseInt(str.slice(i, i + 2), 16) & 0x3f;\n            i += 1;\n          }\n        }\n\n        decode += String.fromCharCode(charcode);\n      }\n\n      return decode;\n    }\n  }, {\n    key: \"fireEvent\",\n    value: function fireEvent(elem, eventname, evt) {\n      if (document.all) {\n        elem.fireEvent(\"on\" + eventname);\n      } else {\n        if (!evt) {\n          evt = document.createEvent(\"Event\");\n        }\n\n        evt.initEvent(eventname, true, true);\n        elem.dispatchEvent(evt);\n      }\n    }\n  }, {\n    key: \"setText\",\n    value: function setText(elem, text) {\n      elem.innerText = text; //elem.textContent=text;\n      //elem.innerHTML=text;\n    }\n  }, {\n    key: \"getText\",\n    value: function getText(elem) {\n      return elem.textContent ? elem.textContent : elem.innerText;\n    }\n  }, {\n    key: \"stringToUtf8\",\n    value: function stringToUtf8(str) {\n      var utf8str = unescape(encodeURIComponent(str));\n      var utf8array = new Uint8Array(utf8str.length);\n\n      for (var i = 0; i < utf8str.length; i++) {\n        utf8array[i] = utf8str.charCodeAt(i);\n      }\n\n      return utf8array;\n    }\n  }, {\n    key: \"utf8ToString\",\n    value: function utf8ToString(array) {\n      var str = \"\";\n\n      for (var i = 0; i < array.length; i++) {\n        str += String.fromCharCode(array[i]);\n      }\n\n      return decodeURIComponent(escape(str));\n    }\n  }]);\n\n  return Util;\n}();\n\n_defineProperty(Util, \"SCREEN_W\", void 0);\n\n_defineProperty(Util, \"SCREEN_H\", void 0);\n\n_defineProperty(Util, \"imagedatacanvas\", void 0);\n\n_defineProperty(Util, \"imagedatacontext\", void 0);\n\n_defineProperty(Util, \"loadingCount\", 0);\n\n_defineProperty(Util, \"ctx\", null);\n\n_defineProperty(Util, \"canvas\", null);\n\n_defineProperty(Util, \"canvasgl\", null);\n\n_defineProperty(Util, \"cursorX\", 0);\n\n_defineProperty(Util, \"cursorY\", 0);\n\n_defineProperty(Util, \"padX\", 0);\n\n_defineProperty(Util, \"padY\", 0);\n\n_defineProperty(Util, \"wheelDelta\", 0);\n\n_defineProperty(Util, \"pressOn\", 0);\n\n_defineProperty(Util, \"pressCount\", 0);\n\n_defineProperty(Util, \"pressOnRight\", 0);\n\n_defineProperty(Util, \"pressCountRight\", 0);\n\n_defineProperty(Util, \"oldcursorX\", 0);\n\n_defineProperty(Util, \"oldcursorY\", 0);\n\n_defineProperty(Util, \"screenscale\", 1);\n\n_defineProperty(Util, \"tap\", 0);\n\n_defineProperty(Util, \"keyflag\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n\n_defineProperty(Util, \"keyflagOld\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n\n_defineProperty(Util, \"keymap\", keymap);\n\n_defineProperty(Util, \"enablePad\", 1);\n\n_defineProperty(Util, \"createCanvas\", function (width, height) {\n  var canvas = document.createElement(\"canvas\");\n\n  if (typeof G_vmlCanvasManager !== 'undefined') {\n    canvas = G_vmlCanvasManager.initElement(canvas);\n  }\n\n  canvas.setAttribute('width', width);\n  canvas.setAttribute('height', height);\n  return canvas;\n});\n\n_defineProperty(Util, \"hex2rgb\", function (rgb, hex) {\n  //16進数の文字列をrgbに変換\n  rgb[0] = parseInt(hex.slice(0, 2), 16) / 255;\n  rgb[1] = parseInt(hex.slice(2, 4), 16) / 255;\n  rgb[2] = parseInt(hex.slice(4, 6), 16) / 255;\n\n  if (isNaN(rgb[0])) {\n    rgb[0] = 0;\n  }\n\n  ;\n\n  if (isNaN(rgb[1])) {\n    rgb[1] = 0;\n  }\n\n  ;\n\n  if (isNaN(rgb[2])) {\n    rgb[2] = 0;\n  }\n\n  ;\n  return rgb;\n});\n\n_defineProperty(Util, \"createXMLHttpRequest\", function () {\n  if (window.XMLHttpRequest) {\n    return new XMLHttpRequest();\n  } else if (window.ActiveXObject) {\n    try {\n      return new ActiveXObject(\"Msxml2.XMLHTTP\");\n    } catch (e) {\n      try {\n        return new ActiveXObject(\"Microsoft.XMLHTTP\");\n      } catch (e2) {\n        return null;\n      }\n    }\n  } else {\n    return null;\n  }\n});\n\n_defineProperty(Util, \"getCurrent\", function () {\n  var current = \"/\";\n\n  if (document.currentScript) {\n    current = document.currentScript.src;\n  } else {\n    var scripts = document.getElementsByTagName('script'),\n        script = scripts[scripts.length - 1];\n\n    if (script.src) {\n      current = script.src;\n    }\n  }\n\n  current = current.substring(0, current.lastIndexOf('/') + 1);\n  return current;\n});\n\n_defineProperty(Util, \"loadJs\", function (path, func) {////var script = document.createElement('script');\n  ////script.type=\"module\"\n  ////script.src = path;\n  //loadingCount++;\n  //var _func = func;\n  //import(path)\n  //.then( function(){\n  //\tloadingCount--;\n  //\tif(_func){\n  //\t\t_func();\n  //\t}\n  //})\n  //.catch(function(){\n  //\tloadingCount--;\n  //})\n  ////document.head.appendChild(script);\n});\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/util.js?");

/***/ }),

/***/ "../lib/lib/vector.js":
/*!****************************!*\
  !*** ../lib/lib/vector.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Mat44\": function() { return /* binding */ Mat44; },\n/* harmony export */   \"Vec2\": function() { return /* binding */ Vec2; },\n/* harmony export */   \"Vec3\": function() { return /* binding */ Vec3; },\n/* harmony export */   \"Vec4\": function() { return /* binding */ Vec4; },\n/* harmony export */   \"Mat33\": function() { return /* binding */ Mat33; },\n/* harmony export */   \"Mat43\": function() { return /* binding */ Mat43; }\n/* harmony export */ });\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar Vec2 = function () {\n  var Vec2 = function Vec2() {\n    this[0] = 0.0;\n    this[1] = 0.0;\n  };\n\n  var ret = Vec2;\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n  };\n\n  ret.scalar = function (a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n  };\n\n  ret.scalar2 = function (a) {\n    return a[0] * a[0] + a[1] * a[1];\n  };\n\n  ret.set = function (a, x, y) {\n    a[0] = x;\n    a[1] = y;\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n  };\n\n  ret.len = function (a, b) {\n    return Math.sqrt((a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]));\n  };\n\n  ret.len2 = function (a, b) {\n    return (a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]);\n  };\n\n  ret.nrm = function (a, b) {\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n\n  ret.norm = function (a) {\n    var l = Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n\n  ret.dot = function (a, b) {\n    return a[0] * b[0] + a[1] * b[1];\n  };\n\n  ret.cross = function (a, b) {\n    return a[0] * b[1] - a[1] * b[0];\n  };\n\n  return ret;\n}();\n\nvar Vec3 = function () {\n  var Vec3 = function Vec3() {\n    //var o=new Array(3);\n    var o = new Float32Array(3);\n    o[0] = 0;\n    o[1] = 0;\n    o[2] = 0;\n    return o;\n  };\n\n  var ret = Vec3;\n  ret.ZERO = new Vec3();\n\n  ret.set = function (a, x, y, z) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  };\n\n  ret.mult = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n  };\n\n  ret.len = function (b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return Math.sqrt(buf0 * buf0 + buf1 * buf1 + buf2 * buf2);\n  };\n\n  ret.len2 = function (b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return buf0 * buf0 + buf1 * buf1 + buf2 * buf2;\n  };\n\n  ret.scalar = function (a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n  };\n\n  ret.scalar2 = function (a) {\n    return a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\n  };\n\n  ret.nrm = function (a, b) {\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1] + b[2] * b[2]);\n\n    if (l == 0) {\n      return;\n    }\n\n    l = 1 / l;\n    a[0] = b[0] * l;\n    a[1] = b[1] * l;\n    a[2] = b[2] * l;\n  };\n\n  ret.norm = function (a) {\n    var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n\n    if (l == 0) {\n      return;\n    }\n\n    l = 1 / l;\n    a[0] *= l;\n    a[1] *= l;\n    a[2] *= l;\n  };\n\n  ret.dot = function (a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n  };\n\n  ret.vecmul = function (a, b, c) {\n    a[0] = b[0] * c[0];\n    a[1] = b[1] * c[1];\n    a[2] = b[2] * c[2];\n  };\n\n  ret.cross = function (a, b, c) {\n    var buf0 = b[1] * c[2] - b[2] * c[1];\n    var buf1 = b[2] * c[0] - b[0] * c[2];\n    var buf2 = b[0] * c[1] - b[1] * c[0];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n  };\n\n  var buf1 = new Vec3();\n  var buf2 = new Vec3();\n\n  ret.cross3 = function (a, b, c, d, e) {\n    Vec3.sub(buf1, c, b);\n    Vec3.sub(buf2, e, d);\n    Vec3.cross(a, buf1, buf2);\n  };\n\n  ret.cross2 = function (a, b, c, d) {\n    ret.cross3(a, b, c, b, d);\n  };\n\n  return ret;\n}();\n\nvar Vec4 = function () {\n  var buf0, buf1, buf2, buf3;\n  var x2, y2, z2, xy, yz, zx, xw, yw, zw;\n  var qr, ss, flag, sp, ph, pt, t1, t0;\n\n  var Vec4 = function Vec4() {\n    var o = new Float32Array(4);\n    o[0] = 0;\n    o[1] = 0;\n    o[2] = 0;\n    o[3] = 0;\n    return o; //this[0]=0.0\n    //this[1]=0.0\n    //this[2]=0.0\n    //this[3]=1.0\n  };\n\n  var ret = Vec4;\n\n  ret.set = function (a, x, y, z, w) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n    a[3] = w;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] *= c;\n    a[1] *= c;\n    a[2] *= c;\n    a[3] *= c;\n  };\n\n  ret.set = function (a, x, y, z, w) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n    a[3] = w;\n  };\n\n  ret.qdot = function (a, b, c) {\n    buf0 = b[0] * c[0] - b[1] * c[1] - b[2] * c[2] - b[3] * c[3];\n    buf1 = b[0] * c[1] + c[0] * b[1] + b[2] * c[3] - b[3] * c[2];\n    buf2 = b[0] * c[2] + c[0] * b[2] + b[3] * c[1] - b[1] * c[3];\n    buf3 = b[0] * c[3] + c[0] * b[3] + b[1] * c[2] - b[2] * c[1];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n\n  ret.qmul = function (a, b, c) {\n    if (b[0] == 1) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n      return;\n    }\n\n    var theta = Math.acos(b[0]);\n    var r = Math.sin(theta * c) / Math.sin(theta);\n    a[0] = Math.cos(theta * c);\n    a[1] = b[1] * r;\n    a[2] = b[2] * r;\n    a[3] = b[3] * r;\n  };\n\n  ret.qmdot = function (a, b, c) {\n    buf0 = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    buf1 = -b[0] * c[1] + c[0] * b[1] - b[2] * c[3] + b[3] * c[2];\n    buf2 = -b[0] * c[2] + c[0] * b[2] - b[3] * c[1] + b[1] * c[3];\n    buf3 = -b[0] * c[3] + c[0] * b[3] - b[1] * c[2] + b[2] * c[1];\n    a[0] = Math.min(1, Math.max(-1, buf0));\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n\n  ret.fromRotVector = function (v, w, x, y, z) {\n    var SIN = Math.sin(w * 0.5);\n    v[0] = Math.cos(w * 0.5);\n    ;\n    v[1] = SIN * x;\n    v[2] = SIN * y;\n    v[3] = SIN * z;\n  };\n\n  ret.toTorque = function (v, q) {\n    var w = Math.acos(q[0]) * 2;\n\n    if (w !== 0) {\n      w = w / Math.sin(w * 0.5);\n    } else {\n      w = 0;\n    }\n\n    v[0] = q[1] * w;\n    v[1] = q[2] * w;\n    v[2] = q[3] * w;\n  };\n\n  ret.rotVec3 = function (a, b, c) {\n    //c = (0,x,y,z)\n    buf0 = -b[1] * c[0] - b[2] * c[1] - b[3] * c[2];\n    buf1 = b[0] * c[0] + b[2] * c[2] - b[3] * c[1];\n    buf2 = b[0] * c[1] + b[3] * c[0] - b[1] * c[2];\n    buf3 = b[0] * c[2] + b[1] * c[1] - b[2] * c[0];\n    a[0] = -buf0 * b[1] + b[0] * buf1 - buf2 * b[3] + buf3 * b[2];\n    a[1] = -buf0 * b[2] + b[0] * buf2 - buf3 * b[1] + buf1 * b[3];\n    a[2] = -buf0 * b[3] + b[0] * buf3 - buf1 * b[2] + buf2 * b[1];\n  };\n\n  ret.toMat33 = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n  };\n\n  ret.toMat43 = ret.qTOm = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  }; //\n\n\n  ret.slerp = function (a, b, c, t) {\n    qr = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    ss = 1.0 - qr * qr;\n    flag = 0;\n\n    if (qr < 0) {\n      flag = 1;\n      qr *= -1;\n    }\n\n    if (ss <= 0.0) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n    } else {\n      sp = Math.sqrt(ss);\n      ph = Math.acos(qr);\n      pt = ph * t;\n      t1 = Math.sin(pt) / sp;\n      t0 = Math.sin(ph - pt) / sp;\n      if (flag) t1 *= -1;\n      a[0] = b[0] * t0 + c[0] * t1;\n      a[1] = b[1] * t0 + c[1] * t1;\n      a[2] = b[2] * t0 + c[2] * t1;\n      a[3] = b[3] * t0 + c[3] * t1;\n    }\n  };\n\n  ret.fromMat44 = function (v, m) {\n    var m33 = Mat33.poolAlloc();\n    m33[0] = m[0];\n    m33[1] = m[1];\n    m33[2] = m[2];\n    m33[3] = m[4];\n    m33[4] = m[5];\n    m33[5] = m[6];\n    m33[6] = m[8];\n    m33[7] = m[9];\n    m33[8] = m[10]; //this.fromMat33(v,m33);\n\n    Mat33.rotToQuat(v, m33);\n    Mat33.poolFree(1);\n  };\n\n  ret.fromMat33 = function (v, m) {\n    var invx = 1 / Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]);\n    var invy = 1 / Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]);\n    var invz = 1 / Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]);\n    var m33 = Mat33.poolAlloc();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getRotVec(v, m33);\n    var r = Vec3.scalar(v);\n\n    if (r !== 0) {\n      Vec3.mul(v, v, 1 / r);\n      Vec4.fromRotVector(v, r, v[0], v[1], v[2]);\n    } else {\n      Vec4.set(v, 0, 0, 0, 1);\n    }\n\n    Mat33.poolFree(1);\n  };\n\n  return ret;\n}();\n\nvar Mat33 = function () {\n  var Mat33 = function Mat33() {\n    var o = new Float32Array(9);\n    Mat33.setInit(o);\n    return o;\n  };\n\n  var ret = Mat33;\n\n  ret.setInit = function (m) {\n    m[0] = 1;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = 0;\n    m[4] = 1;\n    m[5] = 0;\n    m[6] = 0;\n    m[7] = 0;\n    m[8] = 1;\n  };\n\n  ret.ZERO = new Mat33(); //ret.ZERO.fill(0);\n\n  ret.ZERO[0] = 0;\n  ret.ZERO[4] = 0;\n  ret.ZERO[8] = 0;\n  var buffer = new Mat33();\n  var bufferVec3 = new Vec3();\n\n  ret.set = function (obj, a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n  };\n\n  ret.copy = function (m, a) {\n    m[0] = a[0];\n    m[1] = a[1];\n    m[2] = a[2];\n    m[3] = a[3];\n    m[4] = a[4];\n    m[5] = a[5];\n    m[6] = a[6];\n    m[7] = a[7];\n    m[8] = a[8];\n  };\n\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n    a[4] = b[4] + c[4];\n    a[5] = b[5] + c[5];\n    a[6] = b[6] + c[6];\n    a[7] = b[7] + c[7];\n    a[8] = b[8] + c[8];\n  };\n\n  ret.madd = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n    a[3] = b[3] + c[3] * d;\n    a[4] = b[4] + c[4] * d;\n    a[5] = b[5] + c[5] * d;\n    a[6] = b[6] + c[6] * d;\n    a[7] = b[7] + c[7] * d;\n    a[8] = b[8] + c[8] * d;\n  };\n\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n    a[4] = b[4] - c[4];\n    a[5] = b[5] - c[5];\n    a[6] = b[6] - c[6];\n    a[7] = b[7] - c[7];\n    a[8] = b[8] - c[8];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n  };\n\n  ret.dotVec3 = function (ret, m, v) {\n    var v0 = v[0];\n    var v1 = v[1];\n    var v2 = v[2];\n    ret[0] = m[0] * v0 + m[3] * v1 + m[6] * v2;\n    ret[1] = m[1] * v0 + m[4] * v1 + m[7] * v2;\n    ret[2] = m[2] * v0 + m[5] * v1 + m[8] * v2; //ret.set(bufferVec3);\n  };\n\n  ret.dot = function (ret, ma, mb) {\n    buffer[0] = ma[0] * mb[0] + ma[3] * mb[1] + ma[6] * mb[2];\n    buffer[1] = ma[1] * mb[0] + ma[4] * mb[1] + ma[7] * mb[2];\n    buffer[2] = ma[2] * mb[0] + ma[5] * mb[1] + ma[8] * mb[2];\n    buffer[3] = ma[0] * mb[3] + ma[3] * mb[4] + ma[6] * mb[5];\n    buffer[4] = ma[1] * mb[3] + ma[4] * mb[4] + ma[7] * mb[5];\n    buffer[5] = ma[2] * mb[3] + ma[5] * mb[4] + ma[8] * mb[5];\n    buffer[6] = ma[0] * mb[6] + ma[3] * mb[7] + ma[6] * mb[8];\n    buffer[7] = ma[1] * mb[6] + ma[4] * mb[7] + ma[7] * mb[8];\n    buffer[8] = ma[2] * mb[6] + ma[5] * mb[7] + ma[8] * mb[8];\n    ret.set(buffer);\n  };\n\n  ret.fromRotVector = function (ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n  };\n\n  ret.getRotVec = function (ret, m) {\n    var COS = (m[0] + m[4] + m[8] - 1) * 0.5;\n\n    if (COS * COS >= 1) {\n      Vec3.set(ret, 0, 0, 0);\n      return;\n    }\n\n    var r = Math.acos(COS);\n    var SIN = Math.sin(r);\n    ret[0] = m[5] - m[7];\n    ret[1] = m[6] - m[2];\n    ret[2] = m[1] - m[3];\n    Vec3.mul(ret, ret, r / (SIN * 2.0));\n  };\n\n  ret.rotToQuat = function (r, m) {\n    r[1] = m[0] - m[4] - m[8] + 1;\n    r[2] = -m[0] + m[4] - m[8] + 1;\n    r[3] = -m[0] - m[4] + m[8] + 1;\n    r[0] = m[0] + m[4] + m[8] + 1;\n    var bigest = 0;\n\n    for (var i = 1; i < 4; i++) {\n      if (r[i] > r[bigest]) {\n        bigest = i;\n      }\n    }\n\n    if (r[bigest] < 0) {\n      return;\n    }\n\n    var v = Math.sqrt(r[bigest]) * 0.5;\n    r[bigest] = v;\n    var mult = 0.25 / v;\n\n    switch (bigest) {\n      case 1:\n        r[2] = (m[1] + m[3]) * mult;\n        r[3] = (m[2] + m[6]) * mult;\n        r[0] = (m[5] - m[7]) * mult;\n        break;\n\n      case 2:\n        r[1] = (m[1] + m[3]) * mult;\n        r[3] = (m[7] + m[5]) * mult;\n        r[0] = (m[6] - m[2]) * mult;\n        break;\n\n      case 3:\n        r[1] = (m[7] + m[5]) * mult;\n        r[2] = (m[2] + m[6]) * mult;\n        r[0] = (m[1] - m[3]) * mult;\n        break;\n\n      case 0:\n        r[1] = (m[5] - m[7]) * mult;\n        r[2] = (m[6] - m[2]) * mult;\n        r[3] = (m[1] - m[3]) * mult;\n        break;\n    }\n\n    return;\n  };\n\n  ret.getRotQuat = function (ret, m) {\n    return Mat33.rotToQuat(ret, m);\n    Mat33.getRotVec(ret, m);\n    var r = Vec3.scalar(ret);\n\n    if (!r) {\n      Vec4.set(ret, 1, 0, 0, 0);\n      return;\n    }\n\n    Vec3.mul(ret, ret, 1 / r);\n    Vec4.fromRotVector(ret, r, ret[0], ret[1], ret[2]);\n  };\n\n  ret.getEulerXYZ = function (vec, m) {\n    vec[1] = Math.asin(m[2]);\n\n    if (m[2] == 1 || m[2] == -1) {\n      vec[0] = 0;\n      vec[2] = Math.atan2(-m[3], [4]);\n    } else {\n      vec[0] = Math.atan2(m[5], m[8]);\n      vec[2] = Math.atan2(m[1], m[0]);\n    }\n  };\n\n  ret.getEuler = function (vec, m) {\n    vec[2] = Math.asin(m[1]);\n\n    if (m[1] == 1 || m[1] == -1) {\n      vec[0] = 0;\n      vec[1] = Math.atan2(m[8], [6]);\n    } else {\n      vec[0] = Math.atan2(-m[7], m[4]);\n      vec[1] = Math.atan2(-m[2], m[0]);\n    }\n  };\n\n  ret.getInv = function (ret, m) {\n    var d = m[0] * m[4] * m[8] + m[3] * m[7] * m[2] + m[6] * m[1] * m[5] - m[6] * m[4] * m[2] - m[3] * m[1] * m[8] - m[0] * m[7] * m[5];\n\n    if (!d) {\n      this.mul(m, m, 0);\n      return;\n    }\n\n    d = 1.0 / d;\n    var m0 = (m[4] * m[8] - m[7] * m[5]) * d;\n    var m1 = (m[7] * m[2] - m[1] * m[8]) * d;\n    var m2 = (m[1] * m[5] - m[4] * m[2]) * d;\n    var m3 = (m[6] * m[5] - m[3] * m[8]) * d;\n    var m4 = (m[0] * m[8] - m[6] * m[2]) * d;\n    var m5 = (m[3] * m[2] - m[0] * m[5]) * d;\n    var m6 = (m[3] * m[7] - m[6] * m[4]) * d;\n    var m7 = (m[6] * m[1] - m[0] * m[7]) * d;\n    var m8 = (m[0] * m[4] - m[3] * m[1]) * d;\n    ret[0] = m0;\n    ret[1] = m1;\n    ret[2] = m2;\n    ret[3] = m3;\n    ret[4] = m4;\n    ret[5] = m5;\n    ret[6] = m6;\n    ret[7] = m7;\n    ret[8] = m8;\n  };\n\n  ret.calcTranspose = function (ret, m) {\n    var buf;\n    buf = m[1];\n    ret[1] = m[3];\n    ret[3] = buf;\n    buf = m[2];\n    ret[2] = m[6];\n    ret[6] = buf;\n    buf = m[5];\n    ret[5] = m[7];\n    ret[7] = buf;\n  };\n\n  ret.rotate = function (mat33, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    mat33[0] = x * x * (1 - COS) + COS;\n    mat33[3] = x * y * (1 - COS) - z * SIN;\n    mat33[6] = z * x * (1 - COS) + y * SIN;\n    mat33[1] = x * y * (1 - COS) + z * SIN;\n    mat33[4] = y * y * (1 - COS) + COS;\n    mat33[7] = y * z * (1 - COS) - x * SIN;\n    mat33[2] = z * x * (1 - COS) - y * SIN;\n    mat33[5] = y * z * (1 - COS) + x * SIN;\n    mat33[8] = z * z * (1 - COS) + COS;\n  };\n\n  return ret;\n}();\n\nvar Mat43 = function () {\n  //|0 3 6 9 |\n  //|1 4 7 10|\n  //|2 5 8 11|\n  var Mat43 = function Mat43() {\n    var o = new Float32Array(12);\n    Mat43.setInit(o);\n    return o;\n  };\n\n  var ret = Mat43;\n  var buf = new Float32Array(12);\n\n  ret.setInit = function (mat) {\n    mat[0] = 1.0;\n    mat[1] = 0.0;\n    mat[2] = 0.0;\n    mat[3] = 0.0;\n    mat[4] = 1.0;\n    mat[5] = 0.0;\n    mat[6] = 0.0;\n    mat[7] = 0.0;\n    mat[8] = 1.0;\n    mat[9] = 0.0;\n    mat[10] = 0.0;\n    mat[11] = 0.0;\n  };\n\n  ret.set = function (obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n    obj[9] = a9;\n    obj[10] = a10;\n    obj[11] = a11;\n  };\n\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n    a[4] = b[4];\n    a[5] = b[5];\n    a[6] = b[6];\n    a[7] = b[7];\n    a[8] = b[8];\n    a[9] = b[9];\n    a[10] = b[10];\n    a[11] = b[11];\n  };\n\n  ret.copyMat44 = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[4];\n    a[4] = b[5];\n    a[5] = b[6];\n    a[6] = b[8];\n    a[7] = b[9];\n    a[8] = b[10];\n    a[9] = b[12];\n    a[10] = b[13];\n    a[11] = b[14];\n  };\n\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n    a[9] = b[9] * c;\n    a[10] = b[10] * c;\n    a[11] = b[11] * c;\n  };\n\n  ret.dotVec3 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9];\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10];\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11];\n  };\n\n  ret.dotMat33Vec3 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2;\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2;\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2;\n  };\n\n  ret.dotVec4 = function (a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    var buf3 = c[3];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9] * buf3;\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10] * buf3;\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11] * buf3;\n    a[3] = buf3;\n  };\n\n  ret.dot = function (a, b, c) {\n    buf[0] = b[0] * c[0] + b[3] * c[1] + b[6] * c[2];\n    buf[1] = b[1] * c[0] + b[4] * c[1] + b[7] * c[2];\n    buf[2] = b[2] * c[0] + b[5] * c[1] + b[8] * c[2];\n    buf[3] = b[0] * c[3] + b[3] * c[4] + b[6] * c[5];\n    buf[4] = b[1] * c[3] + b[4] * c[4] + b[7] * c[5];\n    buf[5] = b[2] * c[3] + b[5] * c[4] + b[8] * c[5];\n    buf[6] = b[0] * c[6] + b[3] * c[7] + b[6] * c[8];\n    buf[7] = b[1] * c[6] + b[4] * c[7] + b[7] * c[8];\n    buf[8] = b[2] * c[6] + b[5] * c[7] + b[8] * c[8];\n    buf[9] = b[0] * c[9] + b[3] * c[10] + b[6] * c[11] + b[9];\n    buf[10] = b[1] * c[9] + b[4] * c[10] + b[7] * c[11] + b[10];\n    buf[11] = b[2] * c[9] + b[5] * c[10] + b[8] * c[11] + b[11];\n    a.set(buf); //if(a == b){\n    //\tvar buf0 = b[0];\n    //\tvar buf1 = b[1];\n    //\tvar buf2 = b[2];\n    //\tvar buf3 = b[3];\n    //\tvar buf4 = b[4];\n    //\tvar buf5 = b[5];\n    //\tvar buf6 = b[6];\n    //\tvar buf7 = b[7];\n    //\tvar buf8 = b[8];\n    //\tvar buf9 = b[9];\n    //\tvar buf10 = b[10];\n    //\tvar buf11 = b[11];\n    //\ta[0]=buf0*c[0] + buf3*c[1] + buf6*c[2];\n    //\ta[1]=buf1*c[0] + buf4*c[1] + buf7*c[2];\n    //\ta[2]=buf2*c[0] + buf5*c[1] + buf8*c[2];\n    //\ta[3]=buf0*c[3] + buf3*c[4] + buf6*c[5];\n    //\ta[4]=buf1*c[3] + buf4*c[4] + buf7*c[5];\n    //\ta[5]=buf2*c[3] + buf5*c[4] + buf8*c[5];\n    //\ta[6]=buf0*c[6] + buf3*c[7] + buf6*c[8];\n    //\ta[7]=buf1*c[6] + buf4*c[7] + buf7*c[8];\n    //\ta[8]=buf2*c[6] + buf5*c[7] + buf8*c[8];\n    //\ta[9]=buf0*c[9] + buf3*c[10] + buf6*c[11] + buf9;\n    //\ta[10]=buf1*c[9] + buf4*c[10] + buf7*c[11] + buf10;\n    //\ta[11]=buf2*c[9] + buf5*c[10] + buf8*c[11] + buf11;\n    //}else{\n    //\tvar buf0 = c[0];\n    //\tvar buf1 = c[1];\n    //\tvar buf2 = c[2];\n    //\tvar buf3 = c[3];\n    //\tvar buf4 = c[4];\n    //\tvar buf5 = c[5];\n    //\tvar buf6 = c[6];\n    //\tvar buf7 = c[7];\n    //\tvar buf8 = c[8];\n    //\tvar buf9 = c[9];\n    //\tvar buf10 = c[10];\n    //\tvar buf11 = c[11];\n    //\ta[0]=b[0]*buf0 + b[3]*buf1 + b[6]*buf2;\n    //\ta[1]=b[1]*buf0 + b[4]*buf1 + b[7]*buf2;\n    //\ta[2]=b[2]*buf0 + b[5]*buf1 + b[8]*buf2;\n    //\ta[3]=b[0]*buf3 + b[3]*buf4 + b[6]*buf5;\n    //\ta[4]=b[1]*buf3 + b[4]*buf4 + b[7]*buf5;\n    //\ta[5]=b[2]*buf3 + b[5]*buf4 + b[8]*buf5;\n    //\ta[6]=b[0]*buf6 + b[3]*buf7 + b[6]*buf8;\n    //\ta[7]=b[1]*buf6 + b[4]*buf7 + b[7]*buf8;\n    //\ta[8]=b[2]*buf6 + b[5]*buf7 + b[8]*buf8;\n    //\ta[9]=b[0]*buf9 + b[3]*buf10 + b[6]*buf11 + b[9];\n    //\ta[10]=b[1]*buf9 + b[4]*buf10 + b[7]*buf11 + b[10];\n    //\ta[11]=b[2]*buf9 + b[5]*buf10 + b[8]*buf11 + b[11];\n    //}\n  };\n\n  ret.dotMat44Mat43 = function (a, b, c) {\n    var buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n    var buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n    var buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n    var buf3 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n    var buf4 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n    var buf5 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n    var buf6 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n    var buf7 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n    var buf8 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n    var buf9 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n    var buf10 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n    var buf11 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n    a[4] = buf4;\n    a[5] = buf5;\n    a[6] = buf6;\n    a[7] = buf7;\n    a[8] = buf8;\n    a[9] = buf9;\n    a[10] = buf10;\n    a[11] = buf11;\n  };\n\n  ret.fromRotVector = function (ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n    ret[9] = ret[10] = ret[11] = 0.0;\n  };\n\n  ret.getRotVector = function (target, angle) {\n    var bM = this.poolAlloc();\n    var dx = angle[0];\n    var dy = angle[1];\n    var dz = angle[2];\n    var ax = Math.atan2(dy, dz) + Math.PI;\n    var ay = Math.atan2(dx, dz);\n    var az = 0;\n    this.fromRotVector(target, -az, 0, 0, 1);\n    this.fromRotVector(bM, -ax, 1, 0, 0);\n    this.dot(target, target, bM);\n    this.fromRotVector(bM, -ay, 0, 1, 0);\n    this.dot(target, target, bM);\n    this.poolFree(1);\n  };\n\n  ret.determinant = function (b) {\n    return b[0] * b[4] * b[8] + b[3] * b[7] * b[2] + b[6] * b[1] * b[5] - b[0] * b[7] * b[5] - b[3] * b[1] * b[8] - b[6] * b[4] * b[2];\n  };\n\n  ret.getInv = function (a, b) {\n    var det = b[0] * b[4] * b[8] + b[3] * b[7] * b[2] + b[6] * b[1] * b[5] - b[0] * b[7] * b[5] - b[3] * b[1] * b[8] - b[6] * b[4] * b[2];\n\n    if (Math.abs(det) === 0) {\n      return;\n    }\n\n    det = 1 / det;\n    var buf0 = b[0];\n    var buf1 = b[1];\n    var buf2 = b[2];\n    var buf3 = b[3];\n    var buf4 = b[4];\n    var buf5 = b[5];\n    var buf6 = b[6];\n    var buf7 = b[7];\n    var buf8 = b[8];\n    var buf9 = b[9];\n    var buf10 = b[10];\n    var buf11 = b[11];\n    a[0] = (buf4 * buf8 - buf7 * buf5) * det;\n    a[1] = (buf2 * buf7 - buf1 * buf8) * det;\n    a[2] = (buf1 * buf5 - buf4 * buf2) * det;\n    a[3] = (buf6 * buf5 - buf3 * buf8) * det;\n    a[4] = (buf0 * buf8 - buf6 * buf2) * det;\n    a[5] = (buf3 * buf2 - buf0 * buf5) * det;\n    a[6] = (buf3 * buf7 - buf4 * buf6) * det;\n    a[7] = (buf6 * buf1 - buf0 * buf7) * det;\n    a[8] = (buf0 * buf4 - buf3 * buf1) * det;\n    a[9] = (buf3 * buf10 * buf8 + buf6 * buf4 * buf11 + buf9 * buf7 * buf5 - buf3 * buf7 * buf11 - buf6 * buf10 * buf5 - buf9 * buf4 * buf8) * det;\n    a[10] = (buf0 * buf7 * buf11 + buf6 * buf10 * buf2 + buf9 * buf1 * buf8 - buf0 * buf10 * buf8 - buf6 * buf1 * buf11 - buf9 * buf7 * buf2) * det;\n    a[11] = (buf0 * buf10 * buf5 + buf3 * buf1 * buf11 + buf9 * buf4 * buf2 - buf0 * buf4 * buf11 - buf3 * buf10 * buf2 - buf9 * buf1 * buf5) * det;\n  };\n\n  ret.fromQuat = function (a, b) {\n    var x2 = b[1] * b[1] * 2.0;\n    var y2 = b[2] * b[2] * 2.0;\n    var z2 = b[3] * b[3] * 2.0;\n    var xy = b[1] * b[2] * 2.0;\n    var yz = b[2] * b[3] * 2.0;\n    var zx = b[3] * b[1] * 2.0;\n    var xw = b[1] * b[0] * 2.0;\n    var yw = b[2] * b[0] * 2.0;\n    var zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  }; //eulerAngleから行列を作る (XZY)\n\n\n  ret.fromEuler = function (m, e) {\n    var buf = Mat43.poolAlloc();\n    ret.fromRotVector(m, e[0], 1, 0, 0);\n    ret.fromRotVector(buf, e[2], 0, 0, 1);\n    Mat43.dot(m, buf, m);\n    ret.fromRotVector(buf, e[1], 0, 1, 0);\n    Mat43.dot(m, buf, m);\n    Mat43.poolFree(1);\n  }; //location,scale,eulerAnlge から行列を作る\n\n\n  ret.fromLSE = function (m, l, s, e) {\n    Mat43.fromEuler(m, e);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }; //location,scale,quartanionから行列を作る\n\n\n  ret.fromLSR = function (m, l, s, r) {\n    Mat43.fromQuat(m, r);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }; //行列をlocation,scale,quartanionに分ける\n\n\n  ret.toLSR = function (l, s, r, m) {\n    Vec3.set(l, m[9], m[10], m[11]);\n    Vec3.set(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getRotQuat(r, m33);\n  };\n\n  ret.toLSE = function (l, s, e, m) {\n    Vec3.set(l, m[9], m[10], m[11]);\n    Vec3.set(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getEuler(e, m33);\n  };\n\n  return ret;\n}();\n\nvar buf0, buf1, buf2, buf3, buf4, buf5, buf6, buf7, buf8, buf9, buf10, buf11, buf12, buf13, buf14, buf15;\nvar bM = new Float32Array(16);\nvar Mat44 = /*#__PURE__*/function () {\n  function Mat44() {\n    _classCallCheck(this, Mat44);\n\n    var m = new Float32Array(16);\n    m[0] = 1.0;\n    m[1] = 0.0;\n    m[2] = 0.0;\n    m[3] = 0.0;\n    m[4] = 0.0;\n    m[5] = 1.0;\n    m[6] = 0.0;\n    m[7] = 0.0;\n    m[8] = 0.0;\n    m[9] = 0.0;\n    m[10] = 1.0;\n    m[11] = 0.0;\n    m[12] = 0.0;\n    m[13] = 0.0;\n    m[14] = 0.0;\n    m[15] = 1.0;\n    return m;\n  }\n\n  _createClass(Mat44, null, [{\n    key: \"setInit\",\n    value: function setInit(mat) {\n      mat[0] = 1.0;\n      mat[1] = 0.0;\n      mat[2] = 0.0;\n      mat[3] = 0.0;\n      mat[4] = 0.0;\n      mat[5] = 1.0;\n      mat[6] = 0.0;\n      mat[7] = 0.0;\n      mat[8] = 0.0;\n      mat[9] = 0.0;\n      mat[10] = 1.0;\n      mat[11] = 0.0;\n      mat[12] = 0.0;\n      mat[13] = 0.0;\n      mat[14] = 0.0;\n      mat[15] = 1.0;\n    }\n  }, {\n    key: \"set\",\n    value: function set(obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14, a15) {\n      obj[0] = a0;\n      obj[1] = a1;\n      obj[2] = a2;\n      obj[3] = a3;\n      obj[4] = a4;\n      obj[5] = a5;\n      obj[6] = a6;\n      obj[7] = a7;\n      obj[8] = a8;\n      obj[9] = a9;\n      obj[10] = a10;\n      obj[11] = a11;\n      obj[12] = a12;\n      obj[13] = a13;\n      obj[14] = a14;\n      obj[15] = a15;\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(a, b) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n      a[4] = b[4];\n      a[5] = b[5];\n      a[6] = b[6];\n      a[7] = b[7];\n      a[8] = b[8];\n      a[9] = b[9];\n      a[10] = b[10];\n      a[11] = b[11];\n      a[12] = b[12];\n      a[13] = b[13];\n      a[14] = b[14];\n      a[15] = b[15];\n    }\n  }, {\n    key: \"copyMat43\",\n    value: function copyMat43(a, b) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = 0;\n      a[4] = b[3];\n      a[5] = b[4];\n      a[6] = b[5];\n      a[7] = 0;\n      a[8] = b[6];\n      a[9] = b[7];\n      a[10] = b[8];\n      a[11] = 0;\n      a[12] = b[9];\n      a[13] = b[10];\n      a[14] = b[11];\n      a[15] = 1;\n    }\n  }, {\n    key: \"mul\",\n    value: function mul(a, b, c) {\n      a[0] = b[0] * c;\n      a[1] = b[1] * c;\n      a[2] = b[2] * c;\n      a[3] = b[3] * c;\n      a[4] = b[4] * c;\n      a[5] = b[5] * c;\n      a[6] = b[6] * c;\n      a[7] = b[7] * c;\n      a[8] = b[8] * c;\n      a[9] = b[9] * c;\n      a[10] = b[10] * c;\n      a[11] = b[11] * c;\n      a[12] = b[12] * c;\n      a[13] = b[13] * c;\n      a[14] = b[14] * c;\n      a[15] = b[15] * c;\n    }\n  }, {\n    key: \"dotVec3\",\n    value: function dotVec3(a, b, c) {\n      buf0 = c[0];\n      buf1 = c[1];\n      buf2 = c[2];\n      a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12];\n      a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13];\n      a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14];\n    }\n  }, {\n    key: \"dotMat33Vec3\",\n    value: function dotMat33Vec3(a, b, c) {\n      buf0 = c[0];\n      buf1 = c[1];\n      buf2 = c[2];\n      a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2;\n      a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2;\n      a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2;\n    }\n  }, {\n    key: \"dotVec4\",\n    value: function dotVec4(a, b, c) {\n      buf0 = c[0];\n      buf1 = c[1];\n      buf2 = c[2];\n      buf3 = c[3];\n      a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n      a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n      a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n      a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n    }\n  }, {\n    key: \"dot\",\n    value: function dot(a, b, c) {\n      if (a == b) {\n        buf0 = b[0];\n        buf1 = b[1];\n        buf2 = b[2];\n        buf3 = b[3];\n        buf4 = b[4];\n        buf5 = b[5];\n        buf6 = b[6];\n        buf7 = b[7];\n        buf8 = b[8];\n        buf9 = b[9];\n        buf10 = b[10];\n        buf11 = b[11];\n        buf12 = b[12];\n        buf13 = b[13];\n        buf14 = b[14];\n        buf15 = b[15];\n        a[0] = buf0 * c[0] + buf4 * c[1] + buf8 * c[2] + buf12 * c[3];\n        a[1] = buf1 * c[0] + buf5 * c[1] + buf9 * c[2] + buf13 * c[3];\n        a[2] = buf2 * c[0] + buf6 * c[1] + buf10 * c[2] + buf14 * c[3];\n        a[3] = buf3 * c[0] + buf7 * c[1] + buf11 * c[2] + buf15 * c[3];\n        a[4] = buf0 * c[4] + buf4 * c[5] + buf8 * c[6] + buf12 * c[7];\n        a[5] = buf1 * c[4] + buf5 * c[5] + buf9 * c[6] + buf13 * c[7];\n        a[6] = buf2 * c[4] + buf6 * c[5] + buf10 * c[6] + buf14 * c[7];\n        a[7] = buf3 * c[4] + buf7 * c[5] + buf11 * c[6] + buf15 * c[7];\n        a[8] = buf0 * c[8] + buf4 * c[9] + buf8 * c[10] + buf12 * c[11];\n        a[9] = buf1 * c[8] + buf5 * c[9] + buf9 * c[10] + buf13 * c[11];\n        a[10] = buf2 * c[8] + buf6 * c[9] + buf10 * c[10] + buf14 * c[11];\n        a[11] = buf3 * c[8] + buf7 * c[9] + buf11 * c[10] + buf15 * c[11];\n        a[12] = buf0 * c[12] + buf4 * c[13] + buf8 * c[14] + buf12 * c[15];\n        a[13] = buf1 * c[12] + buf5 * c[13] + buf9 * c[14] + buf13 * c[15];\n        a[14] = buf2 * c[12] + buf6 * c[13] + buf10 * c[14] + buf14 * c[15];\n        a[15] = buf3 * c[12] + buf7 * c[13] + buf11 * c[14] + buf15 * c[15];\n      } else {\n        buf0 = c[0];\n        buf1 = c[1];\n        buf2 = c[2];\n        buf3 = c[3];\n        buf4 = c[4];\n        buf5 = c[5];\n        buf6 = c[6];\n        buf7 = c[7];\n        buf8 = c[8];\n        buf9 = c[9];\n        buf10 = c[10];\n        buf11 = c[11];\n        buf12 = c[12];\n        buf13 = c[13];\n        buf14 = c[14];\n        buf15 = c[15];\n        a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n        a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n        a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n        a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n        a[4] = b[0] * buf4 + b[4] * buf5 + b[8] * buf6 + b[12] * buf7;\n        a[5] = b[1] * buf4 + b[5] * buf5 + b[9] * buf6 + b[13] * buf7;\n        a[6] = b[2] * buf4 + b[6] * buf5 + b[10] * buf6 + b[14] * buf7;\n        a[7] = b[3] * buf4 + b[7] * buf5 + b[11] * buf6 + b[15] * buf7;\n        a[8] = b[0] * buf8 + b[4] * buf9 + b[8] * buf10 + b[12] * buf11;\n        a[9] = b[1] * buf8 + b[5] * buf9 + b[9] * buf10 + b[13] * buf11;\n        a[10] = b[2] * buf8 + b[6] * buf9 + b[10] * buf10 + b[14] * buf11;\n        a[11] = b[3] * buf8 + b[7] * buf9 + b[11] * buf10 + b[15] * buf11;\n        a[12] = b[0] * buf12 + b[4] * buf13 + b[8] * buf14 + b[12] * buf15;\n        a[13] = b[1] * buf12 + b[5] * buf13 + b[9] * buf14 + b[13] * buf15;\n        a[14] = b[2] * buf12 + b[6] * buf13 + b[10] * buf14 + b[14] * buf15;\n        a[15] = b[3] * buf12 + b[7] * buf13 + b[11] * buf14 + b[15] * buf15;\n      }\n    }\n  }, {\n    key: \"dotMat43\",\n    value: function dotMat43(a, b, c) {\n      buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n      buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n      buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n      buf3 = b[3] * c[0] + b[7] * c[1] + b[11] * c[2];\n      buf4 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n      buf5 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n      buf6 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n      buf7 = b[3] * c[3] + b[7] * c[4] + b[11] * c[5];\n      buf8 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n      buf9 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n      buf10 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n      buf11 = b[3] * c[6] + b[7] * c[7] + b[11] * c[8];\n      buf12 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n      buf13 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n      buf14 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n      buf15 = b[3] * c[9] + b[7] * c[10] + b[11] * c[11] + b[15];\n      a[0] = buf0;\n      a[1] = buf1;\n      a[2] = buf2;\n      a[3] = buf3;\n      a[4] = buf4;\n      a[5] = buf5;\n      a[6] = buf6;\n      a[7] = buf7;\n      a[8] = buf8;\n      a[9] = buf9;\n      a[10] = buf10;\n      a[11] = buf11;\n      a[12] = buf12;\n      a[13] = buf13;\n      a[14] = buf14;\n      a[15] = buf15;\n    }\n  }, {\n    key: \"getRotVector\",\n    value: function getRotVector(target, angle) {\n      Mat43.getRotVector.call(this, target, angle);\n    }\n  }, {\n    key: \"getInv\",\n    value: function getInv(a, b) {\n      var det = b[0] * b[5] * b[10] * b[15] + b[0] * b[9] * b[14] * b[7] + b[0] * b[13] * b[6] * b[11] + b[4] * b[1] * b[14] * b[11] + b[4] * b[9] * b[2] * b[15] + b[4] * b[13] * b[10] * b[3] + b[8] * b[1] * b[6] * b[15] + b[8] * b[5] * b[14] * b[3] + b[8] * b[13] * b[2] * b[7] + b[12] * b[1] * b[10] * b[7] + b[12] * b[5] * b[2] * b[11] + b[12] * b[9] * b[6] * b[3] - b[0] * b[5] * b[14] * b[11] - b[0] * b[9] * b[6] * b[15] - b[0] * b[13] * b[10] * b[7] - b[4] * b[1] * b[10] * b[15] - b[4] * b[9] * b[14] * b[3] - b[4] * b[13] * b[2] * b[11] - b[8] * b[1] * b[14] * b[7] - b[8] * b[5] * b[2] * b[15] - b[8] * b[13] * b[6] * b[3] - b[12] * b[1] * b[6] * b[11] - b[12] * b[5] * b[10] * b[3] - b[12] * b[9] * b[2] * b[7];\n\n      if (Math.abs(det) < 0.000000000001) {\n        return;\n      }\n\n      det = 1 / det;\n      buf0 = b[0];\n      buf1 = b[1];\n      buf2 = b[2];\n      buf3 = b[3];\n      buf4 = b[4];\n      buf5 = b[5];\n      buf6 = b[6];\n      buf7 = b[7];\n      buf8 = b[8];\n      buf9 = b[9];\n      buf10 = b[10];\n      buf11 = b[11];\n      buf12 = b[12];\n      buf13 = b[13];\n      buf14 = b[14];\n      buf15 = b[15];\n      a[0] = (buf5 * buf10 * buf15 + buf9 * buf14 * buf7 + buf13 * buf6 * buf11 - buf5 * buf14 * buf11 - buf9 * buf6 * buf15 - buf13 * buf10 * buf7) * det;\n      a[4] = (buf4 * buf14 * buf11 + buf8 * buf6 * buf15 + buf12 * buf10 * buf7 - buf4 * buf10 * buf15 - buf8 * buf14 * buf7 - buf12 * buf6 * buf11) * det;\n      a[8] = (buf4 * buf9 * buf15 + buf8 * buf13 * buf7 + buf12 * buf5 * buf11 - buf4 * buf13 * buf11 - buf8 * buf5 * buf15 - buf12 * buf9 * buf7) * det;\n      a[12] = (buf4 * buf13 * buf10 + buf8 * buf5 * buf14 + buf12 * buf9 * buf6 - buf4 * buf9 * buf14 - buf8 * buf13 * buf6 - buf12 * buf5 * buf10) * det;\n      a[1] = (buf1 * buf14 * buf11 + buf9 * buf2 * buf15 + buf13 * buf10 * buf3 - buf1 * buf10 * buf15 - buf9 * buf14 * buf3 - buf13 * buf2 * buf11) * det;\n      a[5] = (buf0 * buf10 * buf15 + buf8 * buf14 * buf3 + buf12 * buf2 * buf11 - buf0 * buf14 * buf11 - buf8 * buf2 * buf15 - buf12 * buf10 * buf3) * det;\n      a[9] = (buf0 * buf13 * buf11 + buf8 * buf1 * buf15 + buf12 * buf9 * buf3 - buf0 * buf9 * buf15 - buf8 * buf13 * buf3 - buf12 * buf1 * buf11) * det;\n      a[13] = (buf0 * buf9 * buf14 + buf8 * buf13 * buf2 + buf12 * buf1 * buf10 - buf0 * buf13 * buf10 - buf8 * buf1 * buf14 - buf12 * buf9 * buf2) * det;\n      a[2] = (buf1 * buf6 * buf15 + buf5 * buf14 * buf3 + buf13 * buf2 * buf7 - buf1 * buf14 * buf7 - buf5 * buf2 * buf15 - buf13 * buf6 * buf3) * det;\n      a[6] = (buf0 * buf14 * buf7 + buf4 * buf2 * buf15 + buf12 * buf6 * buf3 - buf0 * buf6 * buf15 - buf4 * buf14 * buf3 - buf12 * buf2 * buf7) * det;\n      a[10] = (buf0 * buf5 * buf15 + buf4 * buf13 * buf3 + buf12 * buf1 * buf7 - buf0 * buf13 * buf7 - buf4 * buf1 * buf15 - buf12 * buf5 * buf3) * det;\n      a[14] = (buf0 * buf13 * buf6 + buf4 * buf1 * buf14 + buf12 * buf5 * buf2 - buf0 * buf5 * buf14 - buf4 * buf13 * buf2 - buf12 * buf1 * buf6) * det;\n      a[3] = (buf1 * buf10 * buf7 + buf5 * buf2 * buf11 + buf9 * buf6 * buf3 - buf1 * buf6 * buf11 - buf5 * buf10 * buf3 - buf9 * buf2 * buf7) * det;\n      a[7] = (buf0 * buf6 * buf11 + buf4 * buf10 * buf3 + buf8 * buf2 * buf7 - buf0 * buf10 * buf7 - buf4 * buf2 * buf11 - buf8 * buf6 * buf3) * det;\n      a[11] = (buf0 * buf9 * buf7 + buf4 * buf1 * buf11 + buf8 * buf5 * buf3 - buf0 * buf5 * buf11 - buf4 * buf9 * buf3 - buf8 * buf1 * buf7) * det;\n      a[15] = (buf0 * buf5 * buf10 + buf4 * buf9 * buf2 + buf8 * buf1 * buf6 - buf0 * buf9 * buf6 - buf4 * buf1 * buf10 - buf8 * buf5 * buf2) * det;\n    }\n  }]);\n\n  return Mat44;\n}();\n\n_defineProperty(Mat44, \"fromRotVector\", function (ret, r, x, y, z) {\n  var SIN = Math.sin(r);\n  var COS = Math.cos(r);\n  ret[0] = x * x * (1 - COS) + COS;\n  ret[4] = x * y * (1 - COS) - z * SIN;\n  ret[8] = z * x * (1 - COS) + y * SIN;\n  ret[1] = x * y * (1 - COS) + z * SIN;\n  ret[5] = y * y * (1 - COS) + COS;\n  ret[9] = y * z * (1 - COS) - x * SIN;\n  ret[2] = z * x * (1 - COS) - y * SIN;\n  ret[6] = y * z * (1 - COS) + x * SIN;\n  ret[10] = z * z * (1 - COS) + COS;\n  ret[3] = ret[7] = ret[11] = ret[12] = ret[13] = ret[14] = 0;\n  ret[15] = 1;\n});\n\n_defineProperty(Mat44, \"determinant\", function (a) {\n  return b[0] * b[5] * b[10] * b[15] + b[0] * b[9] * b[14] * b[7] + b[0] * b[13] * b[6] * b[11] + b[4] * b[1] * b[14] * b[11] + b[4] * b[9] * b[2] * b[15] + b[4] * b[13] * b[10] * b[3] + b[8] * b[1] * b[6] * b[15] + b[8] * b[5] * b[14] * b[3] + b[8] * b[13] * b[2] * b[7] + b[12] * b[1] * b[10] * b[7] + b[12] * b[5] * b[2] * b[11] + b[12] * b[9] * b[6] * b[3] - b[0] * b[5] * b[14] * b[11] - b[0] * b[9] * b[6] * b[15] - b[0] * b[13] * b[10] * b[7] - b[4] * b[1] * b[10] * b[15] - b[4] * b[9] * b[14] * b[3] - b[4] * b[13] * b[2] * b[11] - b[8] * b[1] * b[14] * b[7] - b[8] * b[5] * b[2] * b[15] - b[8] * b[13] * b[6] * b[3] - b[12] * b[1] * b[6] * b[11] - b[12] * b[5] * b[10] * b[3] - b[12] * b[9] * b[2] * b[7];\n});\n\n;\n\n(function () {\n  //プール\n  var classes = [Vec2, Vec3, Vec4, Mat33, Mat43, Mat44];\n\n  for (var i = 0; i < classes.length; i++) {\n    var ret = classes[i]; //プール\n\n    ret.poolIndex = 0;\n    ret.pool = [];\n\n    for (var j = 0; j < 256; j++) {\n      ret.pool.push(new ret());\n    }\n\n    ret.poolAlloc = function () {\n      this.poolIndex++; //if(this.poolIndex>128){\n      //\talert(this+ \"poolIndex leak!?\");\n      //}\n      //if(this.poolIndex>this.pool.length){\n      //\tfor(var i=0;i<16;i++){\n      //\t\tthis.pool.push(new this());\n      //\t}\n      //}\n\n      return this.pool[this.poolIndex - 1];\n    };\n\n    ret.poolFree = function (num) {\n      this.poolIndex -= num; //if(this.poolIndex<0){\n      //\talert(this+\"poolIndex okashii!\");\n      //}\n    };\n  }\n})();\n\nvar Vec2, Vec3, Vec4, Mat33, Mat43;\n\n//# sourceURL=webpack://bc/../lib/lib/vector.js?");

/***/ }),

/***/ "../lib/lib/watcher.js":
/*!*****************************!*\
  !*** ../lib/lib/watcher.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Watcher; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"../lib/lib/util.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n//変数監視\n\n\nvar Watch = /*#__PURE__*/function () {\n  function Watch(variable_root, variable_name, callback) {\n    _classCallCheck(this, Watch);\n\n    this.variable_root = variable_root;\n    this.variable_direction = variable_name.split(\".\");\n    this.callback = callback;\n    this.old_value = {};\n  }\n\n  _createClass(Watch, [{\n    key: \"getValue\",\n    value: function getValue(n) {\n      //監視対象の変数の値を取得\n      // n=1なら親を取得\n      if (!n) {\n        n = 0;\n      }\n\n      var value = this.variable_root;\n      var v = this.variable_direction;\n\n      for (var j = 0; j < v.length - n; j++) {\n        value = value[v[j]];\n\n        if (value == undefined) {\n          value = null;\n          break;\n        }\n      }\n\n      return value;\n    }\n  }, {\n    key: \"setValue\",\n    value: function setValue(value) {\n      //監視変数に値をセットする\n      var val = this.getValue(1); //対象の変数の親を取得\n\n      val[this.variable_direction[this.variable_direction.length - 1]] = value;\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      //バインドされた変数の値をノード属性にセット\n      var value = this.getValue(0);\n\n      if (value && (value instanceof HTMLElement || value.nodeName)) {} else {\n        if (_typeof(value) === 'object') {\n          value = JSON.stringify(value);\n        }\n      }\n\n      this.change_flg = this.old_value !== value;\n      this.old_value = value;\n    }\n  }]);\n\n  return Watch;\n}();\n\nvar Watcher = /*#__PURE__*/function () {\n  function Watcher() {\n    _classCallCheck(this, Watcher);\n\n    this.watches = [];\n  }\n\n  _createClass(Watcher, [{\n    key: \"init\",\n    value: function init() {//初期化&バインド\n      //\t\tvar func =()=>{\n      //\t\t\tthis.refresh();\n      //\t\t\twindow.requestAnimationFrame(func);\n      //\t\t}\n      //\t\tfunc();\n    }\n  }, {\n    key: \"watch\",\n    value: function watch(variable_root, variable_name, func) {\n      //監視変数を追加\n      var watch = new Watch(variable_root, variable_name, func);\n      this.watches.push(watch);\n      return watch;\n    }\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      //監視対象をチェック\n      this.watches.forEach(function (w) {\n        w.refresh();\n      });\n    }\n  }]);\n\n  return Watcher;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/watcher.js?");

/***/ }),

/***/ "../lib/lib/zlib.js":
/*!**************************!*\
  !*** ../lib/lib/zlib.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Zlib; }\n/* harmony export */ });\n/* harmony import */ var _deflate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./deflate.js */ \"../lib/lib/deflate.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\n\nvar adler32 = function adler32(data) {\n  //パリティ計算\n  var aa = 1,\n      bb = 0;\n  var len = data.length;\n\n  for (var ai = 0; ai < len;) {\n    var bmax = Math.min(5550, len - ai);\n\n    for (var bi = 0; bi < bmax; bi++, ai++) {\n      aa += data[ai];\n      bb += aa;\n    }\n\n    aa %= 65521;\n    bb %= 65521;\n  }\n\n  return bb * 65536 + aa;\n};\n\nvar Zlib = /*#__PURE__*/function () {\n  function Zlib() {\n    _classCallCheck(this, Zlib);\n  }\n\n  _createClass(Zlib, null, [{\n    key: \"compress\",\n    value: function compress(buffer, flg, block) {\n      var header = [];\n      header[0] = (7 << 4) + 8;\n      header[1] = 2 << 6;\n      header[1] += 31 - ((header[0] << 8) + header[1]) % 31;\n      var body = Array.from(_deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compress(buffer, flg, block)); //var check = Deflate.expand(new Uint8Array(body).buffer);\n\n      var ad = adler32(buffer);\n      var footer = new DataView(new ArrayBuffer(4));\n      footer.setUint32(0, ad);\n      footer = Array.from(new Uint8Array(footer.buffer));\n      return header.concat(body).concat(Array.from(footer));\n    }\n  }, {\n    key: \"expand\",\n    value: function expand(buffer, offset, length) {\n      var dv = new DataView(buffer);\n      var c = dv.getUint16(0);\n      var adl = dv.getUint32(offset + (length - 4));\n      var data = _deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].expand(buffer, offset + 2, length - 6);\n      var ad2 = adler32(data);\n      return data;\n    }\n  }]);\n\n  return Zlib;\n}();\n\n\n\n//# sourceURL=webpack://bc/../lib/lib/zlib.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _main_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./main.js */ \"./src/main.js\");\n\n\n//# sourceURL=webpack://bc/./src/index.js?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_lib_binder_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/lib/binder.js */ \"../lib/lib/binder.js\");\n/* harmony import */ var _lib_lib_colorpickerhdr_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/lib/colorpickerhdr.js */ \"../lib/lib/colorpickerhdr.js\");\n/* harmony import */ var _lib_lib_colorpicker_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/lib/colorpicker.js */ \"../lib/lib/colorpicker.js\");\n/* harmony import */ var _lib_lib_slider_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/lib/slider.js */ \"../lib/lib/slider.js\");\n/* harmony import */ var _lib_lib_ono3d_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/lib/ono3d.js */ \"../lib/lib/ono3d.js\");\n/* harmony import */ var _lib_lib_rastgl_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../lib/lib/rastgl.js */ \"../lib/lib/rastgl.js\");\n/* harmony import */ var _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../lib/lib/util.js */ \"../lib/lib/util.js\");\n/* harmony import */ var _lib_engine_engine_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../lib/engine/engine.js */ \"../lib/engine/engine.js\");\n/* harmony import */ var _lib_engine_obj_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../lib/engine/obj.js */ \"../lib/engine/obj.js\");\n/* harmony import */ var _lib_engine_o3o_o3o_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../lib/engine/o3o/o3o.js */ \"../lib/engine/o3o/o3o.js\");\n/* harmony import */ var _lib_engine_o3o_o3oinstance_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../lib/engine/o3o/o3oinstance.js */ \"../lib/engine/o3o/o3oinstance.js\");\n/* harmony import */ var _lib_engine_o3o_sceneobjectinstance_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../lib/engine/o3o/sceneobjectinstance.js */ \"../lib/engine/o3o/sceneobjectinstance.js\");\n/* harmony import */ var _lib_engine_assetmanager_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../lib/engine/assetmanager.js */ \"../lib/engine/assetmanager.js\");\n/* harmony import */ var _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../lib/lib/vector.js */ \"../lib/lib/vector.js\");\n/* harmony import */ var _lib_lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../lib/lib/onophy/onophy.js */ \"../lib/lib/onophy/onophy.js\");\n/* harmony import */ var _lib_lib_onophy_spring_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../lib/lib/onophy/spring.js */ \"../lib/lib/onophy/spring.js\");\n/* harmony import */ var _lib_lib_collider_collider__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../lib/lib/collider/collider */ \"../lib/lib/collider/collider.js\");\n\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nwindow.Util = _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"];\nvar values = {};\nvar binder = new _lib_lib_binder_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\nvar base_model;\nvar base_instance;\nvar engine;\nvar onoPhy;\nvar col;\nvar line_material = new _lib_engine_o3o_o3o_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].Material();\n\nvar Scene1 = /*#__PURE__*/function (_Obj) {\n  _inherits(Scene1, _Obj);\n\n  var _super = _createSuper(Scene1);\n\n  function Scene1() {\n    var _this;\n\n    _classCallCheck(this, Scene1);\n\n    _this = _super.call(this);\n    _this.a = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec2();\n    _this.p = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3();\n    _this.cameralen = 10;\n    _this.target = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3();\n    _this.instances = [];\n    _this.targetObj = null;\n    base_model = _lib_engine_assetmanager_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"].o3o(\"model/reverse.o3o\");\n    _this.t = 0;\n    engine.autoExposure = false;\n    engine.exposure_level = 0.5;\n    engine.exposure_upper = 1;\n    _this.tsukami_z = 10;\n    _this.bane = new _lib_lib_onophy_spring_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"]();\n    return _this;\n  }\n\n  _createClass(Scene1, [{\n    key: \"create\",\n    value: function create() {\n      pattern = 0;\n      _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].fpsman.setFps(values.fps);\n      ono3d.clear();\n      engine.calcEnvironment();\n      this.a[1] = Math.PI;\n      var camera = engine.camera;\n      camera.p[0] = 0;\n      camera.p[1] = 0;\n      camera.p[2] = this.cameralen;\n      camera.znear = 1;\n      camera.zfar = 100;\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat44.setInit(ono3d.worldMatrix);\n      base_model.scenes[0].setFrame(0); //初期状態セット\n\n      base_instance = base_model.createInstance();\n      base_instance.calcMatrix(0, true);\n      base_instance.objectInstances.forEach(function (e) {\n        if (e.phyObj) {\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat33.mul(e.phyObj.inertiaTensorBase, e.phyObj.inertiaTensorBase, 4);\n        }\n      });\n      var points = base_instance.objectInstances_hash[\"LightProbe\"].getPoints(); //\t\tbase_instance.draw();\n\n      var list = base_model.getCollectionObjectList(\"field\");\n      list.forEach(function (e) {\n        var instance = base_instance.objectInstances_hash[e.name];\n\n        if (instance.object.hide_render) {\n          return;\n        }\n\n        instance.draw();\n      });\n      var shcoefs = engine.calcSHcoefs(points);\n      engine.calcEnvironment(points, shcoefs);\n      onoPhy = engine.onoPhy;\n      base_instance.joinPhyObj(onoPhy);\n      col = new _lib_lib_collider_collider__WEBPACK_IMPORTED_MODULE_16__[\"default\"].Cuboid();\n      col.matrix[0] = 1000;\n      col.matrix[8] = 1000;\n      col.matrix[10] = -10;\n\n      col.callbackFunc = function (col1, col2, pos1, pos2) {\n        var instance = col2.parent.parent;\n        instance.calcMatrix(0, true); //初期状態セット\n      };\n\n      col.refresh();\n      engine.collider.addCollision(col);\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      if (!this.hoge && _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].getLoadingCount() === 0) {\n        this.create();\n        this.hoge = true;\n      }\n\n      if (!base_instance) return;\n\n      if (values.use_custom_material) {\n        base_instance.custom_material = values.custom_material;\n      } else {\n        base_instance.custom_material = null;\n      }\n\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat44.setInit(ono3d.worldMatrix);\n      base_instance.draw();\n    }\n  }, {\n    key: \"move\",\n    value: function move() {\n      if (!base_instance) {\n        return;\n      }\n\n      engine.fps = Number(values.fps);\n      onoPhy = engine.onoPhy;\n\n      if (pattern === 0) {\n        _lib_lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"].special = true;\n        base_instance.calcMatrix(1.0 / globalParam.fps, true);\n        onoPhy.rigidBodies.forEach(function (rb) {\n          var impulse = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3();\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat43.toLSR(rb.location, rb.scale, rb.rotq, rb.matrix);\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(rb.rotV, 0, 0, 0);\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(rb.v, 0, 0, 0);\n          var r = Math.random() * Math.PI * 2;\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(rb.v, Math.sin(r), 0, Math.cos(r));\n          _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.mul(rb.v, rb.v, 0.001); //Vec3.set(rb.rotV\n          //\t,(Math.random()*2-1)\n          //\t,(Math.random()*2-1)\n          //\t,(Math.random()*2-1));\n          //Vec3.mul(rb.rotV,rb.rotV,0.1);\n        });\n        reverse_counter = 0;\n        rigid_bodies_matrix = [];\n        pattern = 1;\n      }\n\n      if (pattern === 1) {\n        for (var i = 0; i < 120; i++) {\n          var matricies = [];\n          onoPhy.calc(1.0 / 60);\n          onoPhy.rigidBodies.forEach(function (rb) {\n            var mat43 = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat43();\n            _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat43.fromLSR(mat43, rb.location, rb.scale, rb.rotq); //Mat43.copy(mat43,rb.matrix);\n\n            matricies.push(mat43);\n          });\n          rigid_bodies_matrix.push(matricies);\n          reverse_counter++;\n        }\n\n        pattern = 2;\n        engine.phygics = false;\n      }\n\n      if (pattern === 2) {\n        if (reverse_counter > 0) {\n          reverse_counter--;\n          var matricies = rigid_bodies_matrix[reverse_counter];\n          var i = 0;\n          onoPhy.rigidBodies.forEach(function (rb) {\n            //Mat43.copy(rb.matrix,matricies[i]);\n            _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat43.toLSR(rb.location, rb.scale, rb.rotq, matricies[i]);\n            i++;\n          });\n        } else {\n          var matricies = rigid_bodies_matrix[0];\n          var i = 0;\n          onoPhy.rigidBodies.forEach(function (rb) {\n            //Mat43.copy(rb.matrix,matricies[i]);\n            _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat43.toLSR(rb.location, rb.scale, rb.rotq, matricies[i]);\n            i++;\n            _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(rb.rotV, 0, 0, 0);\n            _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(rb.v, 0, 0, 0);\n          });\n          pattern = 3;\n          engine.phygics = true;\n          _lib_lib_onophy_onophy_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"].special = false;\n        }\n      }\n\n      if (pattern === 3) {\n        reverse_counter++;\n\n        if (reverse_counter > 120) {\n          pattern = 0;\n        }\n      }\n\n      if (_lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].pressOn && !this.bane.con2) {\n        //クリックされていた場合は視点変更\n        this.a[1] -= (_lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].cursorX - _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].oldcursorX) / engine.WIDTH * 2;\n        this.a[0] -= (_lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].cursorY - _lib_lib_util_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].oldcursorY) / engine.HEIGHT * 2;\n      }\n\n      this.a[0] = Math.min(this.a[0], Math.PI / 2);\n      this.a[0] = Math.max(this.a[0], -Math.PI / 2);\n      this.p[2] = Math.cos(this.a[0]);\n      this.p[1] = -Math.sin(this.a[0]);\n      this.p[0] = -Math.sin(this.a[1]) * this.p[2];\n      this.p[2] = -Math.cos(this.a[1]) * this.p[2];\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.mul(this.p, this.p, this.cameralen);\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.add(this.p, this.p, this.target);\n      var camera = engine.camera;\n      camera.p[0] += (this.p[0] - camera.p[0]) * 0.3;\n      camera.p[1] += (this.p[1] - camera.p[1]) * 0.3;\n      camera.p[2] += (this.p[2] - camera.p[2]) * 0.3; //ターゲット注目\n\n      _lib_engine_engine_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].Camera.homing(camera.a, this.target, camera.p);\n      var light = engine.ono3d.environments[0].sun;\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(light.color, 1, 1, 1);\n      var jiku = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3();\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.set(jiku, 1, 1, 0);\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec3.norm(jiku);\n      _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Mat44.fromRotVector(light.matrix, Math.PI * 0.7, jiku[0], jiku[1], jiku[2]);\n      engine.calcLightMatrix(); //\t\tMat44.dot(light.viewmatrix2,engine.ono3d.projectionMatrix,engine.ono3d.viewMatrix);\n\n      if (base_instance) {\n        base_instance.calcMatrix(1.0 / globalParam.fps, false);\n      }\n    }\n  }]);\n\n  return Scene1;\n}(_lib_engine_obj_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"]);\n\n;\n\nvar Visualizer = /*#__PURE__*/function () {\n  function Visualizer() {\n    _classCallCheck(this, Visualizer);\n\n    this.engine = new _lib_engine_engine_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"]();\n    engine = this.engine;\n  }\n\n  _createClass(Visualizer, [{\n    key: \"main\",\n    value: function main() {\n      var _this2 = this;\n\n      this.engine.userInit = function () {\n        var scene1 = new Scene1();\n\n        _this2.engine.objMan.addObj(scene1);\n\n        window.engine = _this2.engine;\n        window.ono3d = _this2.engine.ono3d;\n        _this2.scene = scene1;\n      };\n\n      this.engine.init(document.getElementById(\"aaa\"), 1024, 576);\n    }\n  }]);\n\n  return Visualizer;\n}();\n\nvalues.openclose = 1;\nvalues.custom_material = new _lib_engine_o3o_o3o_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].Material();\nvalues.custom_material.baseColor = new _lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec4();\n_lib_lib_vector_js__WEBPACK_IMPORTED_MODULE_13__.Vec4.set(values.custom_material.baseColor, 0.5, 0.5, 0.5, 1);\nvalues.custom_material.name_full = \"custom_material\";\nvalues.use_custom_material = false;\nvalues.render = true;\nvalues.physics = true;\nvalues.use_smoothing = false;\nvalues.smoothing = 0;\nvalues.cursor_pos_2d = \"\";\nvalues.cursor_pos_3d = \"\";\nvalues.render = true;\nvalues.fps = 60;\nvar v = new Visualizer();\nv.main();\nwindow.values = values;\nvar colorpicker = new _lib_lib_colorpicker_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\ncolorpicker.init(document.getElementsByClassName(\"colorpicker\"));\nvar colorpickerhdr = new _lib_lib_colorpickerhdr_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\ncolorpickerhdr.init(document.getElementsByClassName(\"colorpickerhdr\"));\nbinder.init(values);\nvar old_physics;\nvar rigid_bodies_matrix = [];\nvar reverse_counter = 0;\nvar pattern = 0;\n\n//# sourceURL=webpack://bc/./src/main.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ })()
;