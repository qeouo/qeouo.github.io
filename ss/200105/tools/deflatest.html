<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>Deflatest</title>
<style>
</style>
</head>
<script type="text/javascript" src="../lib/inherits.js"></script>
<script type="text/javascript" src="../lib/util.js"></script>
<script type="text/javascript" src="../lib/deflate.js"></script>
<script type="text/javascript">
"use strict"
var ctx,canvas;

var demo=function(){
	var output_str="";
	var str = src.value;

	if(str.length===0){
		//ãªã‚“ã‚‚å…¥åŠ›ã•ã‚Œã¦ãªã‹ã£ãŸã‚‰ãªã‚“ã‚‚ã—ãªã„
		output.innerHTML=output_str;
		return;
	}
	output_str+="â†“ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰\n"

	//å…¥åŠ›æ–‡å­—åˆ—ã‚’UTF-8ã«å¤‰æ›
	var utf8array=[];
	var utf8str = unescape(encodeURIComponent(str));
	for(var i=0;i<utf8str.length;i++){
		utf8array.push(utf8str.charCodeAt(i));
	}
	output_str+="UTF8("+utf8array.length+"byte):"+format(utf8array)+"\n";

	//deflateåœ§ç¸®ã‚’è¡Œã†
	Deflate.output_str="";
	var encoded =Deflate.compress(utf8array,0,utf8array.length);

	output_str+=Deflate.output_str;
	Deflate.output_str="";
	output_str+="å…¨éƒ¨åˆã‚ã›ãŸæœ€çµ‚çµæœ("+ (encoded.byteLength)+"byte):\n"+formatBinary(encoded)+"\n";

	//deflateä¼¸é•·ã‚’è¡Œã†
	output_str+="\n\nâ†“ã“ã£ã‹ã‚‰ãƒ‡ã‚³ãƒ¼ãƒ‰\n"
   	var decode = Deflate.expand(encoded);

	output_str+=Deflate.output_str;

	var str ="";
	for(var i=0;i<decode.length;i++){
		str +=String.fromCharCode(decode[i]);
	}
	var utf16str = decodeURIComponent(escape(str));	
	output_str+="å¾©å·çµæœ:"+utf16str+"\n";

	output.innerHTML = output_str;
}
var onloadfunc=function(e){
	var src = document.getElementById("src");
	var output= document.getElementById("output");

	src.addEventListener("input",function(evt){
		demo();
	});
	document.getElementById("comp_mode").addEventListener("change",function(evt){
		demo();
	});

	demo();
}

var format=function(src){
	//
	var result="";
	for(var i=0;i<src.length;i++){
		if(i!==0){
			result+=",";
		}

		if(isNaN(src[i])){
	 		result+="&lt;"+src[i].len.toString(10)+","+src[i].dist.toString(10)+"&gt;";
		}else{
			result+=src[i].toString(10);
		}
	}
	return result;
}
var formatBinary=function(array_buffer){
	var src = new Uint8Array(array_buffer);
	var result="";
	for(var i=0;i<src.length;i++){
		if(i!==0){
			result+=",";
		}
		result+=('00000000' +src[i].toString(2)).slice(-8);
	}
	return result;
}
var formatHuffmans=function(huffmans){
	var result="";
	for(var i=0;i<huffmans.length && i<3 ;i++){
		if(i!==0){
			result+=",";
		}
		result+=('0000000000' +huffmans[i].Code.toString(2)).slice(-huffmans[i].Len);
	}
	return result;
}



</script>

<body onLoad="onloadfunc(event)">

å…ƒãƒ†ã‚­ã‚¹ãƒˆ<input type="text" id ="src" size="128" value="ã†ã‚‰ã«ã‚ã«ã¯ã«ã‚ã«ã‚ã«ã¯ã«ã‚ã«ã‚ã¨ã‚ŠãŒã„ã‚‹ğŸ”ğŸ”ğŸ”ğŸŠğŸ”ğŸŠğŸ”ğŸŠğŸ”ğŸŠ"><br>
åœ§ç¸®ãƒ¢ãƒ¼ãƒ‰<select id="comp_mode">
<option value="0">ç„¡åœ§ç¸®</option>
<option value="1" >å›ºå®šãƒãƒ•ãƒãƒ³ç¬¦å·</option>
<option value="2" selected>ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ•ãƒãƒ³ç¬¦å·</option>
<select>
<div id="output" style="white-space:pre;"><div>
</body>
</html>

